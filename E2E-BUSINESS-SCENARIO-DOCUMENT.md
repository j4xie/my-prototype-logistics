# 白垩纪食品溯源系统 - 完整业务场景说明

> **适用对象**: 团队成员、客户、投资人
> **文档目的**: 说明系统每天怎么跑，谁在用，解决什么问题
> **功能统计**: 28个功能模块 | 831个API | 228个页面 | 7种角色

---

## 目录

1. [系统解决什么问题](#一系统解决什么问题)
2. [谁在用这个系统](#二谁在用这个系统)
3. [多工厂管理场景](#三多工厂管理新开一家厂怎么做)
4. [一天的生产场景](#四一天的生产场景)
5. [供应商与客户管理](#五供应商与客户管理)
6. [产品与标签管理](#六产品与标签管理)
7. [工单与任务管理](#七工单与任务管理)
8. [质检与废弃物处置](#八质检与废弃物处置)
9. [溯源追踪与召回](#九溯源追踪与召回)
10. [AI智能功能](#十ai智能功能)
11. [系统配置与模板](#十一系统配置与模板)
12. [语音与相机集成](#十二语音与相机集成)
13. [审批与权限管理](#十三审批与权限管理)
14. [异常情况处理](#十四异常情况处理)
15. [平台管理员视角](#十五平台管理员视角)
16. [功能完成度](#十六功能完成度)

---

## 一、系统解决什么问题？

### 食品加工厂的痛点

| 痛点 | 传统方式 | 我们的解决方案 |
|------|----------|----------------|
| **原料来源不清** | Excel记录，供应商信息散落各处 | 入库即绑定供应商、批次、效期，扫码可查 |
| **生产过程无记录** | 纸质表单，事后补录，易遗漏 | 实时录入，每个操作自动记录时间和操作人 |
| **质检问题难追溯** | 出了问题翻台账，几天找不到原因 | 3秒溯源，正向反向都能查 |
| **管理决策靠感觉** | 老板问今天产量，得等财务汇总 | 实时看板，AI自动分析成本和效率 |
| **多工厂标准不统一** | 每个厂自己一套，无法复制 | 平台化管理，配置模板一键部署新厂 |
| **任务分配靠喊话** | 口头通知，责任不清，状态不明 | 工单系统，任务可追踪，逾期有预警 |
| **供应商资质过期** | 证照到期无人管，合规风险大 | 自动提醒，资质过期前30天预警 |

---

## 二、谁在用这个系统？

### 七种角色，各司其职

| 角色 | 典型用户 | 主要职责 | 每天用系统做什么 |
|------|----------|----------|------------------|
| **平台管理员** | 集团IT负责人 | 管理所有工厂 | 创建新工厂、分配AI额度、看全局报表 |
| **工厂管理员** | 厂长/运营总监 | 管理单个工厂 | 看生产报表、AI分析、审批重大事项 |
| **车间主管** | 生产车间负责人 | 管理生产线 | 分配任务、监控进度、处理异常 |
| **调度员** | 生产计划员 | 排产调度 | 制定生产计划、安排人员设备、处理紧急订单 |
| **操作员** | 一线生产工人 | 执行生产 | 打卡、领料、记录生产数据、报工完成 |
| **质检员** | 品控人员 | 质量把关 | 抽检产品、记录结果、发起不合格处理 |
| **仓库管理员** | 仓管员 | 物料进出 | 原料入库、成品出库、盘点库存 |

---

## 三、多工厂管理：新开一家厂怎么做？

### 场景：集团要在宁波新开一家海鲜加工厂

#### 第一步：平台管理员创建工厂

平台管理员老王打开系统，进入「平台管理」→「工厂管理」→ 点击「新建工厂」

填写基本信息：
- 工厂名称：宁波海鲜加工厂
- 行业类型：水产加工
- 地区：浙江宁波
- 联系人：张经理 / 138xxxx

系统自动生成工厂编码 `F003`，创建成功。

#### 第二步：AI一键初始化配置

老王选择「AI智能初始化」，输入业务描述：

> "这是一家水产品加工厂，主要生产冷冻带鱼段、鱿鱼圈、虾仁。原料来自舟山渔船直供，需要冷链存储。生产流程包括收货验收、解冻、分切、清洗、速冻、包装。"

AI 3秒内生成：
- 3种产品类型（带鱼段、鱿鱼圈、虾仁）
- 5种原料类型（带鱼、鱿鱼、虾等）
- 转换率配置（1000kg带鱼 → 300kg带鱼段）
- 质检项模板（温度、色泽、异味等）
- 表单模板（入库单、生产记录、出库单）
- 编码规则（批次号、溯源码格式）

老王检查确认后，一键应用。

#### 第三步：应用蓝图模板

如果集团已有成熟工厂，老王可以：
1. 选择「舟山厂蓝图 v2.0」
2. 系统显示蓝图包含的配置项：
   - 12种产品类型
   - 8种原料类型
   - 15个质检项目
   - 5套表单模板
3. 点击「应用到宁波厂」
4. 系统自动复制所有配置

#### 第四步：创建工厂管理员账号

老王在系统里创建账号：
- 用户名：ningbo_admin
- 角色：工厂管理员
- 关联工厂：F003 宁波海鲜加工厂

#### 第五步：工厂上线运营

老王点击「激活工厂」，宁波厂的张经理就可以登录系统，开始创建部门、添加员工、正式投产。

**从创建到上线，整个过程 10 分钟完成。**

---

## 四、一天的生产场景

### 地点：舟山海鲜加工厂（F001）
### 日期：普通工作日

---

### 07:00 - 员工打卡

**场景**：工人们陆续到达工厂

操作员小李打开手机APP，进入「考勤」，点击「上班打卡」。系统自动获取GPS定位，确认在工厂范围内，打卡成功。

屏幕显示：
```
打卡成功
时间：07:02
状态：正常
```

车间主管张主管打开APP，在「部门考勤」里看到：
- 今日应到：16人
- 已到：14人
- 未到：2人（王五、赵六）

张主管给未到的人打电话确认情况。

---

### 07:30 - 原料到货入库

**场景**：供应商送来一车带鱼

仓库管理员老陈收到供应商送货：
- 供应商：舟山远洋渔业
- 货品：冷冻带鱼
- 数量：500公斤
- 温度：-18℃

老陈打开APP「原料入库」：

1. 扫描供应商二维码，自动带出供应商信息
2. 系统自动检查供应商白名单状态：✓ 已认证
3. 选择原料类型：带鱼
4. 输入数量：500kg
5. 拍照记录外观状态（相机自动添加水印和时间戳）
6. 记录到货温度：-18℃
7. 选择存放位置：冷库A-01

点击「确认入库」，系统自动：
- 生成批次号：`MB-F001-20260103-001`（按编码规则自动生成）
- 计算保质期：有效期至2026-04-03
- 建立供应商追溯关联

老陈把批次标签贴在货物上，放入冷库。

**关键价值**：这批原料从此刻起，在系统里有了完整身份——来自哪里、什么时候到、谁收的、存在哪。

---

### 08:00 - 调度员查看今日计划

**场景**：调度员安排今日生产

调度员小王打开APP，进入「今日计划」：

```
┌─────────────────────────────────────────┐
│ 今日生产任务（3个）                      │
├─────────────────────────────────────────┤
│ 1. 冷冻带鱼段 500kg    产线A   08:30开始 │
│ 2. 鱿鱼圈 300kg        产线B   10:00开始 │
│ 3. 虾仁 200kg          产线C   14:00开始 │
├─────────────────────────────────────────┤
│ 资源状态                                 │
│ 设备：3/3 正常    人员：14/16 已到       │
│ 原料：带鱼500kg✓  鱿鱼350kg✓  虾250kg✓  │
└─────────────────────────────────────────┘
```

小王发现有紧急订单需要插入，点击「紧急插单」：
1. 系统显示可用时段（甘特图视图）
2. 选择插入位置：今日14:00
3. 系统自动评估影响：虾仁批次延后2小时
4. 提交审批请求→生产经理审批通过
5. 计划自动调整

一切就绪，小王确认计划可以正常执行。

---

### 08:30 - 开始生产

**场景**：产线A开始加工带鱼

操作员小李领到任务：加工500kg带鱼段

**第一步：领料**

小李在APP点击「开始生产」，系统自动提示：
- 需要原料：带鱼 150kg（按转换率计算）
- 推荐批次：MB-F001-20260103-001（今早刚到的货，FIFO先进先出）

小李确认领料，系统自动：
- 从原料库存扣减150kg
- 建立批次关联（原料批次 → 生产批次）
- 记录消耗时间和操作人

**第二步：加工**

小李按照SOP操作：解冻 → 分切 → 清洗 → 速冻

每完成一个阶段，在APP里点击记录：
```
08:30 解冻开始
09:00 解冻完成，分切开始
09:45 分切完成，清洗开始
10:15 清洗完成，速冻开始
11:00 速冻完成
```

**（可选）语音录入**：小李双手忙着分切，用语音说"分切完成，开始清洗"，系统自动识别并记录。

**关键价值**：每个操作节点都有记录，知道谁在什么时间做了什么。

---

### 10:00 - 质检员抽检

**场景**：质检员进行过程抽检

质检员小张接到系统提醒：产线A的带鱼段批次需要抽检

小张来到产线，抽取样品，按照检验项逐一检查：

| 检验项 | 标准 | 实测值 | 结果 |
|--------|------|--------|------|
| 中心温度 | ≤-18℃ | -20℃ | ✓ 合格 |
| 色泽 | 银白色有光泽 | 正常 | ✓ 合格 |
| 异味 | 无异味 | 无 | ✓ 合格 |
| 规格 | 8-10cm | 9cm | ✓ 合格 |

小张在APP录入检验结果，拍照留证（相机自动添加时间水印），点击「检验合格」。

批次状态更新为：质检通过。

**如果检验不合格呢？**

假设发现色泽异常，小张选择「检验不合格」，系统会：
1. 冻结该批次，不允许继续生产或出库
2. 自动通知车间主管（APP推送+通知中心）
3. 要求提交处置申请（报废/返工/降级）
4. 进入审批流程，需主管审批后才能执行

---

### 11:30 - 批次完成入库

**场景**：这批带鱼段加工完成

操作员小李完成所有工序，在APP点击「完成生产」：
- 计划产量：500kg
- 实际产量：485kg
- 损耗：15kg（分切损耗）
- 损耗率：3%

系统自动：
1. 生成生产批次号：`PB-F001-20260103-001`
2. 生成溯源码和追溯标签
3. 更新成品库存
4. 记录完成时间和操作人
5. 建立完整的批次关联链

**标签打印**：

小李点击「打印标签」：
- 选择标签类型：二维码标签
- 打印数量：50张
- 系统记录：标签状态→已打印

小李将标签贴在包装箱上，每贴一个点击「确认贴标」，标签状态更新为「已贴标」。

送入成品冷库。

---

### 14:00 - 成品出库

**场景**：客户订单发货

仓库管理员老陈收到发货通知：
- 客户：上海生鲜超市
- 商品：冷冻带鱼段 200kg
- 批次：PB-F001-20260103-001

老陈在APP「成品出库」：
1. 扫描批次码，确认商品信息
2. 核对数量：200kg
3. 记录车辆信息：沪A12345，司机李师傅
4. 拍照记录装车状态
5. 点击「确认发货」

系统生成出货单，状态变为「已发货」。

**关键价值**：这批货去了哪个客户，用的是哪批原料，全程可追溯。

---

### 16:00 - 车间主管看报表

**场景**：张主管了解今日生产情况

张主管打开APP「生产报表」：

```
┌─────────────────────────────────────────┐
│ 今日生产概览                            │
├──────────┬──────────┬──────────┬────────┤
│ 计划批次 │ 已完成   │ 完成率   │ 合格率 │
│    3     │    2     │   67%    │  100%  │
├──────────┴──────────┴──────────┴────────┤
│ 产量统计                                │
│ 计划：1000kg   实际：785kg   达成：79%  │
├─────────────────────────────────────────┤
│ 在制品：虾仁 200kg（产线C进行中）        │
└─────────────────────────────────────────┘
```

张主管还可以查看：
- 设备报表：设备运行时间、故障次数、OEE效率
- 质量趋势：合格率曲线、不合格品分布
- 人员工时：各员工今日工时统计

---

### 17:00 - 老板看AI分析

**场景**：厂长王总了解运营状况

王总打开APP「AI分析」，选择「今日成本分析」：

```
┌─────────────────────────────────────────┐
│ AI 成本分析报告                          │
├─────────────────────────────────────────┤
│ 今日总成本：¥28,500                      │
│                                         │
│ 成本构成：                               │
│ • 原料成本：¥18,000（63%）               │
│ • 人工成本：¥6,500（23%）                │
│ • 设备能耗：¥3,000（11%）                │
│ • 其他：¥1,000（3%）                     │
├─────────────────────────────────────────┤
│ AI 建议：                                │
│ 1. 带鱼段损耗率3%略高于标准2.5%，         │
│    建议检查分切环节的刀具状态             │
│ 2. 下午班次人均产出低于上午15%，          │
│    建议调整休息时间安排                   │
└─────────────────────────────────────────┘
```

王总也可以直接问AI：
> "这个月产量最高的产品是什么？"

AI回答：
> "本月产量最高的是冷冻带鱼段，共生产12.5吨，占总产量的45%。较上月增长8%，主要是上海生鲜超市订单增加带动。"

---

### 18:00 - 下班打卡

员工们陆续下班，在APP点击「下班打卡」。

系统自动计算今日工时：
- 小李：10小时（含2小时加班）
- 小张：8小时（正常班）

HR月底可以直接导出考勤报表用于薪资计算。

---

## 五、供应商与客户管理

### 5.1 供应商准入流程

**场景**：新供应商"福建渔业公司"想要合作

采购员小周在系统发起「供应商准入申请」：

1. **资料提交**
   - 营业执照（上传扫描件）
   - 食品经营许可证
   - SC生产许可证
   - 近期检验报告

2. **系统自动检查**
   - 证照有效期是否在有效期内
   - 经营范围是否匹配

3. **审批流程**
   - 采购主管审核资质
   - 质量经理确认产品质量
   - 工厂管理员最终批准

4. **准入生效**
   - 供应商进入白名单
   - 设置供应商等级：B级（新供应商）
   - 开放原料入库权限

**资质到期预警**：

供应商的食品许可证还有25天到期，系统自动：
- 发送提醒给采购员
- 在供应商卡片显示黄色警告
- 到期后自动锁定该供应商的入库权限

**供应商绩效评估**：

每月自动统计：
- 交货及时率：95%
- 质量合格率：98%
- 价格竞争力：中等

根据绩效调整供应商等级：A/B/C

---

### 5.2 客户管理

**场景**：管理客户档案和订单历史

销售员小刘在系统录入新客户：
- 客户名称：上海生鲜连锁
- 联系人：王经理
- 配送地址：上海市浦东新区xxx
- 开票信息：xxx有限公司

**客户画像自动生成**：

系统根据历史订单自动分析：
```
┌─────────────────────────────────────────┐
│ 客户画像：上海生鲜连锁                   │
├─────────────────────────────────────────┤
│ 客户等级：VIP（年交易额50万+）           │
│ 主要采购：冷冻带鱼段(60%)、虾仁(25%)     │
│ 采购周期：每周二、周五                   │
│ 平均订单：8000元/单                      │
│ 合作时长：2年3个月                       │
└─────────────────────────────────────────┘
```

**批量操作**：
- Excel导入客户名单
- 批量更新客户标签
- 导出客户数据用于营销分析

---

## 六、产品与标签管理

### 6.1 产品档案管理

**场景**：创建新产品"冷冻带鱼段500g"

产品经理在系统「产品管理」：

1. **基础信息**
   - 产品名称：冷冻带鱼段
   - 产品编码：PT-F001-003
   - 类别：冷冻水产
   - 规格：500g/袋
   - 保质期：90天

2. **加工阶段配置**
   ```
   解冻(30min) → 分切(45min) → 清洗(30min) → 速冻(60min) → 包装(15min)
   ```

3. **排产参数**
   - 标准产能：100kg/小时
   - 换线时间：20分钟
   - 最小批量：50kg

4. **转换率关联**
   - 带鱼 → 带鱼段：转换率30%（1000kg带鱼产300kg带鱼段）

产品创建后，状态为「草稿」，审核通过后变为「启用」。

---

### 6.2 标签与追溯码

**场景**：生成和管理产品追溯标签

生产批次完成后，系统自动生成追溯码：

```
追溯码：TRACE-F001-20260103-00123
```

标签生命周期：
```
生成 → 已打印 → 已贴标 → 消费者扫码验真
         ↓
       作废（打印错误时）
```

**标签管理看板**：
```
┌─────────────────────────────────────────┐
│ 今日标签统计                            │
├─────────────────────────────────────────┤
│ 已生成：500    已打印：480              │
│ 已贴标：475    已作废：5                │
│ 7天内过期：20  已过期：0                │
└─────────────────────────────────────────┘
```

**消费者扫码验真**：

消费者用手机扫描产品二维码，显示：
```
┌─────────────────────────────────────────┐
│ 产品溯源信息                            │
├─────────────────────────────────────────┤
│ 产品：冷冻带鱼段 500g                   │
│ 生产日期：2026-01-03                    │
│ 保质期至：2026-04-03                    │
│ 生产工厂：舟山海鲜加工厂                │
│ 批次号：PB-F001-20260103-001            │
│ 质检状态：合格 ✓                        │
└─────────────────────────────────────────┘
```

---

## 七、工单与任务管理

### 7.1 日常工单分配

**场景**：车间主管分配今日任务

张主管在「工单管理」创建工单：

**工单1：设备维护**
- 标题：冷库A-01压缩机保养
- 优先级：高
- 负责人：设备工程师老李
- 截止时间：今日16:00

**工单2：产线清洁**
- 标题：产线A日终清洁
- 优先级：中
- 负责人：清洁组小王
- 截止时间：今日18:00

工单状态流转：
```
待处理 → 进行中 → 已完成
           ↓
         已取消
```

**我的工单视图**：

老李打开APP，看到自己的待办工单：
```
┌─────────────────────────────────────────┐
│ 我的工单（2个待处理）                    │
├─────────────────────────────────────────┤
│ 🔴 冷库A-01压缩机保养    截止：16:00    │
│ 🟡 冷库B-02温度检查      截止：明日10:00│
└─────────────────────────────────────────┘
```

点击「开始」，工单状态变为「进行中」。

完成后点击「完成」，填写完成备注，状态变为「已完成」。

**逾期预警**：

超过截止时间的工单：
- 工单显示红色标记
- 自动通知车间主管
- 统计入逾期率指标

---

## 八、质检与废弃物处置

### 8.1 不合格品处置流程

**场景**：发现某批鱿鱼圈色泽异常

质检员小张检验后：

1. **记录不合格**
   - 选择：检验不合格
   - 不合格原因：色泽异常
   - 拍照留证（3张照片）

2. **提交处置申请**
   - 处置建议：报废
   - 数量：50kg
   - 预估损失：¥2,500

3. **审批流程**
   - 系统自动判断审批链：金额<5000，车间主管审批
   - 推送通知给张主管

4. **主管审批**
   张主管查看：
   - 不合格详情
   - 现场照片
   - 处置建议

   选择：同意报废

5. **执行处置**
   - 冻结批次库存
   - 生成废弃物记录
   - 通知仓库执行报废

---

### 8.2 废弃物管理

**场景**：生产过程产生的废料处理

**类型1：生产废料（可回收）**

分切环节产生鱼骨、鱼头：
- 登记为「可回收废料」
- 类型：生产边角料
- 数量：30kg
- 联系回收商处置
- 录入回收金额：¥150

**类型2：不合格品销毁**

报废的鱿鱼圈：
- 登记为「销毁处置」
- 拍照存档（销毁前、销毁中、销毁后）
- 负责人签字确认
- 生成销毁证明

**废弃物统计报表**：
```
┌─────────────────────────────────────────┐
│ 本月废弃物统计                          │
├─────────────────────────────────────────┤
│ 生产废料：500kg   回收价值：¥2,500      │
│ 不合格销毁：80kg  损失金额：¥4,000      │
│ 过期原料：20kg    损失金额：¥800        │
│ 废弃物总率：2.3%（低于行业标准3%）      │
└─────────────────────────────────────────┘
```

---

## 九、溯源追踪与召回

### 9.1 批次关联追溯

**核心能力**：任何一个批次，都能追溯到完整的上下游关系

**正向追溯**（原料→成品→客户）：

发现某批原料有问题，想知道影响范围：

输入：原料批次 `MB-F001-20260101-001`

系统显示：
```
原料批次：MB-F001-20260101-001（带鱼500kg）
    ↓
使用于生产批次：
├─ PB-F001-20260101-001（带鱼段 150kg）
│   └─ 出货给：上海生鲜超市 100kg
│   └─ 库存：50kg
├─ PB-F001-20260101-002（带鱼段 100kg）
│   └─ 出货给：杭州餐饮公司 100kg
└─ 剩余库存：50kg
```

**反向追溯**（成品→原料→供应商）：

客户投诉某批产品有问题：

输入：出货单号或生产批次 `PB-F001-20260101-001`

系统显示：
```
溯源结果：PB-F001-20260101-001

原料来源：
└─ 带鱼 150kg，批次 MB-F001-20260101-001
   └─ 供应商：舟山远洋渔业
   └─ 到货日期：2026-01-01
   └─ 验收人：老陈
   └─ 入库质检：合格

生产过程：
└─ 开始时间：08:30
└─ 完成时间：11:30
└─ 操作员：小李
└─ 各阶段质检：全部合格

出货去向：
└─ 客户：上海生鲜超市
└─ 出货时间：14:00
└─ 数量：100kg
└─ 运输车辆：沪A12345
```

### 9.2 召回流程

**场景**：需要召回问题批次

1. **确定召回范围**
   - 输入问题原料批次
   - 系统自动计算影响的所有成品批次
   - 列出所有受影响的客户

2. **启动召回**
   - 生成召回通知
   - 标记相关批次为「召回中」
   - 冻结相关库存

3. **客户通知**
   - 系统导出受影响客户清单
   - 联系方式、出货数量、出货日期

4. **召回记录**
   - 跟踪召回进度
   - 记录回收数量
   - 处置结果存档

---

## 十、AI智能功能

### 10.1 AI智能分析

**场景**：厂长想了解运营状况

**批次成本分析**：

输入批次号，AI自动汇总：
```
批次 PB-F001-20260103-001 成本分析

原料成本：¥1,500（带鱼150kg × ¥10/kg）
人工成本：¥280（3人 × 3小时 × ¥30/小时）
设备能耗：¥120
包装材料：¥100
─────────────────
总成本：¥2,000
单位成本：¥4.12/kg
毛利率：38%

AI建议：
该批次成本正常，损耗率2.8%略低于平均3%，
建议总结该批次操作经验推广至其他班组。
```

**智能对话问答**：

用户提问：
> "上周产量最高的产品是什么？"

AI回答：
> "上周产量最高的是冷冻带鱼段，共生产3.2吨，占总产量的48%。主要集中在周二和周四，均为大客户订单。相比上上周增长12%。"

---

### 10.2 AI意图识别与执行

**场景**：用自然语言操作系统

用户输入：
> "给原材料入库表单添加一个运输温度字段，数值类型，范围-30到30度"

系统处理流程：
1. **意图识别**：识别为「表单字段添加」意图
2. **参数提取**：表单=原材料入库，字段=运输温度，类型=数值，范围=-30~30
3. **预览确认**：显示将要添加的字段配置
4. **用户确认**：确认执行
5. **自动执行**：更新表单模板，添加新字段

**候选意图选择**：

当AI不确定用户意图时：
```
┌─────────────────────────────────────────┐
│ 请确认您的意图                          │
├─────────────────────────────────────────┤
│ 1. 表单字段添加 (置信度 85%) ✓推荐      │
│ 2. 数据查询 (置信度 42%)                │
│ 3. 其他                                 │
└─────────────────────────────────────────┘
```

用户选择后，系统执行对应操作。

---

### 10.3 AI数据操作

**场景**：用自然语言修改业务数据

用户输入：
> "把生产计划PLAN-001的计划产量改成200"

系统处理：
1. 识别为「数据修改」意图
2. 解析：实体=生产计划，目标=PLAN-001，字段=计划产量，值=200
3. 查询数据库找到对应记录
4. 显示修改预览：计划产量 150 → 200
5. 用户确认后执行更新

**支持的数据类型**：
- 产品类型信息
- 生产计划数据
- 加工批次数据
- 原材料批次数据

---

### 10.4 AI意图分析与学习

**场景**：持续优化AI识别准确率

**管理员查看意图分析报告**：

```
┌─────────────────────────────────────────┐
│ 本周意图识别分析                        │
├─────────────────────────────────────────┤
│ 识别成功率：92%（目标：90%）✓           │
│ LLM调用率：15%（优化目标：<20%）✓       │
│ 平均响应时间：0.3秒                     │
├─────────────────────────────────────────┤
│ 失败模式分析：                          │
│ 1. "查产量"被误识别为"修改产量" - 5次   │
│ 2. 新词"出货单"未被识别 - 3次           │
├─────────────────────────────────────────┤
│ AI优化建议：                            │
│ 1. 为"查询产量"意图添加关键词"看产量"   │
│ 2. 将"出货单"添加到出货管理意图         │
│ [一键应用] [忽略]                       │
└─────────────────────────────────────────┘
```

**关键词自动学习**：

1. 用户说"看看今天出了多少货"
2. 规则匹配失败，调用LLM识别
3. LLM返回"出货查询"意图，置信度95%
4. 系统自动将"出了多少货"作为新关键词
5. 下次遇到类似表达直接匹配

**关键词效果追踪**：
- 使用Wilson Score算法评估关键词效果
- 效果差的关键词自动清理（效果分<0.3）
- 优质关键词从工厂级晋升为全局级（3+工厂采用且效果>0.8）

---

## 十一、系统配置与模板

### 11.1 系统配置管理

**场景**：工厂管理员调整系统参数

**工厂级配置**：
- 工作时间：08:00-18:00
- 班次设置：早班/中班/晚班
- 打卡范围：工厂100米内
- 质检标准：温度阈值-18℃±3℃

**配置变更审计**：

所有配置修改自动记录：
```
时间：2026-01-03 14:30
操作人：张经理
修改项：质检温度阈值
修改前：-18℃±2℃
修改后：-18℃±3℃
原因：适配新冷库设备
```

支持一键回滚到历史版本。

---

### 11.2 表单模板设计

**场景**：自定义原料入库表单

在「模板管理」进入表单设计器：

1. **拖拽字段**
   - 文本框：原料名称
   - 下拉框：供应商（关联供应商白名单）
   - 数字框：数量、温度
   - 拍照组件：外观照片
   - 日期选择：到货日期

2. **设置验证规则**
   - 温度必须在-25~-15之间
   - 数量必须>0
   - 照片至少拍1张

3. **保存为模板**
   - 模板名称：海鲜原料入库表单
   - 适用工厂：可选择

**模板包管理**：

将一组相关模板打包：
- 水产加工模板包 v2.0
  - 原料入库表单
  - 生产记录表单
  - 质检记录表单
  - 出库表单

新工厂可一键安装整个模板包。

---

### 11.3 编码规则配置

**场景**：自定义批次号格式

**原料批次编码规则**：
```
模板：MB-{FACTORY}-{YYYYMMDD}-{SEQ:3}
示例：MB-F001-20260103-001
```

**生产批次编码规则**：
```
模板：PB-{PRODUCT_CODE}-{YYYYMMDD}-{SEQ:4}
示例：PB-DY01-20260103-0001
```

**追溯码规则**：
```
模板：TRACE-{FACTORY}-{YYYYMMDD}-{SEQ:5}
示例：TRACE-F001-20260103-00001
```

预览功能：修改规则前可看到生成效果。

---

## 十二、语音与相机集成

### 12.1 语音录入

**场景**：操作员双手被占用时录入数据

小李正在分切带鱼，双手无法操作手机。

戴上耳麦，按住语音按钮说：
> "收货200公斤带鱼，温度零下18度，合格"

系统自动识别并填充表单：
- 货品：带鱼
- 数量：200kg
- 温度：-18℃
- 状态：合格

小李确认后，数据自动提交。

**语音指令**：
> "开始生产批次001"
> "分切完成，开始清洗"
> "批次001生产完成，实际产量485公斤"

**适用场景**：
- 生产线数据录入
- 质检结果报告
- 库存盘点

---

### 12.2 相机拍照取证

**场景**：质检拍照存档

质检员小张发现异常，需要拍照：

1. 打开APP相机功能
2. 拍照（系统自动添加）：
   - 时间水印：2026-01-03 10:15
   - GPS定位：舟山加工厂车间A
   - 操作人：质检员张三
3. 照片自动关联到当前批次
4. 存入证据链，不可删改

**照片用途**：
- 原料入库外观记录
- 质检异常取证
- 设备故障现场记录
- 废弃物销毁存档

---

## 十三、审批与权限管理

### 13.1 审批流程配置

**场景**：配置不同业务的审批链

**质检处置审批链**：
```
金额 < 5000：质检员 → 车间主管（1人审批）
金额 ≥ 5000：质检员 → 车间主管 → 工厂经理（2级审批）
```

**配置变更审批链**：
```
一般配置：操作员 → 技术主管
关键配置：操作员 → 技术主管 → 工厂经理
```

**紧急插单审批链**：
```
调度员 → 生产经理（48小时无响应自动升级给工厂经理）
```

### 13.2 白名单管理

**场景**：控制供应商和设备访问

**供应商白名单**：
- 只有白名单内的供应商可以入库原料
- 入库时自动检查供应商状态

**设备白名单**：
- 只有注册的设备可以登录系统
- 防止未授权设备访问

**IP白名单**：
- 敏感API只允许特定IP访问
- 用于接口安全控制

---

## 十四、异常情况处理

### 14.1 设备故障告警

**情况**：下午2点，冷库温度传感器检测到异常

系统自动：
1. 生成告警：「冷库A温度异常：-12℃（标准：-18℃±3℃）」
2. 推送通知给车间主管和设备负责人
3. 告警页面显示红色警示

张主管收到推送，立即：
1. 点击「确认告警」（表示已知晓）
2. 创建维修工单，指派给设备维护人员
3. 维护人员到场检修
4. 修复后点击「告警已处理」

整个过程有完整记录，月底可以统计设备故障率。

---

### 14.2 客户投诉追溯

**情况**：客户反馈某批带鱼段有异味

客服记录投诉后，质量负责人开始追溯：

1. 输入出货单号或批次号
2. 系统显示完整溯源链
3. 定位问题：原料环节温度波动
4. 联系供应商核实

**从投诉到定位问题，3分钟内完成。**

---

## 十五、平台管理员视角

### 场景：集团总部监控所有工厂

平台管理员老王在总部办公室，打开系统「平台管理」：

**全局看板**：
```
┌─────────────────────────────────────────────────┐
│ 白垩纪食品集团 - 运营总览                         │
├─────────────────────────────────────────────────┤
│ 工厂数量：5家    活跃工厂：4家                    │
│ 总员工数：156人  今日在岗：142人                  │
│ 今日总产量：12.5吨  总产值：¥125万               │
├─────────────────────────────────────────────────┤
│ 各工厂产量排名：                                 │
│ 1. 舟山厂   3.2吨   ████████████                │
│ 2. 宁波厂   2.8吨   ██████████                  │
│ 3. 温州厂   2.5吨   █████████                   │
│ 4. 台州厂   2.2吨   ████████                    │
│ 5. 上海厂   1.8吨   ██████（维护中）             │
├─────────────────────────────────────────────────┤
│ 告警：舟山厂有1条设备告警待处理                   │
└─────────────────────────────────────────────────┘
```

老王可以：
- 点进任一工厂查看详细数据
- 调整各工厂的AI使用额度
- 查看跨工厂对比报表
- 下发统一配置模板
- 管理蓝图版本，推送升级

---

## 十六、功能完成度

### 已经能用的功能（85%）

| 模块 | 功能 | 状态 |
|------|------|------|
| **多工厂管理** | 创建、配置、激活工厂 | ✅ 可用 |
| **AI一键初始化** | 自然语言生成配置 | ✅ 可用 |
| **蓝图模板** | 模板包管理与版本控制 | ✅ 可用 |
| **原料入库** | 扫码、拍照、批次记录 | ✅ 可用 |
| **生产记录** | 领料、加工、完成 | ✅ 可用 |
| **质检管理** | 检验、不合格处置 | ✅ 可用 |
| **成品出库** | 发货记录、物流跟踪 | ✅ 可用 |
| **溯源追踪** | 正向反向追溯 | ✅ 可用 |
| **批次关联** | 原料→成品关联 | ✅ 可用 |
| **标签管理** | 生成、打印、贴标 | ✅ 可用 |
| **员工考勤** | 打卡、工时统计 | ✅ 可用 |
| **AI分析** | 成本分析、智能对话 | ✅ 可用 |
| **AI意图** | 意图识别、自动执行 | ✅ 可用 |
| **报表看板** | 生产、质量、设备报表 | ✅ 可用 |
| **供应商管理** | 准入、资质、绩效 | ✅ 可用 |
| **客户管理** | 档案、订单历史 | ✅ 可用 |
| **工单管理** | 创建、分配、追踪 | ✅ 可用 |
| **废弃物管理** | 登记、审批、统计 | ✅ 可用 |
| **设备管理** | 台账、维护、告警 | ✅ 可用 |
| **审批流程** | 多级审批配置 | ✅ 可用 |
| **编码规则** | 自定义批次号格式 | ✅ 可用 |
| **表单模板** | 可视化设计器 | ✅ 可用 |
| **白名单管理** | 供应商、设备白名单 | ✅ 可用 |
| **通知管理** | 消息推送、已读跟踪 | ✅ 可用 |

### 还需要完善的功能（15%）

| 功能 | 状态 | 对业务的影响 |
|------|------|-------------|
| 消费者扫码验真 | 🔶 待完善 | 消费者扫产品二维码暂时信息不完整 |
| 手机推送通知 | 🔶 待完善 | 告警通知需要打开APP才能看到 |
| 语音录入 | 🔶 待完善 | 接口已就绪，前端集成中 |
| 相机水印 | 🔶 待完善 | 拍照功能可用，水印功能开发中 |
| AI智能排产 | 🔶 待完善 | 排产建议可用，全自动排产待优化 |
| 批量导入数据 | 🔶 待完善 | Excel导入部分模块支持 |

---

## 附录：系统核心价值

1. **全程可追溯**：从原料到成品到客户，每一步都有记录
2. **实时可视化**：老板随时看数据，不用等汇报
3. **AI赋能决策**：成本分析、问题诊断、自然语言操作
4. **多工厂扩展**：新开一家厂，10分钟上线
5. **移动端优先**：工人、主管、老板都在手机上操作
6. **合规有保障**：满足食品安全法规的追溯和审计要求

### 适用场景

- 食品加工厂（水产、肉类、果蔬）
- 需要质量追溯的制造企业
- 多工厂连锁管理的集团公司

---

**文档版本**: v2.0
**最后更新**: 2026-01-03
**功能统计**: 28个模块 | 831个API | 228个页面
