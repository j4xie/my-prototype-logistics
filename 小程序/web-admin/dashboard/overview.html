<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ€»è§ˆä»ªè¡¨æ¿ - ç™½å©çºªé£Ÿå“æº¯æºç®¡ç†åå°</title>

  <!-- CSS -->
  <link rel="stylesheet" href="../../assets/css/variables.css">
  <link rel="stylesheet" href="../../assets/css/common.css">
  <link rel="stylesheet" href="../../assets/css/desktop.css?v=1765970920">

  <style>
    /* å…³é”®æŒ‡æ ‡å¡ç‰‡ */
    .metrics-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: var(--spacing-lg);
      margin-bottom: var(--spacing-2xl);
    }

    .metric-card {
      background: var(--bg-white);
      border-radius: var(--radius-lg);
      padding: var(--spacing-2xl);
      box-shadow: var(--shadow-sm);
      transition: all var(--transition-base);
      cursor: pointer;
    }

    .metric-card:hover {
      box-shadow: var(--shadow-md);
      transform: translateY(-2px);
    }

    .metric-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: var(--spacing-lg);
    }

    .metric-icon {
      width: 48px;
      height: 48px;
      border-radius: var(--radius-md);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: var(--font-size-2xl);
    }

    .metric-icon.primary {
      background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
    }

    .metric-icon.success {
      background: rgba(82, 196, 26, 0.1);
    }

    .metric-icon.warning {
      background: rgba(250, 173, 20, 0.1);
    }

    .metric-icon.danger {
      background: rgba(245, 34, 45, 0.1);
    }

    .metric-trend {
      display: flex;
      align-items: center;
      gap: var(--spacing-xs);
      font-size: var(--font-size-sm);
    }

    .metric-trend.up {
      color: var(--success-color);
    }

    .metric-trend.down {
      color: var(--error-color);
    }

    .metric-value {
      font-size: var(--font-size-3xl);
      font-weight: var(--font-weight-bold);
      color: var(--text-primary);
      margin-bottom: var(--spacing-xs);
    }

    .metric-label {
      font-size: var(--font-size-base);
      color: var(--text-secondary);
    }

    /* å›¾è¡¨åŒºåŸŸ */
    .charts-section {
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: var(--spacing-lg);
      margin-bottom: var(--spacing-2xl);
    }

    .chart-card {
      background: var(--bg-white);
      border-radius: var(--radius-lg);
      padding: var(--spacing-2xl);
      box-shadow: var(--shadow-sm);
    }

    .chart-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: var(--spacing-2xl);
      padding-bottom: var(--spacing-md);
      border-bottom: 1px solid var(--border-color);
    }

    .chart-title {
      font-size: var(--font-size-lg);
      font-weight: var(--font-weight-bold);
      color: var(--text-primary);
    }

    .chart-filters {
      display: flex;
      gap: var(--spacing-sm);
    }

    .chart-filter-btn {
      padding: var(--spacing-xs) var(--spacing-md);
      background: var(--bg-gray);
      border: none;
      border-radius: var(--radius-md);
      font-size: var(--font-size-sm);
      color: var(--text-secondary);
      cursor: pointer;
      transition: all var(--transition-base);
    }

    .chart-filter-btn.active {
      background: var(--primary-color);
      color: var(--text-inverse);
    }

    .chart-placeholder {
      height: 300px;
      background: linear-gradient(180deg, rgba(102, 126, 234, 0.05) 0%, rgba(118, 75, 162, 0.02) 100%);
      border-radius: var(--radius-md);
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--text-tertiary);
      font-size: var(--font-size-sm);
    }

    /* å¾…åŠäº‹é¡¹ */
    .todos-section {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: var(--spacing-lg);
    }

    .todos-card {
      background: var(--bg-white);
      border-radius: var(--radius-lg);
      padding: var(--spacing-2xl);
      box-shadow: var(--shadow-sm);
    }

    .todos-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: var(--spacing-lg);
    }

    .todos-title {
      font-size: var(--font-size-lg);
      font-weight: var(--font-weight-bold);
      color: var(--text-primary);
    }

    .todos-badge {
      padding: var(--spacing-xs) var(--spacing-md);
      background: var(--error-color);
      color: var(--text-inverse);
      border-radius: var(--radius-pill);
      font-size: var(--font-size-xs);
      font-weight: var(--font-weight-semibold);
    }

    .todo-item {
      padding: var(--spacing-md);
      border-bottom: 1px solid var(--border-color);
      cursor: pointer;
      transition: background var(--transition-base);
    }

    .todo-item:last-child {
      border-bottom: none;
    }

    .todo-item:hover {
      background: var(--bg-gray);
    }

    .todo-item-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: var(--spacing-xs);
    }

    .todo-item-title {
      font-size: var(--font-size-base);
      font-weight: var(--font-weight-medium);
      color: var(--text-primary);
    }

    .todo-item-time {
      font-size: var(--font-size-xs);
      color: var(--text-tertiary);
    }

    .todo-item-desc {
      font-size: var(--font-size-sm);
      color: var(--text-secondary);
    }

    /* æ´»åŠ¨åˆ—è¡¨ */
    .activity-item {
      display: flex;
      gap: var(--spacing-md);
      padding: var(--spacing-md);
      border-bottom: 1px solid var(--border-color);
    }

    .activity-item:last-child {
      border-bottom: none;
    }

    .activity-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: var(--primary-gradient);
      color: var(--text-inverse);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: var(--font-weight-bold);
      flex-shrink: 0;
    }

    .activity-content {
      flex: 1;
    }

    .activity-text {
      font-size: var(--font-size-sm);
      color: var(--text-primary);
      margin-bottom: var(--spacing-xs);
    }

    .activity-time {
      font-size: var(--font-size-xs);
      color: var(--text-tertiary);
    }
  </style>
</head>
<body>
  <!-- #region agent log - body start -->
  <script>
    fetch('http://127.0.0.1:7243/ingest/b952d593-1b00-40e1-9ef1-1bf6099c2ae0',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'overview.html:body:start',message:'Body tag started',data:{url: window.location.href},timestamp:Date.now(),sessionId:'debug-session',hypothesisId:'C'})}).catch(()=>{});
  </script>
  <!-- #endregion -->

  <!-- æ¡Œé¢ç«¯å®¹å™¨ -->
  <div class="desktop-container">
    <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
    <div class="desktop-header">
      <div class="desktop-header-left">
        <div class="desktop-logo">ğŸ± ç™½å©çºªé£Ÿå“æº¯æº</div>
      </div>
      <div class="desktop-header-center">
        <div class="desktop-search">
          <input type="text" placeholder="æœç´¢å•†æˆ·ã€äº§å“ã€è®¢å•..." class="desktop-search-input">
          <button class="desktop-search-btn"></button>
        </div>
      </div>
      <div class="desktop-header-right">
        <div class="desktop-header-icon" onclick="Utils.showToast('é€šçŸ¥åŠŸèƒ½å¼€å‘ä¸­', 'info')">
          <span>ğŸ””</span>
          <span class="desktop-header-badge">5</span>
        </div>
        <div class="desktop-header-icon" onclick="Utils.showToast('æ¶ˆæ¯åŠŸèƒ½å¼€å‘ä¸­', 'info')">
          <span>âœ‰ï¸</span>
          <span class="desktop-header-badge">12</span>
        </div>
        <div class="desktop-user-menu">
          <div class="desktop-user-avatar"></div>
          <div class="desktop-user-info">
            <div class="desktop-user-name">ç®¡ç†å‘˜</div>
            <div class="desktop-user-role">è¶…çº§ç®¡ç†å‘˜</div>
          </div>
        </div>
      </div>
    </div>

    <!-- ä¾§è¾¹æ  (New Structure) -->
    <div class="desktop-sidebar">
      <div class="sidebar-header">
        <div class="sidebar-logo">ğŸ¢ ç™½å©çºªç®¡ç†åå°</div>
      </div>
      <nav class="sidebar-nav">
        <a href="../dashboard/overview.html" class="nav-item active">
          <span class="icon">ğŸ“Š</span>
          <span class="text">æ§åˆ¶å°</span>
        </a>
        
        <div class="nav-group">
          <div class="nav-group-title" onclick="toggleSidebarGroup(this)">
            <div class="title-wrap">
                <span class="icon">ğŸ“¦</span>
                <span class="text">å•†å“ä¸è®¢å•</span>
            </div>
            <span class="arrow">â–¼</span>
          </div>
          <div class="nav-sub-menu">
            <a href="../product-management/list.html" class="nav-sub-item">å•†å“ç®¡ç†</a>
            <a href="../orders/list.html" class="nav-sub-item">è®¢å•ç®¡ç†</a>
            <a href="../traceability/batch-list.html" class="nav-sub-item">æº¯æºç®¡ç†</a>
          </div>
        </div>

        <div class="nav-group">
          <div class="nav-group-title" onclick="toggleSidebarGroup(this)">
            <div class="title-wrap">
                <span class="icon">ğŸª</span>
                <span class="text">è¿è¥ä¸å†…å®¹</span>
            </div>
            <span class="arrow">â–¼</span>
          </div>
          <div class="nav-sub-menu">
            <a href="../merchant/list.html" class="nav-sub-item">å•†æˆ·ç®¡ç†</a>
            <a href="../user-management/list.html" class="nav-sub-item">ç”¨æˆ·ç®¡ç†</a>
            <a href="../content-control/review-queue.html" class="nav-sub-item">å†…å®¹å®¡æ ¸</a>
            <a href="../traffic-ad/ad-slots.html" class="nav-sub-item">å¹¿å‘ŠæŠ•æ”¾</a>
          </div>
        </div>

        <div class="nav-group">
          <div class="nav-group-title" onclick="toggleSidebarGroup(this)">
            <div class="title-wrap">
                <span class="icon">ğŸ¤–</span>
                <span class="text">AIä¸è®¾ç½®</span>
            </div>
            <span class="arrow">â–¼</span>
          </div>
          <div class="nav-sub-menu">
            <a href="../ai-knowledge/knowledge-base.html" class="nav-sub-item">AIçŸ¥è¯†åº“</a>
            <a href="../analytics/traffic-stats.html" class="nav-sub-item">æ•°æ®åˆ†æ</a>
          </div>
        </div>
      </nav>
    </div>

    <!-- ä¸»å†…å®¹åŒº -->
    <div class="desktop-main">
      <div class="desktop-content">
        <!-- é¡µé¢æ ‡é¢˜ -->
        <div class="desktop-page-header">
          <div>
            <h1 class="desktop-page-title">æ€»è§ˆä»ªè¡¨æ¿</h1>
            <p class="desktop-page-subtitle">æ¬¢è¿å›æ¥ï¼Œè¿™æ˜¯ä»Šå¤©çš„æ•°æ®æ¦‚è§ˆ</p>
          </div>
          <div class="desktop-page-actions">
            <button class="btn btn-default" onclick="loadDashboardData()">ğŸ”„ åˆ·æ–°æ•°æ®</button>
            <button class="btn btn-primary" onclick="Utils.showToast('å¯¼å‡ºåŠŸèƒ½å¼€å‘ä¸­', 'info')">ğŸ“¥ å¯¼å‡ºæŠ¥è¡¨</button>
          </div>
        </div>

        <!-- å…³é”®æŒ‡æ ‡ -->
        <div class="metrics-grid">
          <div class="metric-card" onclick="navigateTo('../merchant/list.html')">
            <div class="metric-header">
              <div class="metric-icon primary">ğŸ¢</div>
              <div class="metric-trend up">
                <span>â†‘</span>
                <span>+12%</span>
              </div>
            </div>
            <div class="metric-value" id="merchantCount">--</div>
            <div class="metric-label">å…¥é©»å•†æˆ·</div>
          </div>

          <div class="metric-card" onclick="navigateTo('../product-management/list.html')">
            <div class="metric-header">
              <div class="metric-icon success">ğŸ“¦</div>
              <div class="metric-trend up">
                <span>â†‘</span>
                <span>+8%</span>
              </div>
            </div>
            <div class="metric-value" id="productCount">--</div>
            <div class="metric-label">åœ¨å”®äº§å“</div>
          </div>

          <div class="metric-card">
            <div class="metric-header">
              <div class="metric-icon warning">ğŸ’°</div>
              <div class="metric-trend up">
                <span>â†‘</span>
                <span>+24%</span>
              </div>
            </div>
            <div class="metric-value" id="gmvTotal">--</div>
            <div class="metric-label">æœ¬æœˆGMV</div>
          </div>

          <div class="metric-card">
            <div class="metric-header">
              <div class="metric-icon danger">ğŸ“‹</div>
              <div class="metric-trend down">
                <span>â†“</span>
                <span>-5%</span>
              </div>
            </div>
            <div class="metric-value" id="orderCount">--</div>
            <div class="metric-label">æœ¬æœˆè®¢å•</div>
          </div>
        </div>

        <!-- å›¾è¡¨ -->
        <div class="charts-section">
          <!-- è®¢å•è¶‹åŠ¿ -->
          <div class="chart-card">
            <div class="chart-header">
              <div class="chart-title">è®¢å•è¶‹åŠ¿</div>
              <div class="chart-filters">
                <button class="chart-filter-btn active">7å¤©</button>
                <button class="chart-filter-btn">30å¤©</button>
                <button class="chart-filter-btn">90å¤©</button>
              </div>
            </div>
            <div class="chart-placeholder">
              ğŸ“ˆ è®¢å•è¶‹åŠ¿å›¾ (æ¨¡æ‹Ÿå›¾è¡¨ - å®é™…åº”ä½¿ç”¨ Chart.js æˆ– ECharts)
            </div>
          </div>

          <!-- äº§å“åˆ†ç±»å æ¯” -->
          <div class="chart-card">
            <div class="chart-header">
              <div class="chart-title">äº§å“åˆ†ç±»å æ¯”</div>
            </div>
            <div class="chart-placeholder">
               é¥¼å›¾ (æ¨¡æ‹Ÿå›¾è¡¨ - å®é™…åº”ä½¿ç”¨ Chart.js æˆ– ECharts)
            </div>
          </div>
        </div>

        <!-- å¾…åŠäº‹é¡¹å’Œæœ€è¿‘æ´»åŠ¨ -->
        <div class="todos-section">
          <!-- å¾…åŠäº‹é¡¹ -->
          <div class="todos-card">
            <div class="todos-header">
              <div class="todos-title">å¾…åŠäº‹é¡¹</div>
              <div class="todos-badge">8</div>
            </div>
            <div id="todosContainer">
              <div class="todo-item" onclick="navigateTo('../merchant/review.html')">
                <div class="todo-item-header">
                  <div class="todo-item-title">å•†æˆ·å®¡æ ¸</div>
                  <div class="todo-item-time">2å°æ—¶å‰</div>
                </div>
                <div class="todo-item-desc">5ä¸ªå•†æˆ·å¾…å®¡æ ¸</div>
              </div>
              <div class="todo-item" onclick="navigateTo('../content-control/review-queue.html')">
                <div class="todo-item-header">
                  <div class="todo-item-title">å†…å®¹å®¡æ ¸</div>
                  <div class="todo-item-time">5å°æ—¶å‰</div>
                </div>
                <div class="todo-item-desc">12æ¡äº§å“æ–‡æ¡ˆå¾…å®¡æ ¸</div>
              </div>
              <div class="todo-item" onclick="navigateTo('../product-management/list.html')">
                <div class="todo-item-header">
                  <div class="todo-item-title">äº§å“ä¸Šæ¶</div>
                  <div class="todo-item-time">1å¤©å‰</div>
                </div>
                <div class="todo-item-desc">8ä¸ªæ–°äº§å“å¾…ä¸Šæ¶</div>
              </div>
              <div class="todo-item" onclick="Utils.showToast('ç³»ç»Ÿç»´æŠ¤åŠŸèƒ½å¼€å‘ä¸­', 'info')">
                <div class="todo-item-header">
                  <div class="todo-item-title">ç³»ç»Ÿç»´æŠ¤</div>
                  <div class="todo-item-time">2å¤©å‰</div>
                </div>
                <div class="todo-item-desc">å®šæœŸæ•°æ®å¤‡ä»½</div>
              </div>
            </div>
          </div>

          <!-- æœ€è¿‘æ´»åŠ¨ -->
          <div class="todos-card">
            <div class="todos-header">
              <div class="todos-title">æœ€è¿‘æ´»åŠ¨</div>
            </div>
            <div id="activityContainer">
              <div class="activity-item">
                <div class="activity-avatar">å¼ </div>
                <div class="activity-content">
                  <div class="activity-text"><strong>å¼ ä¸‰</strong> å®¡æ ¸é€šè¿‡äº†å•†æˆ· <strong>ä¸Šæµ·é¤é¥®æœ‰é™å…¬å¸</strong></div>
                  <div class="activity-time">10åˆ†é’Ÿå‰</div>
                </div>
              </div>
              <div class="activity-item">
                <div class="activity-avatar">æ</div>
                <div class="activity-content">
                  <div class="activity-text"><strong>æå››</strong> ä¸Šæ¶äº†äº§å“ <strong>é€Ÿå†»é±¼æ’</strong></div>
                  <div class="activity-time">1å°æ—¶å‰</div>
                </div>
              </div>
              <div class="activity-item">
                <div class="activity-avatar">ç‹</div>
                <div class="activity-content">
                  <div class="activity-text"><strong>ç‹äº”</strong> æ›´æ–°äº†çŸ¥è¯†åº“æ–‡æ¡£ <strong>æº¯æºæ“ä½œæŒ‡å—</strong></div>
                  <div class="activity-time">3å°æ—¶å‰</div>
                </div>
              </div>
              <div class="activity-item">
                <div class="activity-avatar">èµµ</div>
                <div class="activity-content">
                  <div class="activity-text"><strong>èµµå…­</strong> å¤„ç†äº†å†…å®¹å®¡æ ¸ <strong>12æ¡äº§å“æ–‡æ¡ˆ</strong></div>
                  <div class="activity-time">5å°æ—¶å‰</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- JavaScript with cache busting -->
  <script src="../../assets/js/mockData.js?v=1765970807"></script>
  <script src="../../assets/js/mockAPI.js?v=1765970807"></script>
  <script src="../../assets/js/utils.js?v=1765970711"></script>

  <script>
    // #region agent log - script start
    fetch('http://127.0.0.1:7243/ingest/b952d593-1b00-40e1-9ef1-1bf6099c2ae0',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'overview.html:script:init',message:'Script started',data:{MockDBExists: typeof MockDB !== 'undefined', MockAPIExists: typeof MockAPI !== 'undefined', UtilsExists: typeof Utils !== 'undefined'},timestamp:Date.now(),sessionId:'debug-session',hypothesisId:'B'})}).catch(()=>{});
    // #endregion

    // ==================== åˆå§‹åŒ– ====================
    document.addEventListener('DOMContentLoaded', () => {
      // #region agent log - DOM ready
      fetch('http://127.0.0.1:7243/ingest/b952d593-1b00-40e1-9ef1-1bf6099c2ae0',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'overview.html:DOMContentLoaded',message:'DOM Content Loaded',data:{},timestamp:Date.now(),sessionId:'debug-session',hypothesisId:'A'})}).catch(()=>{});
      // #endregion
      loadDashboardData();
    });

    // ==================== åŠ è½½ä»ªè¡¨æ¿æ•°æ® ====================
    async function loadDashboardData() {
      try {
        // #region agent log
        fetch('http://127.0.0.1:7243/ingest/b952d593-1b00-40e1-9ef1-1bf6099c2ae0',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'overview.html:loadDashboardData:start',message:'Starting data load',data:{},timestamp:Date.now(),sessionId:'debug-session',hypothesisId:'1'})}).catch(()=>{});
        // #endregion

        // Changed endpoint to admin.statistics
        const result = await MockAPI.request('admin.statistics', {
          type: 'overview',
          skipError: true
        });

        // #region agent log
        fetch('http://127.0.0.1:7243/ingest/b952d593-1b00-40e1-9ef1-1bf6099c2ae0',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'overview.html:loadDashboardData:result',message:'API Result',data:{result},timestamp:Date.now(),sessionId:'debug-session',hypothesisId:'2'})}).catch(()=>{});
        // #endregion

        if (result && result.data) {
            // æ›´æ–°å…³é”®æŒ‡æ ‡
            document.getElementById('merchantCount').textContent = result.data.merchants.total.toLocaleString();
            document.getElementById('productCount').textContent = result.data.products.total.toLocaleString();
            document.getElementById('gmvTotal').textContent = `Â¥${(result.data.orders.gmv / 1000000).toFixed(1)}M`;
            document.getElementById('orderCount').textContent = result.data.orders.total.toLocaleString();
            
            Utils.showToast('æ•°æ®å·²åˆ·æ–°', 'success');
        } else {
             throw new Error("No data returned");
        }

      } catch (error) {
        // #region agent log
        fetch('http://127.0.0.1:7243/ingest/b952d593-1b00-40e1-9ef1-1bf6099c2ae0',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'overview.html:loadDashboardData:error',message:'Data load error',data:{error: error.message, stack: error.stack},timestamp:Date.now(),sessionId:'debug-session',hypothesisId:'1'})}).catch(()=>{});
        // #endregion
        console.error('åŠ è½½ä»ªè¡¨æ¿æ•°æ®å¤±è´¥:', error);
        Utils.showToast('åŠ è½½æ•°æ®å¤±è´¥: ' + error.message, 'error');
      }
    }

    // ==================== å¯¼èˆªå‡½æ•° ====================
    function navigateTo(path) {
      window.location.href = path;
    }

    // Removed inline toggleSidebarGroup as it's now in utils.js attached to window

    // ==================== å›¾è¡¨ç­›é€‰ ====================
    document.querySelectorAll('.chart-filter-btn').forEach(btn => {
      btn.addEventListener('click', (e) => {
        // ç§»é™¤æ‰€æœ‰æ¿€æ´»çŠ¶æ€
        e.target.parentElement.querySelectorAll('.chart-filter-btn').forEach(b => {
          b.classList.remove('active');
        });
        // æ¿€æ´»å½“å‰æŒ‰é’®
        e.target.classList.add('active');
        // é‡æ–°åŠ è½½å›¾è¡¨æ•°æ®
        Utils.showToast(`åˆ‡æ¢åˆ°${e.target.textContent}è§†å›¾`, 'info');
      });
    });
  </script>
</body>
</html>
