<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>çŸ¥è¯†åº“ç®¡ç† - ç™½å©çºªé£Ÿå“æº¯æºç®¡ç†åå°</title>

  <!-- CSS -->
  <link rel="stylesheet" href="../../assets/css/variables.css">
  <link rel="stylesheet" href="../../assets/css/common.css">
  <link rel="stylesheet" href="../../assets/css/desktop.css">

  <style>
    /* ä¸¤æ å¸ƒå±€ */
    .knowledge-layout {
      display: grid;
      grid-template-columns: 280px 1fr;
      gap: var(--spacing-lg);
      align-items: start;
    }

    /* åˆ†ç±»æ ‘ */
    .category-panel {
      background: var(--bg-white);
      border-radius: var(--radius-md);
      padding: var(--spacing-lg);
    }

    .category-title {
      font-size: var(--font-size-base);
      font-weight: var(--font-weight-semibold);
      color: var(--text-primary);
      margin-bottom: var(--spacing-md);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .category-tree {
      display: flex;
      flex-direction: column;
      gap: var(--spacing-xs);
    }

    .category-item {
      padding: var(--spacing-sm) var(--spacing-md);
      border-radius: var(--radius-sm);
      cursor: pointer;
      transition: all var(--transition-base);
      display: flex;
      align-items: center;
      gap: var(--spacing-sm);
      font-size: var(--font-size-sm);
      color: var(--text-secondary);
    }

    .category-item:hover {
      background: var(--bg-gray);
    }

    .category-item.active {
      background: rgba(102, 126, 234, 0.1);
      color: var(--primary-color);
      font-weight: var(--font-weight-medium);
    }

    .category-icon {
      font-size: var(--font-size-base);
    }

    .category-count {
      margin-left: auto;
      padding: 2px 6px;
      background: var(--bg-gray);
      border-radius: var(--radius-pill);
      font-size: var(--font-size-xs);
    }

    .category-item.active .category-count {
      background: var(--primary-color);
      color: var(--text-inverse);
    }

    /* æ–‡æ¡£åˆ—è¡¨åŒºåŸŸ */
    .docs-panel {
      background: var(--bg-white);
      border-radius: var(--radius-md);
      overflow: hidden;
    }

    .docs-header {
      padding: var(--spacing-lg);
      border-bottom: 1px solid var(--border-color);
      display: flex;
      gap: var(--spacing-md);
      align-items: center;
      flex-wrap: wrap;
    }

    .search-box {
      flex: 1;
      min-width: 300px;
      position: relative;
    }

    .search-input {
      width: 100%;
      padding: var(--spacing-sm) var(--spacing-md) var(--spacing-sm) 40px;
      border: 1px solid var(--border-color);
      border-radius: var(--radius-pill);
      font-size: var(--font-size-sm);
      outline: none;
      transition: border-color var(--transition-base);
    }

    .search-input:focus {
      border-color: var(--primary-color);
    }

    .search-icon {
      position: absolute;
      left: var(--spacing-md);
      top: 50%;
      transform: translateY(-50%);
      color: var(--text-tertiary);
    }

    /* æ–‡æ¡£è¡¨æ ¼ */
    .docs-table {
      width: 100%;
      border-collapse: collapse;
    }

    .docs-table thead {
      background: var(--bg-gray);
    }

    .docs-table th {
      padding: var(--spacing-md) var(--spacing-lg);
      text-align: left;
      font-size: var(--font-size-sm);
      font-weight: var(--font-weight-semibold);
      color: var(--text-secondary);
      border-bottom: 1px solid var(--border-color);
    }

    .docs-table td {
      padding: var(--spacing-md) var(--spacing-lg);
      border-bottom: 1px solid var(--border-color);
      font-size: var(--font-size-sm);
      color: var(--text-primary);
    }

    .docs-table tbody tr {
      transition: background var(--transition-base);
    }

    .docs-table tbody tr:hover {
      background: var(--bg-gray);
    }

    /* æ–‡æ¡£ä¿¡æ¯ */
    .doc-title {
      font-weight: var(--font-weight-medium);
      color: var(--text-primary);
      margin-bottom: var(--spacing-xs);
    }

    .doc-meta {
      font-size: var(--font-size-xs);
      color: var(--text-tertiary);
      display: flex;
      gap: var(--spacing-sm);
    }

    /* æ–‡æ¡£ç±»å‹å›¾æ ‡ */
    .doc-type-icon {
      width: 36px;
      height: 36px;
      border-radius: var(--radius-sm);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: var(--font-size-lg);
      background: var(--bg-gray);
    }

    .doc-type-icon.pdf {
      background: rgba(245, 34, 45, 0.1);
      color: var(--error-color);
    }

    .doc-type-icon.word {
      background: rgba(24, 144, 255, 0.1);
      color: var(--info-color);
    }

    .doc-type-icon.excel {
      background: rgba(82, 196, 26, 0.1);
      color: var(--success-color);
    }

    .doc-type-icon.txt {
      background: rgba(250, 173, 20, 0.1);
      color: var(--warning-color);
    }

    /* ç‰ˆæœ¬æ ‡ç­¾ */
    .version-badge {
      display: inline-block;
      padding: 2px var(--spacing-xs);
      background: var(--bg-gray);
      border-radius: var(--radius-sm);
      font-size: var(--font-size-xs);
      color: var(--text-secondary);
    }

    .version-badge.latest {
      background: rgba(82, 196, 26, 0.1);
      color: var(--success-color);
    }

    /* çŠ¶æ€å¾½ç«  */
    .status-badge {
      display: inline-block;
      padding: 4px var(--spacing-sm);
      border-radius: var(--radius-pill);
      font-size: var(--font-size-xs);
      font-weight: var(--font-weight-medium);
    }

    .status-badge.published {
      background: rgba(82, 196, 26, 0.1);
      color: var(--success-color);
    }

    .status-badge.draft {
      background: rgba(0, 0, 0, 0.06);
      color: var(--text-tertiary);
    }

    /* æ“ä½œæŒ‰é’® */
    .doc-actions {
      display: flex;
      gap: var(--spacing-xs);
    }

    .doc-action-btn {
      padding: 4px var(--spacing-sm);
      border: none;
      background: none;
      color: var(--primary-color);
      font-size: var(--font-size-sm);
      cursor: pointer;
      transition: all var(--transition-base);
    }

    .doc-action-btn:hover {
      text-decoration: underline;
    }

    .doc-action-btn.danger {
      color: var(--error-color);
    }

    /* ä¸Šä¼ åŒºåŸŸ */
    .upload-modal {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: var(--z-index-modal);
    }

    .upload-modal.active {
      display: flex;
    }

    .upload-dialog {
      background: var(--bg-white);
      border-radius: var(--radius-md);
      padding: var(--spacing-2xl);
      max-width: 600px;
      width: 90%;
      max-height: 80vh;
      overflow-y: auto;
    }

    .upload-header {
      font-size: var(--font-size-xl);
      font-weight: var(--font-weight-bold);
      color: var(--text-primary);
      margin-bottom: var(--spacing-lg);
    }

    .upload-area {
      border: 2px dashed var(--border-color);
      border-radius: var(--radius-md);
      padding: var(--spacing-3xl);
      text-align: center;
      cursor: pointer;
      transition: all var(--transition-base);
      margin-bottom: var(--spacing-lg);
    }

    .upload-area:hover,
    .upload-area.dragging {
      border-color: var(--primary-color);
      background: rgba(102, 126, 234, 0.05);
    }

    .upload-icon {
      font-size: var(--font-size-4xl);
      margin-bottom: var(--spacing-md);
    }

    .upload-text {
      font-size: var(--font-size-base);
      color: var(--text-secondary);
      margin-bottom: var(--spacing-xs);
    }

    .upload-hint {
      font-size: var(--font-size-sm);
      color: var(--text-tertiary);
    }

    .upload-actions {
      display: flex;
      gap: var(--spacing-md);
      justify-content: flex-end;
    }

    /* ç»Ÿè®¡å¡ç‰‡ */
    .stats-cards {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: var(--spacing-md);
      margin-bottom: var(--spacing-lg);
    }

    .stat-card {
      background: var(--bg-white);
      border-radius: var(--radius-md);
      padding: var(--spacing-lg);
      text-align: center;
    }

    .stat-value {
      font-size: var(--font-size-3xl);
      font-weight: var(--font-weight-bold);
      color: var(--primary-color);
      margin-bottom: var(--spacing-xs);
    }

    .stat-label {
      font-size: var(--font-size-sm);
      color: var(--text-tertiary);
    }
  </style>
</head>
<body>
  <div class="desktop-container">
    <!-- ä¾§è¾¹æ  -->
    <div class="desktop-sidebar">
      <div class="sidebar-header">
        <div class="sidebar-logo">ğŸ¢ ç™½å©çºªç®¡ç†åå°</div>
      </div>

      <nav class="sidebar-nav">
        <a href="../dashboard/overview.html" class="nav-item">
          <span class="nav-icon"></span>
          <span class="nav-label">æ€»è§ˆä»ªè¡¨æ¿</span>
        </a>

        <div class="nav-group">
          <div class="nav-group-title">å•†æˆ·ç®¡ç†</div>
          <a href="../merchant/list.html" class="nav-item">
            <span class="nav-icon"></span>
            <span class="nav-label">å•†æˆ·åˆ—è¡¨</span>
          </a>
          <a href="../merchant/review.html" class="nav-item">
            <span class="nav-icon"></span>
            <span class="nav-label">å•†æˆ·å®¡æ ¸</span>
          </a>
        </div>

        <div class="nav-group">
          <div class="nav-group-title">äº§å“ç®¡ç†</div>
          <a href="../product-management/list.html" class="nav-item">
            <span class="nav-icon"></span>
            <span class="nav-label">äº§å“åˆ—è¡¨</span>
          </a>
          <a href="../product-management/create.html" class="nav-item">
            <span class="nav-icon">â•</span>
            <span class="nav-label">æ–°å»ºäº§å“</span>
          </a>
          <a href="../product-management/price-config.html" class="nav-item">
            <span class="nav-icon"></span>
            <span class="nav-label">ä»·æ ¼é…ç½®</span>
          </a>
        </div>

        <div class="nav-group">
          <div class="nav-group-title">å†…å®¹ç®¡ç†</div>
          <a href="../content-control/review-queue.html" class="nav-item">
            <span class="nav-icon"></span>
            <span class="nav-label">å†…å®¹å®¡æ ¸</span>
          </a>
        </div>

        <div class="nav-group">
          <div class="nav-group-title">AIçŸ¥è¯†åº“</div>
          <a href="knowledge-base.html" class="nav-item active">
            <span class="nav-icon"></span>
            <span class="nav-label">çŸ¥è¯†åº“ç®¡ç†</span>
          </a>
        </div>
      </nav>

      <div class="sidebar-footer">
        <div class="user-profile">
          <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Admin" alt="å¤´åƒ" class="user-avatar">
          <div class="user-info">
            <div class="user-name">ç®¡ç†å‘˜</div>
            <div class="user-role">Platform Admin</div>
          </div>
        </div>
      </div>
    </div>

    <!-- ä¸»å†…å®¹åŒº -->
    <div class="desktop-main">
      <!-- é¡¶éƒ¨æ  -->
      <div class="desktop-header">
        <div class="header-title">AIçŸ¥è¯†åº“ç®¡ç†</div>
        <div class="header-actions">
          <button class="btn btn-default" onclick="Utils.showToast('é€šçŸ¥åŠŸèƒ½å¼€å‘ä¸­', 'info')">
            ğŸ”” é€šçŸ¥
          </button>
          <button class="btn btn-default" onclick="Utils.showToast('è®¾ç½®åŠŸèƒ½å¼€å‘ä¸­', 'info')">
             è®¾ç½®
          </button>
        </div>
      </div>

      <!-- é¢åŒ…å±‘ -->
      <div class="breadcrumb">
        <a href="../dashboard/overview.html">é¦–é¡µ</a>
        <span class="breadcrumb-separator">/</span>
        <span>AIçŸ¥è¯†åº“</span>
        <span class="breadcrumb-separator">/</span>
        <span class="breadcrumb-current">çŸ¥è¯†åº“ç®¡ç†</span>
      </div>

      <!-- å†…å®¹åŒºåŸŸ -->
      <div class="desktop-content">
        <!-- ç»Ÿè®¡å¡ç‰‡ -->
        <div class="stats-cards">
          <div class="stat-card">
            <div class="stat-value" id="totalDocs">28</div>
            <div class="stat-label">æ€»æ–‡æ¡£æ•°</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="publishedDocs">24</div>
            <div class="stat-label">å·²å‘å¸ƒ</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="draftDocs">4</div>
            <div class="stat-label">è‰ç¨¿</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="totalCategories">6</div>
            <div class="stat-label">åˆ†ç±»æ•°</div>
          </div>
        </div>

        <!-- ä¸¤æ å¸ƒå±€ -->
        <div class="knowledge-layout">
          <!-- å·¦ä¾§ï¼šåˆ†ç±»æ ‘ -->
          <div class="category-panel">
            <div class="category-title">
              åˆ†ç±»
              <button class="btn btn-sm btn-link" onclick="Utils.showToast('åˆ†ç±»ç®¡ç†åŠŸèƒ½å¼€å‘ä¸­', 'info')">
                
              </button>
            </div>

            <div class="category-tree" id="categoryTree">
              <!-- åˆ†ç±»å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
            </div>
          </div>

          <!-- å³ä¾§ï¼šæ–‡æ¡£åˆ—è¡¨ -->
          <div class="docs-panel">
            <div class="docs-header">
              <div class="search-box">
                <span class="search-icon"></span>
                <input
                  type="text"
                  class="search-input"
                  id="searchInput"
                  placeholder="æœç´¢æ–‡æ¡£åç§°æˆ–å†…å®¹..."
                  oninput="searchDocs()"
                >
              </div>

              <button class="btn btn-primary" onclick="openUploadModal()">
                â• ä¸Šä¼ æ–‡æ¡£
              </button>
            </div>

            <table class="docs-table">
              <thead>
                <tr>
                  <th style="width: 50px;"></th>
                  <th>æ–‡æ¡£åç§°</th>
                  <th style="width: 100px;">åˆ†ç±»</th>
                  <th style="width: 100px;">ç‰ˆæœ¬</th>
                  <th style="width: 100px;">çŠ¶æ€</th>
                  <th style="width: 150px;">æ›´æ–°æ—¶é—´</th>
                  <th style="width: 200px;">æ“ä½œ</th>
                </tr>
              </thead>
              <tbody id="docsTableBody">
                <!-- è¡¨æ ¼è¡Œå°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ä¸Šä¼ æ–‡æ¡£æ¨¡æ€æ¡† -->
  <div class="upload-modal" id="uploadModal">
    <div class="upload-dialog">
      <div class="upload-header">ä¸Šä¼ æ–‡æ¡£åˆ°çŸ¥è¯†åº“</div>

      <div class="form-group">
        <label class="form-label required">é€‰æ‹©åˆ†ç±»</label>
        <select class="form-control" id="uploadCategory">
          <option value="">è¯·é€‰æ‹©åˆ†ç±»</option>
          <option value="product">äº§å“ç›¸å…³</option>
          <option value="quality">è´¨æ£€æ ‡å‡†</option>
          <option value="traceability">æº¯æºæµç¨‹</option>
          <option value="pricing">ä»·æ ¼æ”¿ç­–</option>
          <option value="faq">å¸¸è§é—®é¢˜</option>
          <option value="policy">å¹³å°æ”¿ç­–</option>
        </select>
      </div>

      <div class="upload-area" id="uploadArea" onclick="triggerFileUpload()">
        <div class="upload-icon"></div>
        <div class="upload-text">ç‚¹å‡»æˆ–æ‹–æ‹½æ–‡ä»¶åˆ°æ­¤åŒºåŸŸä¸Šä¼ </div>
        <div class="upload-hint">æ”¯æŒ PDFã€Wordã€Excelã€TXT ç­‰æ ¼å¼ï¼Œå•ä¸ªæ–‡ä»¶ä¸è¶…è¿‡ 10MB</div>
      </div>

      <input
        type="file"
        id="fileInput"
        accept=".pdf,.doc,.docx,.xls,.xlsx,.txt"
        multiple
        style="display: none;"
        onchange="handleFileSelect(event)"
      >

      <div class="upload-actions">
        <button class="btn btn-default" onclick="closeUploadModal()">
          å–æ¶ˆ
        </button>
        <button class="btn btn-primary" onclick="uploadFiles()">
          å¼€å§‹ä¸Šä¼ 
        </button>
      </div>
    </div>
  </div>

  <!-- JavaScript -->
  <script src="../../assets/js/mockData.js"></script>
  <script src="../../assets/js/utils.js"></script>

  <script>
    // ==================== å…¨å±€çŠ¶æ€ ====================
    let currentCategory = 'all';
    let selectedFiles = [];

    // MockçŸ¥è¯†åº“æ•°æ®
    const knowledgeBase = [
      {
        id: 1,
        name: 'äº§å“æº¯æºæŒ‡å—.pdf',
        type: 'pdf',
        category: 'traceability',
        version: 'v2.1',
        status: 'published',
        updateTime: new Date(Date.now() - 2 * 24 * 60 * 60 * 1000).toISOString()
      },
      {
        id: 2,
        name: 'è´¨æ£€æ ‡å‡†æ–‡æ¡£.docx',
        type: 'word',
        category: 'quality',
        version: 'v1.5',
        status: 'published',
        updateTime: new Date(Date.now() - 5 * 24 * 60 * 60 * 1000).toISOString()
      },
      {
        id: 3,
        name: 'é˜¶æ¢¯å®šä»·FAQ.xlsx',
        type: 'excel',
        category: 'pricing',
        version: 'v1.0',
        status: 'published',
        updateTime: new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toISOString()
      },
      {
        id: 4,
        name: 'å¹³å°ä½¿ç”¨æ‰‹å†Œ.pdf',
        type: 'pdf',
        category: 'faq',
        version: 'v3.0',
        status: 'draft',
        updateTime: new Date(Date.now() - 1 * 24 * 60 * 60 * 1000).toISOString()
      },
      {
        id: 5,
        name: 'äº§å“ä»‹ç»æ¨¡æ¿.txt',
        type: 'txt',
        category: 'product',
        version: 'v1.2',
        status: 'published',
        updateTime: new Date(Date.now() - 10 * 24 * 60 * 60 * 1000).toISOString()
      }
    ];

    const categories = [
      { id: 'all', name: 'å…¨éƒ¨æ–‡æ¡£', icon: '', count: 28 },
      { id: 'product', name: 'äº§å“ç›¸å…³', icon: '', count: 8 },
      { id: 'quality', name: 'è´¨æ£€æ ‡å‡†', icon: '', count: 5 },
      { id: 'traceability', name: 'æº¯æºæµç¨‹', icon: '', count: 6 },
      { id: 'pricing', name: 'ä»·æ ¼æ”¿ç­–', icon: '', count: 4 },
      { id: 'faq', name: 'å¸¸è§é—®é¢˜', icon: '', count: 3 },
      { id: 'policy', name: 'å¹³å°æ”¿ç­–', icon: '', count: 2 }
    ];

    // ==================== åˆå§‹åŒ– ====================
    document.addEventListener('DOMContentLoaded', () => {
      renderCategories();
      renderDocs();
      setupDragAndDrop();
    });

    // ==================== æ¸²æŸ“åˆ†ç±»æ ‘ ====================
    function renderCategories() {
      const categoryTree = document.getElementById('categoryTree');

      categoryTree.innerHTML = categories.map(cat => `
        <div
          class="category-item ${cat.id === currentCategory ? 'active' : ''}"
          onclick="selectCategory('${cat.id}')"
        >
          <span class="category-icon">${cat.icon}</span>
          <span>${cat.name}</span>
          <span class="category-count">${cat.count}</span>
        </div>
      `).join('');
    }

    // ==================== é€‰æ‹©åˆ†ç±» ====================
    function selectCategory(categoryId) {
      currentCategory = categoryId;
      renderCategories();
      renderDocs();
    }

    // ==================== æ¸²æŸ“æ–‡æ¡£åˆ—è¡¨ ====================
    function renderDocs() {
      const tbody = document.getElementById('docsTableBody');

      let filteredDocs = knowledgeBase;

      // åˆ†ç±»ç­›é€‰
      if (currentCategory !== 'all') {
        filteredDocs = filteredDocs.filter(doc => doc.category === currentCategory);
      }

      // æœç´¢ç­›é€‰
      const keyword = document.getElementById('searchInput').value.toLowerCase();
      if (keyword) {
        filteredDocs = filteredDocs.filter(doc =>
          doc.name.toLowerCase().includes(keyword)
        );
      }

      if (filteredDocs.length === 0) {
        tbody.innerHTML = `
          <tr>
            <td colspan="7" style="text-align: center; padding: var(--spacing-3xl); color: var(--text-tertiary);">
              æš‚æ— æ–‡æ¡£
            </td>
          </tr>
        `;
        return;
      }

      tbody.innerHTML = filteredDocs.map(doc => {
        const typeIcons = {
          pdf: 'ğŸ“„',
          word: 'ğŸ“˜',
          excel: '',
          txt: ''
        };

        const categoryNames = {
          product: 'äº§å“ç›¸å…³',
          quality: 'è´¨æ£€æ ‡å‡†',
          traceability: 'æº¯æºæµç¨‹',
          pricing: 'ä»·æ ¼æ”¿ç­–',
          faq: 'å¸¸è§é—®é¢˜',
          policy: 'å¹³å°æ”¿ç­–'
        };

        return `
          <tr>
            <td>
              <div class="doc-type-icon ${doc.type}">
                ${typeIcons[doc.type] || 'ğŸ“„'}
              </div>
            </td>
            <td>
              <div class="doc-title">${doc.name}</div>
              <div class="doc-meta">
                <span>ID: ${doc.id}</span>
              </div>
            </td>
            <td>${categoryNames[doc.category] || doc.category}</td>
            <td>
              <span class="version-badge latest">${doc.version}</span>
            </td>
            <td>
              <span class="status-badge ${doc.status}">
                ${doc.status === 'published' ? 'å·²å‘å¸ƒ' : 'è‰ç¨¿'}
              </span>
            </td>
            <td>${Utils.formatDate(doc.updateTime, 'YYYY-MM-DD HH:mm')}</td>
            <td>
              <div class="doc-actions">
                <button class="doc-action-btn" onclick="viewDoc(${doc.id})">
                  æŸ¥çœ‹
                </button>
                <button class="doc-action-btn" onclick="editDoc(${doc.id})">
                  ç¼–è¾‘
                </button>
                <button class="doc-action-btn" onclick="manageVersions(${doc.id})">
                  ç‰ˆæœ¬
                </button>
                <button class="doc-action-btn danger" onclick="deleteDoc(${doc.id})">
                  åˆ é™¤
                </button>
              </div>
            </td>
          </tr>
        `;
      }).join('');
    }

    // ==================== æœç´¢æ–‡æ¡£ ====================
    function searchDocs() {
      renderDocs();
    }

    // ==================== ä¸Šä¼ æ–‡æ¡£æ¨¡æ€æ¡† ====================
    function openUploadModal() {
      document.getElementById('uploadModal').classList.add('active');
    }

    function closeUploadModal() {
      document.getElementById('uploadModal').classList.remove('active');
      selectedFiles = [];
      document.getElementById('uploadCategory').value = '';
    }

    function setupDragAndDrop() {
      const uploadArea = document.getElementById('uploadArea');

      uploadArea.addEventListener('dragover', (e) => {
        e.preventDefault();
        uploadArea.classList.add('dragging');
      });

      uploadArea.addEventListener('dragleave', () => {
        uploadArea.classList.remove('dragging');
      });

      uploadArea.addEventListener('drop', (e) => {
        e.preventDefault();
        uploadArea.classList.remove('dragging');

        const files = Array.from(e.dataTransfer.files);
        handleFiles(files);
      });
    }

    function triggerFileUpload() {
      document.getElementById('fileInput').click();
    }

    function handleFileSelect(event) {
      const files = Array.from(event.target.files);
      handleFiles(files);
    }

    function handleFiles(files) {
      selectedFiles = files.filter(file => {
        const validTypes = [
          'application/pdf',
          'application/msword',
          'application/vnd.openxmlformats-officedocument.wordprocessingml.document',
          'application/vnd.ms-excel',
          'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',
          'text/plain'
        ];

        if (!validTypes.includes(file.type) && !file.name.match(/\.(pdf|doc|docx|xls|xlsx|txt)$/i)) {
          Utils.showToast(`ä¸æ”¯æŒçš„æ–‡ä»¶æ ¼å¼: ${file.name}`, 'error');
          return false;
        }

        if (file.size > 10 * 1024 * 1024) {
          Utils.showToast(`æ–‡ä»¶è¿‡å¤§: ${file.name}ï¼ˆé™åˆ¶10MBï¼‰`, 'error');
          return false;
        }

        return true;
      });

      if (selectedFiles.length > 0) {
        const uploadArea = document.getElementById('uploadArea');
        uploadArea.innerHTML = `
          <div class="upload-icon"></div>
          <div class="upload-text">å·²é€‰æ‹© ${selectedFiles.length} ä¸ªæ–‡ä»¶</div>
          <div class="upload-hint">${selectedFiles.map(f => f.name).join(', ')}</div>
        `;
      }
    }

    async function uploadFiles() {
      if (selectedFiles.length === 0) {
        Utils.showToast('è¯·é€‰æ‹©è¦ä¸Šä¼ çš„æ–‡ä»¶', 'error');
        return;
      }

      const category = document.getElementById('uploadCategory').value;
      if (!category) {
        Utils.showToast('è¯·é€‰æ‹©åˆ†ç±»', 'error');
        return;
      }

      Utils.showToast('æ­£åœ¨ä¸Šä¼ ...', 'info');
      await Utils.sleep(2000);

      console.log('ä¸Šä¼ æ–‡ä»¶:', selectedFiles, 'åˆ†ç±»:', category);

      Utils.showToast(`æˆåŠŸä¸Šä¼  ${selectedFiles.length} ä¸ªæ–‡æ¡£`, 'success');
      closeUploadModal();
      renderDocs();
    }

    // ==================== æ–‡æ¡£æ“ä½œ ====================
    function viewDoc(docId) {
      Utils.showToast(`æŸ¥çœ‹æ–‡æ¡£ ${docId}`, 'info');
    }

    function editDoc(docId) {
      Utils.showToast(`ç¼–è¾‘æ–‡æ¡£ ${docId}`, 'info');
    }

    function manageVersions(docId) {
      Utils.showToast(`ç‰ˆæœ¬ç®¡ç† ${docId}`, 'info');
    }

    async function deleteDoc(docId) {
      const confirmed = await Utils.confirm(
        'ç¡®è®¤åˆ é™¤æ­¤æ–‡æ¡£ï¼Ÿåˆ é™¤åæ— æ³•æ¢å¤ã€‚',
        'åˆ é™¤æ–‡æ¡£'
      );

      if (confirmed) {
        Utils.showToast('æ–‡æ¡£å·²åˆ é™¤', 'success');
        const index = knowledgeBase.findIndex(d => d.id === docId);
        if (index !== -1) {
          knowledgeBase.splice(index, 1);
          renderDocs();
        }
      }
    }
  </script>
</body>
</html>
