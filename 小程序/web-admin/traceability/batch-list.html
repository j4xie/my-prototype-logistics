<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æº¯æºæ‰¹æ¬¡åˆ—è¡¨ - ç™½å©çºªé£Ÿå“æº¯æºç®¡ç†åå°</title>
  <link rel="stylesheet" href="../../assets/css/variables.css">
  <link rel="stylesheet" href="../../assets/css/common.css">
  <link rel="stylesheet" href="../../assets/css/desktop.css?v=1765970920">
  <style>
      /* Reuse styles from common/desktop css */
      .status-badge {
          padding: 4px 8px;
          border-radius: 4px;
          font-size: 12px;
      }
      .status-completed { background: #e6ffed; color: #52c41a; }
      .status-processing { background: #e6f7ff; color: #1890ff; }
  </style>
</head>
<body>
  <div class="desktop-container">
            <div class="desktop-sidebar">
      <div class="sidebar-header">
        <div class="sidebar-logo">ğŸ¢ ç™½å©çºªç®¡ç†åå°</div>
      </div>
      <nav class="sidebar-nav">
        <a href="../dashboard/overview.html" class="nav-item">
          <span class="icon">ğŸ“Š</span>
          <span class="text">æ§åˆ¶å°</span>
        </a>
        
        <div class="nav-group">
          <div class="nav-group-title" onclick="toggleSidebarGroup(this)">
            <div class="title-wrap">
                <span class="icon">ğŸ“¦</span>
                <span class="text">å•†å“ä¸è®¢å•</span>
            </div>
            <span class="arrow">â–¼</span>
          </div>
          <div class="nav-sub-menu">
            <a href="../product-management/list.html" class="nav-sub-item">å•†å“ç®¡ç†</a>
            <a href="../orders/list.html" class="nav-sub-item">è®¢å•ç®¡ç†</a>
            <a href="../traceability/batch-list.html" class="nav-sub-item">æº¯æºç®¡ç†</a>
          </div>
        </div>

        <div class="nav-group">
          <div class="nav-group-title" onclick="toggleSidebarGroup(this)">
            <div class="title-wrap">
                <span class="icon">ğŸª</span>
                <span class="text">è¿è¥ä¸å†…å®¹</span>
            </div>
            <span class="arrow">â–¼</span>
          </div>
          <div class="nav-sub-menu">
            <a href="../merchant/list.html" class="nav-sub-item">å•†æˆ·ç®¡ç†</a>
            <a href="../user-management/list.html" class="nav-sub-item">ç”¨æˆ·ç®¡ç†</a>
            <a href="../content-control/review-queue.html" class="nav-sub-item">å†…å®¹å®¡æ ¸</a>
            <a href="../traffic-ad/ad-slots.html" class="nav-sub-item">å¹¿å‘ŠæŠ•æ”¾</a>
          </div>
        </div>

        <div class="nav-group">
          <div class="nav-group-title" onclick="toggleSidebarGroup(this)">
            <div class="title-wrap">
                <span class="icon">ğŸ¤–</span>
                <span class="text">AIä¸è®¾ç½®</span>
            </div>
            <span class="arrow">â–¼</span>
          </div>
          <div class="nav-sub-menu">
            <a href="../ai-knowledge/knowledge-base.html" class="nav-sub-item">AIçŸ¥è¯†åº“</a>
            <a href="../analytics/traffic-stats.html" class="nav-sub-item">æ•°æ®åˆ†æ</a>
          </div>
        </div>
      </nav>
    </div>
    </div>

    <div class="desktop-main">
      <div class="desktop-header">
        <div class="header-title">æº¯æºæ‰¹æ¬¡ç®¡ç†</div>
        <div class="header-actions">
           <button class="btn btn-primary" onclick="window.location.href='batch-create.html'">+ æ–°å»ºæ‰¹æ¬¡</button>
        </div>
      </div>

      <div class="breadcrumb">
        <a href="../dashboard/overview.html">é¦–é¡µ</a>
        <span class="breadcrumb-separator">/</span>
        <span>æº¯æºç®¡ç†</span>
        <span class="breadcrumb-separator">/</span>
        <span class="breadcrumb-current">æ‰¹æ¬¡åˆ—è¡¨</span>
      </div>

      <div class="desktop-content">
        <!-- Filter Bar -->
        <div style="background:white;padding:20px;margin-bottom:20px;border-radius:8px;display:flex;gap:10px;">
            <input type="text" id="searchInput" placeholder="æœç´¢æ‰¹æ¬¡å·ã€äº§å“åç§°..." style="padding:8px;border:1px solid #ddd;border-radius:4px;width:300px;">
            <button class="btn btn-default" onclick="renderTable()">æœç´¢</button>
        </div>

        <!-- Table -->
        <div style="background:white;border-radius:8px;overflow:hidden;">
            <table style="width:100%;border-collapse:collapse;">
                <thead style="background:#f5f5f5;border-bottom:1px solid #ddd;">
                    <tr>
                        <th style="padding:15px;text-align:left;">æ‰¹æ¬¡å·</th>
                        <th style="padding:15px;text-align:left;">å…³è”äº§å“</th>
                        <th style="padding:15px;text-align:left;">ç”Ÿäº§æ—¥æœŸ</th>
                        <th style="padding:15px;text-align:left;">è¿‡æœŸæ—¥æœŸ</th>
                        <th style="padding:15px;text-align:left;">æ•°é‡</th>
                        <th style="padding:15px;text-align:left;">çŠ¶æ€</th>
                        <th style="padding:15px;text-align:left;">æ“ä½œ</th>
                    </tr>
                </thead>
                <tbody id="tableBody">
                    <!-- JS Injected -->
                </tbody>
            </table>
        </div>
      </div>
    </div>
  </div>

  <script src="../../assets/js/mockData.js?v=1765970807"></script>
  <script src="../../assets/js/utils.js?v=1765970711"></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
        renderTable();
    });

    function renderTable() {
        const keyword = document.getElementById('searchInput').value.toLowerCase();
        
        // Use MockDB.batches
        let data = MockDB.batches || [];
        
        if (keyword) {
            data = data.filter(b => 
                b.batchNumber.toLowerCase().includes(keyword) || 
                b.productName.toLowerCase().includes(keyword)
            );
        }

        const tbody = document.getElementById('tableBody');
        if (data.length === 0) {
            tbody.innerHTML = '<tr><td colspan="7" style="text-align:center;padding:20px;color:#999;">æš‚æ— æ•°æ®</td></tr>';
            return;
        }

        tbody.innerHTML = data.map(b => `
            <tr style="border-bottom:1px solid #eee;">
                <td style="padding:15px;">${b.batchNumber}</td>
                <td style="padding:15px;">${b.productName}</td>
                <td style="padding:15px;">${b.productionDate}</td>
                <td style="padding:15px;">${b.expiryDate}</td>
                <td style="padding:15px;">${b.quantity} ${b.unit || 'ä»¶'}</td>
                <td style="padding:15px;">
                    <span class="status-badge ${b.status === 'completed' ? 'status-completed' : 'status-processing'}">
                        ${b.status === 'completed' ? 'å·²å½’æ¡£' : 'ç”Ÿäº§ä¸­'}
                    </span>
                </td>
                <td style="padding:15px;">
                    <button style="color:#1890ff;border:none;background:none;cursor:pointer;" onclick="editBatch('${b.batchNumber}')">ç¼–è¾‘</button>
                    <button style="color:#ff4d4f;border:none;background:none;cursor:pointer;margin-left:10px;" onclick="deleteBatch('${b.batchNumber}')">åˆ é™¤</button>
                </td>
            </tr>
        `).join('');
    }

    function editBatch(batchNumber) {
        window.location.href = `batch-create.html?batchNumber=${batchNumber}`;
    }

    function deleteBatch(id) {
        if(confirm('ç¡®å®šåˆ é™¤è¯¥æ‰¹æ¬¡?')) {
            Utils.showToast('åˆ é™¤æˆåŠŸ', 'success');
            // Mock delete
            MockDB.batches = MockDB.batches.filter(b => b.batchNumber !== id);
            renderTable();
        }
    }
  </script>
</body>
</html>

