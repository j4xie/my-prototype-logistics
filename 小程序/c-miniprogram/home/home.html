<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>é¦–é¡µ - æº¯æºå•†åŸ</title>

  <!-- CSS -->
  <link rel="stylesheet" href="../../assets/css/variables.css">
  <link rel="stylesheet" href="../../assets/css/common.css">
  <link rel="stylesheet" href="../../assets/css/mobile.css">

  <style>
    /* ==================== é¦–é¡µç‰¹æœ‰æ ·å¼ (é»‘é‡‘å¥¢åç‰ˆ) ==================== */
    
    /* é¡¶éƒ¨å¯¼èˆªé‡å†™ */
    .mobile-header {
      background: var(--bg-dark);
      border-bottom: none;
      padding: 0 var(--spacing-md);
      height: 54px;
    }

    .header-logo {
      font-size: 18px;
      font-weight: 800;
      color: var(--text-white);
      letter-spacing: 1px;
      font-family: serif;
      margin-right: var(--spacing-sm);
    }

    .header-logo span {
      color: var(--primary-color);
    }

    .header-search {
      flex: 1;
      background: rgba(255, 255, 255, 0.9);
      border-radius: var(--radius-pill);
      height: 32px;
      display: flex;
      align-items: center;
      padding: 0 var(--spacing-md);
      margin: 0 var(--spacing-sm);
    }

    .header-search-icon {
      color: var(--text-secondary);
      margin-right: var(--spacing-xs);
    }

    .header-search-input {
      border: none;
      background: transparent;
      width: 100%;
      font-size: 13px;
      color: var(--text-primary);
    }

    .header-search-input::placeholder {
      color: var(--text-tertiary);
    }

    .header-actions {
      display: flex;
      gap: var(--spacing-sm);
    }

    .header-icon-btn {
      width: 28px;
      height: 28px;
      border-radius: 50%;
      border: 1px solid var(--text-tertiary);
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--text-white);
      font-size: 14px;
    }

    /* é€šçŸ¥æ  */
    .notification-bar {
      background: #FFF8E1; /* æµ…é‡‘åº• */
      color: #856404;
      font-size: 12px;
      padding: 8px var(--spacing-lg);
      display: flex;
      align-items: center;
      gap: var(--spacing-sm);
    }

    .notification-icon {
      font-size: 14px;
    }

    /* åˆ†ç±»ç½‘æ ¼ */
    .category-section {
      background: var(--bg-white);
      padding: var(--spacing-lg) 0;
      margin-bottom: var(--spacing-md);
    }

    .category-grid {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: var(--spacing-lg) var(--spacing-sm);
      padding: 0 var(--spacing-lg);
    }

    .category-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 6px;
      cursor: pointer;
    }

    .category-icon-box {
      width: 44px;
      height: 44px;
      border-radius: 12px;
      background: var(--bg-dark); /* é»‘åº•é‡‘æ ‡ */
      color: var(--primary-color);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      border: 1px solid var(--primary-color);
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    }

    .category-name {
      font-size: 11px;
      color: var(--text-primary);
      text-align: center;
    }

    /* å¹¿å‘Šä½ */
    .promo-section {
      padding: 0 var(--spacing-lg);
      margin-bottom: var(--spacing-lg);
    }

    .promo-banner {
      width: 100%;
      height: 100px;
      border-radius: var(--radius-md);
      background: linear-gradient(135deg, #1a1a1a 0%, #333 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--primary-color);
      font-size: 24px;
      font-weight: bold;
      border: 1px solid rgba(212, 175, 55, 0.3);
      position: relative;
      overflow: hidden;
    }
    
    .promo-banner::after {
      content: 'LUXURY SUPPLY CHAIN';
      position: absolute;
      bottom: 10px;
      right: 10px;
      font-size: 10px;
      color: rgba(255,255,255,0.2);
      letter-spacing: 2px;
    }

    /* æ¨èäº§å“ */
    .section-header {
      padding: 0 var(--spacing-lg);
      margin-bottom: var(--spacing-md);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .section-title {
      font-size: 16px;
      font-weight: bold;
      color: var(--text-primary);
      position: relative;
      padding-left: 10px;
    }

    .section-title::before {
      content: '';
      position: absolute;
      left: 0;
      top: 4px;
      bottom: 4px;
      width: 3px;
      background: var(--primary-color);
      border-radius: 2px;
    }

    /* å¿«æ·å…¥å£é‡è®¾è®¡ */
    .quick-service {
      display: flex;
      justify-content: space-between;
      padding: var(--spacing-md) var(--spacing-lg);
      background: var(--bg-white);
      margin-bottom: var(--spacing-md);
    }
    
    .service-card {
      flex: 1;
      height: 60px;
      margin: 0 4px;
      border-radius: var(--radius-md);
      background: var(--bg-gray);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      border: 1px solid var(--border-color);
    }
    
    .service-title {
      font-size: 12px;
      font-weight: bold;
      margin-bottom: 4px;
    }
    
    .service-desc {
      font-size: 10px;
      color: var(--text-tertiary);
    }

    /* å¯åŠ¨å¹¿å‘Šå¼¹çª— */
    .splash-ad-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.85);
      z-index: 10000;
      align-items: center;
      justify-content: center;
      animation: fadeIn 0.4s ease;
    }

    .splash-ad-modal.show {
      display: flex;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
      }
      to {
        opacity: 1;
      }
    }

    .splash-ad-content {
      position: relative;
      width: 85%;
      max-width: 380px;
      border-radius: 16px;
      overflow: hidden;
      background: white;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
      animation: slideUp 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
    }

    @keyframes slideUp {
      from {
        transform: translateY(100px) scale(0.9);
        opacity: 0;
      }
      to {
        transform: translateY(0) scale(1);
        opacity: 1;
      }
    }

    .splash-ad-image {
      width: 100%;
      height: auto;
      display: block;
      cursor: pointer;
      user-select: none;
    }

    .splash-ad-header {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 16px;
      z-index: 10;
    }

    .splash-ad-countdown {
      background: rgba(0, 0, 0, 0.6);
      color: white;
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: bold;
      backdrop-filter: blur(10px);
    }

    .splash-ad-close {
      width: 36px;
      height: 36px;
      background: rgba(0, 0, 0, 0.6);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 20px;
      cursor: pointer;
      backdrop-filter: blur(10px);
      transition: all 0.2s ease;
    }

    .splash-ad-close:active {
      background: rgba(0, 0, 0, 0.8);
      transform: scale(0.95);
    }

    .splash-ad-skip {
      position: absolute;
      bottom: 16px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(255, 255, 255, 0.95);
      color: #666;
      padding: 8px 24px;
      border-radius: 20px;
      font-size: 13px;
      cursor: pointer;
      backdrop-filter: blur(10px);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
      transition: all 0.2s ease;
    }

    .splash-ad-skip:active {
      background: rgba(255, 255, 255, 1);
      transform: translateX(-50%) scale(0.95);
    }

  </style>
</head>
<body>
  <div class="mobile-container">
    <!-- é¡¶éƒ¨å¯¼èˆªæ  (è‡ªå®šä¹‰) -->
    <div class="mobile-header">
      <div class="header-logo">B<span>&</span>F</div>
      <div class="header-search" onclick="navigateTo('search.html')">
        <span class="header-search-icon">ğŸ”</span>
        <input type="text" class="header-search-input" placeholder="è¯·è¾“å…¥å•†å“åç§°" readonly style="cursor: pointer;">
      </div>
      <div class="header-actions">
        <div class="header-icon-btn">â€¢â€¢â€¢</div>
        <div class="header-icon-btn">â—</div>
      </div>
    </div>

    <!-- é€šçŸ¥æ  -->
    <div class="notification-bar">
      <span class="notification-icon">ğŸ”Š</span>
      <span>è”ç³»ç”µè¯ï¼š13916928096ï¼Œå¾®ä¿¡åŒå·</span>
    </div>

    <!-- ä¸»å†…å®¹åŒº -->
    <div class="mobile-content" style="padding: 0; padding-bottom: 70px;">
      
      <!-- è½®æ’­å›¾ (å¤ç”¨Mobile.cssç»„ä»¶ä½†ç§»é™¤è¾¹è·) -->
      <div class="mobile-carousel" style="border-radius: 0; margin-bottom: 0;">
        <div class="mobile-carousel-inner">
          <div class="mobile-carousel-item">
            <div style="width: 100%; height: 100%; background: url('https://images.unsplash.com/photo-1555244162-803834f70033?w=800') center/cover; display: flex; flex-direction: column; align-items: center; justify-content: center; color: white;">
              <h2 style="text-shadow: 0 2px 4px rgba(0,0,0,0.5); font-size: 32px; margin-bottom: 10px;">æºå¤´ç›´é‡‡</h2>
              <p style="text-shadow: 0 1px 2px rgba(0,0,0,0.5); font-size: 16px;">ä¸€ä»¶ä¹Ÿæ˜¯æ‰¹å‘ä»·</p>
            </div>
          </div>
        </div>
        <div class="mobile-carousel-indicators">
          <span class="mobile-carousel-dot active"></span>
          <span class="mobile-carousel-dot"></span>
          <span class="mobile-carousel-dot"></span>
        </div>
      </div>

      <!-- åˆ†ç±»ç½‘æ ¼ (æ ¹æ®Screenshot 1) -->
      <div class="category-section">
        <div class="category-grid" id="categoryGrid">
          <!-- åŠ¨æ€ç”Ÿæˆ -->
        </div>
      </div>

      <!-- æ¨èå•†å“ -->
      <div class="section-header">
        <div class="section-title">æ¨èå•†å“</div>
      </div>
      <div class="mobile-grid col-2" id="recommendGrid" style="padding-top: 0; padding-bottom: 0; grid-template-columns: repeat(2, 1fr); gap: 10px;">
        <!-- åŠ¨æ€ç”Ÿæˆ -->
      </div>

    </div>

    <!-- å¯åŠ¨å¹¿å‘Šå¼¹çª— -->
    <div class="splash-ad-modal" id="splashAdModal" onclick="handleSplashAdBackdropClick(event)">
      <div class="splash-ad-content" onclick="event.stopPropagation()">
        <div class="splash-ad-header">
          <div class="splash-ad-countdown" id="splashAdCountdown">3ç§’åè‡ªåŠ¨å…³é—­</div>
          <div class="splash-ad-close" onclick="closeSplashAd()">âœ•</div>
        </div>
        <img id="splashAdImage" class="splash-ad-image" src="" alt="å¹¿å‘Š" onclick="handleSplashAdClick()">
        <div class="splash-ad-skip" onclick="closeSplashAd()">è·³è¿‡å¹¿å‘Š</div>
      </div>
    </div>

    <!-- æ‚¬æµ®å®¢æœæŒ‰é’® -->
    <div class="mobile-fab" onclick="openConsultation()">
      ğŸ§
    </div>

    <!-- åº•éƒ¨Tabå¯¼èˆª -->
    <div class="mobile-tabbar">
      <div class="tabbar-item active">
        <div class="tabbar-icon">ğŸ </div>
        <div class="tabbar-label">é¦–é¡µ</div>
      </div>
      <div class="tabbar-item" onclick="navigateTo('../products/list.html')">
        <div class="tabbar-icon">ğŸ“¦</div>
        <div class="tabbar-label">åˆ†ç±»</div>
      </div>
      <div class="tabbar-item" onclick="navigateTo('../orders/list.html')">
        <div class="tabbar-icon">ğŸ§¾</div>
        <div class="tabbar-label">è®¢å•</div>
      </div>
      <div class="tabbar-item" onclick="navigateTo('../profile/index.html')">
        <div class="tabbar-icon">ğŸ‘¤</div>
        <div class="tabbar-label">æˆ‘çš„</div>
      </div>
    </div>
  </div>

  <!-- JavaScript -->
  <script src="../../assets/js/mockData.js?v=20251217"></script>
  <script src="../../assets/js/mockAPI.js?v=20251217"></script>
  <script src="../../assets/js/utils.js?v=20251217"></script>

  <script>
    let currentSplashAd = null;
    let splashAdTimer = null;
    let splashAdCountdownTimer = null;
    let splashAdCountdown = 5; // 5ç§’åè‡ªåŠ¨å…³é—­

    document.addEventListener('DOMContentLoaded', () => {
      renderCategories();
      renderRecommended();
      loadBannerAds();
      
      // ç­‰å¾…é¡µé¢å†…å®¹åŠ è½½å®Œæˆåå†æ˜¾ç¤ºå¯åŠ¨å¹¿å‘Š
      window.addEventListener('load', () => {
        setTimeout(() => {
          loadSplashAd();
        }, 800); // é¡µé¢åŠ è½½å®Œæˆåå»¶è¿Ÿ800msæ˜¾ç¤º
      });
    });

    async function loadBannerAds() {
      try {
        const result = await MockAPI.request('ads.list', { position: 'home_top' });
        const ads = result.data || [];
        
        if (ads.length > 0) {
          renderCarousel(ads);
        }
      } catch (error) {
        console.error('åŠ è½½Bannerå¹¿å‘Šå¤±è´¥:', error);
      }
    }

    function renderCarousel(ads) {
      const carouselInner = document.querySelector('.mobile-carousel-inner');
      const indicators = document.querySelector('.mobile-carousel-indicators');
      
      if (!carouselInner || !indicators) return;

      carouselInner.innerHTML = ads.map(ad => `
        <div class="mobile-carousel-item" onclick="handleAdClick(${ad.id}, ${ad.productId})">
          <div style="width: 100%; height: 100%; background: url('${ad.image}') center/cover no-repeat; display: flex; flex-direction: column; align-items: center; justify-content: center; color: white;">
          </div>
        </div>
      `).join('');

      indicators.innerHTML = ads.map((_, index) => `
        <span class="mobile-carousel-dot ${index === 0 ? 'active' : ''}"></span>
      `).join('');
    }

    async function handleAdClick(adId, productId) {
        try {
            await MockAPI.request('ads.click', { adId });
        } catch (e) {
            console.error('è®°å½•ç‚¹å‡»å¤±è´¥', e);
        }
        if (productId) {
            navigateToProduct(productId);
        }
    }

    // ==================== å¯åŠ¨å¹¿å‘Š ====================
    async function loadSplashAd() {
      // æ£€æŸ¥ä»Šæ—¥æ˜¯å¦å·²å…³é—­è¿‡ï¼ˆå¯é€‰åŠŸèƒ½ï¼‰
      const today = new Date().toDateString();
      const closedToday = localStorage.getItem('splashAdClosed_' + today);
      if (closedToday === 'true') {
        return; // ä»Šæ—¥å·²å…³é—­ï¼Œä¸å†æ˜¾ç¤º
      }

      try {
        const result = await MockAPI.request('ads.list', { position: 'splash_ad' });
        const ads = result.data || [];
        
        if (ads.length > 0) {
          currentSplashAd = ads[0];
          const modal = document.getElementById('splashAdModal');
          const image = document.getElementById('splashAdImage');
          const countdownEl = document.getElementById('splashAdCountdown');
          
          image.src = currentSplashAd.image;
          image.alt = currentSplashAd.productName || 'å¹¿å‘Š';
          
          // é‡ç½®å€’è®¡æ—¶
          splashAdCountdown = 5;
          countdownEl.textContent = `${splashAdCountdown}ç§’åè‡ªåŠ¨å…³é—­`;
          
          // æ˜¾ç¤ºå¼¹çª—
          modal.classList.add('show');
          
          // å¼€å§‹å€’è®¡æ—¶
          startSplashAdCountdown();
          
          // è®¾ç½®è‡ªåŠ¨å…³é—­å®šæ—¶å™¨
          splashAdTimer = setTimeout(() => {
            closeSplashAd();
          }, splashAdCountdown * 1000);
        }
      } catch (error) {
        console.error('åŠ è½½å¯åŠ¨å¹¿å‘Šå¤±è´¥:', error);
      }
    }

    function startSplashAdCountdown() {
      const countdownEl = document.getElementById('splashAdCountdown');
      
      splashAdCountdownTimer = setInterval(() => {
        splashAdCountdown--;
        
        if (splashAdCountdown > 0) {
          countdownEl.textContent = `${splashAdCountdown}ç§’åè‡ªåŠ¨å…³é—­`;
        } else {
          clearInterval(splashAdCountdownTimer);
          countdownEl.textContent = 'æ­£åœ¨å…³é—­...';
        }
      }, 1000);
    }

    function closeSplashAd() {
      // æ¸…é™¤å®šæ—¶å™¨
      if (splashAdTimer) {
        clearTimeout(splashAdTimer);
        splashAdTimer = null;
      }
      if (splashAdCountdownTimer) {
        clearInterval(splashAdCountdownTimer);
        splashAdCountdownTimer = null;
      }
      
      const modal = document.getElementById('splashAdModal');
      modal.classList.remove('show');
      
      // è®°å½•ä»Šæ—¥å·²å…³é—­ï¼ˆå¯é€‰ï¼šå–æ¶ˆæ³¨é‡Šä»¥å¯ç”¨"ä»Šæ—¥ä¸å†æ˜¾ç¤º"åŠŸèƒ½ï¼‰
      // const today = new Date().toDateString();
      // localStorage.setItem('splashAdClosed_' + today, 'true');
    }

    function handleSplashAdBackdropClick(event) {
      // ç‚¹å‡»èƒŒæ™¯å…³é—­å¼¹çª—
      if (event.target.id === 'splashAdModal') {
        closeSplashAd();
      }
    }

    async function handleSplashAdClick() {
      if (!currentSplashAd) return;
      
      // æ¸…é™¤è‡ªåŠ¨å…³é—­å®šæ—¶å™¨
      if (splashAdTimer) {
        clearTimeout(splashAdTimer);
        splashAdTimer = null;
      }
      if (splashAdCountdownTimer) {
        clearInterval(splashAdCountdownTimer);
        splashAdCountdownTimer = null;
      }
      
      try {
        await MockAPI.request('ads.click', { adId: currentSplashAd.id });
      } catch (e) {
        console.error('è®°å½•ç‚¹å‡»å¤±è´¥', e);
      }
      
      closeSplashAd();
      
      if (currentSplashAd.productId) {
        navigateToProduct(currentSplashAd.productId);
      }
    }

    function renderCategories() {
      const grid = document.getElementById('categoryGrid');
      const categories = MockDB.categories.slice(0, 10); // å–å‰10ä¸ªå±•ç¤º

      grid.innerHTML = categories.map(cat => `
        <div class="category-item" onclick="navigateToCategory('${cat.id}')">
          <div class="category-icon-box">${cat.icon}</div>
          <div class="category-name">${cat.name}</div>
        </div>
      `).join('');
    }

    function renderRecommended() {
      const grid = document.getElementById('recommendGrid');
      const products = MockDB.products.slice(0, 4); 
      
      grid.innerHTML = products.map(p => `
        <div style="background: white; border-radius: 8px; overflow: hidden; box-shadow: var(--shadow-sm);" onclick="navigateToProduct(${p.id})">
          <div style="height: 150px; width: 100%; background: #f5f5f5;">
            <img src="${p.images[0]}" style="width: 100%; height: 100%; object-fit: cover;">
          </div>
          <div style="padding: 10px;">
            <div style="font-size: 13px; font-weight: bold; margin-bottom: 6px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; color: var(--text-primary);">${p.name}</div>
            <div style="display: flex; justify-content: space-between; align-items: flex-end;">
              <div style="color: var(--ecommerce-accent); font-weight: bold; font-size: 14px;">Â¥${p.wholesalePrice}</div>
              <div style="font-size: 10px; color: #999;">å·²å”®${p.sales}</div>
            </div>
          </div>
        </div>
      `).join('');
    }

    function navigateTo(path) {
      window.location.href = path;
    }

    function navigateToCategory(id) {
      window.location.href = `../products/list.html?category=${id}`;
    }

    function navigateToProduct(id) {
      window.location.href = `../products/detail.html?id=${id}`;
    }

    function openConsultation() {
      Utils.confirm('æ˜¯å¦è¦è¿æ¥ä¸“ä¸šå®¢æœè¿›è¡Œå’¨è¯¢ï¼Ÿ', 'å’¨è¯¢æœåŠ¡').then(ok => {
        if (ok) {
          // è¿™é‡Œå¯ä»¥è·³è½¬åˆ°å®¢æœé¡µé¢ï¼Œæˆ–è€…æ˜¾ç¤ºQRç æ¨¡æ€æ¡†
          // ä¸ºäº†æ¼”ç¤ºï¼Œæˆ‘ä»¬è·³è½¬åˆ° AI å®¢æœèŠå¤©ç•Œé¢ (å¦‚æœæœ‰) æˆ–è€…æ˜¾ç¤ºä¸€ä¸ªæç¤º
          // å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ª ai-rag/chat.html é¡µé¢ï¼Œæˆ–è€…ç›´æ¥æ˜¾ç¤ºè”ç³»æ–¹å¼
          // Utils.showToast('æ­£åœ¨ä¸ºæ‚¨è½¬æ¥ä¸“ä¸šé¡¾é—®...', 'loading');
          // setTimeout(() => {
             window.location.href = '../ai-rag/chat.html';
          // }, 1000);
        }
      });
    }
  </script>
</body>
</html>
