<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>订单管理 - 商家中心</title>
  <link rel="stylesheet" href="../../assets/css/variables.css">
  <link rel="stylesheet" href="../../assets/css/common.css">
  <link rel="stylesheet" href="../../assets/css/mobile.css">
  <style>
    .order-list {
        padding: 10px;
    }
    .order-card {
        background: white;
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 10px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    }
    .order-header {
        display: flex;
        justify-content: space-between;
        margin-bottom: 10px;
        font-size: 14px;
        color: #666;
    }
    .order-status {
        font-weight: bold;
        color: var(--primary-color);
    }
    .order-item {
        display: flex;
        gap: 10px;
        margin-bottom: 10px;
        padding-bottom: 10px;
        border-bottom: 1px solid #f5f5f5;
    }
    .order-item-img {
        width: 60px;
        height: 60px;
        border-radius: 4px;
        background: #f5f5f5;
        object-fit: cover;
    }
    .order-item-info {
        flex: 1;
    }
    .order-item-name {
        font-size: 14px;
        font-weight: bold;
        margin-bottom: 4px;
    }
    .order-item-meta {
        font-size: 12px;
        color: #999;
    }
    .order-total {
        text-align: right;
        font-size: 14px;
        margin-bottom: 10px;
    }
    .order-actions {
        display: flex;
        justify-content: flex-end;
        gap: 10px;
    }
    .btn-action {
        padding: 6px 15px;
        border-radius: 15px;
        font-size: 13px;
        border: 1px solid #ddd;
        background: white;
    }
    .btn-primary-action {
        border-color: var(--primary-color);
        color: var(--primary-color);
    }
  </style>
</head>
<body>
  <div class="mobile-container">
    <div class="mobile-header">
        <div class="mobile-header-left" onclick="history.back()">←</div>
        <div class="mobile-header-title">订单管理</div>
        <div class="mobile-header-right"></div>
    </div>

    <div class="mobile-content" style="padding-top: 60px;">
        <div class="content-tabs">
            <div class="content-tab active" onclick="filterOrders('all')">全部</div>
            <div class="content-tab" onclick="filterOrders('pending')">待发货</div>
            <div class="content-tab" onclick="filterOrders('shipped')">已发货</div>
            <div class="content-tab" onclick="filterOrders('completed')">已完成</div>
        </div>

        <div class="order-list" id="orderList">
            <!-- JS Injected -->
        </div>
    </div>
  </div>

  <script src="../../assets/js/utils.js"></script>
  <script>
    let orders = [];

    document.addEventListener('DOMContentLoaded', () => {
        // Mock Orders
        orders = [
            {
                id: 'ORD20250115001',
                status: 'pending',
                time: '2025-01-15 10:30',
                total: 136.00,
                items: [
                    { name: '自产有机大米 5kg', price: 68.00, count: 2, img: 'https://images.unsplash.com/photo-1586201375761-83865001e31c?w=200' }
                ],
                user: '张三'
            },
            {
                id: 'ORD20250114088',
                status: 'shipped',
                time: '2025-01-14 14:20',
                total: 45.00,
                items: [
                    { name: '农家土鸡蛋 30枚', price: 45.00, count: 1, img: 'https://images.unsplash.com/photo-1582722872445-44dc5f7e3c8f?w=200' }
                ],
                user: '李四'
            },
            {
                id: 'ORD20250112012',
                status: 'completed',
                time: '2025-01-12 09:15',
                total: 24.00,
                items: [
                    { name: '手工红薯粉条', price: 12.00, count: 2, img: 'https://images.unsplash.com/photo-1612929633738-8fe44f7ec841?w=200' }
                ],
                user: '王五'
            }
        ];
        
        // Initial Filter
        const urlParams = new URLSearchParams(window.location.search);
        const initialStatus = urlParams.get('status') || 'all';
        if (initialStatus !== 'all') {
            document.querySelector(`.content-tab[onclick="filterOrders('${initialStatus}')"]`).click();
        } else {
            renderOrders(orders);
        }
    });

    function filterOrders(status) {
        document.querySelectorAll('.content-tab').forEach(el => el.classList.remove('active'));
        event.target.classList.add('active');

        if (status === 'all') {
            renderOrders(orders);
        } else {
            renderOrders(orders.filter(o => o.status === status));
        }
    }

    function renderOrders(list) {
        const container = document.getElementById('orderList');
        if (list.length === 0) {
            container.innerHTML = '<div style="text-align:center;padding:30px;color:#999;">暂无订单</div>';
            return;
        }

        const statusMap = {
            pending: '待发货',
            shipped: '已发货',
            completed: '已完成'
        };

        container.innerHTML = list.map(o => `
            <div class="order-card">
                <div class="order-header">
                    <span>${o.time}</span>
                    <span class="order-status">${statusMap[o.status]}</span>
                </div>
                ${o.items.map(item => `
                    <div class="order-item">
                        <img src="${item.img}" class="order-item-img">
                        <div class="order-item-info">
                            <div class="order-item-name">${item.name}</div>
                            <div class="order-item-meta">¥${item.price.toFixed(2)} x ${item.count}</div>
                        </div>
                    </div>
                `).join('')}
                <div class="order-total">
                    共${o.items.reduce((sum, i) => sum + i.count, 0)}件商品 合计: <span style="font-size:16px;font-weight:bold;">¥${o.total.toFixed(2)}</span>
                </div>
                <div class="order-actions">
                    ${o.status === 'pending' ? `<button class="btn-action btn-primary-action" onclick="shipOrder('${o.id}')">立即发货</button>` : ''}
                    <button class="btn-action" onclick="Utils.showToast('查看详情', 'info')">查看详情</button>
                </div>
            </div>
        `).join('');
    }

    function shipOrder(id) {
        Utils.confirm('确认发货该订单吗？', '发货确认').then(ok => {
            if (ok) {
                const order = orders.find(o => o.id === id);
                if (order) {
                    order.status = 'shipped';
                    Utils.showToast('发货成功', 'success');
                    // Re-render current tab (simple refresh)
                    document.querySelector('.content-tab.active').click();
                }
            }
        });
    }
  </script>
</body>
</html>














