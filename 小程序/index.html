<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>白垩纪 C端小程序 + Web管理端 - 高保真原型导航</title>

  <!-- CSS -->
  <link rel="stylesheet" href="./assets/css/variables.css">
  <link rel="stylesheet" href="./assets/css/common.css">

  <style>
    /* ==================== 页面整体布局 ==================== */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: var(--font-family);
      background: var(--bg-gray);
      color: var(--text-primary);
      line-height: 1.6;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: var(--spacing-3xl);
    }

    /* ==================== 页面头部 ==================== */
    .header {
      background: var(--primary-gradient);
      color: var(--text-inverse);
      padding: var(--spacing-3xl) 0;
      margin-bottom: var(--spacing-3xl);
      box-shadow: var(--shadow-lg);
    }

    .header-content {
      max-width: 1400px;
      margin: 0 auto;
      padding: 0 var(--spacing-3xl);
    }

    .header-title {
      font-size: var(--font-size-4xl);
      font-weight: var(--font-weight-bold);
      margin-bottom: var(--spacing-md);
    }

    .header-subtitle {
      font-size: var(--font-size-lg);
      opacity: 0.9;
      margin-bottom: var(--spacing-sm);
    }

    .header-info {
      font-size: var(--font-size-base);
      opacity: 0.8;
    }

    /* ==================== 工具栏 ==================== */
    .toolbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: var(--spacing-lg);
      background: var(--bg-white);
      padding: var(--spacing-lg) var(--spacing-2xl);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-sm);
      margin-bottom: var(--spacing-2xl);
    }

    .toolbar-left {
      display: flex;
      align-items: center;
      gap: var(--spacing-md);
      flex-wrap: wrap;
    }

    .toolbar-right {
      display: flex;
      align-items: center;
      gap: var(--spacing-md);
    }

    .search-box {
      display: flex;
      align-items: center;
      gap: var(--spacing-sm);
      padding: var(--spacing-sm) var(--spacing-md);
      background: var(--bg-gray);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-pill);
      min-width: 300px;
      transition: all var(--transition-base);
    }

    .search-box:focus-within {
      background: var(--bg-white);
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    .search-icon {
      color: var(--text-tertiary);
    }

    .search-input {
      flex: 1;
      border: none;
      background: transparent;
      outline: none;
      font-size: var(--font-size-base);
    }

    .filter-group {
      display: flex;
      gap: var(--spacing-sm);
    }

    .filter-btn {
      padding: var(--spacing-sm) var(--spacing-lg);
      background: var(--bg-gray);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-pill);
      font-size: var(--font-size-sm);
      cursor: pointer;
      transition: all var(--transition-base);
    }

    .filter-btn:hover {
      border-color: var(--primary-color);
      color: var(--primary-color);
    }

    .filter-btn.active {
      background: var(--primary-color);
      color: var(--text-inverse);
      border-color: var(--primary-color);
    }

    .toggle-flow-btn {
      padding: var(--spacing-sm) var(--spacing-lg);
      background: var(--bg-white);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-sm);
      cursor: pointer;
      transition: all var(--transition-base);
      font-size: var(--font-size-sm);
    }

    .toggle-flow-btn:hover {
      border-color: var(--primary-color);
      color: var(--primary-color);
    }

    .toggle-flow-btn.active {
      background: var(--info-light);
      border-color: var(--info-color);
      color: var(--info-dark);
    }

    /* ==================== 统计信息 ==================== */
    .stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: var(--spacing-lg);
      margin-bottom: var(--spacing-2xl);
    }

    .stat-card {
      background: var(--bg-white);
      border-radius: var(--radius-md);
      padding: var(--spacing-lg);
      box-shadow: var(--shadow-sm);
      transition: all var(--transition-base);
    }

    .stat-card:hover {
      box-shadow: var(--shadow-md);
      transform: translateY(-2px);
    }

    .stat-label {
      font-size: var(--font-size-sm);
      color: var(--text-secondary);
      margin-bottom: var(--spacing-xs);
    }

    .stat-value {
      font-size: var(--font-size-3xl);
      font-weight: var(--font-weight-bold);
      color: var(--primary-color);
    }

    /* ==================== 页面网格 ==================== */
    .pages-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: var(--spacing-2xl);
      position: relative;
    }

    /* SVG流程连接线 */
    .flow-lines {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 0;
      opacity: 0;
      transition: opacity var(--transition-base);
    }

    body.show-flows .flow-lines {
      opacity: 1;
    }

    .flow-line {
      stroke: var(--info-color);
      stroke-width: 2;
      stroke-dasharray: 5, 5;
      fill: none;
      marker-end: url(#arrowhead);
    }

    /* ==================== 页面卡片 ==================== */
    .page-card {
      background: var(--bg-white);
      border-radius: var(--radius-lg);
      padding: var(--spacing-2xl);
      box-shadow: var(--shadow-sm);
      transition: all var(--transition-base);
      cursor: pointer;
      position: relative;
      z-index: 1;
      border: 2px solid transparent;
    }

    .page-card:hover {
      box-shadow: var(--shadow-lg);
      transform: translateY(-4px);
      border-color: var(--primary-color);
    }

    .page-card.platform-mobile {
      border-top: 4px solid #667eea;
    }

    .page-card.platform-desktop {
      border-top: 4px solid #2ed573;
    }

    .page-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: var(--spacing-md);
    }

    .page-platform {
      display: inline-flex;
      align-items: center;
      gap: var(--spacing-xs);
      padding: 2px var(--spacing-sm);
      background: var(--bg-gray);
      border-radius: var(--radius-pill);
      font-size: var(--font-size-xs);
      font-weight: var(--font-weight-semibold);
    }

    .page-platform.platform-mobile {
      background: rgba(102, 126, 234, 0.1);
      color: #667eea;
    }

    .page-platform.platform-desktop {
      background: rgba(46, 213, 115, 0.1);
      color: #2ed573;
    }

    .page-status {
      display: inline-flex;
      align-items: center;
      padding: 2px var(--spacing-sm);
      border-radius: var(--radius-pill);
      font-size: var(--font-size-xs);
      font-weight: var(--font-weight-semibold);
    }

    .page-status.status-mvp {
      background: var(--error-light);
      color: var(--error-dark);
    }

    .page-status.status-complete {
      background: var(--success-light);
      color: var(--success-dark);
    }

    .page-status.status-planned {
      background: var(--info-light);
      color: var(--info-dark);
    }

    .page-title {
      font-size: var(--font-size-xl);
      font-weight: var(--font-weight-bold);
      color: var(--text-primary);
      margin-bottom: var(--spacing-sm);
    }

    .page-desc {
      font-size: var(--font-size-sm);
      color: var(--text-secondary);
      margin-bottom: var(--spacing-md);
      line-height: 1.6;
      min-height: 40px;
    }

    .page-meta {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding-top: var(--spacing-md);
      border-top: 1px solid var(--border-color-light);
    }

    .page-category {
      font-size: var(--font-size-xs);
      color: var(--text-tertiary);
    }

    .page-number {
      font-size: var(--font-size-xs);
      font-weight: var(--font-weight-bold);
      color: var(--text-tertiary);
    }

    /* ==================== 空状态 ==================== */
    .empty-state {
      text-align: center;
      padding: var(--spacing-5xl) var(--spacing-2xl);
      color: var(--text-secondary);
    }

    .empty-icon {
      font-size: var(--font-size-5xl);
      margin-bottom: var(--spacing-lg);
      opacity: 0.5;
    }

    /* ==================== 页脚 ==================== */
    .footer {
      text-align: center;
      padding: var(--spacing-3xl) 0;
      margin-top: var(--spacing-5xl);
      color: var(--text-tertiary);
      font-size: var(--font-size-sm);
    }

    /* ==================== 响应式 ==================== */
    @media (max-width: 768px) {
      .container {
        padding: var(--spacing-lg);
      }

      .header-content {
        padding: 0 var(--spacing-lg);
      }

      .header-title {
        font-size: var(--font-size-2xl);
      }

      .toolbar {
        flex-direction: column;
        align-items: stretch;
      }

      .toolbar-left,
      .toolbar-right {
        width: 100%;
        flex-direction: column;
      }

      .search-box {
        min-width: 100%;
      }

      .pages-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <!-- 页面头部 -->
  <div class="header">
    <div class="header-content">
      <h1 class="header-title">溯源商城 - 高保真原型导航</h1>
      <p class="header-subtitle">C端小程序（22页面） + Web管理端（24页面）| 总计46个页面</p>
      <p class="header-info">点击卡片预览页面 | 切换显示流程连接线 | 筛选平台类型</p>
    </div>
  </div>

  <div class="container">
    <!-- 工具栏 -->
    <div class="toolbar">
      <div class="toolbar-left">
        <!-- 搜索框 -->
        <div class="search-box">
          <input
            type="text"
            class="search-input"
            id="searchInput"
            placeholder="搜索页面名称或描述..."
          >
        </div>

        <!-- 平台筛选 -->
        <div class="filter-group">
          <button class="filter-btn active" data-filter="all">全部</button>
          <button class="filter-btn" data-filter="mobile">C端小程序</button>
          <button class="filter-btn" data-filter="desktop">Web管理端</button>
        </div>

        <!-- 状态筛选 -->
        <div class="filter-group">
          <button class="filter-btn active" data-filter-status="all">全部</button>
          <button class="filter-btn" data-filter-status="mvp">MVP</button>
          <button class="filter-btn" data-filter-status="complete">完成</button>
          <button class="filter-btn" data-filter-status="planned">规划中</button>
        </div>
      </div>

      <div class="toolbar-right">
        <button class="toggle-flow-btn" id="toggleFlowBtn">
          <span>显示流程连接线</span>
        </button>
      </div>
    </div>

    <!-- 统计信息 -->
    <div class="stats">
      <div class="stat-card">
        <div class="stat-label">总页面数</div>
        <div class="stat-value" id="totalPages">46</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">C端小程序</div>
        <div class="stat-value" id="mobilePages">22</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">Web管理端</div>
        <div class="stat-value" id="desktopPages">24</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">MVP核心</div>
        <div class="stat-value" id="mvpPages">16</div>
      </div>
    </div>

    <!-- 页面网格 -->
    <div class="pages-grid" id="pagesGrid">
      <!-- SVG流程连接线 -->
      <svg class="flow-lines" id="flowLines">
        <defs>
          <marker
            id="arrowhead"
            markerWidth="10"
            markerHeight="10"
            refX="9"
            refY="3"
            orient="auto"
          >
            <polygon points="0 0, 10 3, 0 6" fill="#1890ff" />
          </marker>
        </defs>
      </svg>

      <!-- 页面卡片将通过JavaScript动态生成 -->
    </div>

    <!-- 空状态 -->
    <div class="empty-state" id="emptyState" style="display: none;">
      <div class="empty-icon">?</div>
      <p>未找到匹配的页面</p>
    </div>
  </div>

  <!-- 页脚 -->
  <div class="footer">
    <p>溯源商城 高保真原型系统 © 2025</p>
    <p style="margin-top: var(--spacing-sm);">
      基于项目现有设计系统构建 | 复用 PRD 文档和 Prototypes 样式
    </p>
  </div>

  <!-- JavaScript -->
  <script src="./assets/js/mockData.js"></script>
  <script>
    // ==================== 页面数据 ====================
    const pages = [
      // C端小程序 - MVP (8个)
      { id: 1, platform: 'mobile', category: 'home', title: '首页', desc: '产品推荐、快捷入口、活动Banner、底部Tab导航', file: 'c-miniprogram/home/home.html', status: 'mvp', connectsTo: [2, 3, 4] },
      { id: 2, platform: 'mobile', category: 'auth', title: '微信授权登录', desc: '微信一键登录、授权协议弹窗', file: 'c-miniprogram/auth/login.html', status: 'mvp', connectsTo: [1] },
      { id: 3, platform: 'mobile', category: 'products', title: '产品列表', desc: '分类筛选、搜索、产品卡片、加载更多', file: 'c-miniprogram/products/list.html', status: 'mvp', connectsTo: [4] },
      { id: 4, platform: 'mobile', category: 'products', title: '产品详情', desc: '产品轮播图、阶梯定价、溯源入口、分享按钮', file: 'c-miniprogram/products/detail.html', status: 'mvp', connectsTo: [5, 6, 21] },
      { id: 5, platform: 'mobile', category: 'traceability', title: '扫码溯源', desc: '模拟扫码界面（摄像头动画）、手动输入批次号', file: 'c-miniprogram/traceability/scan.html', status: 'mvp', connectsTo: [6] },
      { id: 6, platform: 'mobile', category: 'traceability', title: '批次溯源信息', desc: '批次详情、质检报告、溯源时间线、原料供应商', file: 'c-miniprogram/traceability/batch-info.html', status: 'mvp', connectsTo: [7, 8] },
      { id: 7, platform: 'mobile', category: 'ai-rag', title: 'AI智能问答', desc: '聊天界面、模拟AI回复（打字动画）、快捷问题', file: 'c-miniprogram/ai-rag/chat.html', status: 'mvp', connectsTo: [] },
      { id: 8, platform: 'mobile', category: 'profile', title: '个人中心', desc: '用户信息、我的订单、推荐、咨询历史、设置', file: 'c-miniprogram/profile/index.html', status: 'mvp', connectsTo: [18, 19, 22] },

      // C端小程序 - 完善 (14个)
      { id: 9, platform: 'mobile', category: 'home', title: '搜索页', desc: '搜索结果列表、热门搜索、历史搜索', file: 'c-miniprogram/home/search.html', status: 'planned', connectsTo: [3] },
      { id: 10, platform: 'mobile', category: 'auth', title: '注册绑定', desc: '公司信息、联系人、推荐人（可选）', file: 'c-miniprogram/auth/register.html', status: 'planned', connectsTo: [1] },
      { id: 11, platform: 'mobile', category: 'products', title: '阶梯定价计算器', desc: '数量输入、实时价格计算、优惠展示', file: 'c-miniprogram/products/price-calculator.html', status: 'planned', connectsTo: [] },
      { id: 12, platform: 'mobile', category: 'traceability', title: '质检报告详情', desc: '检验项目、检验结果、检验员签名', file: 'c-miniprogram/traceability/quality-report.html', status: 'planned', connectsTo: [] },
      { id: 13, platform: 'mobile', category: 'traceability', title: '溯源时间线详情', desc: '完整时间轴、每个环节详情、操作员信息', file: 'c-miniprogram/traceability/timeline.html', status: 'planned', connectsTo: [] },
      { id: 14, platform: 'mobile', category: 'ai-analysis', title: '工厂分析', desc: '稳定性评分、生产一致性、质检合格率', file: 'c-miniprogram/ai-analysis/factory-analysis.html', status: 'planned', connectsTo: [] },
      { id: 15, platform: 'mobile', category: 'ai-analysis', title: '行业分析', desc: '行业价格区间、成本趋势、竞争力分析', file: 'c-miniprogram/ai-analysis/industry-analysis.html', status: 'planned', connectsTo: [] },
      { id: 16, platform: 'mobile', category: 'ai-analysis', title: '产品分析', desc: '产品综合评分、质量趋势、推荐指数', file: 'c-miniprogram/ai-analysis/product-analysis.html', status: 'planned', connectsTo: [] },
      { id: 17, platform: 'mobile', category: 'ai-rag', title: '咨询历史', desc: '历史对话列表、继续对话、删除记录', file: 'c-miniprogram/ai-rag/history.html', status: 'planned', connectsTo: [7] },
      { id: 18, platform: 'mobile', category: 'referral', title: '分享推荐', desc: '二维码生成、分享链接、推荐规则说明', file: 'c-miniprogram/referral/share.html', status: 'planned', connectsTo: [] },
      { id: 19, platform: 'mobile', category: 'referral', title: '我的推荐', desc: '推荐列表、状态跟踪、奖励统计', file: 'c-miniprogram/referral/my-referrals.html', status: 'planned', connectsTo: [20] },
      { id: 20, platform: 'mobile', category: 'referral', title: '推荐奖励', desc: '奖励明细、提现记录、奖励规则', file: 'c-miniprogram/referral/rewards.html', status: 'planned', connectsTo: [] },
      { id: 21, platform: 'mobile', category: 'orders', title: '订单列表', desc: '订单状态筛选、订单详情入口', file: 'c-miniprogram/orders/list.html', status: 'planned', connectsTo: [22, 23] },
      { id: 22, platform: 'mobile', category: 'orders', title: '订单详情', desc: '订单信息、商品明细、物流追踪', file: 'c-miniprogram/orders/detail.html', status: 'planned', connectsTo: [] },
      { id: 23, platform: 'mobile', category: 'orders', title: '下单结算', desc: '商品确认、收货地址、支付方式选择', file: 'c-miniprogram/orders/checkout.html', status: 'planned', connectsTo: [22] },
      { id: 24, platform: 'mobile', category: 'profile', title: '设置', desc: '账户信息、通知设置、隐私设置、退出登录', file: 'c-miniprogram/profile/settings.html', status: 'planned', connectsTo: [] },

      // Web管理端 - MVP (8个)
      { id: 25, platform: 'desktop', category: 'dashboard', title: '总览仪表板', desc: '关键指标卡片、图表可视化、待办事项', file: 'web-admin/dashboard/overview.html', status: 'mvp', connectsTo: [26, 29] },
      { id: 26, platform: 'desktop', category: 'merchant', title: '商户列表', desc: '商户表格、搜索筛选排序、批量操作、分页', file: 'web-admin/merchant/list.html', status: 'mvp', connectsTo: [27, 28] },
      { id: 27, platform: 'desktop', category: 'merchant', title: '商户审核', desc: '审核队列、商户资料展示、审核表单（通过/拒绝）', file: 'web-admin/merchant/review.html', status: 'mvp', connectsTo: [26] },
      { id: 28, platform: 'desktop', category: 'merchant', title: '商户详情', desc: '完整商户信息、经营数据、操作历史', file: 'web-admin/merchant/detail.html', status: 'planned', connectsTo: [26] },
      { id: 29, platform: 'desktop', category: 'product', title: '产品列表', desc: '产品表格、筛选（状态/分类/工厂）、快速上下线', file: 'web-admin/product-management/list.html', status: 'mvp', connectsTo: [30, 31, 32] },
      { id: 30, platform: 'desktop', category: 'product', title: '新建产品', desc: '产品信息表单、图片上传（拖拽）、规格配置', file: 'web-admin/product-management/create.html', status: 'mvp', connectsTo: [29, 31] },
      { id: 31, platform: 'desktop', category: 'product', title: '价格配置', desc: '基础价格、阶梯定价（动态添加/删除）、价格曲线预览', file: 'web-admin/product-management/price-config.html', status: 'mvp', connectsTo: [29] },
      { id: 32, platform: 'desktop', category: 'content', title: '内容审核队列', desc: '待审核内容列表（产品/Banner）、批量审核、审核记录', file: 'web-admin/content-control/review-queue.html', status: 'mvp', connectsTo: [33] },
      { id: 33, platform: 'desktop', category: 'ai', title: '知识库管理', desc: '文档列表（搜索/分类筛选）、文档上传、版本管理', file: 'web-admin/ai-knowledge/knowledge-base.html', status: 'mvp', connectsTo: [34] },

      // Web管理端 - 完善 (16个)
      { id: 34, platform: 'desktop', category: 'merchant', title: '状态管理', desc: '批量上线/下线/封禁、状态变更历史', file: 'web-admin/merchant/status-management.html', status: 'planned', connectsTo: [26] },
      { id: 35, platform: 'desktop', category: 'product', title: '编辑产品', desc: '产品信息编辑、图片管理、规格调整', file: 'web-admin/product-management/edit.html', status: 'planned', connectsTo: [29] },
      { id: 36, platform: 'desktop', category: 'product', title: '批量上下线', desc: '批量选择、状态变更、变更日志', file: 'web-admin/product-management/online-offline.html', status: 'planned', connectsTo: [29] },
      { id: 37, platform: 'desktop', category: 'content', title: '文案审核', desc: '文案详情、修改建议、审核通过/拒绝', file: 'web-admin/content-control/text-review.html', status: 'planned', connectsTo: [32] },
      { id: 38, platform: 'desktop', category: 'content', title: '展示策略配置', desc: '溯源展示开关、AI分析展示控制、推荐规则', file: 'web-admin/content-control/strategy-config.html', status: 'planned', connectsTo: [] },
      { id: 39, platform: 'desktop', category: 'content', title: 'Banner管理', desc: 'Banner列表、新建/编辑、位置配置、上下线', file: 'web-admin/content-control/banner-management.html', status: 'planned', connectsTo: [] },
      { id: 40, platform: 'desktop', category: 'traffic', title: '排序配置', desc: '默认排序策略、搜索权重、排序规则管理', file: 'web-admin/traffic-ad/ranking-config.html', status: 'planned', connectsTo: [] },
      { id: 41, platform: 'desktop', category: 'traffic', title: '推荐位管理', desc: '高曝光位设置、产品优先级、展示时段', file: 'web-admin/traffic-ad/featured-products.html', status: 'planned', connectsTo: [] },
      { id: 42, platform: 'desktop', category: 'traffic', title: '广告位管理', desc: '广告位列表、位置配置、投放管理', file: 'web-admin/traffic-ad/ad-slots.html', status: 'planned', connectsTo: [] },
      { id: 43, platform: 'desktop', category: 'traffic', title: '营销活动', desc: '活动列表、新建活动、效果统计', file: 'web-admin/traffic-ad/campaign-list.html', status: 'planned', connectsTo: [] },
      { id: 44, platform: 'desktop', category: 'ai', title: '文档上传', desc: '拖拽上传、批量上传、文件格式验证、上传进度', file: 'web-admin/ai-knowledge/document-upload.html', status: 'planned', connectsTo: [33] },
      { id: 45, platform: 'desktop', category: 'ai', title: '分类管理', desc: '树形结构分类、新增/编辑/删除、拖拽排序', file: 'web-admin/ai-knowledge/category-management.html', status: 'planned', connectsTo: [33] },
      { id: 46, platform: 'desktop', category: 'ai', title: '问答对管理', desc: '问答列表、批量导入、编辑/删除、搜索', file: 'web-admin/ai-knowledge/qa-pairs.html', status: 'planned', connectsTo: [33] },
      { id: 47, platform: 'desktop', category: 'analytics', title: '流量统计', desc: '访问量图表、用户来源分析、页面热度', file: 'web-admin/analytics/traffic-stats.html', status: 'planned', connectsTo: [] },
      { id: 48, platform: 'desktop', category: 'analytics', title: '转化报告', desc: '转化漏斗、成交率分析、优化建议', file: 'web-admin/analytics/conversion-report.html', status: 'planned', connectsTo: [] },
      { id: 49, platform: 'desktop', category: 'analytics', title: '用户行为', desc: '用户行为路径、热力图、停留时长', file: 'web-admin/analytics/user-behavior.html', status: 'planned', connectsTo: [] },
      { id: 50, platform: 'desktop', category: 'settings', title: '系统配置', desc: '全局参数配置、系统开关、运维工具', file: 'web-admin/settings/system-config.html', status: 'planned', connectsTo: [] },
      { id: 51, platform: 'desktop', category: 'settings', title: '用户角色权限', desc: '角色列表、权限配置、用户分配', file: 'web-admin/settings/user-roles.html', status: 'planned', connectsTo: [] },
      { id: 52, platform: 'desktop', category: 'settings', title: '操作日志', desc: '审计日志列表、筛选查询、导出功能', file: 'web-admin/settings/audit-log.html', status: 'planned', connectsTo: [] }
    ];

    // ==================== 初始化 ====================
    let currentFilter = 'all';
    let currentStatusFilter = 'all';
    let searchKeyword = '';
    let flowLinesVisible = false;

    document.addEventListener('DOMContentLoaded', () => {
      renderPages();
      updateStats();
      initEventListeners();
    });

    // ==================== 渲染页面卡片 ====================
    function renderPages() {
      const filteredPages = filterPages();
      const grid = document.getElementById('pagesGrid');
      const emptyState = document.getElementById('emptyState');

      if (filteredPages.length === 0) {
        grid.style.display = 'none';
        emptyState.style.display = 'block';
        return;
      }

      grid.style.display = 'grid';
      emptyState.style.display = 'none';

      // 生成卡片HTML
      const cardsHTML = filteredPages.map(page => `
        <div class="page-card platform-${page.platform}" data-page-id="${page.id}" onclick="navigateToPage('${page.file}')">
          <div class="page-header">
            <span class="page-platform platform-${page.platform}">
              ${page.platform === 'mobile' ? 'C端' : 'Web端'}
            </span>
            <span class="page-status status-${page.status}">
              ${page.status === 'mvp' ? 'MVP' : page.status === 'complete' ? '完成' : '规划中'}
            </span>
          </div>
          <h3 class="page-title">${page.title}</h3>
          <p class="page-desc">${page.desc}</p>
          <div class="page-meta">
            <span class="page-category">${getCategoryLabel(page.category)}</span>
            <span class="page-number">#${page.id}</span>
          </div>
        </div>
      `).join('');

      grid.innerHTML = cardsHTML + '<svg class="flow-lines" id="flowLines"><defs><marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto"><polygon points="0 0, 10 3, 0 6" fill="#1890ff" /></marker></defs></svg>';

      // 绘制流程连接线（如果启用）
      if (flowLinesVisible) {
        setTimeout(() => drawFlowLines(filteredPages), 100);
      }
    }

    // ==================== 筛选页面 ====================
    function filterPages() {
      return pages.filter(page => {
        // 平台筛选
        if (currentFilter !== 'all' && page.platform !== currentFilter) {
          return false;
        }

        // 状态筛选
        if (currentStatusFilter !== 'all' && page.status !== currentStatusFilter) {
          return false;
        }

        // 搜索关键词
        if (searchKeyword) {
          const keyword = searchKeyword.toLowerCase();
          return (
            page.title.toLowerCase().includes(keyword) ||
            page.desc.toLowerCase().includes(keyword)
          );
        }

        return true;
      });
    }

    // ==================== 绘制流程连接线 ====================
    function drawFlowLines(visiblePages) {
      const svg = document.getElementById('flowLines');
      if (!svg) return;

      // 清空现有连接线
      while (svg.childNodes.length > 1) {
        svg.removeChild(svg.lastChild);
      }

      visiblePages.forEach(page => {
        if (!page.connectsTo || page.connectsTo.length === 0) return;

        const fromCard = document.querySelector(`[data-page-id="${page.id}"]`);
        if (!fromCard) return;

        page.connectsTo.forEach(toId => {
          const toCard = document.querySelector(`[data-page-id="${toId}"]`);
          if (!toCard) return;

          // 计算卡片中心点
          const fromRect = fromCard.getBoundingClientRect();
          const toRect = toCard.getBoundingClientRect();
          const gridRect = svg.parentElement.getBoundingClientRect();

          const x1 = fromRect.left + fromRect.width / 2 - gridRect.left;
          const y1 = fromRect.top + fromRect.height / 2 - gridRect.top;
          const x2 = toRect.left + toRect.width / 2 - gridRect.left;
          const y2 = toRect.top + toRect.height / 2 - gridRect.top;

          // 创建连接线
          const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
          line.setAttribute('class', 'flow-line');
          line.setAttribute('x1', x1);
          line.setAttribute('y1', y1);
          line.setAttribute('x2', x2);
          line.setAttribute('y2', y2);

          svg.appendChild(line);
        });
      });
    }

    // ==================== 更新统计信息 ====================
    function updateStats() {
      const filteredPages = filterPages();

      document.getElementById('totalPages').textContent = filteredPages.length;
      document.getElementById('mobilePages').textContent = filteredPages.filter(p => p.platform === 'mobile').length;
      document.getElementById('desktopPages').textContent = filteredPages.filter(p => p.platform === 'desktop').length;
      document.getElementById('mvpPages').textContent = filteredPages.filter(p => p.status === 'mvp').length;
    }

    // ==================== 事件监听 ====================
    function initEventListeners() {
      // 搜索
      const searchInput = document.getElementById('searchInput');
      searchInput.addEventListener('input', (e) => {
        searchKeyword = e.target.value.trim();
        renderPages();
        updateStats();
      });

      // 平台筛选
      document.querySelectorAll('[data-filter]').forEach(btn => {
        btn.addEventListener('click', (e) => {
          document.querySelectorAll('[data-filter]').forEach(b => b.classList.remove('active'));
          e.target.classList.add('active');
          currentFilter = e.target.dataset.filter;
          renderPages();
          updateStats();
        });
      });

      // 状态筛选
      document.querySelectorAll('[data-filter-status]').forEach(btn => {
        btn.addEventListener('click', (e) => {
          document.querySelectorAll('[data-filter-status]').forEach(b => b.classList.remove('active'));
          e.target.classList.add('active');
          currentStatusFilter = e.target.dataset.filterStatus;
          renderPages();
          updateStats();
        });
      });

      // 切换流程连接线
      const toggleFlowBtn = document.getElementById('toggleFlowBtn');
      toggleFlowBtn.addEventListener('click', () => {
        flowLinesVisible = !flowLinesVisible;
        document.body.classList.toggle('show-flows', flowLinesVisible);
        toggleFlowBtn.classList.toggle('active', flowLinesVisible);
        toggleFlowBtn.querySelector('span').textContent = flowLinesVisible ? '隐藏流程连接线' : '显示流程连接线';

        if (flowLinesVisible) {
          const filteredPages = filterPages();
          setTimeout(() => drawFlowLines(filteredPages), 100);
        }
      });

      // 窗口resize时重新绘制连接线
      let resizeTimer;
      window.addEventListener('resize', () => {
        clearTimeout(resizeTimer);
        resizeTimer = setTimeout(() => {
          if (flowLinesVisible) {
            const filteredPages = filterPages();
            drawFlowLines(filteredPages);
          }
        }, 300);
      });
    }

    // ==================== 导航到页面 ====================
    function navigateToPage(file) {
      window.location.href = file;
    }

    // ==================== 获取分类标签 ====================
    function getCategoryLabel(category) {
      const labels = {
        'home': '首页',
        'auth': '认证',
        'products': '产品',
        'traceability': '溯源',
        'ai-analysis': 'AI分析',
        'ai-rag': 'AI问答',
        'referral': '推荐',
        'orders': '订单',
        'profile': '个人',
        'dashboard': '仪表板',
        'merchant': '商户',
        'product': '产品管理',
        'content': '内容',
        'traffic': '流量',
        'ai': 'AI知识库',
        'analytics': '分析',
        'settings': '设置'
      };
      return labels[category] || category;
    }
  </script>
</body>
</html>
