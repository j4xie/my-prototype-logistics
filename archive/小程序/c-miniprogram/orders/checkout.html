<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>ç¡®è®¤è®¢å• - æº¯æºå•†åŸ</title>
  <link rel="stylesheet" href="../../assets/css/variables.css">
  <link rel="stylesheet" href="../../assets/css/common.css">
  <link rel="stylesheet" href="../../assets/css/mobile.css">
  <style>
    .product-summary {
      background: var(--bg-white);
      padding: var(--spacing-lg);
      margin-bottom: var(--spacing-md);
      display: flex;
      gap: var(--spacing-md);
    }
    .product-image {
      width: 80px;
      height: 80px;
      border-radius: var(--radius-sm);
      object-fit: cover;
    }
    .product-info {
      flex: 1;
    }
    .product-name {
      font-size: var(--font-size-base);
      font-weight: var(--font-weight-medium);
      margin-bottom: var(--spacing-xs);
    }
    .product-spec {
      font-size: var(--font-size-sm);
      color: var(--text-tertiary);
      margin-bottom: var(--spacing-xs);
    }
    .product-qty {
      font-size: var(--font-size-sm);
      color: var(--text-secondary);
    }
    .product-price {
      text-align: right;
      font-size: var(--font-size-lg);
      font-weight: var(--font-weight-bold);
      color: var(--error-color);
    }
    .info-section {
      background: var(--bg-white);
      padding: var(--spacing-lg);
      margin-bottom: var(--spacing-md);
    }
    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: var(--spacing-md);
    }
    .section-title {
      font-size: var(--font-size-base);
      font-weight: var(--font-weight-semibold);
    }
    .section-edit {
      color: var(--primary-color);
      font-size: var(--font-size-sm);
      cursor: pointer;
    }
    .address-content {
      font-size: var(--font-size-sm);
      line-height: 1.6;
    }
    .address-name {
      font-weight: var(--font-weight-medium);
      margin-bottom: var(--spacing-xs);
    }
    .address-phone {
      color: var(--text-secondary);
      margin-bottom: var(--spacing-xs);
    }
    .address-detail {
      color: var(--text-secondary);
    }
    .payment-options {
      display: flex;
      flex-direction: column;
      gap: var(--spacing-md);
    }
    .payment-option {
      display: flex;
      align-items: center;
      gap: var(--spacing-md);
      padding: var(--spacing-md);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-md);
      cursor: pointer;
    }
    .payment-option.selected {
      border-color: var(--primary-color);
      background: var(--primary-light);
    }
    .payment-icon {
      font-size: var(--font-size-3xl);
    }
    .payment-name {
      flex: 1;
      font-size: var(--font-size-base);
      font-weight: var(--font-weight-medium);
    }
    .payment-radio {
      width: 20px;
      height: 20px;
      border-radius: 50%;
      border: 2px solid var(--border-color);
      position: relative;
    }
    .payment-option.selected .payment-radio {
      border-color: var(--primary-color);
    }
    .payment-option.selected .payment-radio::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: var(--primary-color);
    }
    .price-summary {
      background: var(--bg-white);
      padding: var(--spacing-lg);
      margin-bottom: var(--spacing-md);
    }
    .price-row {
      display: flex;
      justify-content: space-between;
      padding: var(--spacing-sm) 0;
      font-size: var(--font-size-sm);
    }
    .price-label {
      color: var(--text-tertiary);
    }
    .price-value {
      color: var(--text-primary);
      font-weight: var(--font-weight-medium);
    }
    .price-total {
      border-top: 1px solid var(--border-color);
      padding-top: var(--spacing-md);
      margin-top: var(--spacing-sm);
    }
    .price-total .price-label {
      font-size: var(--font-size-base);
      color: var(--text-primary);
    }
    .price-total .price-value {
      font-size: var(--font-size-xl);
      color: var(--error-color);
      font-weight: var(--font-weight-bold);
    }
    .checkout-footer {
      position: fixed;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 100%;
      max-width: 430px;
      background: var(--bg-white);
      padding: var(--spacing-md) var(--spacing-lg);
      box-shadow: 0 -2px 8px rgba(0, 0, 0, 0.1);
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-sizing: border-box;
    }
    .total-amount {
      display: flex;
      flex-direction: column;
      gap: var(--spacing-xs);
    }
    .total-label {
      font-size: var(--font-size-xs);
      color: var(--text-tertiary);
    }
    .total-price {
      font-size: var(--font-size-xl);
      color: var(--error-color);
      font-weight: var(--font-weight-bold);
    }
    .submit-btn {
      padding: var(--spacing-md) var(--spacing-xl);
      background: var(--primary-gradient);
      color: var(--text-inverse);
      border: none;
      border-radius: var(--radius-md);
      font-size: var(--font-size-base);
      font-weight: var(--font-weight-semibold);
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div class="mobile-container">
    <div class="mobile-header">
      <div class="mobile-header-back" onclick="window.history.back()">â†</div>
      <div class="mobile-header-title">ç¡®è®¤è®¢å•</div>
    </div>
    <div class="mobile-content" style="padding-bottom: 80px;">
      <!-- æ”¶è´§åœ°å€ -->
      <div class="info-section">
        <div class="section-header">
          <div class="section-title">ğŸ“ æ”¶è´§åœ°å€</div>
          <div class="section-edit" onclick="editAddress()">ä¿®æ”¹</div>
        </div>
        <div class="address-content" id="addressContent">
          <div class="address-name">å¼ ä¸‰ 138****1234</div>
          <div class="address-detail">ä¸Šæµ·å¸‚æµ¦ä¸œæ–°åŒºXXè·¯XXå·</div>
        </div>
      </div>

      <!-- å•†å“ä¿¡æ¯ -->
      <div class="product-summary">
        <img src="https://images.unsplash.com/photo-1544551763-46a013bb70d5?w=200" class="product-image">
        <div class="product-info">
          <div class="product-name">é€Ÿå†»é±¼æ’</div>
          <div class="product-spec">è§„æ ¼: 500g/è¢‹</div>
          <div class="product-qty">æ•°é‡: <span id="productQty">100</span> ä»¶</div>
        </div>
        <div class="product-price">Â¥<span id="productPrice">2800</span></div>
      </div>

      <!-- æ”¯ä»˜æ–¹å¼ -->
      <div class="info-section">
        <div class="section-header">
          <div class="section-title">ğŸ’³ æ”¯ä»˜æ–¹å¼</div>
        </div>
        <div class="payment-options" id="paymentOptions">
          <div class="payment-option selected" data-method="wechat" onclick="selectPayment('wechat')">
            <div class="payment-icon">ğŸ’š</div>
            <div class="payment-name">å¾®ä¿¡æ”¯ä»˜</div>
            <div class="payment-radio"></div>
          </div>
          <div class="payment-option" data-method="alipay" onclick="selectPayment('alipay')">
            <div class="payment-icon">ğŸ’™</div>
            <div class="payment-name">æ”¯ä»˜å®</div>
            <div class="payment-radio"></div>
          </div>
          <div class="payment-option" data-method="bank" onclick="selectPayment('bank')">
            <div class="payment-icon">ğŸ¦</div>
            <div class="payment-name">é“¶è¡Œè½¬è´¦</div>
            <div class="payment-radio"></div>
          </div>
        </div>
      </div>

      <!-- ä»·æ ¼æ˜ç»† -->
      <div class="price-summary">
        <div class="price-row">
          <div class="price-label">å•†å“æ€»ä»·</div>
          <div class="price-value">Â¥<span id="subtotal">2800</span></div>
        </div>
        <div class="price-row">
          <div class="price-label">ä¼˜æƒ é‡‘é¢</div>
          <div class="price-value" style="color: var(--success-color);">-Â¥<span id="discount">200</span></div>
        </div>
        <div class="price-row">
          <div class="price-label">è¿è´¹</div>
          <div class="price-value">Â¥<span id="shipping">0</span></div>
        </div>
        <div class="price-row price-total">
          <div class="price-label">å®ä»˜é‡‘é¢</div>
          <div class="price-value">Â¥<span id="totalAmount">2600</span></div>
        </div>
      </div>
    </div>

    <!-- åº•éƒ¨æäº¤æ  -->
    <div class="checkout-footer">
      <div class="total-amount">
        <div class="total-label">åº”ä»˜é‡‘é¢</div>
        <div class="total-price">Â¥<span id="footerTotal">2600</span></div>
      </div>
      <button class="submit-btn" onclick="submitOrder()">æäº¤è®¢å•</button>
    </div>
  </div>

  <script src="../../assets/js/utils.js"></script>
  <script>
    let selectedPaymentMethod = 'wechat';

    function selectPayment(method) {
      selectedPaymentMethod = method;
      document.querySelectorAll('.payment-option').forEach(option => {
        option.classList.remove('selected');
      });
      document.querySelector(`[data-method="${method}"]`).classList.add('selected');
    }

    function editAddress() {
      Utils.showToast('è·³è½¬åˆ°åœ°å€ç®¡ç†é¡µé¢');
      // å®é™…åº”ç”¨ä¸­è·³è½¬åˆ°åœ°å€é€‰æ‹©é¡µé¢
    }

    async function submitOrder() {
      const orderData = {
        productId: 'PROD001',
        quantity: parseInt(document.getElementById('productQty').textContent),
        totalAmount: parseFloat(document.getElementById('totalAmount').textContent),
        paymentMethod: selectedPaymentMethod,
        address: {
          name: 'å¼ ä¸‰',
          phone: '13812341234',
          detail: 'ä¸Šæµ·å¸‚æµ¦ä¸œæ–°åŒºXXè·¯XXå·'
        }
      };

      const confirmed = await Utils.confirm(
        `ç¡®è®¤æäº¤è®¢å•ï¼Ÿ\næ”¯ä»˜æ–¹å¼ï¼š${getPaymentName(selectedPaymentMethod)}\nå®ä»˜é‡‘é¢ï¼šÂ¥${orderData.totalAmount}`,
        'ç¡®è®¤è®¢å•'
      );

      if (!confirmed) return;

      // æ¨¡æ‹Ÿæäº¤è®¢å•
      Utils.showLoading('æäº¤ä¸­...');
      await Utils.sleep(1500);
      Utils.hideLoading();

      Utils.showToast('è®¢å•æäº¤æˆåŠŸï¼', 'success');
      await Utils.sleep(1000);

      // è·³è½¬åˆ°æ”¯ä»˜é¡µé¢ï¼ˆå®é™…åº”ç”¨ï¼‰
      if (selectedPaymentMethod === 'wechat') {
        Utils.showToast('æ­£åœ¨å”¤èµ·å¾®ä¿¡æ”¯ä»˜...');
      } else if (selectedPaymentMethod === 'alipay') {
        Utils.showToast('æ­£åœ¨å”¤èµ·æ”¯ä»˜å®...');
      } else {
        Utils.showToast('è¯·æŒ‰ç…§æç¤ºå®Œæˆé“¶è¡Œè½¬è´¦');
      }

      await Utils.sleep(1500);
      // è·³è½¬åˆ°è®¢å•åˆ—è¡¨
      window.location.href = 'list.html';
    }

    function getPaymentName(method) {
      const names = {
        wechat: 'å¾®ä¿¡æ”¯ä»˜',
        alipay: 'æ”¯ä»˜å®',
        bank: 'é“¶è¡Œè½¬è´¦'
      };
      return names[method] || method;
    }

    // è®¡ç®—ä»·æ ¼
    function calculateTotal() {
      const subtotal = parseFloat(document.getElementById('subtotal').textContent);
      const discount = parseFloat(document.getElementById('discount').textContent);
      const shipping = parseFloat(document.getElementById('shipping').textContent);
      const total = subtotal - discount + shipping;

      document.getElementById('totalAmount').textContent = total.toFixed(0);
      document.getElementById('footerTotal').textContent = total.toFixed(0);
    }

    // é¡µé¢åŠ è½½æ—¶è®¡ç®—ä¸€æ¬¡
    document.addEventListener('DOMContentLoaded', calculateTotal);
  </script>
</body>
</html>
