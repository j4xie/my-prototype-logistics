<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>äº§å“åˆ—è¡¨ - ç™½å©çºªé£Ÿå“æº¯æºç®¡ç†åå°</title>

  <!-- CSS -->
  <link rel="stylesheet" href="../../assets/css/variables.css">
  <link rel="stylesheet" href="../../assets/css/common.css">
  <link rel="stylesheet" href="../../assets/css/desktop.css?v=1765970920">

  <style>
    /* ç­›é€‰æ  */
    .filter-bar {
      background: var(--bg-white);
      padding: var(--spacing-lg);
      border-radius: var(--radius-md);
      margin-bottom: var(--spacing-lg);
      display: flex;
      gap: var(--spacing-md);
      align-items: flex-end;
      flex-wrap: wrap;
    }

    .filter-group {
      display: flex;
      flex-direction: column;
      gap: var(--spacing-xs);
      min-width: 200px;
    }

    .filter-group.search {
      flex: 1;
      min-width: 300px;
    }

    .filter-label {
      font-size: var(--font-size-sm);
      color: var(--text-secondary);
      font-weight: var(--font-weight-medium);
    }

    .filter-select,
    .filter-input {
      padding: var(--spacing-sm) var(--spacing-md);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-sm);
      font-size: var(--font-size-base);
      outline: none;
      transition: border-color var(--transition-base);
    }

    .filter-select:focus,
    .filter-input:focus {
      border-color: var(--primary-color);
    }

    .filter-actions {
      display: flex;
      gap: var(--spacing-sm);
      margin-left: auto;
    }

    /* è¡¨æ ¼åŒºåŸŸ */
    .table-section {
      background: var(--bg-white);
      border-radius: var(--radius-md);
      overflow: hidden;
    }

    .table-header {
      padding: var(--spacing-lg);
      border-bottom: 1px solid var(--border-color);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .table-title {
      font-size: var(--font-size-lg);
      font-weight: var(--font-weight-semibold);
      color: var(--text-primary);
    }

    .table-count {
      font-size: var(--font-size-sm);
      color: var(--text-tertiary);
      margin-left: var(--spacing-sm);
    }

    .bulk-actions {
      display: flex;
      gap: var(--spacing-sm);
      align-items: center;
    }

    .bulk-actions-text {
      font-size: var(--font-size-sm);
      color: var(--text-secondary);
    }

    /* è¡¨æ ¼æ ·å¼ */
    .table-wrapper {
      overflow-x: auto;
    }

    .table {
      width: 100%;
      border-collapse: collapse;
    }

    .table thead {
      background: var(--bg-gray);
    }

    .table th {
      padding: var(--spacing-md) var(--spacing-lg);
      text-align: left;
      font-size: var(--font-size-sm);
      font-weight: var(--font-weight-semibold);
      color: var(--text-secondary);
      border-bottom: 1px solid var(--border-color);
      white-space: nowrap;
    }

    .table th.sortable {
      cursor: pointer;
      user-select: none;
      position: relative;
      padding-right: 24px;
    }

    .table th.sortable:hover {
      background: var(--bg-hover);
    }

    .sort-indicator {
      position: absolute;
      right: 8px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 10px;
      color: var(--text-tertiary);
    }

    .sort-indicator.active {
      color: var(--primary-color);
    }

    .table td {
      padding: var(--spacing-md) var(--spacing-lg);
      border-bottom: 1px solid var(--border-color);
      font-size: var(--font-size-sm);
      color: var(--text-primary);
    }

    .table tbody tr {
      transition: background var(--transition-base);
    }

    .table tbody tr:hover {
      background: var(--bg-gray);
    }

    .table tbody tr.selected {
      background: rgba(102, 126, 234, 0.08);
    }

    /* äº§å“ä¿¡æ¯åˆ— */
    .product-info {
      display: flex;
      align-items: center;
      gap: var(--spacing-md);
    }

    .product-image {
      width: 60px;
      height: 60px;
      border-radius: var(--radius-sm);
      object-fit: cover;
      border: 1px solid var(--border-color);
    }

    .product-details {
      display: flex;
      flex-direction: column;
      gap: var(--spacing-xs);
    }

    .product-name {
      font-weight: var(--font-weight-medium);
      color: var(--text-primary);
    }

    .product-id {
      font-size: var(--font-size-xs);
      color: var(--text-tertiary);
    }

    /* ä»·æ ¼æ˜¾ç¤º */
    .price-info {
      display: flex;
      flex-direction: column;
      gap: var(--spacing-xs);
    }

    .base-price {
      font-weight: var(--font-weight-semibold);
      color: var(--error-color);
    }

    .tier-price {
      font-size: var(--font-size-xs);
      color: var(--text-tertiary);
    }

    /* çŠ¶æ€å¾½ç«  */
    .status-badge {
      display: inline-block;
      padding: 4px var(--spacing-sm);
      border-radius: var(--radius-pill);
      font-size: var(--font-size-xs);
      font-weight: var(--font-weight-medium);
    }

    .status-badge.online {
      background: rgba(82, 196, 26, 0.1);
      color: var(--success-color);
    }

    .status-badge.offline {
      background: rgba(0, 0, 0, 0.06);
      color: var(--text-tertiary);
    }

    /* æ“ä½œæŒ‰é’® */
    .action-buttons {
      display: flex;
      gap: var(--spacing-xs);
      white-space: nowrap;
    }

    .action-btn {
      padding: 4px var(--spacing-sm);
      border: none;
      background: none;
      color: var(--primary-color);
      font-size: var(--font-size-sm);
      cursor: pointer;
      transition: all var(--transition-base);
      text-decoration: none;
    }

    .action-btn:hover {
      color: var(--primary-dark);
      text-decoration: underline;
    }

    .action-btn.danger {
      color: var(--error-color);
    }

    .action-btn.success {
      color: var(--success-color);
    }

    /* åˆ†é¡µ */
    .pagination {
      padding: var(--spacing-lg);
      border-top: 1px solid var(--border-color);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .pagination-info {
      font-size: var(--font-size-sm);
      color: var(--text-secondary);
    }

    .pagination-controls {
      display: flex;
      gap: var(--spacing-sm);
      align-items: center;
    }

    .pagination-btn {
      padding: var(--spacing-xs) var(--spacing-md);
      border: 1px solid var(--border-color);
      background: var(--bg-white);
      border-radius: var(--radius-sm);
      font-size: var(--font-size-sm);
      cursor: pointer;
      transition: all var(--transition-base);
    }

    .pagination-btn:hover:not(:disabled) {
      background: var(--bg-gray);
      border-color: var(--primary-color);
      color: var(--primary-color);
    }

    .pagination-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .pagination-btn.active {
      background: var(--primary-gradient);
      color: var(--text-inverse);
      border-color: transparent;
    }

    /* ç©ºçŠ¶æ€ */
    .empty-state {
      padding: var(--spacing-3xl);
      text-align: center;
      color: var(--text-tertiary);
    }

    .empty-icon {
      font-size: 48px;
      margin-bottom: var(--spacing-md);
    }

    /* åº“å­˜é¢„è­¦ */
    .stock-warning {
      color: var(--warning-color);
      font-weight: var(--font-weight-medium);
    }

    .stock-danger {
      color: var(--error-color);
      font-weight: var(--font-weight-bold);
    }
  </style>
</head>
<body>
  <div class="desktop-container">
    <!-- ä¾§è¾¹æ  -->
            <div class="desktop-sidebar">
      <div class="sidebar-header">
        <div class="sidebar-logo">ğŸ¢ ç™½å©çºªç®¡ç†åå°</div>
      </div>
      <nav class="sidebar-nav">
        <a href="../dashboard/overview.html" class="nav-item">
          <span class="icon">ğŸ“Š</span>
          <span class="text">æ§åˆ¶å°</span>
        </a>
        
        <div class="nav-group">
          <div class="nav-group-title" onclick="toggleSidebarGroup(this)">
            <div class="title-wrap">
                <span class="icon">ğŸ“¦</span>
                <span class="text">å•†å“ä¸è®¢å•</span>
            </div>
            <span class="arrow">â–¼</span>
          </div>
          <div class="nav-sub-menu">
            <a href="../product-management/list.html" class="nav-sub-item">å•†å“ç®¡ç†</a>
            <a href="../orders/list.html" class="nav-sub-item">è®¢å•ç®¡ç†</a>
            <a href="../traceability/batch-list.html" class="nav-sub-item">æº¯æºç®¡ç†</a>
          </div>
        </div>

        <div class="nav-group">
          <div class="nav-group-title" onclick="toggleSidebarGroup(this)">
            <div class="title-wrap">
                <span class="icon">ğŸª</span>
                <span class="text">è¿è¥ä¸å†…å®¹</span>
            </div>
            <span class="arrow">â–¼</span>
          </div>
          <div class="nav-sub-menu">
            <a href="../merchant/list.html" class="nav-sub-item">å•†æˆ·ç®¡ç†</a>
            <a href="../user-management/list.html" class="nav-sub-item">ç”¨æˆ·ç®¡ç†</a>
            <a href="../content-control/review-queue.html" class="nav-sub-item">å†…å®¹å®¡æ ¸</a>
            <a href="../traffic-ad/ad-slots.html" class="nav-sub-item">å¹¿å‘ŠæŠ•æ”¾</a>
          </div>
        </div>

        <div class="nav-group">
          <div class="nav-group-title" onclick="toggleSidebarGroup(this)">
            <div class="title-wrap">
                <span class="icon">ğŸ¤–</span>
                <span class="text">AIä¸è®¾ç½®</span>
            </div>
            <span class="arrow">â–¼</span>
          </div>
          <div class="nav-sub-menu">
            <a href="../ai-knowledge/knowledge-base.html" class="nav-sub-item">AIçŸ¥è¯†åº“</a>
            <a href="../analytics/traffic-stats.html" class="nav-sub-item">æ•°æ®åˆ†æ</a>
          </div>
        </div>
      </nav>
    </div>

    <!-- ä¸»å†…å®¹åŒº -->
    <div class="desktop-main">
      <!-- é¡¶éƒ¨æ  -->
      <div class="desktop-header">
        <div class="header-title">äº§å“åˆ—è¡¨</div>
        <div class="header-actions">
          <button class="btn btn-default" onclick="Utils.showToast('é€šçŸ¥åŠŸèƒ½å¼€å‘ä¸­', 'info')">
            ğŸ”” é€šçŸ¥
          </button>
          <button class="btn btn-default" onclick="Utils.showToast('è®¾ç½®åŠŸèƒ½å¼€å‘ä¸­', 'info')">
             è®¾ç½®
          </button>
        </div>
      </div>

      <!-- é¢åŒ…å±‘ -->
      <div class="breadcrumb">
        <a href="../dashboard/overview.html">é¦–é¡µ</a>
        <span class="breadcrumb-separator">/</span>
        <span>äº§å“ç®¡ç†</span>
        <span class="breadcrumb-separator">/</span>
        <span class="breadcrumb-current">äº§å“åˆ—è¡¨</span>
      </div>

      <!-- å†…å®¹åŒºåŸŸ -->
      <div class="desktop-content">
        <!-- ç­›é€‰æ  -->
        <div class="filter-bar">
          <div class="filter-group">
            <label class="filter-label">çŠ¶æ€</label>
            <select class="filter-select" id="statusFilter" onchange="applyFilters()">
              <option value="">å…¨éƒ¨çŠ¶æ€</option>
              <option value="online">å·²ä¸Šæ¶</option>
              <option value="offline">å·²ä¸‹æ¶</option>
            </select>
          </div>

          <div class="filter-group">
            <label class="filter-label">åˆ†ç±»</label>
            <select class="filter-select" id="categoryFilter" onchange="applyFilters()">
              <option value="">å…¨éƒ¨åˆ†ç±»</option>
              <option value="seafood">æµ·é²œæ°´äº§</option>
              <option value="meat">è‚‰ç±»ç¦½è›‹</option>
              <option value="vegetable">è”¬èœæœè”¬</option>
              <option value="grain">ç²®æ²¹ç±³é¢</option>
            </select>
          </div>

          <div class="filter-group search">
            <label class="filter-label">æœç´¢</label>
            <input
              type="text"
              class="filter-input"
              id="searchInput"
              placeholder="è¾“å…¥äº§å“åç§°æˆ–IDæœç´¢"
              oninput="applyFilters()"
            >
          </div>

          <div class="filter-actions">
            <button class="btn btn-default" onclick="resetFilters()">
              ğŸ”„ é‡ç½®
            </button>
            <button class="btn btn-primary" onclick="navigateTo('create.html')">
              â• æ–°å»ºäº§å“
            </button>
          </div>
        </div>

        <!-- è¡¨æ ¼åŒºåŸŸ -->
        <div class="table-section">
          <div class="table-header">
            <div>
              <span class="table-title">äº§å“åˆ—è¡¨</span>
              <span class="table-count" id="totalCount">(å…± 0 ä¸ªäº§å“)</span>
            </div>

            <div class="bulk-actions" id="bulkActions" style="display: none;">
              <span class="bulk-actions-text">
                å·²é€‰æ‹© <strong id="selectedCount">0</strong> ä¸ªäº§å“
              </span>
              <button class="btn btn-sm btn-default" onclick="bulkOnline()">
                æ‰¹é‡ä¸Šæ¶
              </button>
              <button class="btn btn-sm btn-default" onclick="bulkOffline()">
                æ‰¹é‡ä¸‹æ¶
              </button>
              <button class="btn btn-sm btn-link" onclick="clearSelection()">
                å–æ¶ˆé€‰æ‹©
              </button>
            </div>
          </div>

          <div class="table-wrapper">
            <table class="table">
              <thead>
                <tr>
                  <th style="width: 50px;">
                    <input type="checkbox" id="selectAll" onchange="toggleSelectAll()">
                  </th>
                  <th style="width: 300px;">äº§å“ä¿¡æ¯</th>
                  <th class="sortable" onclick="sortTable('category')" style="width: 120px;">
                    åˆ†ç±»
                    <span class="sort-indicator" id="sort-category">â‡…</span>
                  </th>
                  <th class="sortable" onclick="sortTable('price')" style="width: 150px;">
                    ä»·æ ¼
                    <span class="sort-indicator" id="sort-price">â‡…</span>
                  </th>
                  <th class="sortable" onclick="sortTable('stock')" style="width: 100px;">
                    åº“å­˜
                    <span class="sort-indicator" id="sort-stock">â‡…</span>
                  </th>
                  <th style="width: 100px;">çŠ¶æ€</th>
                  <th class="sortable" onclick="sortTable('updateTime')" style="width: 180px;">
                    æ›´æ–°æ—¶é—´
                    <span class="sort-indicator active" id="sort-updateTime">â†“</span>
                  </th>
                  <th style="width: 200px;">æ“ä½œ</th>
                </tr>
              </thead>
              <tbody id="tableBody">
                <!-- è¡¨æ ¼è¡Œå°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
              </tbody>
            </table>
          </div>

          <!-- åˆ†é¡µ -->
          <div class="pagination">
            <div class="pagination-info" id="paginationInfo">
              æ˜¾ç¤º 1-10 / å…± 0 æ¡
            </div>
            <div class="pagination-controls">
              <button class="pagination-btn" id="prevBtn" onclick="changePage(currentPage - 1)">
                ä¸Šä¸€é¡µ
              </button>
              <div id="pageButtons">
                <!-- é¡µç æŒ‰é’®å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
              </div>
              <button class="pagination-btn" id="nextBtn" onclick="changePage(currentPage + 1)">
                ä¸‹ä¸€é¡µ
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- JavaScript -->
  <script src="../../assets/js/mockData.js?v=1765970807"></script>
  <script src="../../assets/js/listHelper.js"></script>
  <script src="../../assets/js/utils.js?v=1765970711"></script>

  <script>
    // ==================== å…¨å±€çŠ¶æ€ ====================
    let allProducts = [];
    let filteredProducts = [];
    let selectedProducts = new Set();
    let currentPage = 1;
    const pageSize = 10;

    // æ’åºçŠ¶æ€
    let sortBy = 'updateTime';
    let sortOrder = 'desc';

    // ç­›é€‰çŠ¶æ€
    let filters = {
      status: '',
      category: '',
      keyword: ''
    };

    // ==================== åˆå§‹åŒ– ====================
    document.addEventListener('DOMContentLoaded', async () => {
      await loadProducts();
    });

    // ==================== åŠ è½½äº§å“æ•°æ® ====================
    async function loadProducts() {
      try {
        // ä»MockDBè·å–äº§å“æ•°æ®
        allProducts = MockDB.products.map(p => ({
          ...p,
          status: p.status || (Math.random() > 0.3 ? 'online' : 'offline'),
          stock: p.stock || Math.floor(Math.random() * 1000),
          updateTime: p.updateTime || new Date(Date.now() - Math.random() * 30 * 24 * 60 * 60 * 1000).toISOString()
        }));

        applyFilters();
      } catch (error) {
        console.error('åŠ è½½äº§å“æ•°æ®å¤±è´¥:', error);
        Utils.showToast('åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢', 'error');
      }
    }

    // ==================== åº”ç”¨ç­›é€‰ ====================
    function applyFilters() {
      // è·å–ç­›é€‰æ¡ä»¶
      filters.status = document.getElementById('statusFilter').value;
      filters.category = document.getElementById('categoryFilter').value;
      filters.keyword = document.getElementById('searchInput').value.trim().toLowerCase();

      // åº”ç”¨ç­›é€‰
      filteredProducts = allProducts.filter(product => {
        if (filters.status && product.status !== filters.status) return false;
        if (filters.category && product.category !== filters.category) return false;
        if (filters.keyword) {
          const matchName = product.name.toLowerCase().includes(filters.keyword);
          const matchId = product.id.toString().includes(filters.keyword);
          if (!matchName && !matchId) return false;
        }
        return true;
      });

      // åº”ç”¨æ’åº
      filteredProducts = ListHelper.sort(filteredProducts, sortBy, sortOrder);

      // é‡ç½®åˆ°ç¬¬ä¸€é¡µ
      currentPage = 1;
      clearSelection();
      renderTable();
      renderPagination();
    }

    // ==================== é‡ç½®ç­›é€‰ ====================
    function resetFilters() {
      document.getElementById('statusFilter').value = '';
      document.getElementById('categoryFilter').value = '';
      document.getElementById('searchInput').value = '';
      applyFilters();
    }

    // ==================== æ’åºè¡¨æ ¼ ====================
    function sortTable(column) {
      if (sortBy === column) {
        sortOrder = sortOrder === 'asc' ? 'desc' : 'asc';
      } else {
        sortBy = column;
        sortOrder = 'asc';
      }

      // æ›´æ–°æ’åºæŒ‡ç¤ºå™¨
      document.querySelectorAll('.sort-indicator').forEach(el => {
        el.className = 'sort-indicator';
        el.textContent = 'â‡…';
      });

      const indicator = document.getElementById(`sort-${column}`);
      indicator.className = 'sort-indicator active';
      indicator.textContent = sortOrder === 'asc' ? 'â†‘' : 'â†“';

      // é‡æ–°æ’åºå’Œæ¸²æŸ“
      filteredProducts = ListHelper.sort(filteredProducts, sortBy, sortOrder);
      renderTable();
    }

    // ==================== æ¸²æŸ“è¡¨æ ¼ ====================
    function renderTable() {
      const tableBody = document.getElementById('tableBody');
      const totalCount = document.getElementById('totalCount');

      // æ›´æ–°æ€»æ•°
      totalCount.textContent = `(å…± ${filteredProducts.length} ä¸ªäº§å“)`;

      // åˆ†é¡µ
      const start = (currentPage - 1) * pageSize;
      const end = start + pageSize;
      const pageData = filteredProducts.slice(start, end);

      // æ¸²æŸ“è¡¨æ ¼è¡Œ
      if (pageData.length === 0) {
        tableBody.innerHTML = `
          <tr>
            <td colspan="8">
              <div class="empty-state">
                <div class="empty-icon">ğŸ“­</div>
                <div>æš‚æ— äº§å“æ•°æ®</div>
              </div>
            </td>
          </tr>
        `;
        return;
      }

      tableBody.innerHTML = pageData.map(product => {
        const isSelected = selectedProducts.has(product.id);
        const categoryMap = {
          seafood: 'æµ·é²œæ°´äº§',
          meat: 'è‚‰ç±»ç¦½è›‹',
          vegetable: 'è”¬èœæœè”¬',
          grain: 'ç²®æ²¹ç±³é¢'
        };

        // åº“å­˜é¢„è­¦
        let stockClass = '';
        if (product.stock < 50) stockClass = 'stock-danger';
        else if (product.stock < 200) stockClass = 'stock-warning';

        // ä»·æ ¼ä¿¡æ¯
        const basePrice = product.price.base;
        const hasTiers = product.price.tiers && product.price.tiers.length > 0;
        const lowestPrice = hasTiers
          ? Math.min(...product.price.tiers.map(t => t.price))
          : basePrice;

        return `
          <tr class="${isSelected ? 'selected' : ''}">
            <td>
              <input
                type="checkbox"
                ${isSelected ? 'checked' : ''}
                onchange="toggleSelectProduct(${product.id})"
              >
            </td>
            <td>
              <div class="product-info">
                <img
                  src="${product.images[0]}"
                  alt="${product.name}"
                  class="product-image"
                >
                <div class="product-details">
                  <div class="product-name">${product.name}</div>
                  <div class="product-id">ID: ${product.id}</div>
                </div>
              </div>
            </td>
            <td>${categoryMap[product.category] || product.category}</td>
            <td>
              <div class="price-info">
                <div class="base-price">Â¥${basePrice}</div>
                ${hasTiers ? `<div class="tier-price">æœ€ä½ Â¥${lowestPrice}</div>` : ''}
              </div>
            </td>
            <td>
              <span class="${stockClass}">${product.stock}</span>
            </td>
            <td>
              <span class="status-badge ${product.status}">
                ${product.status === 'online' ? 'å·²ä¸Šæ¶' : 'å·²ä¸‹æ¶'}
              </span>
            </td>
            <td>${Utils.formatDate(product.updateTime, 'YYYY-MM-DD HH:mm')}</td>
            <td>
              <div class="action-buttons">
                <button class="action-btn" onclick="viewProduct(${product.id})">
                  æŸ¥çœ‹
                </button>
                <button class="action-btn" onclick="editProduct(${product.id})">
                  ç¼–è¾‘
                </button>
                <button class="action-btn" onclick="configPrice(${product.id})">
                  ä»·æ ¼é…ç½®
                </button>
                ${product.status === 'online'
                  ? `<button class="action-btn danger" onclick="toggleProductStatus(${product.id}, 'offline')">ä¸‹æ¶</button>`
                  : `<button class="action-btn success" onclick="toggleProductStatus(${product.id}, 'online')">ä¸Šæ¶</button>`
                }
              </div>
            </td>
          </tr>
        `;
      }).join('');

      // æ›´æ–°å…¨é€‰æ¡†çŠ¶æ€
      updateSelectAllCheckbox();
    }

    // ==================== æ¸²æŸ“åˆ†é¡µ ====================
    function renderPagination() {
      const totalPages = Math.ceil(filteredProducts.length / pageSize);
      const start = (currentPage - 1) * pageSize + 1;
      const end = Math.min(currentPage * pageSize, filteredProducts.length);

      // æ›´æ–°åˆ†é¡µä¿¡æ¯
      document.getElementById('paginationInfo').textContent =
        `æ˜¾ç¤º ${start}-${end} / å…± ${filteredProducts.length} æ¡`;

      // æ¸²æŸ“é¡µç æŒ‰é’®
      const pageButtons = document.getElementById('pageButtons');
      const buttons = [];

      // å§‹ç»ˆæ˜¾ç¤ºç¬¬ä¸€é¡µ
      buttons.push(1);

      // å½“å‰é¡µé™„è¿‘çš„é¡µç 
      const range = 2;
      for (let i = Math.max(2, currentPage - range); i <= Math.min(totalPages - 1, currentPage + range); i++) {
        if (!buttons.includes(i)) buttons.push(i);
      }

      // å§‹ç»ˆæ˜¾ç¤ºæœ€åä¸€é¡µ
      if (totalPages > 1 && !buttons.includes(totalPages)) {
        buttons.push(totalPages);
      }

      pageButtons.innerHTML = buttons.map((page, index) => {
        // æ·»åŠ çœç•¥å·
        const prevPage = buttons[index - 1];
        const ellipsis = prevPage && page - prevPage > 1
          ? '<span style="padding: 0 var(--spacing-xs);">...</span>'
          : '';

        return `
          ${ellipsis}
          <button
            class="pagination-btn ${page === currentPage ? 'active' : ''}"
            onclick="changePage(${page})"
          >
            ${page}
          </button>
        `;
      }).join('');

      // æ›´æ–°ä¸Šä¸€é¡µ/ä¸‹ä¸€é¡µæŒ‰é’®çŠ¶æ€
      document.getElementById('prevBtn').disabled = currentPage === 1;
      document.getElementById('nextBtn').disabled = currentPage === totalPages || totalPages === 0;
    }

    // ==================== åˆ‡æ¢é¡µç  ====================
    function changePage(page) {
      const totalPages = Math.ceil(filteredProducts.length / pageSize);
      if (page < 1 || page > totalPages) return;

      currentPage = page;
      renderTable();
      renderPagination();

      // æ»šåŠ¨åˆ°é¡¶éƒ¨
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    // ==================== åˆ‡æ¢å…¨é€‰ ====================
    function toggleSelectAll() {
      const selectAll = document.getElementById('selectAll').checked;
      const start = (currentPage - 1) * pageSize;
      const end = start + pageSize;
      const pageData = filteredProducts.slice(start, end);

      if (selectAll) {
        pageData.forEach(product => selectedProducts.add(product.id));
      } else {
        pageData.forEach(product => selectedProducts.delete(product.id));
      }

      renderTable();
      updateBulkActions();
    }

    // ==================== åˆ‡æ¢å•ä¸ªäº§å“é€‰æ‹© ====================
    function toggleSelectProduct(productId) {
      if (selectedProducts.has(productId)) {
        selectedProducts.delete(productId);
      } else {
        selectedProducts.add(productId);
      }

      renderTable();
      updateBulkActions();
    }

    // ==================== æ›´æ–°å…¨é€‰æ¡†çŠ¶æ€ ====================
    function updateSelectAllCheckbox() {
      const start = (currentPage - 1) * pageSize;
      const end = start + pageSize;
      const pageData = filteredProducts.slice(start, end);

      const allSelected = pageData.length > 0 && pageData.every(p => selectedProducts.has(p.id));
      const someSelected = pageData.some(p => selectedProducts.has(p.id));

      const selectAllCheckbox = document.getElementById('selectAll');
      selectAllCheckbox.checked = allSelected;
      selectAllCheckbox.indeterminate = someSelected && !allSelected;
    }

    // ==================== æ›´æ–°æ‰¹é‡æ“ä½œæŒ‰é’® ====================
    function updateBulkActions() {
      const bulkActions = document.getElementById('bulkActions');
      const selectedCount = document.getElementById('selectedCount');

      if (selectedProducts.size > 0) {
        bulkActions.style.display = 'flex';
        selectedCount.textContent = selectedProducts.size;
      } else {
        bulkActions.style.display = 'none';
      }
    }

    // ==================== æ¸…é™¤é€‰æ‹© ====================
    function clearSelection() {
      selectedProducts.clear();
      renderTable();
      updateBulkActions();
    }

    // ==================== æ‰¹é‡ä¸Šæ¶ ====================
    async function bulkOnline() {
      if (selectedProducts.size === 0) return;

      const confirmed = await Utils.confirm(
        `ç¡®è®¤ä¸Šæ¶é€‰ä¸­çš„ ${selectedProducts.size} ä¸ªäº§å“ï¼Ÿ`,
        'æ‰¹é‡ä¸Šæ¶'
      );

      if (confirmed) {
        selectedProducts.forEach(id => {
          const product = allProducts.find(p => p.id === id);
          if (product) product.status = 'online';
        });

        Utils.showToast(`æˆåŠŸä¸Šæ¶ ${selectedProducts.size} ä¸ªäº§å“`, 'success');
        clearSelection();
        applyFilters();
      }
    }

    // ==================== æ‰¹é‡ä¸‹æ¶ ====================
    async function bulkOffline() {
      if (selectedProducts.size === 0) return;

      const confirmed = await Utils.confirm(
        `ç¡®è®¤ä¸‹æ¶é€‰ä¸­çš„ ${selectedProducts.size} ä¸ªäº§å“ï¼Ÿ`,
        'æ‰¹é‡ä¸‹æ¶'
      );

      if (confirmed) {
        selectedProducts.forEach(id => {
          const product = allProducts.find(p => p.id === id);
          if (product) product.status = 'offline';
        });

        Utils.showToast(`æˆåŠŸä¸‹æ¶ ${selectedProducts.size} ä¸ªäº§å“`, 'success');
        clearSelection();
        applyFilters();
      }
    }

    // ==================== åˆ‡æ¢äº§å“çŠ¶æ€ ====================
    async function toggleProductStatus(productId, newStatus) {
      const product = allProducts.find(p => p.id === productId);
      if (!product) return;

      const action = newStatus === 'online' ? 'ä¸Šæ¶' : 'ä¸‹æ¶';
      const confirmed = await Utils.confirm(
        `ç¡®è®¤${action}äº§å“ã€Œ${product.name}ã€ï¼Ÿ`,
        `${action}äº§å“`
      );

      if (confirmed) {
        product.status = newStatus;
        Utils.showToast(`${action}æˆåŠŸ`, 'success');
        applyFilters();
      }
    }

    // ==================== æŸ¥çœ‹äº§å“ ====================
    function viewProduct(productId) {
      Utils.showToast(`æŸ¥çœ‹äº§å“è¯¦æƒ…åŠŸèƒ½å¼€å‘ä¸­ (ID: ${productId})`, 'info');
    }

    // ==================== ç¼–è¾‘äº§å“ ====================
    function editProduct(productId) {
      Utils.showToast(`ç¼–è¾‘äº§å“åŠŸèƒ½å¼€å‘ä¸­ (ID: ${productId})`, 'info');
      // å®é™…åº”è¯¥è·³è½¬åˆ°ç¼–è¾‘é¡µé¢
      // window.location.href = `edit.html?id=${productId}`;
    }

    // ==================== ä»·æ ¼é…ç½® ====================
    function configPrice(productId) {
      // è·³è½¬åˆ°ä»·æ ¼é…ç½®é¡µé¢
      window.location.href = `price-config.html?id=${productId}`;
    }

    // ==================== å¯¼èˆªå‡½æ•° ====================
    function navigateTo(path) {
      window.location.href = path;
    }
  </script>
</body>
</html>
