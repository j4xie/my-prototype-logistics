<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>åˆ›å»ºæ‰¹æ¬¡ - ç™½å©çºªé£Ÿå“æº¯æºç³»ç»Ÿ</title>
    <link rel="stylesheet" href="../../assets/css/common.css">
    <link rel="stylesheet" href="../../assets/css/mobile.css">
    <style>
        /* ç§»åŠ¨ç«¯å¸ƒå±€ */
        body {
            max-width: 428px;
            margin: 0 auto;
            background: #f5f5f5;
        }

        .page-content {
            padding-bottom: 120px; /* ä¸ºåº•éƒ¨æŒ‰é’®ç•™ç©ºé—´ */
        }

        /* è¡¨å•å®¹å™¨ */
        .form-container {
            background: white;
            border-radius: 16px;
            padding: 20px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.08);
            position: relative;
        }

        /* æµç¨‹æŒ‡ç¤ºå™¨ */
        .flow-indicator {
            position: absolute;
            right: 16px;
            top: 16px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 8px 14px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        /* è¡¨å•ç»„ */
        .form-group {
            margin-bottom: 24px;
            position: relative;
        }

        .form-group.required .form-label::after {
            content: '*';
            color: #ff4d4f;
            margin-left: 4px;
            font-size: 16px;
        }

        .form-label {
            display: block;
            font-size: 15px;
            font-weight: 600;
            color: #262626;
            margin-bottom: 10px;
        }

        .form-hint {
            font-size: 13px;
            color: #8c8c8c;
            margin-top: 6px;
        }

        /* è¡¨å•æ§ä»¶ */
        .form-input,
        .form-select,
        .form-textarea {
            width: 100%;
            min-height: 48px;
            padding: 12px 16px;
            border: 2px solid #e8e8e8;
            border-radius: 10px;
            font-size: 15px;
            transition: all 0.3s;
            background: #fafafa;
        }

        .form-input:focus,
        .form-select:focus,
        .form-textarea:focus {
            outline: none;
            border-color: #667eea;
            background: white;
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
        }

        .form-textarea {
            min-height: 100px;
            resize: vertical;
            font-family: inherit;
        }

        .form-select {
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg width='12' height='8' viewBox='0 0 12 8' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M1 1L6 6L11 1' stroke='%238c8c8c' stroke-width='2' stroke-linecap='round'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 16px center;
            padding-right: 48px;
        }

        /* æ•°å­—è¾“å…¥æ¡† */
        .number-input-wrapper {
            position: relative;
        }

        .number-input-wrapper .unit {
            position: absolute;
            right: 16px;
            top: 50%;
            transform: translateY(-50%);
            color: #8c8c8c;
            font-weight: 500;
            pointer-events: none;
        }

        .number-input-wrapper .form-input {
            padding-right: 50px;
        }

        /* å¤é€‰æ¡†åˆ—è¡¨ */
        .checkbox-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            padding: 14px;
            border: 2px solid #e8e8e8;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            background: #fafafa;
        }

        .checkbox-item:active {
            transform: scale(0.98);
        }

        .checkbox-item.checked {
            border-color: #667eea;
            background: #f0f2ff;
        }

        .checkbox-item input[type="checkbox"] {
            width: 24px;
            height: 24px;
            margin-right: 12px;
            cursor: pointer;
            accent-color: #667eea;
        }

        .checkbox-content {
            flex: 1;
        }

        .checkbox-title {
            font-size: 15px;
            font-weight: 500;
            color: #262626;
            margin-bottom: 4px;
        }

        .checkbox-meta {
            font-size: 13px;
            color: #8c8c8c;
            display: flex;
            gap: 16px;
        }

        .stock-indicator {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .stock-indicator.low {
            color: #ff4d4f;
        }

        .stock-indicator.normal {
            color: #52c41a;
        }

        /* å•é€‰æŒ‰é’®ç»„ */
        .radio-group {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .radio-item {
            display: flex;
            align-items: center;
            padding: 14px;
            border: 2px solid #e8e8e8;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            background: #fafafa;
            position: relative;
        }

        .radio-item:active {
            transform: scale(0.98);
        }

        .radio-item.checked {
            border-color: #667eea;
            background: #f0f2ff;
        }

        .radio-item.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .radio-item input[type="radio"] {
            width: 24px;
            height: 24px;
            margin-right: 12px;
            cursor: pointer;
            accent-color: #667eea;
        }

        .radio-item.disabled input[type="radio"] {
            cursor: not-allowed;
        }

        .radio-content {
            flex: 1;
        }

        .radio-title {
            font-size: 15px;
            font-weight: 500;
            color: #262626;
        }

        .radio-status {
            position: absolute;
            right: 14px;
            top: 50%;
            transform: translateY(-50%);
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }

        .status-available {
            background: #e6f7ff;
            color: #1890ff;
        }

        .status-busy {
            background: #fff7e6;
            color: #fa8c16;
        }

        /* å‘˜å·¥é€‰æ‹©å™¨ */
        .employee-selector {
            display: flex;
            align-items: center;
            padding: 14px;
            border: 2px solid #e8e8e8;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            background: #fafafa;
        }

        .employee-selector:active {
            transform: scale(0.98);
        }

        .employee-selector.selected {
            border-color: #667eea;
            background: #f0f2ff;
        }

        .employee-avatar {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            font-weight: bold;
            margin-right: 12px;
        }

        .employee-info {
            flex: 1;
        }

        .employee-name {
            font-size: 15px;
            font-weight: 500;
            color: #262626;
            margin-bottom: 4px;
        }

        .employee-title {
            font-size: 13px;
            color: #8c8c8c;
        }

        .select-icon {
            font-size: 20px;
            color: #8c8c8c;
        }

        /* æ—¥æœŸé€‰æ‹©å™¨ */
        .datetime-input {
            position: relative;
        }

        .datetime-input input[type="datetime-local"] {
            width: 100%;
            min-height: 48px;
            padding: 12px 16px;
            border: 2px solid #e8e8e8;
            border-radius: 10px;
            font-size: 15px;
            background: #fafafa;
            cursor: pointer;
        }

        .datetime-input input[type="datetime-local"]:focus {
            outline: none;
            border-color: #667eea;
            background: white;
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
        }

        /* åº•éƒ¨æ“ä½œæ  */
        .action-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            max-width: 428px;
            margin: 0 auto;
            padding: 16px;
            background: white;
            box-shadow: 0 -4px 16px rgba(0,0,0,0.08);
            display: flex;
            gap: 12px;
            z-index: 100;
        }

        .btn {
            flex: 1;
            min-height: 52px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }

        .btn:active {
            transform: scale(0.96);
        }

        .btn-secondary {
            background: #f5f5f5;
            color: #595959;
            border: 2px solid #d9d9d9;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 4px 16px rgba(102, 126, 234, 0.4);
        }

        .btn-primary:active {
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.4);
        }

        /* éªŒè¯é”™è¯¯ */
        .error-message {
            color: #ff4d4f;
            font-size: 13px;
            margin-top: 6px;
            display: none;
        }

        .form-group.error .form-input,
        .form-group.error .form-select,
        .form-group.error .form-textarea {
            border-color: #ff4d4f;
            background: #fff1f0;
        }

        .form-group.error .error-message {
            display: block;
        }

        /* æµç¨‹ç®­å¤´ */
        .flow-arrow {
            position: relative;
            padding: 12px;
            background: linear-gradient(135deg, #e6f7ff 0%, #f0f2ff 100%);
            border-radius: 10px;
            margin: 20px 0;
            border-left: 4px solid #667eea;
        }

        .flow-arrow::before {
            content: 'â†’';
            font-size: 20px;
            color: #667eea;
            margin-right: 8px;
        }

        .flow-text {
            color: #262626;
            font-size: 14px;
            font-weight: 500;
        }

        /* è‰ç¨¿ä¿å­˜æç¤º */
        .draft-indicator {
            position: fixed;
            top: 70px;
            right: 16px;
            background: rgba(0, 0, 0, 0.75);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 13px;
            display: none;
            z-index: 200;
            animation: fadeInOut 2s;
        }

        @keyframes fadeInOut {
            0%, 100% { opacity: 0; }
            10%, 90% { opacity: 1; }
        }

        /* å‘˜å·¥é€‰æ‹©å¼¹çª— */
        .employee-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 300;
            max-width: 428px;
            margin: 0 auto;
            align-items: flex-end;
        }

        .employee-modal.show {
            display: flex;
        }

        .employee-modal-content {
            background: white;
            border-radius: 20px 20px 0 0;
            width: 100%;
            max-height: 70vh;
            overflow-y: auto;
            animation: slideUp 0.3s;
        }

        @keyframes slideUp {
            from { transform: translateY(100%); }
            to { transform: translateY(0); }
        }

        .modal-header {
            padding: 20px;
            border-bottom: 1px solid #f0f0f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 18px;
            font-weight: 600;
            color: #262626;
        }

        .modal-close {
            font-size: 28px;
            cursor: pointer;
            color: #8c8c8c;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.2s;
        }

        .modal-close:active {
            background: #f5f5f5;
            transform: scale(0.9);
        }

        .employee-list {
            padding: 12px;
        }

        .employee-list-item {
            display: flex;
            align-items: center;
            padding: 14px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .employee-list-item:active {
            background: #f5f5f5;
            transform: scale(0.98);
        }
    </style>
</head>
<body>
    <div class="page-container">
        <!-- é¡µé¢å¤´éƒ¨ -->
        <div class="page-header">
            <div class="navbar">
                <a href="list.html" class="back-button" style="width: 44px; height: 44px; display: flex; align-items: center; justify-content: center; border-radius: 50%; background: rgba(24,144,255,0.1);">
                    <span style="font-size: 20px;">â†</span>
                </a>
                <h1 style="font-size: 18px; font-weight: 600; color: #262626; flex: 1; text-align: center;">åˆ›å»ºæ‰¹æ¬¡</h1>
                <button onclick="saveDraft()" style="padding: 8px 16px; background: rgba(102, 126, 234, 0.1); border: none; border-radius: 20px; color: #667eea; font-size: 14px; font-weight: 500; cursor: pointer; min-width: 44px; min-height: 44px;">
                    ğŸ’¾ è‰ç¨¿
                </button>
            </div>
        </div>

        <!-- è‰ç¨¿ä¿å­˜æç¤º -->
        <div id="draftIndicator" class="draft-indicator">
            âœ“ è‰ç¨¿å·²ä¿å­˜
        </div>

        <!-- ä¸»å†…å®¹åŒº -->
        <div class="page-content">
            <!-- æµç¨‹æŒ‡ç¤º -->
            <div class="flow-arrow">
                <span class="flow-text">å¡«å†™å®Œæˆåç‚¹å‡»åº•éƒ¨"åˆ›å»ºæ‰¹æ¬¡"æŒ‰é’®</span>
            </div>

            <!-- è¡¨å•å®¹å™¨ -->
            <form id="batchForm" class="form-container">
                <div class="flow-indicator">ğŸ“‹ æ–°å»ºæ‰¹æ¬¡</div>

                <!-- äº§å“ç±»å‹é€‰æ‹© -->
                <div class="form-group required">
                    <label class="form-label">äº§å“ç±»å‹</label>
                    <select id="productType" name="productType" class="form-select" required>
                        <option value="">è¯·é€‰æ‹©äº§å“ç±»å‹</option>
                        <option value="frozen_fish_fillet">é€Ÿå†»é±¼æ’</option>
                        <option value="frozen_fish_ball">å†·å†»é±¼ä¸¸</option>
                        <option value="frozen_shrimp">é€Ÿå†»è™¾ä»</option>
                        <option value="frozen_hairtail">é€Ÿå†»å¸¦é±¼æ®µ</option>
                    </select>
                    <div class="error-message">è¯·é€‰æ‹©äº§å“ç±»å‹</div>
                </div>

                <!-- åŸææ–™é€‰æ‹© -->
                <div class="form-group required">
                    <label class="form-label">åŸææ–™é€‰æ‹©</label>
                    <div class="form-hint">å¯å¤šé€‰ï¼Œåº“å­˜ä¸è¶³æ—¶ä¼šæ ‡çº¢æç¤º</div>
                    <div class="checkbox-list">
                        <label class="checkbox-item">
                            <input type="checkbox" name="materials" value="bass">
                            <div class="checkbox-content">
                                <div class="checkbox-title">é²ˆé±¼</div>
                                <div class="checkbox-meta">
                                    <span class="stock-indicator normal">ğŸ“¦ åº“å­˜: 500 kg</span>
                                    <span>ğŸ’° Â¥28/kg</span>
                                </div>
                            </div>
                        </label>
                        <label class="checkbox-item">
                            <input type="checkbox" name="materials" value="hairtail">
                            <div class="checkbox-content">
                                <div class="checkbox-title">å¸¦é±¼</div>
                                <div class="checkbox-meta">
                                    <span class="stock-indicator normal">ğŸ“¦ åº“å­˜: 300 kg</span>
                                    <span>ğŸ’° Â¥32/kg</span>
                                </div>
                            </div>
                        </label>
                        <label class="checkbox-item">
                            <input type="checkbox" name="materials" value="shrimp">
                            <div class="checkbox-content">
                                <div class="checkbox-title">è™¾ä»</div>
                                <div class="checkbox-meta">
                                    <span class="stock-indicator low">ğŸ“¦ åº“å­˜: 200 kg</span>
                                    <span>ğŸ’° Â¥85/kg</span>
                                </div>
                            </div>
                        </label>
                        <label class="checkbox-item">
                            <input type="checkbox" name="materials" value="squid">
                            <div class="checkbox-content">
                                <div class="checkbox-title">é±¿é±¼</div>
                                <div class="checkbox-meta">
                                    <span class="stock-indicator normal">ğŸ“¦ åº“å­˜: 350 kg</span>
                                    <span>ğŸ’° Â¥45/kg</span>
                                </div>
                            </div>
                        </label>
                    </div>
                    <div class="error-message">è¯·è‡³å°‘é€‰æ‹©ä¸€ç§åŸææ–™</div>
                </div>

                <!-- ç›®æ ‡äº§é‡ -->
                <div class="form-group required">
                    <label class="form-label">ç›®æ ‡äº§é‡</label>
                    <div class="number-input-wrapper">
                        <input type="number" id="targetQuantity" name="targetQuantity" class="form-input" placeholder="è¯·è¾“å…¥ç›®æ ‡äº§é‡" min="1" step="0.1" required>
                        <span class="unit">kg</span>
                    </div>
                    <div class="form-hint">æ ¹æ®åŸææ–™åº“å­˜è‡ªåŠ¨è®¡ç®—æœ€å¤§å¯ç”Ÿäº§é‡</div>
                    <div class="error-message">è¯·è¾“å…¥æœ‰æ•ˆçš„ç›®æ ‡äº§é‡</div>
                </div>

                <!-- ç”Ÿäº§çº¿é€‰æ‹© -->
                <div class="form-group required">
                    <label class="form-label">ç”Ÿäº§çº¿é€‰æ‹©</label>
                    <div class="radio-group">
                        <label class="radio-item">
                            <input type="radio" name="productionLine" value="line_a" required>
                            <div class="radio-content">
                                <div class="radio-title">ç”Ÿäº§çº¿ A</div>
                            </div>
                            <span class="radio-status status-available">å¯ç”¨</span>
                        </label>
                        <label class="radio-item disabled">
                            <input type="radio" name="productionLine" value="line_b" disabled>
                            <div class="radio-content">
                                <div class="radio-title">ç”Ÿäº§çº¿ B</div>
                            </div>
                            <span class="radio-status status-busy">ä½¿ç”¨ä¸­</span>
                        </label>
                        <label class="radio-item">
                            <input type="radio" name="productionLine" value="line_c" required>
                            <div class="radio-content">
                                <div class="radio-title">ç”Ÿäº§çº¿ C</div>
                            </div>
                            <span class="radio-status status-available">å¯ç”¨</span>
                        </label>
                    </div>
                    <div class="error-message">è¯·é€‰æ‹©ä¸€æ¡å¯ç”¨çš„ç”Ÿäº§çº¿</div>
                </div>

                <!-- è´Ÿè´£äººé€‰æ‹© -->
                <div class="form-group required">
                    <label class="form-label">è´Ÿè´£äºº</label>
                    <div id="employeeSelector" class="employee-selector" onclick="showEmployeeModal()">
                        <div class="employee-avatar">?</div>
                        <div class="employee-info">
                            <div class="employee-name">è¯·é€‰æ‹©è´Ÿè´£äºº</div>
                            <div class="employee-title">ç‚¹å‡»é€‰æ‹©</div>
                        </div>
                        <span class="select-icon">â€º</span>
                    </div>
                    <input type="hidden" id="selectedEmployee" name="supervisor" required>
                    <div class="error-message">è¯·é€‰æ‹©è´Ÿè´£äºº</div>
                </div>

                <!-- å¼€å§‹æ—¥æœŸ -->
                <div class="form-group required">
                    <label class="form-label">å¼€å§‹æ—¥æœŸ</label>
                    <div class="datetime-input">
                        <input type="datetime-local" id="startDate" name="startDate" class="form-input" required>
                    </div>
                    <div class="form-hint">é»˜è®¤ä¸ºå½“å‰æ—¶é—´ï¼Œå¯è‡ªå®šä¹‰é€‰æ‹©</div>
                    <div class="error-message">è¯·é€‰æ‹©å¼€å§‹æ—¥æœŸ</div>
                </div>

                <!-- å¤‡æ³¨ -->
                <div class="form-group">
                    <label class="form-label">å¤‡æ³¨ä¿¡æ¯</label>
                    <textarea id="notes" name="notes" class="form-textarea" placeholder="æ·»åŠ å¤‡æ³¨ä¿¡æ¯ï¼ˆå¯é€‰ï¼‰..."></textarea>
                    <div class="form-hint">å¯é€‰å¡«å†™ç‰¹æ®Šè¦æ±‚ã€æ³¨æ„äº‹é¡¹ç­‰</div>
                </div>
            </form>

            <!-- æµç¨‹è¯´æ˜ -->
            <div class="flow-arrow" style="margin-top: 24px;">
                <span class="flow-text">ç‚¹å‡»"åˆ›å»ºæ‰¹æ¬¡" â†’ åˆ›å»ºæˆåŠŸåè·³è½¬åˆ°æ‰¹æ¬¡åˆ—è¡¨</span>
            </div>

            <div class="flow-arrow">
                <span class="flow-text">ç‚¹å‡»"å–æ¶ˆ" â†’ è¿”å›æ‰¹æ¬¡åˆ—è¡¨ï¼ˆä¸ä¿å­˜ï¼‰</span>
            </div>
        </div>

        <!-- åº•éƒ¨æ“ä½œæ  -->
        <div class="action-bar">
            <button type="button" class="btn btn-secondary" onclick="cancelCreate()">
                âœ• å–æ¶ˆ
            </button>
            <button type="submit" form="batchForm" class="btn btn-primary">
                âœ“ åˆ›å»ºæ‰¹æ¬¡
            </button>
        </div>

        <!-- å‘˜å·¥é€‰æ‹©å¼¹çª— -->
        <div id="employeeModal" class="employee-modal" onclick="hideEmployeeModal(event)">
            <div class="employee-modal-content" onclick="event.stopPropagation()">
                <div class="modal-header">
                    <div class="modal-title">é€‰æ‹©è´Ÿè´£äºº</div>
                    <div class="modal-close" onclick="hideEmployeeModal()">Ã—</div>
                </div>
                <div class="employee-list">
                    <div class="employee-list-item" onclick="selectEmployee('wang', 'ç‹å¸ˆå‚…', 'ç”Ÿäº§ä¸»ç®¡')">
                        <div class="employee-avatar" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">ç‹</div>
                        <div class="employee-info">
                            <div class="employee-name">ç‹å¸ˆå‚…</div>
                            <div class="employee-title">ç”Ÿäº§ä¸»ç®¡ â€¢ 5å¹´ç»éªŒ</div>
                        </div>
                    </div>
                    <div class="employee-list-item" onclick="selectEmployee('li', 'æå¸ˆå‚…', 'æŠ€æœ¯è´Ÿè´£äºº')">
                        <div class="employee-avatar" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">æ</div>
                        <div class="employee-info">
                            <div class="employee-name">æå¸ˆå‚…</div>
                            <div class="employee-title">æŠ€æœ¯è´Ÿè´£äºº â€¢ 8å¹´ç»éªŒ</div>
                        </div>
                    </div>
                    <div class="employee-list-item" onclick="selectEmployee('zhao', 'èµµå¸ˆå‚…', 'è´¨æ£€ä¸“å‘˜')">
                        <div class="employee-avatar" style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);">èµµ</div>
                        <div class="employee-info">
                            <div class="employee-name">èµµå¸ˆå‚…</div>
                            <div class="employee-title">è´¨æ£€ä¸“å‘˜ â€¢ 3å¹´ç»éªŒ</div>
                        </div>
                    </div>
                    <div class="employee-list-item" onclick="selectEmployee('chen', 'é™ˆå¸ˆå‚…', 'ç”Ÿäº§ç»„é•¿')">
                        <div class="employee-avatar" style="background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);">é™ˆ</div>
                        <div class="employee-info">
                            <div class="employee-name">é™ˆå¸ˆå‚…</div>
                            <div class="employee-title">ç”Ÿäº§ç»„é•¿ â€¢ 6å¹´ç»éªŒ</div>
                        </div>
                    </div>
                    <div class="employee-list-item" onclick="selectEmployee('sun', 'å­™å¸ˆå‚…', 'è®¾å¤‡æ“ä½œå‘˜')">
                        <div class="employee-avatar" style="background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);">å­™</div>
                        <div class="employee-info">
                            <div class="employee-name">å­™å¸ˆå‚…</div>
                            <div class="employee-title">è®¾å¤‡æ“ä½œå‘˜ â€¢ 4å¹´ç»éªŒ</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // åˆå§‹åŒ–è¡¨å•
        document.addEventListener('DOMContentLoaded', function() {
            // è®¾ç½®é»˜è®¤å¼€å§‹æ—¥æœŸä¸ºå½“å‰æ—¶é—´
            const now = new Date();
            now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
            document.getElementById('startDate').value = now.toISOString().slice(0, 16);

            // å¤é€‰æ¡†é€‰ä¸­æ•ˆæœ
            document.querySelectorAll('.checkbox-item input[type="checkbox"]').forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    if (this.checked) {
                        this.closest('.checkbox-item').classList.add('checked');
                    } else {
                        this.closest('.checkbox-item').classList.remove('checked');
                    }
                });
            });

            // å•é€‰æŒ‰é’®é€‰ä¸­æ•ˆæœ
            document.querySelectorAll('.radio-item input[type="radio"]').forEach(radio => {
                radio.addEventListener('change', function() {
                    document.querySelectorAll('.radio-item').forEach(item => {
                        item.classList.remove('checked');
                    });
                    if (this.checked) {
                        this.closest('.radio-item').classList.add('checked');
                    }
                });
            });

            // è¡¨å•éªŒè¯
            const form = document.getElementById('batchForm');
            form.addEventListener('submit', function(e) {
                e.preventDefault();

                let isValid = true;

                // éªŒè¯äº§å“ç±»å‹
                const productType = document.getElementById('productType');
                if (!productType.value) {
                    productType.closest('.form-group').classList.add('error');
                    isValid = false;
                } else {
                    productType.closest('.form-group').classList.remove('error');
                }

                // éªŒè¯åŸææ–™ï¼ˆè‡³å°‘é€‰ä¸€ä¸ªï¼‰
                const materials = document.querySelectorAll('input[name="materials"]:checked');
                const materialsGroup = document.querySelector('input[name="materials"]').closest('.form-group');
                if (materials.length === 0) {
                    materialsGroup.classList.add('error');
                    isValid = false;
                } else {
                    materialsGroup.classList.remove('error');
                }

                // éªŒè¯ç›®æ ‡äº§é‡
                const targetQuantity = document.getElementById('targetQuantity');
                if (!targetQuantity.value || targetQuantity.value <= 0) {
                    targetQuantity.closest('.form-group').classList.add('error');
                    isValid = false;
                } else {
                    targetQuantity.closest('.form-group').classList.remove('error');
                }

                // éªŒè¯ç”Ÿäº§çº¿
                const productionLine = document.querySelector('input[name="productionLine"]:checked');
                const productionLineGroup = document.querySelector('input[name="productionLine"]').closest('.form-group');
                if (!productionLine) {
                    productionLineGroup.classList.add('error');
                    isValid = false;
                } else {
                    productionLineGroup.classList.remove('error');
                }

                // éªŒè¯è´Ÿè´£äºº
                const supervisor = document.getElementById('selectedEmployee');
                if (!supervisor.value) {
                    supervisor.closest('.form-group').classList.add('error');
                    isValid = false;
                } else {
                    supervisor.closest('.form-group').classList.remove('error');
                }

                // éªŒè¯å¼€å§‹æ—¥æœŸ
                const startDate = document.getElementById('startDate');
                if (!startDate.value) {
                    startDate.closest('.form-group').classList.add('error');
                    isValid = false;
                } else {
                    startDate.closest('.form-group').classList.remove('error');
                }

                if (isValid) {
                    // æ¨¡æ‹Ÿåˆ›å»ºæˆåŠŸ
                    showSuccess();
                } else {
                    // æ»šåŠ¨åˆ°ç¬¬ä¸€ä¸ªé”™è¯¯
                    const firstError = document.querySelector('.form-group.error');
                    if (firstError) {
                        firstError.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }
                }
            });

            // è‡ªåŠ¨ä¿å­˜è‰ç¨¿
            let saveTimeout;
            form.addEventListener('input', function() {
                clearTimeout(saveTimeout);
                saveTimeout = setTimeout(() => {
                    saveDraftSilent();
                }, 2000);
            });
        });

        // æ˜¾ç¤ºå‘˜å·¥é€‰æ‹©å¼¹çª—
        function showEmployeeModal() {
            document.getElementById('employeeModal').classList.add('show');
        }

        // éšè—å‘˜å·¥é€‰æ‹©å¼¹çª—
        function hideEmployeeModal(event) {
            if (!event || event.target.id === 'employeeModal') {
                document.getElementById('employeeModal').classList.remove('show');
            }
        }

        // é€‰æ‹©å‘˜å·¥
        function selectEmployee(id, name, title) {
            document.getElementById('selectedEmployee').value = id;
            const selector = document.getElementById('employeeSelector');
            selector.classList.add('selected');
            selector.querySelector('.employee-name').textContent = name;
            selector.querySelector('.employee-title').textContent = title;
            selector.querySelector('.employee-avatar').textContent = name.charAt(0);
            hideEmployeeModal();
        }

        // ä¿å­˜è‰ç¨¿ï¼ˆå¸¦æç¤ºï¼‰
        function saveDraft() {
            const formData = new FormData(document.getElementById('batchForm'));
            localStorage.setItem('batchDraft', JSON.stringify(Object.fromEntries(formData)));

            const indicator = document.getElementById('draftIndicator');
            indicator.style.display = 'block';
            setTimeout(() => {
                indicator.style.display = 'none';
            }, 2000);
        }

        // é™é»˜ä¿å­˜è‰ç¨¿
        function saveDraftSilent() {
            const formData = new FormData(document.getElementById('batchForm'));
            localStorage.setItem('batchDraft', JSON.stringify(Object.fromEntries(formData)));
        }

        // å–æ¶ˆåˆ›å»º
        function cancelCreate() {
            if (confirm('ç¡®å®šè¦å–æ¶ˆåˆ›å»ºå—ï¼Ÿæœªä¿å­˜çš„å†…å®¹å°†ä¼šä¸¢å¤±ã€‚')) {
                window.location.href = 'list.html';
            }
        }

        // åˆ›å»ºæˆåŠŸ
        function showSuccess() {
            // æ¸…é™¤è‰ç¨¿
            localStorage.removeItem('batchDraft');

            // æ¨¡æ‹Ÿåˆ›å»ºæˆåŠŸï¼Œè·³è½¬åˆ°åˆ—è¡¨
            alert('âœ“ æ‰¹æ¬¡åˆ›å»ºæˆåŠŸï¼\næ‰¹æ¬¡å·: FAC001-20250105-004\nçŠ¶æ€: è®¡åˆ’ä¸­');
            window.location.href = 'list.html';
        }

        // æ¨¡æ‹Ÿé”®ç›˜é¿è®©ï¼ˆè¾“å…¥æ—¶é¡µé¢ä¸Šæ¨ï¼‰
        document.querySelectorAll('input, textarea, select').forEach(input => {
            input.addEventListener('focus', function() {
                // åœ¨ç§»åŠ¨ç«¯å®é™…ä¼šè§¦å‘é”®ç›˜ï¼Œè¿™é‡Œä»…æ¨¡æ‹Ÿæ•ˆæœ
                setTimeout(() => {
                    this.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }, 300);
            });
        });
    </script>
    <script src="../../assets/js/flow-navigator.js"></script>
</body>
</html>
