# 正确的业务流程 - 最终版

## 🎯 核心业务逻辑

### 业务流程图

```
第1步: 原材料入库 (管理员)
       采购1000kg鲈鱼 → 记录入库 → 库存总量: 1000kg

第2步: 创建生产计划 (管理员)
       商家订单500kg鲈鱼片
       → 系统计算: 需要1000kg鲈鱼 (50%转换率)
       → 虚拟扣减库存: 1000kg - 1000kg = 0kg
       → 检查: 库存充足 ✓

第3步: 员工每日记录生产量
       第1天: 100kg  ┐
       第2天: 120kg  │
       第3天: 110kg  ├→ 累计: 485kg
       第4天: 105kg  │
       第5天: 50kg   ┘

第4步: 完成盘点 (管理员)
       理论库存: 0kg (1000-1000)
       实际库存: 检查仓库
       ├─ 如果有剩余 → 转换率偏高，需调整算法
       └─ 如果不足   → 生产浪费，填写缺料报告

第5步: 数据分析
       - 产量差异: 500kg计划 vs 485kg实际
       - 库存差异: 0kg理论 vs ?kg实际
       - 每日对比: 哪天效率最高/最低
       - 成本分析: 浪费了多少原材料
```

---

## 📋 完整实例演示：王老板订单

### 背景
- 时间: 2025年10月6日
- 订单: 王老板需要500kg鲈鱼片
- 现状: 仓库有2000kg鲈鱼库存

---

## 第1步: 原材料入库 (10月1日) ⭐ MaterialTypeSelector主要使用

### 场景: 管理员记录采购的原材料入库

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
管理员张经理操作
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

登录: super_admin / 123456

导航: 管理 → 库存管理 → 原材料入库

点击 [新增入库]

┌─────────────────────────────────┐
│ 原材料入库                      │
│                         [X 关闭] │
├─────────────────────────────────┤
│ 原材料类型 *                    │
│ ┌─────────────────────────────┐ │
│ │ 选择原材料类型 ▼            │ │ ← 点击这里
│ └─────────────────────────────┘ │
│                                 │
│ 数量 (kg) *                     │
│ ┌─────────────────────────────┐ │
│ │                             │ │
│ └─────────────────────────────┘ │
│                                 │
│ 供应商                          │
│ ┌─────────────────────────────┐ │
│ │ 选择供应商 ▼                │ │
│ └─────────────────────────────┘ │
│                                 │
│ 入库日期                        │
│ 2025-10-01                      │
│                                 │
│ [取消]  [提交入库]              │
└─────────────────────────────────┘

🎯 点击"选择原材料类型"，弹出MaterialTypeSelector:

┌─────────────────────────────────┐
│ 选择原材料类型           [取消] │
├─────────────────────────────────┤
│ 🔍 搜索原材料...                │
├─────────────────────────────────┤
│ • 鲈鱼 (淡水鱼)              ✓  │ ← 选择鲈鱼
│ • 带鱼 (海水鱼)                 │
│ • 黄花鱼 (海水鱼)               │
│ • 大虾 (虾蟹类)                 │
│ • 扇贝 (贝类)                   │
│                                 │
│ ↓ 滚动查看更多 ↓               │
└─────────────────────────────────┘

选择"鲈鱼"后，继续填写:

┌─────────────────────────────────┐
│ 原材料入库                      │
├─────────────────────────────────┤
│ 原材料类型 *                    │
│ 鲈鱼 ✓                          │
│                                 │
│ 数量 (kg) *                     │
│ ┌─────────────────────────────┐ │
│ │ 2000                        │ │ ← 输入数量
│ └─────────────────────────────┘ │
│                                 │
│ 供应商                          │
│ 海鲜批发商A ✓                   │
│                                 │
│ 入库日期                        │
│ 2025-10-01                      │
│                                 │
│ 备注                            │
│ ┌─────────────────────────────┐ │
│ │ 本周采购，鱼质量很好         │ │
│ └─────────────────────────────┘ │
│                                 │
│ [取消]  [提交入库]              │ ← 点击提交
└─────────────────────────────────┘

提交成功:
✅ 原材料入库成功
✅ 鲈鱼库存: 0kg → 2000kg
✅ 入库记录已保存
```

### 📌 如果原材料类型不存在 - MaterialTypeSelector快速添加

```
场景: 第一次采购石斑鱼

点击"选择原材料类型"
→ 搜索"石斑鱼"
→ 未找到

滚动到底部:
┌─────────────────────────────────┐
│ • 鱿鱼 (头足类)                 │
│ • 章鱼 (头足类)                 │
├─────────────────────────────────┤
│ ┌─────────────────────────────┐ │
│ │ ➕ 找不到？点击添加新原材料  │ │ ← 点击
│ │    类型                     │ │
│ └─────────────────────────────┘ │
└─────────────────────────────────┘

快捷添加表单展开:
┌─────────────────────────────────┐
│ 添加新原材料                    │
├─────────────────────────────────┤
│ 原材料名称 *                    │
│ ┌─────────────────────────────┐ │
│ │ 石斑鱼                      │ │ ← 输入
│ └─────────────────────────────┘ │
│                                 │
│ 分类                            │
│ [鱼类] [虾蟹类] [贝类]          │ ← 选择鱼类
│ [头足类] [其他]                 │
│                                 │
│ [取消]  [保存]                  │ ← 点击保存
└─────────────────────────────────┘

✅ 石斑鱼已添加
✅ 自动选中
✅ 继续填写数量

下次其他管理员或员工需要用到石斑鱼，
直接在列表中选择即可，不需要重新添加！
```

---

## 第2步: 创建生产计划 (10月6日)

### 场景: 接到王老板订单，创建生产计划

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
管理员张经理操作
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

导航: 管理 → 生产计划管理

点击右下角 [+ 新建]

┌─────────────────────────────────┐
│ 新建生产计划            [X 关闭] │
├─────────────────────────────────┤
│ 商家 *                          │
│ ┌─────────────────────────────┐ │
│ │ 海鲜批发商A (王老板) ▼      │ │ ← 选择商家
│ └─────────────────────────────┘ │
│                                 │
│ 出货产品类型 *                  │
│ ┌─────────────────────────────┐ │
│ │ 鲈鱼片 ▼                    │ │ ← 选择产品
│ └─────────────────────────────┘ │
│                                 │
│ 计划产量 (kg) *                 │
│ ┌─────────────────────────────┐ │
│ │ 500                         │ │ ← 输入产量
│ └─────────────────────────────┘ │
│                                 │
│ ━━━━━━━━━━━━━━━━━━━━━━━━━━━   │
│ 💡 系统自动计算                 │
│ ━━━━━━━━━━━━━━━━━━━━━━━━━━━   │
│                                 │
│ 预估原材料消耗:                 │
│ ┌─────────────────────────────┐ │
│ │ 鲈鱼: 1000 kg               │ │ ← 自动计算
│ │ (转换率: 50%)               │ │  (500÷0.5=1000)
│ └─────────────────────────────┘ │
│                                 │
│ 库存检查:                       │
│ ┌─────────────────────────────┐ │
│ │ 当前总库存: 2000 kg         │ │
│ │ 已分配: 0 kg                │ │
│ │ 可用库存: 2000 kg           │ │
│ │                             │ │
│ │ 本计划消耗: 1000 kg         │ │
│ │ 扣除后剩余: 1000 kg ✓      │ │ ← 库存充足
│ └─────────────────────────────┘ │
│                                 │
│ 预计完成日期                    │
│ 2025-10-12                      │
│                                 │
│ 备注                            │
│ ┌─────────────────────────────┐ │
│ │ 王老板订单，优先处理         │ │
│ └─────────────────────────────┘ │
│                                 │
│        [取消]  [创建计划]       │ ← 点击创建
└─────────────────────────────────┘

点击"创建计划"

系统自动处理:
✅ 生成批次号: #2025051
✅ 记录预估消耗: 1000kg鲈鱼
✅ 虚拟扣减库存:
   - 鲈鱼总库存: 2000kg
   - 已分配: 0kg → 1000kg
   - 可用库存: 2000kg → 1000kg
✅ 创建成功

成功提示:
┌─────────────────────────────────┐
│ ✅ 生产计划创建成功              │
│ 批次号: #2025051                │
│ 预计完成: 2025-10-12            │
│ [查看详情]  [确定]              │
└─────────────────────────────────┘
```

---

## 第3步: 员工每日记录生产量 (10月7-11日)

### 场景: 员工每天下班前记录当天生产量

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
员工李师傅操作
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

登录: operator1 / 123456

导航: 加工 → 我的任务

看到分配的生产计划:
┌─────────────────────────────────┐
│ 📋 我的生产任务                  │
├─────────────────────────────────┤
│ 批次 #2025051                   │
│ ┌─────────────────────────────┐ │
│ │ 🐟 鲈鱼片                    │ │
│ │ 计划产量: 500 kg             │ │
│ │ 累计完成: 0 kg (0%)          │ │
│ │ 预计完成: 2025-10-12         │ │
│ │                             │ │
│ │ [记录今日产量]               │ │ ← 每天点这里
│ └─────────────────────────────┘ │
└─────────────────────────────────┘

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
第1天 (10月7日)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

李师傅点击 [记录今日产量]

┌─────────────────────────────────┐
│ 今日生产记录            [X 关闭] │
├─────────────────────────────────┤
│ 批次: #2025051                  │
│ 产品: 鲈鱼片                    │
│ 生产日期: 2025-10-07            │
│                                 │
│ 今日产量 (kg) *                 │
│ ┌─────────────────────────────┐ │
│ │ 100                         │ │ ← 输入今日产量
│ └─────────────────────────────┘ │
│                                 │
│ 工作时长 (小时)                 │
│ ┌─────────────────────────────┐ │
│ │ 8                           │ │ ← 输入工作时间
│ └─────────────────────────────┘ │
│                                 │
│ 流程问题                        │
│ ┌─────────────────────────────┐ │
│ │ ☐ 原材料质量问题             │ │
│ │ ☐ 设备故障                   │ │ ← 勾选遇到的问题
│ │ ☐ 人手不足                   │ │
│ │ ☑ 无问题                     │ │
│ └─────────────────────────────┘ │
│                                 │
│ 备注                            │
│ ┌─────────────────────────────┐ │
│ │ 今日鱼质量很好，加工顺利     │ │
│ └─────────────────────────────┘ │
│                                 │
│        [取消]  [提交记录]       │ ← 点击提交
└─────────────────────────────────┘

提交后看到:
┌─────────────────────────────────┐
│ ✅ 今日记录已保存                │
│ 今日产量: 100 kg                │
│ 累计产量: 100/500 kg (20%)      │
│ [确定]                           │
└─────────────────────────────────┘

返回任务列表，看到更新:
┌─────────────────────────────────┐
│ 批次 #2025051                   │
│ ┌─────────────────────────────┐ │
│ │ 🐟 鲈鱼片                    │ │
│ │ 计划产量: 500 kg             │ │
│ │ 累计完成: 100 kg (20%) ⬆    │ │ ← 自动更新
│ │                             │ │
│ │ 📊 每日明细:                │ │
│ │ 10-07: 100kg ⭐             │ │
│ └─────────────────────────────┘ │
└─────────────────────────────────┘

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
第2-5天 继续记录
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

第2天 (10月8日): 120 kg → 累计 220kg (44%)
第3天 (10月9日): 110 kg → 累计 330kg (66%)
第4天 (10月10日): 105 kg → 累计 435kg (87%)
第5天 (10月11日): 50 kg → 累计 485kg (97%)

最终状态:
┌─────────────────────────────────┐
│ 批次 #2025051                   │
│ ┌─────────────────────────────┐ │
│ │ 🐟 鲈鱼片                    │ │
│ │ 计划产量: 500 kg             │ │
│ │ 累计完成: 485 kg (97%)       │ │
│ │                             │ │
│ │ 📊 每日明细:                │ │
│ │ 10-07: 100kg                │ │
│ │ 10-08: 120kg ⭐ 最高        │ │
│ │ 10-09: 110kg                │ │
│ │ 10-10: 105kg                │ │
│ │ 10-11: 50kg                 │ │
│ │                             │ │
│ │ [标记完成]                   │ │
│ └─────────────────────────────┘ │
└─────────────────────────────────┘

李师傅点击 [标记完成]
```

---

## 第4步: 完成盘点和差异分析 (10月11日)

### 场景A: 管理员查看完成报告

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
管理员张经理操作
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

导航: 管理 → 生产计划管理 → 批次 #2025051

查看详细报告:
┌─────────────────────────────────┐
│ 📊 批次 #2025051 完成报告        │
├─────────────────────────────────┤
│ 基本信息                         │
│ ├─ 批次号: #2025051             │
│ ├─ 产品: 鲈鱼片                 │
│ ├─ 商家: 王老板                 │
│ ├─ 状态: 已完成 ✅              │
│ └─ 完成日期: 2025-10-11         │
│                                 │
│ ━━━━━━━━━━━━━━━━━━━━━━━━━━━   │
│ 产量分析                         │
│ ━━━━━━━━━━━━━━━━━━━━━━━━━━━   │
│ ┌─────────────────────────────┐ │
│ │ 项目     │ 计划    │ 实际   │ │
│ ├─────────┼────────┼────────┤ │
│ │ 产量     │ 500kg  │ 485kg  │ │
│ │ 差异     │        │ -15kg  │ │
│ │ 完成率   │        │ 97%    │ │
│ └─────────────────────────────┘ │
│                                 │
│ ━━━━━━━━━━━━━━━━━━━━━━━━━━━   │
│ 每日产量明细                     │
│ ━━━━━━━━━━━━━━━━━━━━━━━━━━━   │
│ ┌─────────────────────────────┐ │
│ │ 日期   │ 产量  │ 工时│备注 │ │
│ ├────────┼──────┼────┼─────┤ │
│ │ 10-07  │100kg │ 8h │正常 │ │
│ │ 10-08  │120kg │ 8h │正常 │ │← 效率最高
│ │ 10-09  │110kg │ 8h │正常 │ │
│ │ 10-10  │105kg │ 8h │正常 │ │
│ │ 10-11  │ 50kg │ 4h │提前 │ │
│ │        │      │    │完成 │ │
│ └─────────────────────────────┘ │
│                                 │
│ 💡 效率分析:                    │
│ • 平均日产量: 97kg/天           │
│ • 最高效率: 10月8日 (120kg)    │
│ • 建议: 研究8日的工作方法       │
│                                 │
│ ━━━━━━━━━━━━━━━━━━━━━━━━━━━   │
│ 原材料消耗                       │
│ ━━━━━━━━━━━━━━━━━━━━━━━━━━━   │
│ ┌─────────────────────────────┐ │
│ │ 原材料 │ 预估   │ 理论库存 │ │
│ ├────────┼───────┼──────────┤ │
│ │ 鲈鱼   │1000kg │ 0kg      │ │← 理论上应该用完
│ └─────────────────────────────┘ │
│                                 │
│ ⚠️  需要实际盘点确认              │
│                                 │
│ [库存盘点]  [导出报表]  [关闭]  │
└─────────────────────────────────┘
```

### 场景B: 实际库存盘点

```
张经理点击 [库存盘点]

┌─────────────────────────────────┐
│ 库存盘点                         │
├─────────────────────────────────┤
│ 原材料: 鲈鱼                    │
│                                 │
│ 理论库存:                       │
│ ┌─────────────────────────────┐ │
│ │ 总库存: 2000 kg             │ │
│ │ 本批次预估消耗: 1000 kg     │ │
│ │ 理论剩余: 1000 kg           │ │
│ └─────────────────────────────┘ │
│                                 │
│ 实际盘点 *                      │
│ ┌─────────────────────────────┐ │
│ │ 950                         │ │ ← 输入实际测量值
│ └─────────────────────────────┘ │
│                                 │
│ ━━━━━━━━━━━━━━━━━━━━━━━━━━━   │
│ 💡 自动分析                     │
│ ━━━━━━━━━━━━━━━━━━━━━━━━━━━   │
│ ┌─────────────────────────────┐ │
│ │ 理论剩余: 1000 kg           │ │
│ │ 实际库存: 950 kg            │ │
│ │ 差异: -50 kg ⚠️            │ │
│ │                             │ │
│ │ 分析结果:                   │ │
│ │ 实际库存少于理论库存         │ │
│ │ → 生产过程中有浪费          │ │
│ │                             │ │
│ │ 建议操作:                   │ │
│ │ 1. 填写缺料报告             │ │
│ │ 2. 调查浪费原因             │ │
│ │ 3. 加强生产培训             │ │
│ └─────────────────────────────┘ │
│                                 │
│ [取消]  [确认并生成报告]        │ ← 点击
└─────────────────────────────────┘
```

### 场景C: 填写缺料报告

```
系统自动引导到缺料报告:

┌─────────────────────────────────┐
│ 缺料报告                         │
├─────────────────────────────────┤
│ 批次号: #2025051                │
│ 原材料: 鲈鱼                    │
│                                 │
│ 缺少数量 (kg) *                 │
│ ┌─────────────────────────────┐ │
│ │ 50                          │ │ ← 自动填入差异
│ └─────────────────────────────┘ │
│                                 │
│ 缺少原因 *                      │
│ ┌─────────────────────────────┐ │
│ │ ☑ 边角料浪费                │ │
│ │ ☐ 原材料腐坏                │ │ ← 选择原因
│ │ ☐ 质量不合格丢弃            │ │
│ │ ☐ 其他                      │ │
│ └─────────────────────────────┘ │
│                                 │
│ 详细说明                        │
│ ┌─────────────────────────────┐ │
│ │ 加工过程中鱼头、鱼尾、鱼骨   │ │
│ │ 等边角料约占5%，建议后续    │ │
│ │ 考虑边角料再利用            │ │
│ └─────────────────────────────┘ │
│                                 │
│ 改进措施                        │
│ ┌─────────────────────────────┐ │
│ │ 1. 加强操作培训，减少浪费   │ │
│ │ 2. 研究边角料产品化方案     │ │
│ │ 3. 调整转换率算法           │ │
│ └─────────────────────────────┘ │
│                                 │
│        [取消]  [提交报告]       │ ← 点击提交
└─────────────────────────────────┘

提交成功:
✅ 缺料报告已保存
✅ 数据已记录，用于后续分析
✅ 建议已发送给相关部门
```

---

## 第5步: 数据分析和改进

### 场景: 长期数据分析

```
一个月后，张经理查看数据分析报告:

导航: 管理 → 数据分析 → 原材料效率

┌─────────────────────────────────┐
│ 📊 原材料使用效率分析            │
├─────────────────────────────────┤
│ 时间范围: 2025-10月             │
│                                 │
│ 鲈鱼使用情况:                   │
│ ┌─────────────────────────────┐ │
│ │ 总采购: 10000 kg            │ │
│ │ 总消耗: 9800 kg             │ │
│ │ 总浪费: 200 kg (2%)         │ │
│ │                             │ │
│ │ 浪费原因分布:               │ │
│ │ • 边角料: 150kg (75%)       │ │
│ │ • 质量问题: 30kg (15%)      │ │
│ │ • 其他: 20kg (10%)          │ │
│ └─────────────────────────────┘ │
│                                 │
│ 💡 改进建议:                    │
│ ┌─────────────────────────────┐ │
│ │ 1. 转换率调整建议:          │ │
│ │    当前: 50%                │ │
│ │    建议: 48%                │ │
│ │    (考虑2%边角料损耗)       │ │
│ │                             │ │
│ │ 2. 边角料利用方案:          │ │
│ │    开发鱼骨汤、鱼头产品     │ │
│ │    预计可回收50%边角料      │ │
│ │                             │ │
│ │ 3. 成本节约预期:            │ │
│ │    减少浪费2% = 节约¥800/月│ │
│ └─────────────────────────────┘ │
│                                 │
│ [应用建议]  [导出报表]          │
└─────────────────────────────────┘
```

---

## 🎯 MaterialTypeSelector 的正确使用总结

### ✅ 主要使用场景

#### 1. 原材料入库 (管理员) ⭐ 最主要
```
管理员记录采购入库
→ 选择原材料类型
→ 如果不存在，快速添加
→ 填写数量、供应商
→ 提交入库
```

#### 2. 转换率配置 (管理员)
```
配置产品-原材料关系
→ 选择原材料类型
→ 选择产品类型
→ 设置转换率
→ 保存配置
```

#### 3. 缺料报告 (管理员)
```
报告原材料短缺
→ 选择缺少的原材料类型
→ 填写缺少数量和原因
→ 提交报告
```

### ❌ 不使用的场景

- ❌ 员工每日生产记录（只记录产品数量）
- ❌ 生产计划创建（系统自动计算原材料）

---

## 💡 核心价值

### 1. 库存追踪精准
```
入库 → 计划扣减 → 盘点对比 → 发现差异
```

### 2. 浪费可量化
```
理论库存 vs 实际库存 = 浪费量
```

### 3. 转换率可优化
```
长期数据积累 → 分析实际转换率 → 调整算法
```

### 4. 成本可控制
```
减少浪费 → 提高转换率 → 降低成本
```

### 5. 决策有依据
```
详细数据 → 准确分析 → 科学决策
```

---

**文档版本**: Final v1.0
**创建日期**: 2025-10-06
**基于**: 真实业务逻辑
**状态**: ✅ 正确且完整
