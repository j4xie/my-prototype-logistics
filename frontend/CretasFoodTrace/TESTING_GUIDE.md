# Phase 1-4 功能测试指南

**测试日期**: 待执行
**测试范围**: 批次编辑、考勤统计、平台管理
**预计时间**: 2-3小时

---

## 🚀 开始测试

### 前置准备

#### 1. 启动开发环境

```bash
cd frontend/CretasFoodTrace
npx expo start
```

#### 2. 准备测试账号

**工厂管理员账号**（用于测试批次编辑和管理功能）：
- 用户名：`admin`
- 密码：`Admin@123456`
- 权限：factory_super_admin

**平台管理员账号**（用于测试平台管理功能）：
- 用户名：待确认
- 密码：待确认
- 权限：platform_admin

**普通员工账号**（用于测试考勤功能）：
- 用户名：待确认
- 密码：待确认
- 权限：operator

---

## ✅ 测试清单

### 阶段1：TypeScript编译检查（5分钟）

**目的**: 确保所有代码无类型错误

```bash
cd frontend/CretasFoodTrace
npx tsc --noEmit
```

**预期结果**: ✅ 无编译错误

**如果有错误**:
1. 记录错误信息
2. 检查是否是类型定义问题
3. 根据错误提示修复

---

### 阶段2：批次编辑功能测试（30分钟）

#### 测试2.1：进入编辑模式

**操作步骤**：
1. 登录工厂管理员账号
2. 点击底部"生产"Tab
3. 在生产仪表板点击"批次列表"
4. 选择任意一个批次（建议选择状态为"进行中"的）
5. 点击进入批次详情页面
6. 查看右上角是否有"编辑"按钮（铅笔图标）
7. 点击"编辑"按钮

**预期结果**：
- ✅ 批次详情页面右上角显示编辑按钮
- ✅ 点击后跳转到编辑页面
- ✅ 页面标题显示"编辑批次"（而非"原料入库"）
- ✅ 表单自动填充现有批次数据
- ✅ 没有显示"记录原料入库信息"提示文字

**截图位置**：
- 批次详情页面（显示编辑按钮）
- 编辑页面（显示已填充数据）

---

#### 测试2.2：数据加载验证

**操作步骤**：
在编辑页面，验证以下字段是否正确填充：

**预期结果**：
- ✅ 原料类型：显示批次的原料类型
- ✅ 原料数量：显示正确的数量值
- ✅ 原料成本：显示正确的成本值
- ✅ 供应商：显示供应商名称
- ✅ 生产负责人：显示负责人姓名
- ✅ 备注：显示原有备注（如果有）

**检查点**：
- [ ] 所有字段数据与批次详情页一致
- [ ] 选择器组件显示正确的选中项
- [ ] 数字字段可以正常编辑

---

#### 测试2.3：编辑并提交

**操作步骤**：
1. 修改"原料数量"字段（例如从1200改为1500）
2. 点击底部"更新批次"按钮
3. 等待提交完成

**预期结果**：
- ✅ 点击按钮后显示"更新中..."
- ✅ 提交成功后弹出"更新成功"提示
- ✅ 提示框包含"查看详情"按钮
- ✅ 点击"查看详情"返回批次详情页面
- ✅ 批次详情页面显示更新后的数据

**API调用验证**：
在浏览器开发者工具Console中查看：
- ✅ 调用了 `PUT /api/mobile/{factoryId}/processing/batches/{batchId}`
- ✅ 请求body包含更新的数据
- ✅ 响应状态码为200

**注意事项**：
- ⚠️ 如果后端尚未实现 `updateBatch` API，会看到404错误
- 这是正常的，记录下来即可，前端功能已完成

---

#### 测试2.4：只读模式验证

**操作步骤**：
1. 在批次详情页面，传入 `readonly=true` 参数
2. 验证编辑按钮是否隐藏

**预期结果**：
- ✅ readonly模式下不显示编辑按钮

---

### 阶段3：考勤统计入口测试（20分钟）

#### 测试3.1：统计入口显示

**操作步骤**：
1. 登录任意工厂用户账号
2. 点击底部"考勤"Tab
3. 在打卡页面滚动到底部
4. 查找"统计与查询" Card

**预期结果**：
- ✅ 在"今日打卡记录"Card下方显示"统计与查询"Card
- ✅ Card内包含3个按钮：
  - 打卡历史（历史图标）
  - 工时统计（图表图标）
  - 工作记录（笔记本图标）
- ✅ 按钮样式为 `outlined` 模式
- ✅ 按钮之间有适当间距

**截图位置**：
- 考勤打卡页面底部（显示统计入口）

---

#### 测试3.2：打卡历史导航

**操作步骤**：
1. 点击"打卡历史"按钮
2. 验证页面跳转

**预期结果**：
- ✅ 跳转到打卡历史页面
- ✅ 页面标题为"打卡历史"
- ✅ 页面显示历史打卡记录
- ✅ 可以返回打卡页面

---

#### 测试3.3：工时统计导航

**操作步骤**：
1. 返回打卡页面
2. 点击"工时统计"按钮
3. 验证页面跳转

**预期结果**：
- ✅ 跳转到工时统计页面
- ✅ 页面标题为"工时统计"
- ✅ 页面显示工时统计数据
- ✅ 可以返回打卡页面

---

#### 测试3.4：工作记录导航

**操作步骤**：
1. 返回打卡页面
2. 点击"工作记录"按钮
3. 验证页面跳转

**预期结果**：
- ✅ 跳转到工作记录页面
- ✅ 页面标题为"工作记录"
- ✅ 页面显示工作记录
- ✅ 可以返回打卡页面

---

#### 测试3.5：Appbar历史按钮

**操作步骤**：
1. 在打卡页面，点击右上角"历史"图标

**预期结果**：
- ✅ 跳转到 AttendanceHistory 页面
- ✅ 页面标题为"工时查询"

---

### 阶段4：工厂设置入口测试（10分钟）

#### 测试4.1：管理入口显示

**操作步骤**：
1. 登录工厂管理员账号
2. 点击底部"管理"Tab
3. 滚动查找"工厂配置" section

**预期结果**：
- ✅ 在其他管理section下方显示"工厂配置" section
- ✅ Section图标为工厂图标
- ✅ 包含"工厂设置"项目
- ✅ 工厂设置描述为"工厂基本信息和配置"
- ✅ 工厂设置标记为"仅管理员"（有相应标识）

---

#### 测试4.2：权限控制

**操作步骤**：
1. 登录普通员工账号（非管理员）
2. 进入管理页面
3. 查看是否显示"工厂配置" section

**预期结果**：
- ✅ 普通员工看不到"工厂配置" section
- ✅ 只有 factory_super_admin 可以看到

---

#### 测试4.3：导航功能

**操作步骤**：
1. 使用管理员账号
2. 点击"工厂设置"
3. 验证页面跳转

**预期结果**：
- ✅ 跳转到工厂设置页面
- ✅ 页面正确显示工厂设置内容

---

### 阶段5：平台管理功能测试（40分钟）

#### 测试5.1：平台Tab显示

**操作步骤**：
1. 登录平台管理员账号
2. 查看底部Tab导航栏

**预期结果**：
- ✅ 显示5个Tab：首页、生产、管理、平台、我的
- ✅ "平台"Tab图标为盾牌皇冠图标
- ✅ 点击"平台"Tab进入平台仪表板

**对比测试**：
1. 登录工厂用户账号
2. 查看底部Tab

**预期结果**：
- ✅ 不显示"平台"Tab
- ✅ 只显示：首页、考勤、生产、管理、我的

---

#### 测试5.2：平台仪表板显示

**操作步骤**：
在平台管理员账号下，点击"平台"Tab

**预期结果**：
- ✅ 显示欢迎卡片，包含：
  - 皇冠图标
  - 欢迎文字
  - "平台超级管理员"角色标识
- ✅ 显示平台概览统计（3个统计块）：
  - 工厂总数
  - 用户总数
  - 本周AI调用次数
- ✅ 显示管理功能列表（4项）：
  - 工厂管理
  - 用户管理
  - 白名单管理
  - AI配额管理
- ✅ 显示快捷操作（4个按钮）
- ✅ 显示系统状态（3项）

**截图位置**：
- 平台仪表板完整页面

---

#### 测试5.3：工厂管理导航

**操作步骤**：
1. 在平台仪表板点击"工厂管理"
2. 验证页面跳转

**预期结果**：
- ✅ 跳转到工厂管理页面
- ✅ 页面显示工厂列表
- ✅ 可以查看工厂详情
- ✅ 可以返回平台仪表板

---

#### 测试5.4：用户管理导航

**操作步骤**：
1. 返回平台仪表板
2. 点击"用户管理"
3. 验证页面跳转

**预期结果**：
- ✅ 跳转到用户管理页面
- ✅ 页面显示跨工厂用户列表
- ✅ 可以返回平台仪表板

---

#### 测试5.5：白名单管理导航

**操作步骤**：
1. 返回平台仪表板
2. 点击"白名单管理"
3. 验证页面跳转

**预期结果**：
- ✅ 跳转到白名单管理页面
- ✅ 页面显示注册白名单列表
- ✅ 可以添加/编辑白名单
- ✅ 可以返回平台仪表板

---

#### 测试5.6：AI配额管理导航

**操作步骤**：
1. 返回平台仪表板
2. 点击"AI配额管理"
3. 验证页面跳转

**预期结果**：
- ✅ 跳转到AI配额管理页面
- ✅ 页面显示各工厂AI使用情况
- ✅ 可以调整配额
- ✅ 可以返回平台仪表板

---

#### 测试5.7：快捷操作按钮

**操作步骤**：
在平台仪表板依次点击4个快捷操作按钮：
1. 添加工厂
2. 添加用户
3. 添加白名单
4. AI配额

**预期结果**：
- ✅ 每个按钮都能正确导航到对应页面
- ✅ 导航效果与管理功能列表一致

---

### 阶段6：端到端测试场景（30分钟）

#### 场景E2E-1：完整批次编辑流程

**场景描述**: 工厂管理员编辑一个批次的信息

**操作步骤**：
1. 使用工厂管理员账号登录
2. 导航：首页 → 生产 → 批次列表
3. 选择批次号"BATCH-20250118-001"（或任意批次）
4. 进入批次详情，查看当前原料数量为1200kg
5. 点击编辑按钮
6. 修改原料数量为1500kg
7. 修改备注为"测试编辑功能"
8. 点击"更新批次"
9. 确认成功提示
10. 返回批次详情
11. 验证数量已更新为1500kg
12. 验证备注已更新

**预期完整流程**：
- ✅ 所有页面跳转顺畅
- ✅ 数据正确保存和显示
- ✅ 无页面崩溃或错误

**注意事项**：
- 如果后端API未实现，第8步会失败
- 记录API错误但继续测试其他功能

---

#### 场景E2E-2：考勤统计完整访问

**场景描述**: 员工查看自己的考勤统计

**操作步骤**：
1. 使用普通员工账号登录
2. 导航：首页 → 考勤
3. 查看今日打卡状态
4. 滚动到底部，点击"打卡历史"
5. 查看历史记录
6. 返回，点击"工时统计"
7. 查看日/周/月统计
8. 返回，点击"工作记录"
9. 查看工作记录详情
10. 返回打卡页面
11. 点击Appbar的历史按钮
12. 进入工时查询页面

**预期完整流程**：
- ✅ 所有统计页面正确显示
- ✅ 导航流畅无卡顿
- ✅ 数据展示正确

---

#### 场景E2E-3：平台管理员工作流

**场景描述**: 平台管理员管理工厂和用户

**操作步骤**：
1. 使用平台管理员账号登录
2. 验证底部显示"平台"Tab
3. 点击进入平台仪表板
4. 查看平台统计数据
5. 点击"工厂管理"
6. 浏览工厂列表
7. 返回仪表板
8. 点击"用户管理"
9. 浏览用户列表
10. 返回仪表板
11. 点击"白名单管理"
12. 查看白名单
13. 返回仪表板
14. 点击"AI配额管理"
15. 查看配额使用情况

**预期完整流程**：
- ✅ 平台Tab仅对平台管理员可见
- ✅ 所有管理页面正确显示
- ✅ 权限控制正确
- ✅ 数据统计准确

---

## 📝 测试结果记录

### 快速检查表

#### 批次编辑功能
- [ ] 编辑按钮显示正确
- [ ] 进入编辑模式成功
- [ ] 数据自动填充正确
- [ ] 更新提交成功
- [ ] 更新后数据显示正确

#### 考勤统计入口
- [ ] 统计入口Card显示
- [ ] 3个统计按钮正常工作
- [ ] 页面导航正确
- [ ] Appbar历史按钮正常

#### 工厂设置入口
- [ ] 管理员可见工厂配置
- [ ] 普通用户不可见
- [ ] 导航到设置页面正常

#### 平台管理功能
- [ ] 平台Tab仅管理员可见
- [ ] 仪表板显示正确
- [ ] 4个管理功能导航正常
- [ ] 快捷操作按钮正常
- [ ] 权限控制正确

---

## 🐛 问题记录模板

如果发现问题，请按以下格式记录：

```markdown
### 问题 #1: [简短描述]

**严重程度**: Critical / High / Medium / Low
**发现时间**: YYYY-MM-DD HH:MM
**测试场景**: [测试场景编号]
**复现步骤**:
1. 步骤1
2. 步骤2
3. ...

**预期结果**: [应该发生什么]
**实际结果**: [实际发生了什么]
**截图/日志**: [附加信息]
**可能原因**: [初步分析]
```

---

## ✅ 测试完成标准

所有测试通过的标准：

### 必须通过（P0）：
- [ ] TypeScript编译无错误
- [ ] 批次编辑按钮可点击
- [ ] 考勤统计入口显示
- [ ] 平台Tab权限控制正确

### 应该通过（P1）：
- [ ] 批次编辑数据加载正确
- [ ] 考勤统计导航正常
- [ ] 工厂设置入口可访问
- [ ] 平台管理所有页面可访问

### 最好通过（P2）：
- [ ] 批次更新API调用成功（需后端支持）
- [ ] 所有端到端场景无错误

---

## 📊 测试报告模板

测试完成后，请填写：

```markdown
# Phase 1-4 测试报告

**测试执行人**: [姓名]
**测试日期**: YYYY-MM-DD
**测试环境**:
- 设备: [Android/iOS]
- 操作系统版本: [版本号]
- App版本: [版本号]

## 测试概况
- 总测试项: X
- 通过: Y
- 失败: Z
- 跳过: W

## 主要发现
1. [发现1]
2. [发现2]
...

## 遗留问题
1. [问题1]
2. [问题2]
...

## 测试结论
- [ ] ✅ 所有核心功能正常，可以发布
- [ ] ⚠️ 有次要问题，需要修复后发布
- [ ] ❌ 有严重问题，不能发布
```

---

**测试准备**: 预计15分钟
**测试执行**: 预计2-3小时
**报告编写**: 预计30分钟
**总计**: 预计3-4小时

祝测试顺利！🎉
