# 原料类型管理 - 使用指南

## 📋 目录
- [功能概述](#功能概述)
- [管理员操作流程](#管理员操作流程)
- [普通员工操作流程](#普通员工操作流程)
- [实际业务场景](#实际业务场景)
- [常见问题](#常见问题)

---

## 🎯 功能概述

**原料选择器快捷添加功能**允许用户在进行原料入库时，如果找不到需要的原料类型，可以直接在选择器中快速创建新的原料类型，无需退出当前页面或联系管理员。

### 核心优势
- ✅ **无缝操作**: 在原料入库过程中直接添加新原料类型
- ✅ **节省时间**: 无需等待管理员预先配置
- ✅ **提高效率**: 减少操作步骤，提升工作效率
- ✅ **权限控制**: 根据角色自动限制可见范围

---

## 👨‍💼 管理员操作流程

### 场景1: 系统初始化 - 预设常用原料类型

**角色**: 工厂超级管理员、部门管理员
**目标**: 为工厂预先配置常用的原料类型

#### 操作步骤

```
1️⃣ 登录系统
   账号: super_admin / processing_admin / dept_admin
   密码: 123456

2️⃣ 进入"加工管理"模块
   导航: 底部Tab → "加工" → "原料入库"

3️⃣ 点击"原料类型"选择器
   位置: 原料入库表单 → "原料类型 *" 字段

4️⃣ 添加常用原料类型
   滚动到列表底部 → 点击"➕ 找不到？点击添加新原料类型"

5️⃣ 批量创建原料类型

   示例1 - 鱼类:
   ┌─────────────────────────┐
   │ 原料名称: 鲈鱼          │
   │ 分类: 🐟 鱼类          │
   │ [取消]  [保存]          │
   └─────────────────────────┘

   示例2 - 虾蟹类:
   ┌─────────────────────────┐
   │ 原料名称: 大虾          │
   │ 分类: 🦐 虾蟹类        │
   │ [取消]  [保存]          │
   └─────────────────────────┘

   示例3 - 贝类:
   ┌─────────────────────────┐
   │ 原料名称: 扇贝          │
   │ 分类: 🐚 贝类          │
   │ [取消]  [保存]          │
   └─────────────────────────┘

6️⃣ 验证创建结果
   保存后列表自动刷新，新原料出现在列表中
   新创建的原料自动被选中
```

#### 建议的初始原料类型配置

**鱼类** (分类: 鱼类)
- 鲈鱼
- 带鱼
- 黄花鱼
- 三文鱼
- 鳕鱼
- 金枪鱼

**虾蟹类** (分类: 虾蟹类)
- 大虾
- 基围虾
- 龙虾
- 螃蟹
- 帝王蟹

**贝类** (分类: 贝类)
- 扇贝
- 生蚝
- 蛤蜊
- 鲍鱼

**头足类** (分类: 头足类)
- 鱿鱼
- 墨鱼
- 章鱼

**其他** (分类: 其他)
- 海参
- 海胆
- 海带

---

### 场景2: 日常管理 - 审核和优化

**角色**: 工厂超级管理员
**目标**: 定期检查和优化原料类型库

#### 操作建议

1. **定期检查** (建议每周一次)
   - 查看新增的原料类型
   - 检查是否有重复或不规范的命名
   - 合并相似的原料类型

2. **数据清理** (通过Prisma Studio)
   - 访问: http://localhost:5555
   - 表名: `raw_material_types`
   - 操作: 删除无效或重复的记录

3. **分类优化**
   - 统一命名规范
   - 调整分类归属
   - 添加描述信息

---

## 👷‍♂️ 普通员工操作流程

### 场景1: 日常入库 - 选择现有原料类型

**角色**: 加工部操作员、物流员
**目标**: 记录原料入库信息

#### 操作步骤

```
1️⃣ 登录系统
   账号: operator1 / operator2
   密码: 123456

2️⃣ 进入原料入库页面
   导航: 底部Tab → "加工" → "原料入库"

3️⃣ 填写入库信息

   ┌──────────────────────────────┐
   │ 📦 原料入库                   │
   ├──────────────────────────────┤
   │ 原料类型 *                    │
   │ ┌──────────────────────────┐ │
   │ │ 选择原料类型 ▼           │ │
   │ └──────────────────────────┘ │
   │                              │
   │ 重量 (kg) *                  │
   │ ┌──────────────────────────┐ │
   │ │                          │ │
   │ └──────────────────────────┘ │
   │                              │
   │ 供应商                        │
   │ ┌──────────────────────────┐ │
   │ │ 选择供应商 ▼             │ │
   │ └──────────────────────────┘ │
   │                              │
   │ [提交入库]                   │
   └──────────────────────────────┘

4️⃣ 点击"原料类型"
   弹出原料选择器

5️⃣ 搜索和选择

   ┌──────────────────────────────┐
   │ 选择原料类型            [取消]│
   ├──────────────────────────────┤
   │ 🔍 搜索原料...               │
   ├──────────────────────────────┤
   │ • 鲈鱼 (淡水鱼)           ✓  │
   │ • 带鱼 (海水鱼)              │
   │ • 黄花鱼 (海水鱼)            │
   │ • 大虾 (虾蟹类)              │
   │ • 扇贝 (贝类)                │
   └──────────────────────────────┘

   - 可以直接滚动查找
   - 或者使用搜索框输入关键字
   - 点击选择需要的原料类型

6️⃣ 继续填写其他信息
   填写重量、供应商等信息

7️⃣ 提交入库
   点击"提交入库"完成操作
```

---

### 场景2: 新品入库 - 快速添加新原料

**角色**: 加工部操作员
**目标**: 记录新品种原料入库（例如：刚采购的新鱼种）

#### 实际案例：黄鱼入库

```
📖 业务场景:
供应商送来一批黄鱼，但系统中没有"黄鱼"这个原料类型。
以往需要联系管理员添加，现在可以自己快速创建。

操作步骤:

1️⃣ 进入原料入库页面

2️⃣ 点击"原料类型"
   发现列表中没有"黄鱼"

3️⃣ 使用搜索功能确认
   ┌──────────────────────────────┐
   │ 🔍 搜索: 黄鱼                │
   ├──────────────────────────────┤
   │ 未找到匹配的原料类型         │
   │                              │
   │ ↓ 滚动到底部 ↓              │
   └──────────────────────────────┘

4️⃣ 滚动到列表底部
   看到蓝色提示按钮:

   ┌──────────────────────────────┐
   │ • 扇贝 (贝类)                │
   │ • 鱿鱼 (头足类)              │
   ├──────────────────────────────┤
   │ ➕ 找不到？点击添加新原料类型│ ← 点击这里
   └──────────────────────────────┘

5️⃣ 填写新原料信息
   表单自动展开:

   ┌──────────────────────────────┐
   │ 添加新原料                    │
   ├──────────────────────────────┤
   │ 原料名称 *                    │
   │ ┌──────────────────────────┐ │
   │ │ 黄鱼                     │ │ ← 输入原料名称
   │ └──────────────────────────┘ │
   │                              │
   │ 分类                         │
   │ [鱼类] [虾蟹] [贝类]         │ ← 选择鱼类
   │ [头足] [其他]                │
   │                              │
   │ [取消]  [保存]               │
   └──────────────────────────────┘

6️⃣ 点击"保存"

   ✅ 系统提示: "原料类型创建成功"
   ✅ 列表自动刷新
   ✅ "黄鱼"自动被选中
   ✅ 弹窗自动关闭

7️⃣ 继续完成入库

   ┌──────────────────────────────┐
   │ 原料类型 *                    │
   │ ┌──────────────────────────┐ │
   │ │ 黄鱼 ✓                   │ │ ← 已自动选中
   │ └──────────────────────────┘ │
   │                              │
   │ 重量 (kg) *                  │
   │ ┌──────────────────────────┐ │
   │ │ 150                      │ │ ← 输入重量
   │ └──────────────────────────┘ │
   │                              │
   │ [提交入库]                   │
   └──────────────────────────────┘

8️⃣ 提交完成
   ✅ 入库记录保存成功
   ✅ 下次入库时可以直接选择"黄鱼"
```

---

## 🏭 实际业务场景

### 场景A: 早班入库（操作员视角）

**时间**: 早上8:00
**角色**: operator1（加工部操作员）
**任务**: 记录当天到货的原料

```
8:00 - 供应商送来3种海鲜
      ├─ 100kg 鲈鱼 (系统有) → 直接选择 → 提交
      ├─ 80kg 带鱼 (系统有) → 直接选择 → 提交
      └─ 50kg 黄鱼 (系统无) → 快速添加 → 选择 → 提交

8:15 - 入库完成，打印标签
```

### 场景B: 新品测试（管理员视角）

**时间**: 下午2:00
**角色**: dept_admin（部门管理员）
**任务**: 试产新品种海鲜

```
14:00 - 收到新品种: 石斑鱼、龙虾

14:05 - 添加新原料类型
        ├─ 石斑鱼 (鱼类)
        └─ 龙虾 (虾蟹类)

14:10 - 记录入库
        ├─ 石斑鱼 30kg
        └─ 龙虾 20kg

14:15 - 通知操作员新品种已添加
```

### 场景C: 月度盘点（超级管理员视角）

**时间**: 月末
**角色**: super_admin（工厂超级管理员）
**任务**: 检查和优化原料库

```
1. 登录Prisma Studio (http://localhost:5555)
2. 查看 raw_material_types 表
3. 检查数据:
   ├─ 本月新增: 8种原料
   ├─ 重复项: 0个
   └─ 需优化: 统一命名规范

4. 导出报表给采购部参考
```

---

## 🎓 操作技巧

### 技巧1: 快速搜索

```
场景: 列表中有50种原料，想找"鲈鱼"

❌ 不推荐: 慢慢滚动查找
✅ 推荐: 使用搜索框

操作:
┌──────────────────────────────┐
│ 🔍 搜索: 鲈                  │ ← 输入关键字
├──────────────────────────────┤
│ • 鲈鱼 (淡水鱼)           ✓  │ ← 立即显示匹配结果
└──────────────────────────────┘
```

### 技巧2: 分类规范

```
建议的命名规范:

✅ 好的命名:
   - 鲈鱼
   - 大虾
   - 扇贝
   (简洁、清晰、无歧义)

❌ 不好的命名:
   - 鲈鱼（大的）
   - 今天的虾
   - 扇贝123
   (包含多余信息或不规范)
```

### 技巧3: 批量操作

```
如果需要添加多个原料:

1. 添加第一个 → 保存
2. 再次点击"原料类型" → 滚动到底部
3. 添加第二个 → 保存
4. 重复...

💡 提示: 管理员可以在系统空闲时批量预设
```

---

## ❓ 常见问题

### Q1: 我创建的原料类型其他人能看到吗？

**A**: 能！同一工厂的所有用户共享原料类型库。

- ✅ 同工厂用户: 立即可见
- ❌ 不同工厂: 数据隔离，互不可见

### Q2: 可以删除或修改原料类型吗？

**A**: 目前版本只能创建，删除和修改需要管理员通过后台操作。

- **删除**: 管理员 → Prisma Studio → 删除记录
- **修改**: 管理员 → Prisma Studio → 编辑记录

### Q3: 创建时选错分类怎么办？

**A**:
1. **方法1**: 取消后重新创建（使用正确分类）
2. **方法2**: 联系管理员修改（通过Prisma Studio）

### Q4: 为什么我创建失败了？

**A**: 可能的原因:

1. **原料名称为空**: 必须填写名称
2. **网络问题**: 检查网络连接
3. **系统错误**: 联系管理员查看日志

### Q5: 可以创建重复名称的原料吗？

**A**:
- **当前版本**: 可以创建重复名称（后端会记录为不同ID）
- **建议**: 创建前先搜索，避免重复
- **未来优化**: 将添加重复检测功能

### Q6: 操作员权限够吗？

**A**: 够！所有角色都可以创建原料类型。

```
权限说明:
├─ factory_super_admin: ✅ 创建 ✅ 查看 ✅ 编辑(后台) ✅ 删除(后台)
├─ department_admin:    ✅ 创建 ✅ 查看 ✅ 编辑(后台) ✅ 删除(后台)
├─ operator:            ✅ 创建 ✅ 查看
└─ viewer:              ❌ 创建 ✅ 查看
```

---

## 📱 界面截图说明

### 1. 原料选择器（未展开）

```
┌────────────────────────────┐
│ 原料类型 *                 │
│ ┌────────────────────────┐ │
│ │ 选择原料类型 ▼         │ │ ← 点击展开
│ └────────────────────────┘ │
└────────────────────────────┘
```

### 2. 原料列表（已展开）

```
┌────────────────────────────┐
│ 选择原料类型        [取消] │
├────────────────────────────┤
│ 🔍 搜索原料...             │
├────────────────────────────┤
│ • 鲈鱼 (淡水鱼)         ✓  │
│ • 带鱼 (海水鱼)            │
│ • 黄花鱼 (海水鱼)          │
│ • 大虾 (虾蟹类)            │
│ • 扇贝 (贝类)              │
│ ↓ 滚动查看更多 ↓          │
└────────────────────────────┘
```

### 3. 添加按钮（列表底部）

```
┌────────────────────────────┐
│ • 鱿鱼 (头足类)            │
│ • 章鱼 (头足类)            │
├────────────────────────────┤
│ ➕ 找不到？点击添加新原料  │ ← 蓝色背景按钮
│    类型                    │
└────────────────────────────┘
```

### 4. 创建表单（展开状态）

```
┌────────────────────────────┐
│ 添加新原料                 │
├────────────────────────────┤
│ 原料名称 *                 │
│ ┌────────────────────────┐ │
│ │ 例如: 黄鱼             │ │
│ └────────────────────────┘ │
│                            │
│ 分类                       │
│ ┌─────┬─────┬─────┬─────┐ │
│ │鱼类 │虾蟹 │贝类 │头足 │ │
│ └─────┴─────┴─────┴─────┘ │
│ ┌─────┐                    │
│ │其他 │                    │
│ └─────┘                    │
│                            │
│ [取消]  [保存]             │
└────────────────────────────┘
```

---

## 🔧 技术支持

### 管理员后台访问

```bash
# 启动Prisma Studio
cd backend
npx prisma studio --port 5555

# 访问地址
http://localhost:5555

# 操作表
raw_material_types
```

### API测试

```bash
# 测试脚本
cd backend
node test-material-api.js

# 查看测试结果
✅ 登录成功
✅ 获取列表成功
✅ 创建成功
✅ 验证成功
```

---

## 📞 联系支持

如有问题，请联系:
- **技术支持**: [技术部门]
- **系统管理员**: super_admin
- **部门管理员**: dept_admin

---

**文档版本**: v1.0
**更新日期**: 2025-10-06
**适用系统**: 白垩纪食品溯源系统 v1.0
