# 食品溯源系统端到端测试

## 简介

本目录包含食品溯源系统的端到端测试，使用Playwright测试框架实现。端到端测试模拟真实用户与系统的交互，确保系统的功能在真实环境中正常工作。

## 测试内容

当前实现的端到端测试包括：

1. **登录流程测试 (login.test.js)**
   - 测试登录页面加载
   - 测试无效登录场景（表单验证）
   - 测试有效登录流程
   - 测试退出登录流程

2. **溯源查询流程测试 (trace.test.js)**
   - 测试已登录用户溯源查询
   - 测试未登录用户有限溯源查询
   - 测试溯源记录详情查看
   - 测试导航和页面交互

## 运行测试

### 准备工作

在运行测试前，请确保已安装所有依赖：

```bash
npm install
```

并安装Playwright浏览器：

```bash
npx playwright install
```

### 运行测试

有两种方式运行端到端测试：

1. **命令行模式**

   ```bash
   npm run test:e2e
   ```

2. **UI交互模式**（推荐用于开发和调试）

   ```bash
   npm run test:e2e:ui
   ```

   UI模式提供了友好的界面，可以查看测试执行过程、调试测试和检查测试结果。

### 查看报告

测试完成后，可以通过以下命令查看HTML报告：

```bash
npx playwright show-report
```

## 测试注意事项

1. **测试环境**
   - 测试会自动启动本地开发服务器（端口8080）
   - 确保服务器可以正常启动，且数据库连接正常

2. **测试依赖数据**
   - 测试依赖于特定的测试数据，请确保系统中存在ID为"p001"的产品数据
   - 登录测试使用用户名"testuser"和密码"password123"，请确保系统中存在此测试账号

3. **浏览器兼容性**
   - 默认会在Chromium和Firefox两种浏览器中运行测试
   - 可以通过修改playwright.config.js配置添加更多浏览器

4. **超时设置**
   - 测试中包含等待页面加载和元素显示的超时设置
   - 如果测试环境响应较慢，可能需要调整超时时间

## 扩展测试

添加新的端到端测试时，请遵循以下原则：

1. 创建有意义的测试文件名，如feature.test.js
2. 使用test.describe()分组相关测试
3. 使用beforeEach()设置测试前置条件
4. 确保每个测试都有明确的断言
5. 测试应该独立且可重复执行

## 常见问题

1. **测试超时失败**
   - 检查选择器是否正确
   - 增加等待超时时间
   - 检查页面是否正确加载

2. **元素未找到**
   - 使用Playwright Inspector检查元素
   - 确认页面结构是否变更
   - 使用更稳定的选择器

3. **登录测试失败**
   - 确认测试账号存在且可用
   - 检查登录表单字段名称
   - 验证登录成功后的重定向URL 