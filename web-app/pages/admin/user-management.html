<!DOCTYPE html><html lang="zh-CN"><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>用户管理 - 食品溯源系统</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="assets/styles.css">
<script src="../components/trace-common.js"></script><script src="../components/trace-error-handler.js"></script><script src="../components/trace-ui.js"></script><script src="../components/trace-nav.js"></script><script src="../components/trace-a11y.js"></script><script src="../components/trace-store.js"></script></head>
<body class="bg-[#F7F8FA]">
    <div class="max-w-[390px] mx-auto min-h-screen pb-16">
        <!-- 顶部导航栏 -->
        <div class="trace-navbar sticky top-0 z-10">
            <a href="javascript:history.back()" class="w-10 h-10 rounded-full flex items-center justify-center">
                <i class="fas fa-arrow-left text-[#00467F]"></i>
            </a>
            <div class="trace-navbar-title">用户管理</div>
            <div class="flex">
                <button class="w-10 h-10 rounded-full flex items-center justify-center" onclick="openModal('add-user-modal')">
                    <i class="fas fa-user-plus text-[#00467F]"></i>
                </button>
            </div>
        </div>

        <!-- 主要内容区域 -->
        <div class="px-4 py-4">
            <!-- 搜索栏 -->
            <div class="bg-white rounded-xl shadow-sm p-4 mb-6">
                <div class="relative">
                    <input type="text" placeholder="搜索用户..." class="trace-input pl-10">
                    <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                </div>
            </div>

            <!-- 用户列表 -->
            <div class="bg-white rounded-xl shadow-sm">
                <div class="p-4 border-b border-gray-200">
                    <div class="flex items-center justify-between">
                        <h3 class="text-lg font-medium text-gray-800">用户列表</h3>
                        <div class="flex items-center space-x-2">
                            <button class="text-sm text-gray-600">
                                <i class="fas fa-filter mr-1"></i>筛选
                            </button>
                            <button class="text-sm text-gray-600">
                                <i class="fas fa-sort mr-1"></i>排序
                            </button>
                        </div>
                    </div>
                </div>

                <div class="divide-y divide-gray-200">
                    <!-- 用户项 -->
                    <div class="p-4 flex items-center justify-between">
                        <div class="flex items-center">
                            <div class="w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center mr-3">
                                <i class="fas fa-user text-[#00467F]"></i>
                            </div>
                            <div>
                                <div class="font-medium">张三</div>
                                <div class="text-sm text-gray-500">zhangsan@example.com</div>
                            </div>
                        </div>
                        <div class="flex items-center space-x-2">
                            <button class="text-[#00467F]">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="text-red-500">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>

                    <!-- 更多用户项 -->
                    <div class="p-4 flex items-center justify-between">
                        <div class="flex items-center">
                            <div class="w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center mr-3">
                                <i class="fas fa-user text-[#00467F]"></i>
                            </div>
                            <div>
                                <div class="font-medium">李四</div>
                                <div class="text-sm text-gray-500">lisi@example.com</div>
                            </div>
                        </div>
                        <div class="flex items-center space-x-2">
                            <button class="text-[#00467F]">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="text-red-500">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 添加用户模态框 -->
    <div id="add-user-modal" class="modal-backdrop">
        <div class="modal-dialog">
            <div class="modal-header">
                <div class="modal-title">添加用户</div>
                <button type="button" onclick="closeModal('add-user-modal')" class="text-gray-500">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">用户名</label>
                        <input type="text" class="trace-input" required="">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">邮箱</label>
                        <input type="email" class="trace-input" required="">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">角色</label>
                        <select class="trace-input" required="">
                            <option value="">请选择角色</option>
                            <option value="admin">管理员</option>
                            <option value="user">普通用户</option>
                            <option value="viewer">查看者</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">密码</label>
                        <input type="password" class="trace-input" required="">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">确认密码</label>
                        <input type="password" class="trace-input" required="">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" onclick="closeModal('add-user-modal')" class="trace-button trace-button-secondary">
                    取消
                </button>
                <button type="button" class="trace-button trace-button-primary">
                    添加
                </button>
            </div>
        </div>
    </div>

    <script type="module">
        import { traceErrorHandler } from './components/trace-error-handler.js';
        import { traceStore } from './components/trace-store.js';

        document.addEventListener('DOMContentLoaded', () => {
            // 检查是否在iframe中
            const isInIframe = window !== window.parent;
            
            // 监听父页面消息
            window.addEventListener('message', function(event) {
                if (event.origin !== window.location.origin) return;
                
                if (event.data.type === 'UPDATE_AUTH') {
                    traceStore.login(event.data.data);
                    if (!traceStore.hasPermission('manage_users')) {
                        traceErrorHandler.showErrorMessage({ 
                            title: '权限不足',
                            message: '您没有用户管理的权限',
                            type: 'error'
                        });
                        setTimeout(() => {
                            if (!isInIframe) {
                                window.location.href = 'home.html';
                            }
                        }, 2000);
                        return;
                    }
                } else if (event.data.type === 'CLEAR_AUTH') {
                    traceStore.logout();
                    if (!isInIframe) {
                        window.location.href = 'login.html';
                    }
                }
            });

            if (!traceStore.user.isAuthenticated) {
                if (!isInIframe) {
                    window.location.href = 'login.html';
                }
                return;
            }

            if (!traceStore.hasPermission('manage_users')) {
                traceErrorHandler.showErrorMessage({ 
                    title: '权限不足',
                    message: '您没有用户管理的权限',
                    type: 'error'
                });
                setTimeout(() => {
                    if (!isInIframe) {
                        window.location.href = 'home.html';
                    }
                }, 2000);
                return;
            }
        });
    </script>

  <!-- 自动按钮升级脚本 (自动注入) -->
  <script src="/components/autoload-button-upgrade.js"></script>
  
 </body></html>