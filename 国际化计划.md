# å¤šè¯­è¨€å›½é™…åŒ–å®ç°è®¡åˆ’

## æ¦‚è¿°

ä¸º CretasFoodTrace å‰ç«¯é¡¹ç›®æ·»åŠ ä¸­è‹±æ–‡åŒè¯­æ”¯æŒï¼Œé‡‡ç”¨æ¸è¿›å¼è¿ç§»ç­–ç•¥ã€‚

| é¡¹ç›® | é€‰æ‹© |
|------|------|
| **ç›®æ ‡è¯­è¨€** | zh-CN, en-US |
| **è¿ç§»ç­–ç•¥** | æ¸è¿›å¼ |
| **è¯­è¨€åˆ‡æ¢** | è·Ÿéšç³»ç»Ÿ + æ‰‹åŠ¨åˆ‡æ¢ |
| **å½“å‰çŠ¶æ€** | å·²å®Œæˆ 118/238 é¡µé¢ (49.6%)ï¼ŒPhase 3 è¿›è¡Œä¸­ |

---

## æŠ€æœ¯é€‰å‹

| ä¾èµ– | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| `i18next` | ^23.x | æ ¸å¿ƒ i18n æ¡†æ¶ |
| `react-i18next` | ^14.x | React ç»‘å®š |
| `expo-localization` | ~16.x | è®¾å¤‡è¯­è¨€æ£€æµ‹ï¼ˆå·²å®‰è£…ï¼‰ |
| `intl-pluralrules` | ^2.x | Android å¤æ•°è§„åˆ™ polyfill |

---

## ç›®å½•ç»“æ„

```
frontend/CretasFoodTrace/src/i18n/
â”œâ”€â”€ index.ts              # i18n åˆå§‹åŒ–é…ç½®
â”œâ”€â”€ types.ts              # TypeScript ç±»å‹å®šä¹‰
â”œâ”€â”€ resources.ts          # èµ„æºæ–‡ä»¶å¯¼å…¥
â””â”€â”€ locales/
    â”œâ”€â”€ zh-CN/
    â”‚   â”œâ”€â”€ common.json   # é€šç”¨ UIï¼ˆæŒ‰é’®ã€çŠ¶æ€ã€éªŒè¯ï¼‰
    â”‚   â”œâ”€â”€ auth.json     # ç™»å½•æ³¨å†Œ
    â”‚   â”œâ”€â”€ home.json     # é¦–é¡µ
    â”‚   â”œâ”€â”€ processing.json
    â”‚   â”œâ”€â”€ quality.json
    â”‚   â”œâ”€â”€ warehouse.json
    â”‚   â”œâ”€â”€ hr.json
    â”‚   â”œâ”€â”€ dispatcher.json
    â”‚   â”œâ”€â”€ reports.json
    â”‚   â”œâ”€â”€ management.json
    â”‚   â”œâ”€â”€ alerts.json
    â”‚   â”œâ”€â”€ profile.json
    â”‚   â””â”€â”€ errors.json
    â””â”€â”€ en-US/
        â””â”€â”€ (åŒä¸Šç»“æ„)
```

---

## å®æ–½æ­¥éª¤

### Phase 1: åŸºç¡€è®¾æ–½æ­å»º

**ä»»åŠ¡æ¸…å•ï¼š**

1. å®‰è£…ä¾èµ–
   ```bash
   cd frontend/CretasFoodTrace
   npm install i18next react-i18next intl-pluralrules
   ```

2. åˆ›å»º `src/i18n/index.ts` - i18n åˆå§‹åŒ–é…ç½®
   ```typescript
   import i18n from 'i18next';
   import { initReactI18next } from 'react-i18next';
   import { getLocales } from 'expo-localization';
   import 'intl-pluralrules';
   import { resources } from './resources';
   import { SUPPORTED_LANGUAGES, DEFAULT_LANGUAGE } from './types';

   const getDeviceLanguage = (): string => {
     const locales = getLocales();
     const deviceLang = locales[0]?.languageCode ?? 'zh';
     if (deviceLang.startsWith('zh')) return 'zh-CN';
     if (deviceLang.startsWith('en')) return 'en-US';
     return DEFAULT_LANGUAGE;
   };

   i18n
     .use(initReactI18next)
     .init({
       resources,
       lng: getDeviceLanguage(),
       fallbackLng: DEFAULT_LANGUAGE,
       defaultNS: 'common',
       ns: ['common', 'auth', 'home', 'processing', 'quality', 'warehouse',
            'hr', 'dispatcher', 'reports', 'management', 'alerts', 'profile', 'errors'],
       interpolation: { escapeValue: false },
       react: { useSuspense: false },
       compatibilityJSON: 'v4',
       debug: __DEV__,
     });

   export default i18n;
   ```

3. åˆ›å»º `src/i18n/types.ts` - ç±»å‹å®‰å…¨å®šä¹‰
   ```typescript
   import 'i18next';
   import type common from './locales/zh-CN/common.json';
   // ... å…¶ä»– namespace ç±»å‹å¯¼å…¥

   export const SUPPORTED_LANGUAGES = ['zh-CN', 'en-US'] as const;
   export type SupportedLanguage = typeof SUPPORTED_LANGUAGES[number];
   export const DEFAULT_LANGUAGE: SupportedLanguage = 'zh-CN';

   declare module 'i18next' {
     interface CustomTypeOptions {
       defaultNS: 'common';
       resources: {
         common: typeof common;
         // ... å…¶ä»– namespace
       };
     }
   }

   export const LANGUAGE_NAMES: Record<SupportedLanguage, string> = {
     'zh-CN': 'ç®€ä½“ä¸­æ–‡',
     'en-US': 'English',
   };
   ```

4. åˆ›å»º `src/i18n/resources.ts` - èµ„æºå¯¼å…¥
   ```typescript
   // zh-CN
   import zhCommon from './locales/zh-CN/common.json';
   import zhAuth from './locales/zh-CN/auth.json';
   // ... å…¶ä»–å¯¼å…¥

   // en-US
   import enCommon from './locales/en-US/common.json';
   import enAuth from './locales/en-US/auth.json';
   // ... å…¶ä»–å¯¼å…¥

   export const resources = {
     'zh-CN': { common: zhCommon, auth: zhAuth, ... },
     'en-US': { common: enCommon, auth: enAuth, ... },
   } as const;
   ```

5. åˆ›å»º `src/store/languageStore.ts` - Zustand çŠ¶æ€ç®¡ç†
   ```typescript
   import { create } from 'zustand';
   import { persist, createJSONStorage } from 'zustand/middleware';
   import AsyncStorage from '@react-native-async-storage/async-storage';
   import i18n from '../i18n';

   interface LanguageState {
     language: SupportedLanguage;
     isSystemLanguage: boolean;
     setLanguage: (lang: SupportedLanguage) => void;
     setSystemLanguage: (follow: boolean) => void;
     initializeLanguage: () => void;
   }

   export const useLanguageStore = create<LanguageState>()(
     persist(
       (set, get) => ({
         language: 'zh-CN',
         isSystemLanguage: true,
         setLanguage: (lang) => {
           i18n.changeLanguage(lang);
           set({ language: lang, isSystemLanguage: false });
         },
         setSystemLanguage: (follow) => { ... },
         initializeLanguage: () => {
           const { language } = get();
           i18n.changeLanguage(language);
         },
       }),
       {
         name: 'language-storage',
         storage: createJSONStorage(() => AsyncStorage),
       }
     )
   );
   ```

6. æ›´æ–° `App.tsx` - åˆå§‹åŒ– i18n
   ```typescript
   import './src/i18n'; // åœ¨æœ€é¡¶éƒ¨å¯¼å…¥
   import { useLanguageStore } from './src/store/languageStore';

   export default function App() {
     const { initializeLanguage } = useLanguageStore();
     useEffect(() => { initializeLanguage(); }, []);
     // ...
   }
   ```

**å…³é”®æ–‡ä»¶ï¼š**
- `frontend/CretasFoodTrace/package.json`
- `frontend/CretasFoodTrace/App.tsx`
- `frontend/CretasFoodTrace/src/i18n/` (æ–°å»º)
- `frontend/CretasFoodTrace/src/store/languageStore.ts` (æ–°å»º)

---

### Phase 2: æ ¸å¿ƒé¡µé¢è¿ç§»

**ä¼˜å…ˆçº§ P1ï¼ˆé«˜é¢‘ä½¿ç”¨ï¼‰ï¼š**

| æ¨¡å— | æ–‡ä»¶ | å‘½åç©ºé—´ |
|------|------|----------|
| ç™»å½•/æ³¨å†Œ | `screens/auth/*` | auth.json |
| é¦–é¡µ | `screens/main/HomeScreen.tsx` | home.json |
| ä¸ªäººä¸­å¿ƒ | `screens/*/profile/*` | profile.json |

**ä¼˜å…ˆçº§ P2ï¼ˆå¸¸ç”¨åŠŸèƒ½ï¼‰ï¼š**

| æ¨¡å— | æ–‡ä»¶ | å‘½åç©ºé—´ |
|------|------|----------|
| é€šç”¨ç»„ä»¶ | `components/common/*` | common.json |
| å¯¼èˆªæ ‡é¢˜ | `navigation/*` | (å„è‡ªæ¨¡å—) |

---

### Phase 3: è§’è‰²æ¨¡å—è¿ç§»

| è§’è‰² | æ¨¡å— | å‘½åç©ºé—´ |
|------|------|----------|
| å·¥å‚ç®¡ç†å‘˜ | ç”Ÿäº§é…ç½®ã€AI åˆ†æ | management, processing |
| HR | å‘˜å·¥ã€è€ƒå‹¤ã€ç™½åå• | hr |
| è°ƒåº¦å‘˜ | æ’äº§ã€è°ƒåº¦ | dispatcher |
| ä»“åº“ | å‡ºå…¥åº“ | warehouse |
| è´¨æ£€å‘˜ | æ£€éªŒè®°å½• | quality |
| è½¦é—´ä¸»ç®¡ | æ‰¹æ¬¡ç®¡ç† | processing |

---

### Phase 4: å®Œå–„æ”¶å°¾

- å‰©ä½™é¡µé¢è¿ç§»
- æŠ¥è¡¨æ¨¡å—
- å‘Šè­¦æ¨¡å—
- è‹±æ–‡ç¿»è¯‘æ ¡å¯¹
- ä¸€è‡´æ€§æ£€æŸ¥

---

## ä½¿ç”¨ç¤ºä¾‹

### ç»„ä»¶ä¸­ä½¿ç”¨

```typescript
// è¿ç§»å‰
<Text>æ‰¹æ¬¡åˆ—è¡¨</Text>
<Button>ä¿å­˜</Button>

// è¿ç§»å
import { useTranslation } from 'react-i18next';

function MyScreen() {
  const { t } = useTranslation('processing');
  return (
    <>
      <Text>{t('batchList.title')}</Text>
      <Button>{t('common:buttons.save')}</Button>
    </>
  );
}
```

### ç¿»è¯‘é”®å‘½åè§„èŒƒ

```
{namespace}.{section}.{key}

ç¤ºä¾‹ï¼š
- common.buttons.save
- processing.batchList.title
- auth.login.placeholder.username
```

### æ’å€¼è¯­æ³•

```json
{
  "greeting": "ä½ å¥½, {{name}}",
  "itemCount": "å…± {{count}} é¡¹"
}
```

```typescript
t('greeting', { name: 'å¼ ä¸‰' })
```

---

## è¯­è¨€åˆ‡æ¢ç»„ä»¶

åœ¨è®¾ç½®é¡µæ·»åŠ è¯­è¨€åˆ‡æ¢å™¨ï¼š

```typescript
// src/components/settings/LanguageSwitcher.tsx
import { useTranslation } from 'react-i18next';
import { useLanguageStore } from '../../store/languageStore';
import { SUPPORTED_LANGUAGES, LANGUAGE_NAMES } from '../../i18n/types';

export function LanguageSwitcher() {
  const { t } = useTranslation('profile');
  const { language, isSystemLanguage, setLanguage, setSystemLanguage } = useLanguageStore();

  return (
    <List.Section title={t('settings.language')}>
      <List.Item
        title={t('settings.followSystem')}
        left={() => (
          <RadioButton
            status={isSystemLanguage ? 'checked' : 'unchecked'}
            onPress={() => setSystemLanguage(true)}
          />
        )}
      />
      {SUPPORTED_LANGUAGES.map((lang) => (
        <List.Item
          key={lang}
          title={LANGUAGE_NAMES[lang]}
          left={() => (
            <RadioButton
              status={!isSystemLanguage && language === lang ? 'checked' : 'unchecked'}
              onPress={() => setLanguage(lang)}
            />
          )}
        />
      ))}
    </List.Section>
  );
}
```

---

## æ—¥æœŸ/æ•°å­—æ ¼å¼åŒ–

æ›´æ–° `src/utils/index.ts`ï¼š

```typescript
import i18n from '../i18n';

export const formatDate = (date: Date | string): string => {
  const d = new Date(date);
  const locale = i18n.language === 'en-US' ? 'en-US' : 'zh-CN';
  return d.toLocaleDateString(locale, {
    year: 'numeric',
    month: '2-digit',
    day: '2-digit',
  });
};

export const formatDateTime = (date: Date | string): string => {
  const d = new Date(date);
  const locale = i18n.language === 'en-US' ? 'en-US' : 'zh-CN';
  return d.toLocaleString(locale, {
    year: 'numeric',
    month: '2-digit',
    day: '2-digit',
    hour: '2-digit',
    minute: '2-digit',
  });
};

export const formatNumber = (num: number, decimals = 2): string => {
  const locale = i18n.language === 'en-US' ? 'en-US' : 'zh-CN';
  return new Intl.NumberFormat(locale, {
    minimumFractionDigits: decimals,
    maximumFractionDigits: decimals,
  }).format(num);
};

export const formatCurrency = (amount: number, currency = 'CNY'): string => {
  const locale = i18n.language === 'en-US' ? 'en-US' : 'zh-CN';
  return new Intl.NumberFormat(locale, {
    style: 'currency',
    currency,
  }).format(amount);
};
```

---

## å¹¶è¡Œå·¥ä½œå»ºè®®

### Subagent å¹¶è¡Œ

- **å¯å¹¶è¡Œ**: âœ…
- **å»ºè®®**:
  1. Agent 1: åˆ›å»º i18n é…ç½®æ–‡ä»¶
  2. Agent 2: åˆ›å»º zh-CN ç¿»è¯‘æ–‡ä»¶
  3. Agent 3: åˆ›å»º en-US ç¿»è¯‘æ–‡ä»¶

### å¤š Chat å¹¶è¡Œ

- **å¯å¹¶è¡Œ**: âœ…
- **å»ºè®®**:
  - çª—å£1: i18n åŸºç¡€è®¾æ–½ (i18n/, store/, App.tsx)
  - çª—å£2: è¿ç§» screens/auth/ å’Œ screens/main/
  - çª—å£3: è¿ç§» screens/processing/
- **æ³¨æ„**: é¿å…åŒæ—¶ä¿®æ”¹åŒä¸€ä¸ª JSON ç¿»è¯‘æ–‡ä»¶

---

## éªŒæ”¶æ ‡å‡†

- [ ] ä¾èµ–å®‰è£…å®Œæˆ
- [ ] i18n é…ç½®å¯æ­£å¸¸å·¥ä½œ
- [ ] è¯­è¨€è·Ÿéšç³»ç»Ÿè®¾ç½®
- [ ] æ‰‹åŠ¨åˆ‡æ¢è¯­è¨€ç«‹å³ç”Ÿæ•ˆ
- [ ] è¯­è¨€åå¥½æŒä¹…åŒ–
- [ ] æ ¸å¿ƒé¡µé¢å®Œæˆä¸­è‹±æ–‡ç¿»è¯‘
- [ ] æ—¥æœŸ/æ•°å­—æ ¼å¼åŒ–éšè¯­è¨€åˆ‡æ¢
- [ ] æ§åˆ¶å°æ— ç¼ºå¤±ç¿»è¯‘è­¦å‘Š

---

## ç¿»è¯‘æ–‡ä»¶ç¤ºä¾‹

### zh-CN/common.json

```json
{
  "buttons": {
    "confirm": "ç¡®è®¤",
    "cancel": "å–æ¶ˆ",
    "save": "ä¿å­˜",
    "delete": "åˆ é™¤",
    "edit": "ç¼–è¾‘",
    "add": "æ·»åŠ ",
    "search": "æœç´¢",
    "refresh": "åˆ·æ–°",
    "submit": "æäº¤",
    "back": "è¿”å›",
    "next": "ä¸‹ä¸€æ­¥",
    "previous": "ä¸Šä¸€æ­¥",
    "retry": "é‡è¯•"
  },
  "status": {
    "loading": "åŠ è½½ä¸­...",
    "saving": "ä¿å­˜ä¸­...",
    "success": "æ“ä½œæˆåŠŸ",
    "failed": "æ“ä½œå¤±è´¥",
    "noData": "æš‚æ— æ•°æ®"
  },
  "validation": {
    "required": "æ­¤å­—æ®µä¸ºå¿…å¡«é¡¹",
    "invalidEmail": "é‚®ç®±æ ¼å¼ä¸æ­£ç¡®",
    "invalidPhone": "æ‰‹æœºå·æ ¼å¼ä¸æ­£ç¡®"
  },
  "network": {
    "connectionFailed": "ç½‘ç»œè¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè®¾ç½®åé‡è¯•",
    "timeout": "è¯·æ±‚è¶…æ—¶ï¼Œè¯·ç¨åé‡è¯•",
    "serverError": "æœåŠ¡å™¨ç¹å¿™ï¼Œè¯·ç¨åé‡è¯•"
  }
}
```

### en-US/common.json

```json
{
  "buttons": {
    "confirm": "Confirm",
    "cancel": "Cancel",
    "save": "Save",
    "delete": "Delete",
    "edit": "Edit",
    "add": "Add",
    "search": "Search",
    "refresh": "Refresh",
    "submit": "Submit",
    "back": "Back",
    "next": "Next",
    "previous": "Previous",
    "retry": "Retry"
  },
  "status": {
    "loading": "Loading...",
    "saving": "Saving...",
    "success": "Operation successful",
    "failed": "Operation failed",
    "noData": "No data"
  },
  "validation": {
    "required": "This field is required",
    "invalidEmail": "Invalid email format",
    "invalidPhone": "Invalid phone number format"
  },
  "network": {
    "connectionFailed": "Network connection failed. Please check your connection.",
    "timeout": "Request timed out. Please try again.",
    "serverError": "Server is busy. Please try again later."
  }
}
```

---

## è¿ç§»è¿›åº¦è¿½è¸ª

### æ€»ä½“è¿›åº¦

| æŒ‡æ ‡ | æ•°å€¼ |
|------|------|
| **æ€»é¡µé¢æ•°** | 238 |
| **å·²è¿ç§»** | 118 |
| **å¾…è¿ç§»** | 120 |
| **å®Œæˆç‡** | 49.6% |

### é˜¶æ®µè¿›åº¦

| é˜¶æ®µ | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|
| Phase 1: åŸºç¡€è®¾æ–½ | âœ… å®Œæˆ | i18n é…ç½®ã€storeã€App.tsx |
| Phase 2: æ ¸å¿ƒé¡µé¢ | âœ… å®Œæˆ | ç™»å½•/é¦–é¡µ/ä¸ªäººä¸­å¿ƒ |
| Phase 3: è§’è‰²æ¨¡å— | ğŸ”„ è¿›è¡Œä¸­ | éƒ¨åˆ†æ¨¡å—å·²å®Œæˆ |
| Phase 4: å®Œå–„æ”¶å°¾ | â³ å¾…å¼€å§‹ | æŠ¥è¡¨/å‘Šè­¦/æ ¡å¯¹/å‰©ä½™é¡µé¢ |

### æ¨¡å—è¿›åº¦

| æ¨¡å— | æ€»æ•° | å·²å®Œæˆ | å¾…è¿ç§» | çŠ¶æ€ |
|------|------|--------|--------|------|
| auth | 3 | 3 | 0 | âœ… å®Œæˆ |
| factory-admin | 24 | 24 | 0 | âœ… å®Œæˆ |
| reports | 12 | 12 | 0 | âœ… å®Œæˆ |
| workshop-supervisor | 20 | 18 | 2 | ğŸ”„ 90% |
| quality-inspector | 17 | 12 | 5 | ğŸ”„ 71% |
| processing | 28 | 14 | 14 | ğŸ”„ 50% |
| platform | 9 | 4 | 5 | ğŸ”„ 44% |
| hr | 22 | 7 | 15 | ğŸ”„ 32% |
| dispatcher | 23 | 6 | 17 | ğŸ”„ 26% |
| warehouse | 32 | 6 | 26 | ğŸ”„ 19% |
| management | 21 | 3 | 18 | ğŸ”„ 14% |
| å…¶ä»– (demo/test/legacy/alerts/profile/work/traceability/common) | ~27 | ~9 | ~18 | ğŸ”„ è¿›è¡Œä¸­ |

### å·²åˆ›å»ºç¿»è¯‘æ–‡ä»¶

| å‘½åç©ºé—´ | zh-CN | en-US |
|----------|-------|-------|
| common | âœ… | âœ… |
| auth | âœ… | âœ… |
| home | âœ… | âœ… |
| profile | âœ… | âœ… |
| processing | âœ… | âœ… |
| management | âœ… | âœ… |
| warehouse | âœ… | âœ… |
| hr | âœ… | âœ… |
| dispatcher | âœ… | âœ… |
| quality | âœ… | âœ… |
| reports | â³ | â³ |
| alerts | âœ… | âœ… |
| errors | â³ | â³ |

### å·²å®Œæˆæ¨¡å—æ¸…å•

| # | æ¨¡å— | æ–‡ä»¶æ•° | å‘½åç©ºé—´ | å®Œæˆæ—¥æœŸ |
|---|------|--------|----------|----------|
| 1 | auth | 3 | auth | 2026-01-01 |
| 2 | factory-admin | 24 | home, profile | 2026-01-02 |
| 3 | reports | 12 | reports | 2026-01-02 |

### æ›´æ–°æ—¥å¿—

| æ—¥æœŸ | æ›´æ–°å†…å®¹ |
|------|----------|
| 2026-01-01 | Phase 1 åŸºç¡€è®¾æ–½å®Œæˆï¼›Phase 2 å¼€å§‹ï¼Œè¿ç§» auth æ¨¡å— (3 é¡µé¢) |
| 2026-01-02 | factory-admin (24), reports (12) æ¨¡å—å®Œæˆï¼›å…¶ä»–æ¨¡å—éƒ¨åˆ†è¿ç§»ä¸­ |
| 2026-01-02 | æ›´æ­£ç»Ÿè®¡ï¼šå®é™…å·²å®Œæˆ 118/238 (49.6%)ï¼Œå¾…è¿ç§» 120 ä¸ªæ–‡ä»¶ |
