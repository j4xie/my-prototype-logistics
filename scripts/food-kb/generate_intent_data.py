#!/usr/bin/env python3
"""
食品领域意图训练数据生成脚本

生成 50 个食品领域意图分类的训练数据，每个意图 100+ 条样本。
使用模板 + 同义词替换 + 口语化变体 进行数据增强。

输出格式兼容 full_training_data.jsonl:
  {"text": "柠檬酸可以加在果汁里吗", "label": "FOOD_ADDITIVE_QUERY"}

使用方式:
  python generate_intent_data.py --output food_intent_data.jsonl
  python generate_intent_data.py --output data.jsonl --samples-per-intent 150
"""

import argparse
import itertools
import json
import logging
import random
import sys
from pathlib import Path
from typing import Dict, List, Tuple

# ---------------------------------------------------------------------------
# 日志配置
# ---------------------------------------------------------------------------
logging.basicConfig(
    level=logging.INFO,
    format="%(asctime)s [%(levelname)s] %(name)s - %(message)s",
    datefmt="%Y-%m-%d %H:%M:%S",
)
logger = logging.getLogger("generate_intent_data")

# ---------------------------------------------------------------------------
# 常量
# ---------------------------------------------------------------------------
DEFAULT_SAMPLES_PER_INTENT = 120
RANDOM_SEED = 42

# ---------------------------------------------------------------------------
# 同义词词典 (用于数据增强)
# ---------------------------------------------------------------------------
SYNONYMS: Dict[str, List[str]] = {
    # 查询动词
    "查询": ["查询", "查一下", "查", "搜索", "搜一下", "看看", "帮我查", "找一下", "查找"],
    "了解": ["了解", "知道", "想知道", "想了解", "了解一下", "想问", "请问"],
    "告诉我": ["告诉我", "说一下", "给我说说", "跟我讲讲", "帮我看看", "回答一下"],
    "是什么": ["是什么", "是啥", "什么意思", "指的是什么", "代表什么"],
    "怎么": ["怎么", "如何", "怎样", "用什么方法", "通过什么方式"],
    "能不能": ["能不能", "可不可以", "是否可以", "行不行", "可以吗", "能吗"],

    # 食品添加剂
    "食品添加剂": ["食品添加剂", "添加剂", "食品助剂", "加工助剂"],
    "柠檬酸": ["柠檬酸", "枸橼酸"],
    "山梨酸钾": ["山梨酸钾", "山梨酸", "钾盐防腐剂"],
    "防腐剂": ["防腐剂", "保鲜剂", "防腐添加剂"],
    "甜味剂": ["甜味剂", "代糖", "人工甜味剂", "高倍甜味剂"],
    "着色剂": ["着色剂", "色素", "食用色素", "染色剂"],
    "增稠剂": ["增稠剂", "增粘剂", "胶凝剂"],
    "乳化剂": ["乳化剂", "表面活性剂"],

    # 食品标准
    "标准": ["标准", "国标", "国家标准", "行业标准"],
    "GB2760": ["GB2760", "食品添加剂使用标准", "添加剂标准", "2760标准"],
    "GB2762": ["GB2762", "污染物限量标准"],
    "GB2763": ["GB2763", "农药残留标准", "农残标准"],

    # 食品产品
    "酸奶": ["酸奶", "发酵乳", "酸牛奶", "风味酸奶"],
    "面包": ["面包", "烘焙食品", "烘焙产品"],
    "饮料": ["饮料", "饮品", "果汁", "果汁饮料"],
    "肉制品": ["肉制品", "肉类加工品", "肉食品", "熟肉制品"],
    "乳制品": ["乳制品", "奶制品", "奶类产品", "牛奶制品"],
    "罐头": ["罐头", "罐头食品", "罐装食品"],
    "方便食品": ["方便食品", "方便面", "即食食品", "速食"],
    "冷冻食品": ["冷冻食品", "速冻食品", "冷冻水饺", "速冻水饺"],
    "调味品": ["调味品", "调料", "酱油", "醋"],
    "婴幼儿食品": ["婴幼儿食品", "婴幼儿配方奶粉", "婴儿食品", "辅食"],

    # 检测与质量
    "检测": ["检测", "检验", "测试", "化验", "测定"],
    "合格": ["合格", "达标", "符合标准", "合格率"],
    "超标": ["超标", "不合格", "超限", "违规", "检出"],

    # 微生物
    "微生物": ["微生物", "菌落", "细菌", "致病菌"],
    "大肠杆菌": ["大肠杆菌", "大肠埃希氏菌", "大肠菌群"],
    "沙门氏菌": ["沙门氏菌", "沙门菌"],
    "霉菌": ["霉菌", "真菌", "霉菌毒素"],

    # 工艺
    "温度": ["温度", "温控", "加热温度", "杀菌温度"],
    "灭菌": ["灭菌", "杀菌", "消毒", "除菌"],
    "保质期": ["保质期", "有效期", "货架期", "shelf life"],

    # 认证
    "认证": ["认证", "资质", "证书", "许可"],
    "SC认证": ["SC认证", "生产许可证", "SC证", "食品生产许可"],
    "HACCP": ["HACCP", "危害分析和关键控制点", "HACCP体系", "HACCP认证"],
    "ISO22000": ["ISO22000", "ISO 22000", "食品安全管理体系"],

    # 法规
    "食品安全法": ["食品安全法", "食安法", "食品安全法律"],

    # 营养
    "蛋白质": ["蛋白质", "蛋白", "protein"],
    "脂肪": ["脂肪", "油脂", "fat"],
    "营养成分": ["营养成分", "营养元素", "营养素", "营养物质"],
    "营养标签": ["营养标签", "营养成分表", "营养标识", "NRV"],
}

# ---------------------------------------------------------------------------
# 50 个食品领域意图定义
# ---------------------------------------------------------------------------

FOOD_INTENTS: Dict[str, Dict] = {
    # ===== 食品添加剂 (5个) =====
    "FOOD_ADDITIVE_QUERY": {
        "desc": "食品添加剂使用查询",
        "templates": [
            "{添加剂}可以加在{产品}里吗",
            "{添加剂}在{产品}中的最大使用量是多少",
            "{产品}里能用{添加剂}吗",
            "{添加剂}的使用范围有哪些",
            "哪些食品可以使用{添加剂}",
            "{添加剂}属于哪一类{食品添加剂}",
            "{告诉我}{添加剂}的使用限量",
            "我想{了解}{添加剂}能不能用在{产品}里",
            "{查询}{添加剂}的适用食品类别",
            "{产品}用{添加剂}违规吗",
        ],
        "slots": {
            "添加剂": ["柠檬酸", "山梨酸钾", "苯甲酸钠", "阿斯巴甜", "安赛蜜",
                      "卡拉胶", "黄原胶", "二氧化钛", "亚硝酸钠", "焦亚硫酸钠",
                      "丁基羟基茴香醚", "特丁基对苯二酚", "单甘油脂肪酸酯", "碳酸钠"],
            "产品": ["酸奶", "面包", "饮料", "肉制品", "糕点", "果冻",
                    "火腿肠", "方便面", "罐头", "果汁", "饼干", "冰淇淋"],
        },
    },
    "FOOD_ADDITIVE_SAFETY": {
        "desc": "食品添加剂安全性咨询",
        "templates": [
            "{添加剂}对人体有害吗",
            "长期食用含{添加剂}的食品安全吗",
            "{添加剂}的安全性{怎么}评价的",
            "{添加剂}有毒吗",
            "孕妇能吃含{添加剂}的{产品}吗",
            "{添加剂}的ADI值是多少",
            "{添加剂}致癌吗",
            "含{添加剂}的食品儿童能吃吗",
            "{添加剂}的毒理学评估结果",
            "国际上对{添加剂}的安全评价",
        ],
        "slots": {
            "添加剂": ["亚硝酸钠", "苯甲酸钠", "二氧化硫", "铝", "糖精钠",
                      "甜蜜素", "日落黄", "柠檬黄", "胭脂红", "苋菜红"],
            "产品": ["酸奶", "面包", "饮料", "火腿肠", "罐头", "蜜饯"],
        },
    },
    "FOOD_ADDITIVE_ALTERNATIVE": {
        "desc": "添加剂替代方案",
        "templates": [
            "{添加剂}有什么天然替代品",
            "不用{添加剂}可以用什么替代",
            "{产品}中{怎么}不使用{添加剂}",
            "有没有天然{防腐剂}可以替代{添加剂}",
            "零添加{产品}{怎么}实现",
            "用什么可以代替{添加剂}做{产品}",
            "天然{增稠剂}有哪些",
            "天然{着色剂}有哪些",
            "植物提取的{甜味剂}有哪些",
            "清洁标签{产品}怎么做",
        ],
        "slots": {
            "添加剂": ["防腐剂", "人工色素", "化学甜味剂", "化学乳化剂",
                      "苯甲酸钠", "山梨酸钾", "合成着色剂"],
            "产品": ["面包", "酸奶", "饮料", "糕点", "果酱", "酱油"],
        },
    },
    "FOOD_ADDITIVE_INTERACTION": {
        "desc": "添加剂相互作用",
        "templates": [
            "{GB2760}对{添加剂}是{怎么}规定的",
            "最新{标准}中{添加剂}的限量是多少",
            "国家对{添加剂}的法规要求",
            "{添加剂}在中国和欧盟的标准差异",
            "{查询}最新的食品添加剂使用{标准}",
            "哪些{食品添加剂}被禁止使用",
            "被撤销的{食品添加剂}有哪些",
            "{添加剂}的国际编码(INS号)是什么",
            "新版GB2760有什么变化",
            "食品添加剂备案流程",
        ],
        "slots": {
            "添加剂": ["面粉增白剂", "溴酸钾", "过氧化苯甲酰", "甲醛次硫酸氢钠",
                      "硼砂", "工业硫磺", "苏丹红", "三聚氰胺"],
        },
    },
    "FOOD_LABEL_REVIEW": {
        "desc": "食品标签审核",
        "templates": [
            "{食品添加剂}在标签上{怎么}标注",
            "配料表中{添加剂}{怎么}写",
            "复配{食品添加剂}的标签要求",
            "{食品添加剂}通用名称和商品名的区别",
            "食品标签中{添加剂}的排列规则",
            "{食品添加剂}标签上可以写别名吗",
            "{产品}配料表里的E编码{是什么}",
            "食品添加剂零添加标签合法吗",
            "带入原则下需要标注{添加剂}吗",
            "复合调味料中的{添加剂}需要逐一标注吗",
        ],
        "slots": {
            "添加剂": ["柠檬酸", "山梨酸钾", "焦糖色", "阿斯巴甜"],
            "产品": ["饮料", "饼干", "酱油", "面包"],
        },
    },

    # ===== 食品标准查询 (5个) =====
    "FOOD_STANDARD_LOOKUP": {
        "desc": "食品标准查询",
        "templates": [
            "{查询}{标准}的最新版本",
            "{标准}{是什么}",
            "{标准}的适用范围",
            "{告诉我}{标准}的主要内容",
            "{产品}适用哪些食品安全{标准}",
            "{标准}和{标准2}有什么区别",
            "生产{产品}需要遵循哪些{标准}",
            "最新的食品安全{标准}有哪些更新",
            "{标准}什么时候实施的",
            "{产品}的产品{标准}是哪个",
        ],
        "slots": {
            "标准": ["GB2760", "GB7718", "GB28050", "GB14881", "GB29921",
                    "GB2761", "GB2762", "GB2763"],
            "标准2": ["GB/T 22000", "ISO22000", "NY/T 1172"],
            "产品": ["酸奶", "面包", "饮料", "方便面", "肉制品", "婴幼儿配方奶粉"],
        },
    },
    "FOOD_REGULATION_QUERY": {
        "desc": "食品法规查询",
        "templates": [
            "{产品}中{物质}的限量标准是多少",
            "{物质}在{产品}中允许的最大含量",
            "{产品}的{物质}超过多少算超标",
            "{查询}{产品}的{物质}限量值",
            "{标准}中{物质}的限量是多少mg/kg",
            "{产品}中{物质}的安全限值",
            "{物质}的最大残留限量(MRL)",
            "国标对{产品}中{物质}的要求",
            "{产品}重金属限量标准",
            "{产品}农药残留限量{查询}",
        ],
        "slots": {
            "物质": ["铅", "镉", "汞", "砷", "亚硝酸盐", "黄曲霉毒素B1",
                    "二氧化硫残留", "苯并芘", "毒死蜱", "克百威"],
            "产品": ["大米", "茶叶", "水产品", "蔬菜", "水果", "肉制品",
                    "食用油", "调味品", "乳制品"],
        },
    },
    "FOOD_TEST_METHOD": {
        "desc": "检测方法查询",
        "templates": [
            "{产品}中{物质}{怎么}检测",
            "检测{物质}用什么方法",
            "{检测}方法{标准}是什么",
            "{物质}的国标检测方法",
            "{查询}{物质}检测的仪器设备",
            "快速检测{物质}有什么方法",
            "{物质}的检出限是多少",
            "{产品}微生物{检测}标准",
            "重金属{检测}国标方法",
            "{物质}定量分析方法",
        ],
        "slots": {
            "物质": ["蛋白质", "脂肪", "水分", "灰分", "重金属铅",
                    "黄曲霉毒素", "农药残留", "兽药残留", "微生物"],
            "产品": ["牛奶", "茶叶", "蜂蜜", "食用油", "肉制品"],
        },
    },
    "FOOD_AUDIT_PREP": {
        "desc": "审核准备指导",
        "templates": [
            "最近有什么食品{标准}更新",
            "{标准}最新修订了什么内容",
            "今年食品安全{标准}有什么变化",
            "即将实施的食品{标准}有哪些",
            "{标准}的历次修订内容",
            "食品安全标准征求意见稿最新消息",
            "GB2760什么时候出新版",
            "新版食品标签标准进展如何",
            "{产品}相关标准有新的征求意见吗",
            "食品安全标准整合进度",
        ],
        "slots": {
            "产品": ["保健食品", "婴幼儿食品", "特殊医学用途食品"],
        },
    },

    # ===== 食品安全与危害 (5个) =====
    "FOOD_SAFETY_CHECK": {
        "desc": "食品安全检查",
        "templates": [
            "{产品}有哪些食品安全风险",
            "{危害}是什么，有什么危害",
            "{产品}中可能存在哪些{危害}",
            "{危害}的来源和控制措施",
            "{产品}的主要安全隐患",
            "{怎么}识别{产品}中的{危害}",
            "{危害}会导致什么健康问题",
            "最常见的食品安全事故有哪些",
            "{产品}中的化学性危害有哪些",
            "{产品}中的生物性危害有哪些",
        ],
        "slots": {
            "危害": ["黄曲霉毒素", "亚硝胺", "丙烯酰胺", "苯并芘",
                    "二噁英", "3-MCPD", "氯丙醇", "重金属"],
            "产品": ["花生", "食用油", "烧烤食品", "腌制食品", "油炸食品",
                    "发酵食品", "烟熏肉", "坚果"],
        },
    },
    "FOOD_RECALL_QUERY": {
        "desc": "召回信息查询",
        "templates": [
            "最近有什么食品被召回了",
            "{产品}被召回是什么原因",
            "食品召回{怎么}查询",
            "{产品}{物质}超标需要召回吗",
            "食品召回的等级分类",
            "食品安全预警信息在哪查",
            "进口食品被拒绝入境的原因有哪些",
            "食品抽检不合格的处理流程",
            "{查询}最新的食品安全抽检结果",
            "食品企业自主召回的流程",
        ],
        "slots": {
            "产品": ["奶粉", "零食", "进口食品", "网购食品"],
            "物质": ["菌落总数", "大肠菌群", "甜蜜素", "防腐剂"],
        },
    },
    "FOOD_CONTAMINATION_ASSESS": {
        "desc": "污染评估",
        "templates": [
            "{产品}中{污染物}的来源",
            "{怎么}防止{产品}中{污染物}超标",
            "{污染物}的主要控制措施",
            "重金属污染{产品}的原因",
            "{产品}中真菌毒素的预防",
            "农药残留{怎么}降低",
            "兽药残留{怎么}控制",
            "加工过程中{产品}的交叉污染{怎么}防止",
            "{污染物}在食物链中的富集",
            "环境污染对{产品}安全的影响",
        ],
        "slots": {
            "污染物": ["重金属", "农药残留", "黄曲霉毒素", "多环芳烃",
                      "塑化剂", "抗生素残留"],
            "产品": ["蔬菜", "水产品", "粮食", "茶叶", "水果", "畜禽肉"],
        },
    },
    "FOOD_ALLERGEN_CHECK": {
        "desc": "过敏原检查",
        "templates": [
            "{产品}含有什么过敏原",
            "{过敏原}过敏的人不能吃什么",
            "食品标签上必须标注哪些过敏原",
            "{过敏原}交叉污染{怎么}控制",
            "含{过敏原}的食品有哪些",
            "过敏原标签的标注规范",
            "{产品}里有{过敏原}吗",
            "食品工厂{怎么}管理过敏原",
            "无{过敏原}产品的认证要求",
            "过敏原风险评估方法",
        ],
        "slots": {
            "过敏原": ["花生", "大豆", "牛奶", "鸡蛋", "小麦", "坚果",
                      "鱼类", "甲壳类", "芝麻"],
            "产品": ["巧克力", "饼干", "面包", "零食", "酱料"],
        },
    },
    "FOOD_COMPLIANCE_CHECK": {
        "desc": "合规检查",
        "templates": [
            "{怎么}鉴别{产品}是否掺假",
            "{产品}常见的掺假手段有哪些",
            "假{产品}和真{产品}的区别",
            "{产品}掺假检测方法",
            "{怎么}识别{产品}的真假",
            "地沟油{怎么}鉴别",
            "假蜂蜜的特征",
            "{产品}以次充好{怎么}辨别",
            "食品掺假的常用指标",
            "{产品}的同位素溯源技术",
        ],
        "slots": {
            "产品": ["蜂蜜", "橄榄油", "牛奶", "牛肉", "三文鱼",
                    "五常大米", "西湖龙井", "阳澄湖大闸蟹"],
        },
    },

    # ===== 食品加工与工艺 (5个) =====
    "FOOD_PROCESS_OPTIMIZATION": {
        "desc": "工艺优化建议",
        "templates": [
            "{产品}的加工工艺流程",
            "{产品}{怎么}加工生产",
            "{工艺}的原理和操作要点",
            "{产品}生产中{工艺}的参数设置",
            "{告诉我}{产品}的生产工艺",
            "{工艺}对{产品}品质的影响",
            "{产品}加工的关键控制点",
            "{产品}生产中常见的工艺问题",
            "新型{产品}加工技术有哪些",
            "{工艺}在{产品}中的应用",
        ],
        "slots": {
            "工艺": ["巴氏杀菌", "UHT灭菌", "冻干", "真空包装", "热风干燥",
                    "喷雾干燥", "微波杀菌", "超高压处理", "均质", "乳化"],
            "产品": ["酸奶", "面包", "果汁", "罐头", "火腿肠", "速冻水饺",
                    "茶叶", "奶粉", "植物肉"],
        },
    },
    "FOOD_PROCESS_PARAM": {
        "desc": "食品加工参数查询",
        "templates": [
            "{产品}的杀菌{温度}是多少",
            "{产品}的{灭菌}条件",
            "{产品}的水分活度要控制在多少",
            "{产品}的pH值范围是多少",
            "{产品}发酵{温度}和时间",
            "{产品}的冷藏{温度}要求",
            "{产品}的烘焙{温度}和时间",
            "{产品}的均质压力设置",
            "低温长时灭菌和高温短时灭菌的参数",
            "{产品}的F值{怎么}计算",
        ],
        "slots": {
            "产品": ["鲜牛奶", "酸奶", "罐头", "香肠", "面包", "果汁",
                    "豆腐", "啤酒", "婴幼儿配方奶粉"],
        },
    },
    "FOOD_EQUIPMENT_GUIDE": {
        "desc": "设备使用指南",
        "templates": [
            "生产{产品}需要什么设备",
            "{设备}{是什么}，{怎么}使用",
            "{设备}的操作注意事项",
            "{设备}的清洗消毒方法",
            "{设备}的选型建议",
            "小型{产品}加工厂需要哪些设备",
            "{设备}和{设备2}的区别",
            "{设备}的维护保养要点",
            "{产品}生产线设备配置方案",
            "CIP清洗{设备}的流程",
        ],
        "slots": {
            "设备": ["杀菌釜", "均质机", "灌装机", "封口机", "冻干机",
                    "喷雾干燥塔", "反渗透设备", "搅拌罐", "离心机"],
            "设备2": ["板式换热器", "管式换热器", "夹层锅"],
            "产品": ["酸奶", "果汁", "罐头", "面包", "速冻食品"],
        },
    },
    "FOOD_SHELF_LIFE": {
        "desc": "食品保质期咨询",
        "templates": [
            "{产品}的{保质期}一般多长",
            "{怎么}延长{产品}的{保质期}",
            "影响{产品}{保质期}的因素",
            "{产品}过了{保质期}还能吃吗",
            "{产品}的{保质期}测试方法",
            "加速货架期试验{怎么}做",
            "{产品}开封后{保质期}多久",
            "不同包装对{产品}{保质期}的影响",
            "{怎么}确定新产品的{保质期}",
            "{产品}在不同温度下的{保质期}变化",
        ],
        "slots": {
            "产品": ["鲜牛奶", "酸奶", "面包", "月饼", "火腿肠", "果汁",
                    "食用油", "坚果", "休闲零食", "冷鲜肉"],
        },
    },
    "FOOD_PACKAGING_GUIDE": {
        "desc": "包装指导",
        "templates": [
            "{产品}用什么包装材料好",
            "食品包装材料的安全{标准}",
            "真空包装{产品}的保鲜原理",
            "气调包装{怎么}应用在{产品}上",
            "食品接触材料的{检测}要求",
            "塑料包装{产品}安全吗",
            "可降解包装材料有哪些",
            "{产品}包装材料的迁移量{标准}",
            "活性包装和智能包装{是什么}",
            "{产品}标签设计规范",
        ],
        "slots": {
            "产品": ["肉制品", "乳制品", "饮料", "烘焙食品", "速冻食品",
                    "零食", "调味品"],
        },
    },

    # ===== 食品质量控制 (5个) =====
    "FOOD_SAMPLING_PLAN": {
        "desc": "抽样方案",
        "templates": [
            "{产品}的质量控制要点",
            "食品工厂{怎么}做质量控制",
            "HACCP{怎么}应用在{产品}生产中",
            "{产品}的关键质量指标有哪些",
            "出厂{检测}项目包括哪些",
            "{产品}的感官评价方法",
            "SPC在食品质量控制中的应用",
            "食品安全管理体系{怎么}建立",
            "{产品}的来料检验标准",
            "过程控制和终产品{检测}哪个更重要",
        ],
        "slots": {
            "产品": ["乳制品", "肉制品", "饮料", "罐头", "速冻食品",
                    "烘焙食品", "调味品", "婴幼儿食品"],
        },
    },
    "FOOD_MICROBE_QUERY": {
        "desc": "微生物知识查询",
        "templates": [
            "{产品}中{微生物}的{检测}方法",
            "{微生物}的限量标准是多少",
            "{怎么}检测{产品}中的{微生物}",
            "{微生物}超标{怎么}办",
            "菌落总数和大肠菌群有什么区别",
            "{产品}的微生物控制措施",
            "{微生物}的快速{检测}方法",
            "食品微生物采样方案{怎么}制定",
            "{产品}中致病菌的{检测}周期",
            "微生物{检测}实验室的基本要求",
        ],
        "slots": {
            "微生物": ["大肠杆菌", "沙门氏菌", "金黄色葡萄球菌", "李斯特菌",
                      "霉菌", "酵母", "菌落总数", "大肠菌群", "阪崎肠杆菌"],
            "产品": ["牛奶", "肉制品", "即食食品", "饮料", "婴幼儿食品"],
        },
    },
    "FOOD_PROCESS_TROUBLESHOOT": {
        "desc": "工艺故障排查",
        "templates": [
            "{产品}中{营养成分}的{检测}方法",
            "{怎么}测定{产品}的{物质}含量",
            "{产品}的理化指标有哪些",
            "常用的食品理化{检测}仪器",
            "{物质}的{检测}标准方法是什么",
            "近红外光谱在食品{检测}中的应用",
            "{产品}的水分{检测}方法",
            "食品中{物质}的前处理方法",
            "{产品}品质的仪器分析方法",
            "重金属{检测}的样品消解方法",
        ],
        "slots": {
            "物质": ["蛋白质", "脂肪", "水分", "灰分", "纤维素",
                    "维生素C", "铅", "砷", "防腐剂", "甜味剂"],
            "产品": ["牛奶", "肉制品", "蜂蜜", "茶叶", "食用油"],
        },
    },
    "FOOD_TRACEABILITY_GUIDE": {
        "desc": "溯源指导",
        "templates": [
            "食品溯源体系{怎么}建立",
            "{产品}的全程溯源流程",
            "一物一码溯源{怎么}实现",
            "区块链在食品溯源中的应用",
            "食品溯源的法规要求",
            "{产品}的溯源信息应该包括什么",
            "食品溯源平台有哪些",
            "进口{产品}的溯源要求",
            "从农场到餐桌的溯源链路",
            "溯源码扫码查询不到信息{怎么}办",
        ],
        "slots": {
            "产品": ["肉类", "乳制品", "蔬菜", "水产品", "进口食品",
                    "婴幼儿配方奶粉", "保健食品"],
        },
    },
    "FOOD_GMP_GUIDE": {
        "desc": "GMP指导",
        "templates": [
            "{产品}生产的GMP要求",
            "食品工厂卫生规范{是什么}",
            "{GB14881}的主要内容",
            "食品车间的清洁度分区{怎么}划分",
            "食品从业人员健康管理要求",
            "食品工厂虫害控制措施",
            "食品设备的清洗消毒SOP",
            "洁净车间的环境监控",
            "食品工厂废水处理要求",
            "SSOP标准操作程序包括哪些",
        ],
        "slots": {
            "产品": ["乳制品", "肉制品", "饮料", "婴幼儿食品", "保健食品"],
        },
    },

    # ===== 食品法规与认证 (5个) =====
    "FOOD_HACCP_GUIDE": {
        "desc": "HACCP指导",
        "templates": [
            "{食品安全法}第几条规定了什么",
            "{食品安全法}对{主题}是{怎么}规定的",
            "违反{食品安全法}的处罚措施",
            "食品经营许可证{怎么}办理",
            "食品生产许可证的申请条件",
            "网络食品经营的法规要求",
            "进口食品的法规要求",
            "食品广告的法律规定",
            "食品安全举报的法律依据",
            "食品安全犯罪的刑事责任",
        ],
        "slots": {
            "主题": ["食品召回", "标签标注", "食品添加剂", "食品生产许可",
                    "食品安全事故", "保健食品注册"],
        },
    },
    "FOOD_CERT_GUIDE": {
        "desc": "认证体系指导",
        "templates": [
            "{认证}{怎么}办理",
            "{认证}的认证流程和费用",
            "{认证}和{认证2}有什么区别",
            "食品企业需要哪些{认证}",
            "有机{认证}的申请条件",
            "绿色食品{认证}的要求",
            "出口食品需要什么{认证}",
            "{认证}审核重点关注什么",
            "{认证}证书的有效期是多长",
            "清真食品{认证}要求",
        ],
        "slots": {
            "认证": ["SC认证", "HACCP认证", "ISO22000", "BRC认证",
                    "IFS认证", "FSSC22000", "有机认证", "绿色食品认证"],
            "认证2": ["BRC认证", "IFS认证", "SQF认证"],
        },
    },
    "FOOD_EXPORT_GUIDE": {
        "desc": "出口指导",
        "templates": [
            "出口{产品}到{国家}需要什么手续",
            "进口{产品}的报关流程",
            "食品进口商需要什么资质",
            "{国家}对{产品}的进口要求",
            "跨境电商食品的法规要求",
            "进口食品标签{怎么}制作",
            "食品出口的CIQ{检测}",
            "进口食品境外生产企业注册要求",
            "食品进出口的关税是多少",
            "跨境食品安全信息通报机制",
        ],
        "slots": {
            "国家": ["美国", "日本", "欧盟", "韩国", "东南亚"],
            "产品": ["茶叶", "水产品", "蜂蜜", "调味品", "零食", "保健食品"],
        },
    },
    "FOOD_HACCP_CCP": {
        "desc": "关键控制点分析",
        "templates": [
            "食品生产许可证{怎么}申请",
            "小作坊需要什么证照",
            "食品经营许可证变更流程",
            "网上卖食品需要什么证",
            "食品生产许可证到期{怎么}续证",
            "食品生产许可的审查要点",
            "食品小经营店备案要求",
            "食品生产许可证上的品种明细{怎么}增加",
            "餐饮服务许可证和食品经营许可证的区别",
            "代工生产需要生产许可证吗",
        ],
        "slots": {},
    },
    "FOOD_REGULATION_PENALTY": {
        "desc": "食品违规处罚查询",
        "templates": [
            "生产不合格食品的处罚标准",
            "食品{物质}超标怎么处罚",
            "无证生产食品的法律后果",
            "食品虚假宣传的处罚",
            "食品安全事故的追责流程",
            "过期食品销售的处罚",
            "食品标签不合格的处罚",
            "食品掺假的法律责任",
            "食品安全十倍赔偿的条件",
            "职业打假人举报{怎么}处理",
        ],
        "slots": {
            "物质": ["添加剂", "重金属", "农药残留", "防腐剂", "甜味剂"],
        },
    },

    # ===== 食品营养与健康 (5个) =====
    "FOOD_NUTRITION_CALC": {
        "desc": "营养成分计算",
        "templates": [
            "{产品}的{营养成分}含量是多少",
            "{产品}有什么营养价值",
            "{产品}的热量是多少",
            "{营养成分}含量高的食物有哪些",
            "每天需要摄入多少{营养成分}",
            "{产品}和{产品2}哪个营养价值高",
            "{营养成分}的每日推荐摄入量(NRV)",
            "{产品}的升糖指数(GI值)是多少",
            "高{营养成分}食品排行",
            "{产品}的氨基酸组成",
        ],
        "slots": {
            "营养成分": ["蛋白质", "钙", "铁", "锌", "维生素C", "膳食纤维",
                       "DHA", "叶酸", "维生素D", "钾"],
            "产品": ["牛奶", "鸡蛋", "牛肉", "三文鱼", "菠菜", "西兰花"],
            "产品2": ["豆浆", "鸭蛋", "猪肉", "鳕鱼"],
        },
    },
    "FOOD_NUTRITION_LABEL": {
        "desc": "食品营养标签解读",
        "templates": [
            "{营养标签}上的NRV{是什么}",
            "{怎么}看{产品}的{营养标签}",
            "{营养标签}的核心营养素有哪些",
            "反式脂肪酸标注0{是什么}意思",
            "{营养标签}上的能量{怎么}换算",
            "食品标签上的%NRV{怎么}理解",
            "{营养标签}对比{怎么}做",
            "{产品}的{营养标签}有什么要求",
            "无糖食品的标签标准",
            "低钠食品的营养声称标准",
        ],
        "slots": {
            "产品": ["饮料", "零食", "乳制品", "面包", "麦片"],
        },
    },
    "FOOD_FORMULA_DESIGN": {
        "desc": "配方设计指导",
        "templates": [
            "{产品}能宣传保健功能吗",
            "食品营养声称的规范",
            "功能声称和营养声称的区别",
            "哪些营养成分可以做声称",
            "{产品}标签上写'增强免疫力'合规吗",
            "普通食品能写'降血压'吗",
            "保健食品的声称范围",
            "食品广告中的健康声称限制",
            "{产品}的营养功能声称条件",
            "减肥食品的宣传规范",
        ],
        "slots": {
            "产品": ["酸奶", "麦片", "蛋白粉", "保健食品", "果汁", "茶饮"],
        },
    },
    "FOOD_SENSORY_EVAL": {
        "desc": "感官评价",
        "templates": [
            "婴幼儿配方奶粉的营养要求",
            "特殊医学用途食品{是什么}",
            "运动营养食品的{标准}",
            "糖尿病人适用食品的要求",
            "低蛋白食品的{标准}要求",
            "无麸质食品{怎么}认证",
            "特膳食品的注册流程",
            "婴幼儿辅食的营养{标准}",
            "老年食品的营养要求",
            "孕妇专用食品的规范",
        ],
        "slots": {},
    },
    "FOOD_RISK_ASSESSMENT": {
        "desc": "风险评估",
        "templates": [
            "益生菌食品的功能和选购",
            "膳食纤维{产品}的健康作用",
            "植物甾醇对胆固醇的影响",
            "DHA食品{怎么}选择",
            "抗氧化食品有哪些",
            "发酵食品的健康益处",
            "全谷物食品的营养优势",
            "功能性食品和保健品的区别",
            "肠道健康相关的食品成分",
            "植物蛋白食品的营养价值",
        ],
        "slots": {
            "产品": ["酸奶", "燕麦", "坚果", "发酵食品", "杂粮"],
        },
    },

    # ===== 食品生产管理 (5个) =====
    "FOOD_THERMAL_CALC": {
        "desc": "热处理计算",
        "templates": [
            "开一个{产品}加工厂需要什么条件",
            "{产品}工厂的选址要求",
            "食品车间的布局设计",
            "小型{产品}加工厂投资预算",
            "食品工厂的环保要求",
            "洁净车间的建设标准",
            "食品工厂的供水排水设计",
            "食品车间的通风和空调要求",
            "{产品}生产线的规划",
            "食品工厂消防要求",
        ],
        "slots": {
            "产品": ["乳制品", "肉制品", "饮料", "烘焙食品", "速冻食品",
                    "调味品", "预制菜"],
        },
    },
    "FOOD_SUPPLIER_AUDIT": {
        "desc": "供应商审核",
        "templates": [
            "食品冷链物流的要求",
            "{产品}的运输温度控制",
            "食品仓储管理规范",
            "先进先出(FIFO)在食品仓储中的实施",
            "{产品}的冷链配送标准",
            "食品原料供应商{怎么}评估",
            "食品供应链的风险管理",
            "冷链断链对{产品}的影响",
            "食品物流的温度监控方案",
            "第三方冷链物流的选择标准",
        ],
        "slots": {
            "产品": ["鲜奶", "冷鲜肉", "速冻食品", "蔬菜", "水产品", "疫苗"],
        },
    },
    "FOOD_COLD_CHAIN": {
        "desc": "冷链管理",
        "templates": [
            "{产品}生产成本{怎么}控制",
            "降低食品原料损耗的方法",
            "食品包装成本优化",
            "{产品}的BOM表{怎么}做",
            "食品生产的能耗{怎么}降低",
            "减少食品生产中的废弃物",
            "{产品}的配方成本核算",
            "食品工厂的人工效率提升",
            "精益生产在食品工厂的应用",
            "{产品}的毛利率{怎么}提升",
        ],
        "slots": {
            "产品": ["面包", "饮料", "罐头", "速冻食品", "调味品"],
        },
    },
    "FOOD_TRAINING_GUIDE": {
        "desc": "培训指导",
        "templates": [
            "食品从业人员需要什么健康证",
            "食品安全培训的内容",
            "食品工厂新员工培训计划",
            "食品安全管理员{怎么}考核",
            "HACCP内审员培训",
            "食品检验人员的资质要求",
            "食品安全知识考核题库",
            "食品从业人员的卫生操作规范",
            "食品企业年度培训计划{怎么}制定",
            "食品安全总监的职责",
        ],
        "slots": {},
    },
    "FOOD_WASTE_MANAGEMENT": {
        "desc": "食品废弃物管理",
        "templates": [
            "食品工厂废弃物{怎么}处理",
            "过期食品的处理规范",
            "食品加工废水处理工艺",
            "餐厨垃圾的处理方法",
            "食品废弃物的资源化利用",
            "减少食品浪费的措施",
            "食品报废的流程和记录",
            "副产物的综合利用方案",
            "食品工厂的环评要求",
            "废弃食用油脂的管理规定",
        ],
        "slots": {},
    },

    # ===== 新兴食品领域 (5个) =====
    "FOOD_RND_CONSULT": {
        "desc": "研发咨询",
        "templates": [
            "{原料}属于新食品原料吗",
            "新食品原料{怎么}申报",
            "新食品原料的安全性评估流程",
            "已批准的新食品原料有哪些",
            "{原料}的使用范围和用量",
            "新食品原料公告的查询方法",
            "药食同源目录里有{原料}吗",
            "新资源食品和普通食品的区别",
            "进口新食品原料的审批流程",
            "新食品原料的毒理学要求",
        ],
        "slots": {
            "原料": ["DHA藻油", "壳寡糖", "益生菌", "塔格糖", "人参",
                    "玛咖", "奇亚籽", "藜麦"],
        },
    },
    "FOOD_WATER_QUALITY": {
        "desc": "水质管理",
        "templates": [
            "转基因食品的安全评价",
            "基因编辑食品和转基因食品的区别",
            "合成生物学在食品中的应用",
            "细胞培养肉{是什么}",
            "精准发酵技术生产蛋白质",
            "转基因食品的标签要求",
            "生物技术在食品防腐中的应用",
            "酶工程在食品加工中的应用",
            "发酵工程生产食品配料",
            "基因组学在食品安全检测中的应用",
        ],
        "slots": {},
    },
    "FOOD_PEST_CONTROL": {
        "desc": "虫害控制",
        "templates": [
            "植物肉的生产工艺",
            "植物奶和牛奶的营养对比",
            "植物基食品的{标准}",
            "大豆蛋白拉丝技术{是什么}",
            "植物基冰淇淋的配方",
            "植物基食品的过敏原管理",
            "植物基食品市场趋势",
            "植物蛋白肉的营养评价",
            "燕麦奶的加工工艺",
            "植物基食品的标签规范",
        ],
        "slots": {},
    },
    "FOOD_EQUIPMENT_VALIDATION": {
        "desc": "设备验证",
        "templates": [
            "食品工厂数字化转型方案",
            "MES系统在食品生产中的应用",
            "食品生产线的自动化改造",
            "AI在食品质量{检测}中的应用",
            "食品工厂的物联网方案",
            "机器视觉在食品分选中的应用",
            "食品生产的数据采集和分析",
            "ERP系统在食品企业中的选型",
            "食品工厂的智能仓储方案",
            "数字孪生技术在食品工厂的应用",
        ],
        "slots": {},
    },
    "FOOD_CIP_GUIDE": {
        "desc": "CIP清洗指导",
        "templates": [
            "食品碳足迹{怎么}计算",
            "食品企业的ESG报告",
            "可持续包装材料有哪些",
            "食品供应链的碳减排措施",
            "水足迹在食品生产中的意义",
            "食品浪费的全球数据",
            "循环经济在食品行业的应用",
            "食品企业的碳中和路径",
            "可持续渔业认证(MSC)",
            "生态标签在食品上的应用",
        ],
        "slots": {},
    },

    # ===== 食品品类专项 (5个) =====
    "FOOD_DAIRY_GUIDE": {
        "desc": "乳制品指导",
        "templates": [
            "巴氏奶和UHT奶的区别",
            "酸奶发酵剂{怎么}选择",
            "奶酪的生产工艺流程",
            "乳清蛋白和酪蛋白的区别",
            "{乳制品}中{物质}的限量标准",
            "鲜奶的微生物指标",
            "复原乳的标注规定",
            "生乳收购的质量检验项目",
            "乳制品中三聚氰胺的{检测}方法",
            "常温酸奶和低温酸奶的区别",
        ],
        "slots": {
            "物质": ["体细胞数", "黄曲霉毒素M1", "蛋白质", "脂肪", "抗生素残留"],
        },
    },
    "FOOD_MEAT_GUIDE": {
        "desc": "肉制品指导",
        "templates": [
            "{肉制品}的加工工艺",
            "冷鲜肉和冷冻肉的区别",
            "肉制品中亚硝酸盐的使用标准",
            "肉制品的保水剂{怎么}使用",
            "{肉制品}的微生物控制要点",
            "瘦肉精{检测}方法",
            "注水肉的鉴别方法",
            "肉类嫩化剂的使用规范",
            "预制菜的安全管理",
            "肉制品中兽药残留限量",
        ],
        "slots": {
            "肉制品": ["火腿", "香肠", "培根", "腊肉", "卤味", "肉松", "午餐肉"],
        },
    },
    "FOOD_BEVERAGE_GUIDE": {
        "desc": "饮料指导",
        "templates": [
            "{饮料}的生产工艺流程",
            "碳酸饮料的充气工艺",
            "果汁含量{怎么}标注",
            "功能饮料的配方设计",
            "饮用水的微生物{标准}",
            "NFC果汁和FC果汁的区别",
            "茶饮料的品质控制要点",
            "植物蛋白饮料的稳定性{怎么}解决",
            "{饮料}的杀菌工艺选择",
            "饮料中防腐剂的使用标准",
        ],
        "slots": {
            "饮料": ["果汁", "茶饮料", "碳酸饮料", "功能饮料", "乳饮料",
                    "咖啡饮料", "植物蛋白饮料"],
        },
    },
    "FOOD_BAKERY_GUIDE": {
        "desc": "烘焙指导",
        "templates": [
            "{烘焙}的配方比例",
            "面包的发酵工艺",
            "{烘焙}的{保质期}延长方法",
            "烘焙食品中反式脂肪酸{怎么}控制",
            "{烘焙}的品质评价标准",
            "天然酵母和商业酵母的区别",
            "无麸质烘焙的配方设计",
            "烘焙食品中丙烯酰胺的控制",
            "{烘焙}的包装和储存要求",
            "预拌粉的质量标准",
        ],
        "slots": {
            "烘焙": ["面包", "蛋糕", "饼干", "月饼", "吐司", "曲奇",
                    "泡芙", "丹麦面包"],
        },
    },
    "FOOD_FROZEN_GUIDE": {
        "desc": "速冻食品指导",
        "templates": [
            "酱油的酿造工艺和等级划分",
            "食醋的酿造方法",
            "{调味品}的质量{标准}",
            "配制酱油和酿造酱油的区别",
            "味精的安全性",
            "{调味品}中{物质}的限量",
            "复合调味料的配方设计",
            "火锅底料的质量控制",
            "蚝油的掺假鉴别",
            "调味品的防腐保鲜措施",
        ],
        "slots": {
            "调味品": ["酱油", "食醋", "蚝油", "豆瓣酱", "芝麻酱", "辣椒酱"],
            "物质": ["氨基酸态氮", "总酸", "苯甲酸", "菌落总数"],
        },
    },
    "FOOD_INCIDENT_RESPONSE": {
        "desc": "应急处置",
        "templates": [
            "食品安全事故的应急处置流程",
            "发现{产品}质量问题{怎么}应急处理",
            "食品安全事件的报告程序",
            "食品中毒事件的应急响应方案",
            "食品污染事故的处置步骤",
            "{产品}发生质量问题后的召回应急预案",
            "食品工厂突发事件应急预案{怎么}制定",
            "食品安全舆情应对措施",
            "消费者投诉食品安全问题{怎么}处理",
            "食品安全应急演练方案",
        ],
        "slots": {
            "产品": ["乳制品", "肉制品", "饮料", "婴幼儿食品", "速冻食品",
                    "零食", "保健食品", "进口食品"],
        },
    },
}

# ---------------------------------------------------------------------------
# 口语化/非正式变体模板
# ---------------------------------------------------------------------------
COLLOQUIAL_PREFIXES = [
    "", "请问", "我想问一下", "帮忙查查", "你好，",
    "想请教一下", "在线等，", "急问！", "小白求助，",
    "大佬帮忙看看", "想咨询下", "麻烦问下",
]

COLLOQUIAL_SUFFIXES = [
    "", "谢谢", "急！", "在线等回复", "求解答",
    "感恩", "拜托了", "跪求答案", "?", "呢？", "啊？",
]


# ---------------------------------------------------------------------------
# 数据生成核心逻辑
# ---------------------------------------------------------------------------

def expand_synonyms(text: str, synonyms: Dict[str, List[str]]) -> List[str]:
    """
    对模板中的同义词槽位 {key} 进行展开。
    如果 key 在 synonyms 中，返回所有替换组合的子集。
    """
    import re as _re

    # 查找所有 {xxx} 槽位
    slots = _re.findall(r"\{(\w+)\}", text)
    if not slots:
        return [text]

    # 判断哪些是同义词槽位
    syn_slots = [s for s in slots if s in synonyms]
    if not syn_slots:
        return [text]

    results = []
    # 对同义词槽位做替换
    for combo in itertools.product(*[synonyms[s] for s in syn_slots]):
        replaced = text
        for slot, value in zip(syn_slots, combo):
            replaced = replaced.replace("{" + slot + "}", value, 1)
        results.append(replaced)

    return results


def fill_template(
    template: str,
    slots: Dict[str, List[str]],
    synonyms: Dict[str, List[str]],
    rng: random.Random,
) -> List[str]:
    """
    填充模板的所有槽位，返回多个变体。
    步骤: 先替换同义词槽位 → 再替换数据槽位。
    """
    # 1. 展开同义词
    syn_expanded = expand_synonyms(template, synonyms)

    # 2. 收集所有数据槽位
    import re as _re
    all_results = []

    for text in syn_expanded:
        remaining_slots = _re.findall(r"\{(\w+)\}", text)
        data_slots = [s for s in remaining_slots if s in slots]

        if not data_slots:
            all_results.append(text)
            continue

        # 做槽位组合
        slot_values = [slots[s] for s in data_slots]
        for combo in itertools.product(*slot_values):
            filled = text
            for slot, value in zip(data_slots, combo):
                filled = filled.replace("{" + slot + "}", value, 1)
            # 清除未填充的槽位
            filled = _re.sub(r"\{(\w+)\}", "", filled).strip()
            if filled:
                all_results.append(filled)

    return all_results


def add_colloquial_variants(
    texts: List[str],
    rng: random.Random,
    ratio: float = 0.3,
) -> List[str]:
    """
    为部分样本添加口语化前缀/后缀。
    ratio: 口语化变体比例。
    """
    variants = []
    for text in texts:
        variants.append(text)  # 保留原始版本
        if rng.random() < ratio:
            prefix = rng.choice(COLLOQUIAL_PREFIXES)
            suffix = rng.choice(COLLOQUIAL_SUFFIXES)
            variant = f"{prefix}{text}{suffix}".strip()
            if variant != text:
                variants.append(variant)
    return variants


def generate_intent_samples(
    intent_name: str,
    intent_config: Dict,
    synonyms: Dict[str, List[str]],
    target_count: int,
    rng: random.Random,
) -> List[Dict]:
    """
    为单个意图生成训练样本。
    """
    templates = intent_config.get("templates", [])
    slots = intent_config.get("slots", {})

    # 1. 通过模板生成基础样本
    all_texts = []
    for tmpl in templates:
        filled = fill_template(tmpl, slots, synonyms, rng)
        all_texts.extend(filled)

    # 2. 去重
    all_texts = list(dict.fromkeys(all_texts))

    # 3. 添加口语化变体
    all_texts = add_colloquial_variants(all_texts, rng, ratio=0.25)

    # 4. 去重 + 打乱
    all_texts = list(dict.fromkeys(all_texts))
    rng.shuffle(all_texts)

    # 5. 截断或补足到目标数量
    if len(all_texts) > target_count:
        all_texts = all_texts[:target_count]
    elif len(all_texts) < target_count:
        # 通过随机组合补足
        deficit = target_count - len(all_texts)
        logger.debug(
            "意图 %s: 基础样本 %d 不足 %d, 尝试补足 %d",
            intent_name, len(all_texts), target_count, deficit,
        )
        # 随机选模板重新填充
        extra = []
        for _ in range(deficit * 2):
            tmpl = rng.choice(templates)
            filled = fill_template(tmpl, slots, synonyms, rng)
            if filled:
                chosen = rng.choice(filled)
                # 加口语化变体
                if rng.random() < 0.4:
                    prefix = rng.choice(COLLOQUIAL_PREFIXES)
                    suffix = rng.choice(COLLOQUIAL_SUFFIXES)
                    chosen = f"{prefix}{chosen}{suffix}".strip()
                extra.append(chosen)

        extra = [t for t in extra if t not in set(all_texts)]
        extra = list(dict.fromkeys(extra))
        all_texts.extend(extra[: deficit])

    # 6. 构造输出格式
    samples = [
        {"text": text, "label": intent_name}
        for text in all_texts[:target_count]
    ]
    return samples


# ---------------------------------------------------------------------------
# 主流程
# ---------------------------------------------------------------------------

def main() -> None:
    parser = argparse.ArgumentParser(
        description="食品领域意图训练数据生成脚本 (50个意图)",
        formatter_class=argparse.RawDescriptionHelpFormatter,
    )
    parser.add_argument(
        "--output", "-o", type=str, default="food_intent_data.jsonl",
        help="输出 JSONL 文件路径 (默认: food_intent_data.jsonl)",
    )
    parser.add_argument(
        "--samples-per-intent", type=int, default=DEFAULT_SAMPLES_PER_INTENT,
        help=f"每个意图的样本数 (默认: {DEFAULT_SAMPLES_PER_INTENT})",
    )
    parser.add_argument(
        "--seed", type=int, default=RANDOM_SEED,
        help=f"随机种子 (默认: {RANDOM_SEED})",
    )
    parser.add_argument(
        "--list-intents", action="store_true",
        help="列出所有意图类别后退出",
    )
    parser.add_argument(
        "--stats", action="store_true",
        help="输出生成统计",
    )
    parser.add_argument(
        "--verbose", "-v", action="store_true",
        help="启用详细日志",
    )
    args = parser.parse_args()

    if args.verbose:
        logging.getLogger().setLevel(logging.DEBUG)

    # 列出意图
    if args.list_intents:
        print(f"共 {len(FOOD_INTENTS)} 个食品领域意图:\n")
        for i, (name, config) in enumerate(FOOD_INTENTS.items(), 1):
            print(f"  {i:2d}. {name:40s} — {config['desc']}")
        return

    rng = random.Random(args.seed)
    output_path = Path(args.output)
    output_path.parent.mkdir(parents=True, exist_ok=True)

    logger.info("=" * 60)
    logger.info("食品领域意图训练数据生成")
    logger.info("意图数量: %d", len(FOOD_INTENTS))
    logger.info("目标样本/意图: %d", args.samples_per_intent)
    logger.info("输出文件: %s", output_path.resolve())
    logger.info("随机种子: %d", args.seed)
    logger.info("=" * 60)

    all_samples: List[Dict] = []
    intent_stats: Dict[str, int] = {}

    for intent_name, intent_config in FOOD_INTENTS.items():
        samples = generate_intent_samples(
            intent_name=intent_name,
            intent_config=intent_config,
            synonyms=SYNONYMS,
            target_count=args.samples_per_intent,
            rng=rng,
        )
        all_samples.extend(samples)
        intent_stats[intent_name] = len(samples)
        logger.info(
            "意图 %-40s: %d 条 (目标 %d)",
            intent_name, len(samples), args.samples_per_intent,
        )

    # 全局打乱
    rng.shuffle(all_samples)

    # 写出 JSONL
    with open(output_path, "w", encoding="utf-8") as f:
        for sample in all_samples:
            f.write(json.dumps(sample, ensure_ascii=False) + "\n")

    logger.info("=" * 60)
    logger.info("生成完成!")
    logger.info("总样本数: %d", len(all_samples))
    logger.info("意图数: %d", len(intent_stats))

    if args.stats:
        logger.info("--- 各意图样本数 ---")
        for name, count in sorted(intent_stats.items()):
            logger.info("  %s: %d", name, count)

    # 检查样本不足的意图
    under_target = {
        k: v for k, v in intent_stats.items() if v < args.samples_per_intent
    }
    if under_target:
        logger.warning("以下意图样本数不足目标:")
        for name, count in under_target.items():
            logger.warning("  %s: %d / %d", name, count, args.samples_per_intent)

    logger.info("输出文件: %s", output_path.resolve())
    logger.info("=" * 60)


if __name__ == "__main__":
    main()
