<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>首页 - 中国牛产业数智云平台</title>
  <link rel="stylesheet" href="../../assets/css/variables.css">
  <link rel="stylesheet" href="../../assets/css/common.css">
  <link rel="stylesheet" href="../../assets/css/mobile.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@mdi/font@7.2.96/css/materialdesignicons.min.css">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Microsoft YaHei', sans-serif;
      background: #F5F5F5;
      min-height: 100vh;
      /* padding-bottom 由 mobile.css 的 body.has-bottom-nav 统一控制 (75px) */
    }

    /* 顶部Header */
    .header {
      background: linear-gradient(135deg, #2E7D32 0%, #1B5E20 100%);
      padding: 16px;
      padding-top: 48px;
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .header-top {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 16px;
    }

    .location {
      display: flex;
      align-items: center;
      gap: 4px;
      color: white;
      font-size: 14px;
    }

    .location-icon {
      font-size: 16px;
    }

    .search-bar {
      flex: 1;
      display: flex;
      align-items: center;
      background: white;
      border-radius: 20px;
      padding: 10px 16px;
      gap: 8px;
    }

    .search-bar input {
      flex: 1;
      border: none;
      outline: none;
      font-size: 14px;
      color: #212121;
    }

    .search-bar input::placeholder {
      color: #BDBDBD;
    }

    .search-icon {
      color: #9E9E9E;
      font-size: 16px;
    }

    .header-actions {
      display: flex;
      gap: 16px;
    }

    .header-btn {
      color: white;
      font-size: 20px;
      text-decoration: none;
    }

    /* Banner轮播 */
    .banner {
      margin: 16px;
      border-radius: 12px;
      overflow: hidden;
      height: 140px;
      position: relative;
    }

    .banner-container {
      display: flex;
      width: 300%;
      height: 100%;
      transition: transform 0.4s ease;
    }

    .banner-slide {
      width: 33.333%;
      height: 100%;
      display: flex;
      align-items: center;
      padding: 20px;
      color: white;
      cursor: pointer;
      text-decoration: none;
    }

    .banner-slide:active {
      opacity: 0.9;
    }

    .banner-slide:nth-child(1) {
      background: linear-gradient(135deg, #388E3C 0%, #1B5E20 100%);
    }

    .banner-slide:nth-child(2) {
      background: linear-gradient(135deg, #1565C0 0%, #0D47A1 100%);
    }

    .banner-slide:nth-child(3) {
      background: linear-gradient(135deg, #E65100 0%, #BF360C 100%);
    }

    .banner-content {
      flex: 1;
    }

    .banner-title {
      font-size: 20px;
      font-weight: 600;
      margin-bottom: 8px;
    }

    .banner-desc {
      font-size: 13px;
      opacity: 0.9;
    }

    .banner-image {
      font-size: 64px;
    }

    .banner-dots {
      position: absolute;
      bottom: 12px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 6px;
      z-index: 10;
    }

    .banner-dot {
      width: 6px;
      height: 6px;
      border-radius: 3px;
      background: rgba(255, 255, 255, 0.5);
      cursor: pointer;
      transition: all 0.3s;
    }

    .banner-dot.active {
      width: 18px;
      background: white;
    }

    /* 分类网格 */
    .category-section {
      background: white;
      margin: 0 16px 16px;
      border-radius: 12px;
      padding: 20px 16px;
    }

    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }

    .section-title {
      font-size: 18px;
      font-weight: 600;
      color: #212121;
    }

    .section-more {
      font-size: 13px;
      color: #9E9E9E;
      text-decoration: none;
    }

    .category-grid {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 12px;
    }

    .category-item {
      text-align: center;
      text-decoration: none;
      color: inherit;
    }

    .category-icon {
      width: 52px;
      height: 52px;
      margin: 0 auto 8px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 28px;
      background: #F5F5F5;
      transition: all 0.3s;
    }

    .category-item:hover .category-icon {
      transform: scale(1.05);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .category-icon.primary {
      background: linear-gradient(135deg, #E8F5E9 0%, #C8E6C9 100%);
    }

    .category-name {
      font-size: 12px;
      color: #424242;
    }

    .category-item.disabled .category-icon {
      opacity: 0.4;
    }

    .category-item.disabled .category-name {
      color: #BDBDBD;
    }

    /* 快捷入口 */
    .quick-entry {
      display: flex;
      gap: 12px;
      margin: 0 16px 16px;
    }

    .quick-item {
      flex: 1;
      background: white;
      border-radius: 12px;
      padding: 16px;
      display: flex;
      align-items: center;
      gap: 12px;
      text-decoration: none;
      color: inherit;
      transition: all 0.3s;
    }

    .quick-item:hover {
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    }

    .quick-icon {
      width: 44px;
      height: 44px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
    }

    .quick-icon.green {
      background: #E8F5E9;
    }

    .quick-icon.orange {
      background: #FFF3E0;
    }

    .quick-info h4 {
      font-size: 15px;
      font-weight: 600;
      color: #212121;
      margin-bottom: 4px;
    }

    .quick-info p {
      font-size: 12px;
      color: #9E9E9E;
    }

    /* 推荐列表 */
    .recommend-section {
      background: white;
      margin: 0 16px 16px;
      border-radius: 12px;
      padding: 20px 16px;
    }

    .tab-header {
      display: flex;
      gap: 24px;
      margin-bottom: 16px;
      border-bottom: 1px solid #F5F5F5;
    }

    .tab-item {
      padding-bottom: 12px;
      font-size: 15px;
      color: #757575;
      cursor: pointer;
      border-bottom: 2px solid transparent;
      transition: all 0.3s;
    }

    .tab-item.active {
      color: #2E7D32;
      font-weight: 600;
      border-bottom-color: #2E7D32;
    }

    /* 信息卡片 */
    .listing-list {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .listing-card {
      display: flex;
      gap: 12px;
      text-decoration: none;
      color: inherit;
      padding-bottom: 16px;
      border-bottom: 1px solid #F5F5F5;
    }

    .listing-card:last-child {
      border-bottom: none;
      padding-bottom: 0;
    }

    .listing-image {
      width: 110px;
      height: 85px;
      border-radius: 8px;
      background: #E8F5E9;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 36px;
      flex-shrink: 0;
    }

    .listing-info {
      flex: 1;
      display: flex;
      flex-direction: column;
    }

    .listing-title {
      font-size: 15px;
      font-weight: 500;
      color: #212121;
      line-height: 1.4;
      margin-bottom: 6px;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .listing-tags {
      display: flex;
      gap: 8px;
      margin-bottom: 8px;
    }

    .listing-tag {
      font-size: 11px;
      padding: 2px 6px;
      border-radius: 4px;
      background: #F5F5F5;
      color: #757575;
    }

    .listing-tag.green {
      background: #E8F5E9;
      color: #2E7D32;
    }

    .listing-bottom {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: auto;
    }

    .listing-price {
      font-size: 18px;
      font-weight: 600;
      color: #D32F2F;
    }

    .listing-price span {
      font-size: 12px;
      font-weight: 400;
    }

    .listing-meta {
      font-size: 12px;
      color: #9E9E9E;
    }

    /* 加载更多 */
    .load-more {
      text-align: center;
      padding: 16px;
      color: #9E9E9E;
      font-size: 13px;
    }

    /* 登录提示条 */
    .login-prompt {
      background: #FFF8E1;
      padding: 12px 16px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .login-prompt-text {
      font-size: 13px;
      color: #F57C00;
    }

    .login-prompt-btn {
      background: #FF8F00;
      color: white;
      border: none;
      padding: 6px 16px;
      border-radius: 16px;
      font-size: 13px;
      cursor: pointer;
    }

    /* 统计数据 */
    .stats-bar {
      display: flex;
      background: white;
      margin: 0 16px 16px;
      border-radius: 12px;
      padding: 16px;
      gap: 16px;
    }

    .stat-item {
      flex: 1;
      text-align: center;
      border-right: 1px solid #F5F5F5;
    }

    .stat-item:last-child {
      border-right: none;
    }

    .stat-number {
      font-size: 20px;
      font-weight: 600;
      color: #2E7D32;
    }

    .stat-label {
      font-size: 12px;
      color: #9E9E9E;
      margin-top: 4px;
    }

    /* ==================== MDI 图标标准化 ==================== */
    .mdi {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      vertical-align: middle;
      line-height: 1;
    }

    .location {
      display: flex !important;
      align-items: center;
    }

    .location-icon {
      display: flex !important;
      align-items: center;
      justify-content: center;
      margin-right: 4px;
      /* Adjust spacing as needed */
    }

    .search-bar {
      display: flex !important;
      align-items: center;
    }

    .search-icon {
      display: flex !important;
      align-items: center;
      justify-content: center;
    }

    .category-icon {
      display: flex !important;
      align-items: center;
      justify-content: center;
    }

    .quick-icon {
      display: flex !important;
      align-items: center;
      justify-content: center;
    }

    .listing-image {
      display: flex !important;
      align-items: center;
      justify-content: center;
    }
  </style>
</head>

<body class="theme-green has-bottom-nav">
  <!-- 登录提示条（未登录时显示） -->
  <div class="login-prompt" id="loginPrompt" style="display: none;">
    <span class="login-prompt-text">登录后可发布信息、联系卖家</span>
    <button class="login-prompt-btn" onclick="goLogin()">去登录</button>
  </div>

  <!-- 顶部Header -->
  <header class="header">
    <div class="header-top">
      <div class="location">
        <span class="location-icon mdi mdi-map-marker"></span>
        <span id="currentLocation">全国</span>
      </div>
      <div class="search-bar" onclick="goSearch()">
        <span class="search-icon mdi mdi-magnify"></span>
        <input type="text" placeholder="搜索活牛、饲料、设备..." readonly>
      </div>
      <div class="header-actions">
        <a href="#" class="header-btn mdi mdi-bell-outline" onclick="showMessage()"></a>
      </div>
    </div>
  </header>

  <!-- Banner轮播 -->
  <div class="banner" id="banner">
    <div class="banner-container" id="bannerContainer">
      <!-- 广告1: 平台介绍 -->
      <a href="../enterprise/center.html" class="banner-slide" onclick="trackBannerClick(0, '平台介绍')">
        <div class="banner-content">
          <div class="banner-title">牛产业数智化交易平台</div>
          <div class="banner-desc">连接养殖-贸易-屠宰全链条</div>
        </div>
        <div class="banner-image mdi mdi-cow"></div>
      </a>
      <!-- 广告2: AI智能助手 -->
      <a href="../ai-rag/chat.html" class="banner-slide" onclick="trackBannerClick(1, 'AI助手')">
        <div class="banner-content">
          <div class="banner-title">AI智能助手上线</div>
          <div class="banner-desc">专业牛产业知识问答</div>
        </div>
        <div class="banner-image mdi mdi-robot"></div>
      </a>
      <!-- 广告3: 溯源服务 -->
      <a href="../trace/scan.html" class="banner-slide" onclick="trackBannerClick(2, '溯源服务')">
        <div class="banner-content">
          <div class="banner-title">扫码溯源 安心消费</div>
          <div class="banner-desc">全程可追溯 品质有保障</div>
        </div>
        <div class="banner-image mdi mdi-qrcode-scan"></div>
      </a>
    </div>
    <div class="banner-dots">
      <div class="banner-dot active" onclick="goToSlide(0)"></div>
      <div class="banner-dot" onclick="goToSlide(1)"></div>
      <div class="banner-dot" onclick="goToSlide(2)"></div>
    </div>
  </div>

  <!-- 统计数据 -->
  <div class="stats-bar">
    <div class="stat-item">
      <div class="stat-number">1,256</div>
      <div class="stat-label">入驻企业</div>
    </div>
    <div class="stat-item">
      <div class="stat-number">3,456</div>
      <div class="stat-label">在售信息</div>
    </div>
    <div class="stat-item">
      <div class="stat-number">892</div>
      <div class="stat-label">今日新增</div>
    </div>
  </div>

  <!-- 分类网格 -->
  <div class="category-section">
    <div class="section-header">
      <h2 class="section-title">业务分类</h2>
    </div>
    <div class="category-grid" id="categoryGrid">
      <!-- 动态生成 -->
    </div>
  </div>

  <!-- 快捷入口 -->
  <div class="quick-entry">
    <a href="../cattle/publish.html" class="quick-item">
      <div class="quick-icon green mdi mdi-pencil-plus-outline"></div>
      <div class="quick-info">
        <h4>我要发布</h4>
        <p>发布活牛/饲料信息</p>
      </div>
    </a>
    <a href="../trace/scan.html" class="quick-item">
      <div class="quick-icon orange mdi mdi-qrcode-scan"></div>
      <div class="quick-info">
        <h4>扫码溯源</h4>
        <p>查看牛只溯源信息</p>
      </div>
    </a>
  </div>

  <!-- 推荐列表 -->
  <div class="recommend-section">
    <div class="tab-header">
      <div class="tab-item active" data-tab="hot">热门推荐</div>
      <div class="tab-item" data-tab="latest">最新发布</div>
      <div class="tab-item" data-tab="nearby">附近</div>
    </div>
    <div class="listing-list" id="listingList">
      <!-- 动态生成 -->
    </div>
    <div class="load-more" id="loadMore">上拉加载更多</div>
  </div>

  <!-- 底部导航 -->
  <nav class="bottom-nav">
    <a href="javascript:void(0)" class="nav-item active">
      <span class="nav-icon mdi mdi-home"></span>
      <span>首页</span>
    </a>
    <a href="../cattle/publish.html" class="nav-item">
      <span class="nav-icon mdi mdi-plus-circle"></span>
      <span>发布</span>
    </a>
    <a href="../ai-rag/chat.html" class="nav-item">
      <span class="nav-icon mdi mdi-robot"></span>
      <span>AI</span>
    </a>
    <a href="../enterprise/messages.html" class="nav-item">
      <span class="nav-icon mdi mdi-bell"></span>
      <span>消息</span>
    </a>
    <a href="../enterprise/center.html" class="nav-item">
      <span class="nav-icon mdi mdi-account"></span>
      <span>我的</span>
    </a>
  </nav>

  <!-- JS -->
  <script src="../../assets/js/utils.js"></script>
  <script src="../../assets/js/stateManager.js"></script>
  <script src="../../assets/js/dictionaries.js"></script>
  <script src="../../assets/js/mockData.js"></script>

  <script>
    // ==================== Banner轮播变量 ====================
    let currentSlide = 0;
    let slideCount = 3;
    let autoSlideTimer = null;
    let touchStartX = 0;
    let touchEndX = 0;

    // ==================== 初始化 ====================
    document.addEventListener('DOMContentLoaded', function () {
      checkLoginStatus();
      renderCategories();
      renderListings('hot');
      initTabs();
      initBanner();
    });

    // ==================== Banner轮播功能 ====================
    function initBanner() {
      const banner = document.getElementById('banner');
      const container = document.getElementById('bannerContainer');

      // 启动自动轮播
      startAutoSlide();

      // 触摸事件支持
      banner.addEventListener('touchstart', function(e) {
        touchStartX = e.changedTouches[0].screenX;
        stopAutoSlide();
      }, { passive: true });

      banner.addEventListener('touchend', function(e) {
        touchEndX = e.changedTouches[0].screenX;
        handleSwipe();
        startAutoSlide();
      }, { passive: true });

      // 鼠标悬停暂停（PC端）
      banner.addEventListener('mouseenter', stopAutoSlide);
      banner.addEventListener('mouseleave', startAutoSlide);
    }

    function goToSlide(index) {
      currentSlide = index;
      updateBanner();
    }

    function nextSlide() {
      currentSlide = (currentSlide + 1) % slideCount;
      updateBanner();
    }

    function prevSlide() {
      currentSlide = (currentSlide - 1 + slideCount) % slideCount;
      updateBanner();
    }

    function updateBanner() {
      const container = document.getElementById('bannerContainer');
      const dots = document.querySelectorAll('.banner-dot');

      // 移动轮播
      container.style.transform = `translateX(-${currentSlide * 33.333}%)`;

      // 更新指示点
      dots.forEach((dot, i) => {
        dot.classList.toggle('active', i === currentSlide);
      });
    }

    function startAutoSlide() {
      stopAutoSlide();
      autoSlideTimer = setInterval(nextSlide, 4000); // 4秒切换
    }

    function stopAutoSlide() {
      if (autoSlideTimer) {
        clearInterval(autoSlideTimer);
        autoSlideTimer = null;
      }
    }

    function handleSwipe() {
      const swipeThreshold = 50;
      const diff = touchStartX - touchEndX;

      if (Math.abs(diff) > swipeThreshold) {
        if (diff > 0) {
          nextSlide(); // 左滑 -> 下一张
        } else {
          prevSlide(); // 右滑 -> 上一张
        }
      }
    }

    function trackBannerClick(index, name) {
      console.log(`[Banner点击] 第${index + 1}张: ${name}`);
      // 可以在这里添加埋点统计
      // 例如: analytics.track('banner_click', { index, name });
    }

    // ==================== 登录状态检查 ====================
    function checkLoginStatus() {
      const isLoggedIn = globalState.get('auth.isLoggedIn');
      const loginPrompt = document.getElementById('loginPrompt');

      if (!isLoggedIn) {
        loginPrompt.style.display = 'flex';
      }

      // 设置位置（模拟）
      const user = globalState.get('user');
      if (user && user.location) {
        document.getElementById('currentLocation').textContent = user.location;
      }
    }

    // ==================== 渲染分类 ====================
    function renderCategories() {
      const grid = document.getElementById('categoryGrid');
      const categories = [
        { code: 'CATTLE', name: '活牛交易', icon: 'mdi mdi-cow', enabled: true, link: '../cattle/list.html' },
        { code: 'BREEDING', name: '育种种牛', icon: 'mdi mdi-dna', enabled: true, link: '../breeding/list.html' },
        { code: 'FEED', name: '饲料', icon: 'mdi mdi-barley', enabled: true, link: '../feed/list.html' },
        { code: 'BEEF', name: '牛肉', icon: 'mdi mdi-food-steak', enabled: true, link: '../beef/list.html' },
        { code: 'EQUIPMENT', name: '设备', icon: 'mdi mdi-tractor', enabled: true, link: '../equipment/list.html' },
        { code: 'FARM', name: '养殖场', icon: 'mdi mdi-barn', enabled: true, link: '../farm/list.html' },
        { code: 'SLAUGHTER', name: '屠宰场', icon: 'mdi mdi-factory', enabled: true, link: '../slaughter/list.html' },
        { code: 'LAND', name: '土地', icon: 'mdi mdi-earth', enabled: false },
        { code: 'FINANCE', name: '金融', icon: 'mdi mdi-cash-multiple', enabled: false },
        { code: 'DESIGN', name: '工程', icon: 'mdi mdi-compass-outline', enabled: false }
      ];

      grid.innerHTML = categories.map(cat => `
        <a class="category-item ${cat.enabled ? '' : 'disabled'}"
           href="${cat.enabled ? cat.link : '#'}"
           ${cat.enabled ? '' : 'onclick="showComingSoon(event)"'}>
          <div class="category-icon ${cat.enabled ? 'primary' : ''}">
            <i class="${cat.icon}" style="font-size: 28px;"></i>
          </div>
          <div class="category-name">${cat.name}</div>
        </a>
      `).join('');
    }

    // ==================== 渲染列表 ====================
    function renderListings(type) {
      const list = document.getElementById('listingList');
      let data = [];

      switch (type) {
        case 'hot':
          data = MockData.getHotListings(6);
          break;
        case 'latest':
          data = MockData.getLatestListings(6);
          break;
        case 'nearby':
          data = MockData.filterCattleListings({ province: '内蒙古' });
          break;
      }

      if (data.length === 0) {
        list.innerHTML = '<div class="load-more">暂无数据</div>';
        return;
      }

      list.innerHTML = data.map(item => `
        <a href="../cattle/detail.html?id=${item.id}" class="listing-card">
          <div class="listing-image">
            <i class="mdi mdi-cow" style="font-size:36px; color:#bdbdbd;"></i>
          </div>
          <div class="listing-info">
            <div class="listing-title">${item.title}</div>
            <div class="listing-tags">
              <span class="listing-tag green">${getBreedName(item.breed)}</span>
              <span class="listing-tag">${getCattleTypeName(item.cattleType)}</span>
              <span class="listing-tag">${item.quantity}头</span>
            </div>
            <div class="listing-bottom">
              <div class="listing-price">
                ¥${formatPrice(item.price)}
                <span>${item.priceType === 'UNIT' ? '/头' : '/斤'}</span>
              </div>
              <div class="listing-meta">${item.location.province} ${item.location.city}</div>
            </div>
          </div>
        </a>
      `).join('');
    }

    // ==================== Tab切换 ====================
    function initTabs() {
      const tabs = document.querySelectorAll('.tab-item');
      tabs.forEach(tab => {
        tab.addEventListener('click', function () {
          tabs.forEach(t => t.classList.remove('active'));
          this.classList.add('active');
          renderListings(this.dataset.tab);
        });
      });
    }

    // ==================== 工具函数 ====================
    function getBreedName(code) {
      const breed = Dictionaries.CATTLE_BREEDS.find(b => b.code === code);
      return breed ? breed.name : code;
    }

    function getCattleTypeName(code) {
      const type = Dictionaries.CATTLE_TYPES.find(t => t.code === code);
      return type ? type.name : code;
    }

    function formatPrice(price) {
      if (price >= 10000) {
        return (price / 10000).toFixed(1) + '万';
      }
      return price.toLocaleString();
    }

    // ==================== 页面跳转 ====================
    function goLogin() {
      window.location.href = '../auth/login.html';
    }

    function goSearch() {
      // TODO: 跳转搜索页
      alert('搜索功能开发中...');
    }

    function showMessage() {
      alert('消息功能开发中...');
    }

    function showComingSoon(e) {
      e.preventDefault();
      alert('该分类即将开放，敬请期待！');
    }
  </script>
</body>

</html>