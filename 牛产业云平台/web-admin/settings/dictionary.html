<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>字典管理 - 中国牛产业数智云平台</title>
  <link rel="stylesheet" href="../../assets/css/variables.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@mdi/font@7.2.96/css/materialdesignicons.min.css">
  <link rel="stylesheet" href="../../assets/css/desktop.css">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: var(--font-family);
      background: var(--bg-gray);
    }

    /* 字典管理布局 */
    .dict-layout {
      display: grid;
      grid-template-columns: 280px 1fr;
      gap: 24px;
      height: calc(100vh - 140px);
    }

    /* 左侧字典类型列表 */
    .dict-types {
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    .dict-types-header {
      padding: 20px;
      border-bottom: 1px solid #f0f0f0;
    }

    .dict-types-header h3 {
      font-size: 16px;
      font-weight: 600;
      color: #1a1a1a;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .dict-types-search {
      margin-top: 12px;
    }

    .dict-types-search input {
      width: 100%;
      padding: 10px 12px;
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      font-size: 14px;
    }

    .dict-types-list {
      flex: 1;
      overflow-y: auto;
      padding: 12px;
    }

    .dict-type-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px 16px;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s;
      margin-bottom: 4px;
    }

    .dict-type-item:hover {
      background: #f5f5f5;
    }

    .dict-type-item.active {
      background: #e8f5e9;
      color: var(--primary-color);
    }

    .dict-type-info {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .dict-type-icon {
      width: 36px;
      height: 36px;
      background: #f5f5f5;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
    }

    .dict-type-item.active .dict-type-icon {
      background: #c8e6c9;
    }

    .dict-type-name {
      font-size: 14px;
      font-weight: 500;
    }

    .dict-type-count {
      font-size: 12px;
      color: #999;
      background: #f0f0f0;
      padding: 2px 8px;
      border-radius: 10px;
    }

    .dict-type-item.active .dict-type-count {
      background: #c8e6c9;
      color: var(--primary-color);
    }

    /* 右侧字典项列表 */
    .dict-items {
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .dict-items-header {
      padding: 20px;
      border-bottom: 1px solid #f0f0f0;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .dict-items-title h3 {
      font-size: 18px;
      font-weight: 600;
      color: #1a1a1a;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .dict-items-title p {
      font-size: 13px;
      color: #666;
      margin-top: 4px;
    }

    .dict-items-actions {
      display: flex;
      gap: 12px;
    }

    .action-btn {
      padding: 10px 20px;
      border-radius: 8px;
      font-size: 14px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 6px;
      transition: all 0.2s;
    }

    .action-btn.primary {
      background: var(--primary-color);
      color: #fff;
      border: none;
    }

    .action-btn.primary:hover {
      background: var(--primary-dark);
    }

    .action-btn.secondary {
      background: #fff;
      color: #666;
      border: 1px solid #e0e0e0;
    }

    .action-btn.secondary:hover {
      border-color: var(--primary-color);
      color: var(--primary-color);
    }

    /* 字典项表格 */
    .dict-items-content {
      flex: 1;
      overflow-y: auto;
      padding: 20px;
    }

    .dict-table {
      width: 100%;
      border-collapse: collapse;
    }

    .dict-table th,
    .dict-table td {
      padding: 14px 16px;
      text-align: left;
      border-bottom: 1px solid #f0f0f0;
    }

    .dict-table th {
      background: #fafafa;
      font-weight: 600;
      color: #666;
      font-size: 13px;
    }

    .dict-table tr:hover {
      background: #fafafa;
    }

    .dict-value {
      font-weight: 500;
      color: #333;
    }

    .dict-code {
      font-family: 'Monaco', 'Consolas', monospace;
      font-size: 12px;
      background: #f5f5f5;
      padding: 4px 8px;
      border-radius: 4px;
      color: #666;
    }

    .dict-status {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 12px;
    }

    .dict-status.enabled {
      background: #e8f5e9;
      color: var(--primary-color);
    }

    .dict-status.disabled {
      background: #f5f5f5;
      color: #999;
    }

    .dict-actions {
      display: flex;
      gap: 8px;
    }

    .dict-action-btn {
      width: 32px;
      height: 32px;
      border: none;
      background: #f5f5f5;
      border-radius: 6px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      transition: all 0.2s;
    }

    .dict-action-btn:hover {
      background: #e8f5e9;
    }

    .dict-action-btn.delete:hover {
      background: #ffebee;
    }

    /* 排序拖拽 */
    .drag-handle {
      cursor: grab;
      color: #ccc;
    }

    .drag-handle:hover {
      color: #999;
    }

    /* 空状态 */
    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: #999;
    }

    .empty-state-icon {
      font-size: 48px;
      margin-bottom: 16px;
    }

    .empty-state h4 {
      font-size: 16px;
      color: #666;
      margin-bottom: 8px;
    }

    .empty-state p {
      font-size: 14px;
    }

    /* 弹窗 */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }

    .modal-overlay.show {
      display: flex;
    }

    .modal {
      background: #fff;
      border-radius: 16px;
      width: 480px;
      max-width: 90%;
      overflow: hidden;
    }

    .modal-header {
      padding: 20px 24px;
      border-bottom: 1px solid #f0f0f0;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .modal-header h3 {
      font-size: 18px;
      font-weight: 600;
    }

    .modal-close {
      width: 32px;
      height: 32px;
      border: none;
      background: #f5f5f5;
      border-radius: 50%;
      cursor: pointer;
      font-size: 18px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .modal-body {
      padding: 24px;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-group label {
      display: block;
      font-size: 14px;
      font-weight: 500;
      color: #333;
      margin-bottom: 8px;
    }

    .form-group label span {
      color: #ff4d4f;
    }

    .form-group input,
    .form-group textarea,
    .form-group select {
      width: 100%;
      padding: 12px;
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      font-size: 14px;
    }

    .form-group input:focus,
    .form-group textarea:focus,
    .form-group select:focus {
      border-color: var(--primary-color);
      outline: none;
    }

    .form-group textarea {
      min-height: 80px;
      resize: vertical;
    }

    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
    }

    .form-switch {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .switch {
      width: 44px;
      height: 24px;
      background: #e0e0e0;
      border-radius: 12px;
      position: relative;
      cursor: pointer;
      transition: all 0.3s;
    }

    .switch.active {
      background: var(--primary-color);
    }

    .switch::after {
      content: '';
      position: absolute;
      width: 20px;
      height: 20px;
      background: #fff;
      border-radius: 50%;
      top: 2px;
      left: 2px;
      transition: all 0.3s;
    }

    .switch.active::after {
      left: 22px;
    }

    .modal-footer {
      padding: 16px 24px;
      border-top: 1px solid #f0f0f0;
      display: flex;
      justify-content: flex-end;
      gap: 12px;
    }

    .modal-btn {
      padding: 10px 24px;
      border-radius: 8px;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .modal-btn.cancel {
      background: #f5f5f5;
      border: none;
      color: #666;
    }

    .modal-btn.cancel:hover {
      background: #e0e0e0;
    }

    .modal-btn.confirm {
      background: var(--primary-color);
      border: none;
      color: #fff;
    }

    .modal-btn.confirm:hover {
      background: var(--primary-dark);
    }

    /* 页面标题 */
    .page-header {
      margin-bottom: 24px;
    }

    .page-header h1 {
      font-size: 24px;
      font-weight: 600;
      color: #1a1a1a;
    }

    .page-header p {
      color: #666;
      margin-top: 4px;
    }
  </style>
</head>

<body>
  <div class="desktop-layout">
    <!-- 侧边栏 -->
    <aside class="desktop-sidebar">
      <div class="sidebar-header">
        <div class="sidebar-logo">
          <span><i class="mdi mdi-cow"></i></span>
          <span>牛产业云平台</span>
        </div>
      </div>
      <nav class="sidebar-nav">
        <!-- 数据概览 -->
        <a href="../dashboard/overview.html" class="nav-item">
          <span class="icon"><i class="mdi mdi-chart-bar"></i></span>
          <span>数据概览</span>
        </a>

        <!-- 企业管理 -->
        <div class="nav-group">
          <div class="nav-group-title">
            <div class="title-wrap">
              <span class="icon"><i class="mdi mdi-office-building"></i></span>
              <span>企业管理</span>
            </div>
            <span class="arrow"><i class="mdi mdi-menu-down"></i></span>
          </div>
          <div class="nav-sub-menu">
            <a href="../enterprise/list.html" class="nav-sub-item">企业列表</a>
            <a href="../enterprise/review.html" class="nav-sub-item">企业审核</a>
          </div>
        </div>

        <!-- 内容管理 -->
        <div class="nav-group">
          <div class="nav-group-title">
            <div class="title-wrap">
              <span class="icon"><i class="mdi mdi-file-document-edit"></i></span>
              <span>内容管理</span>
            </div>
            <span class="arrow"><i class="mdi mdi-menu-down"></i></span>
          </div>
          <div class="nav-sub-menu">
            <a href="../content/cattle-manage.html" class="nav-sub-item">活牛信息</a>
            <a href="../content/review-queue.html" class="nav-sub-item">审核队列</a>
          </div>
        </div>

        <!-- 系统设置 -->
        <div class="nav-group expanded">
          <div class="nav-group-title">
            <div class="title-wrap">
              <span class="icon"><i class="mdi mdi-cog"></i></span>
              <span>系统设置</span>
            </div>
            <span class="arrow"><i class="mdi mdi-menu-down"></i></span>
          </div>
          <div class="nav-sub-menu">
            <a href="dictionary.html" class="nav-sub-item active">字典管理</a>
          </div>
        </div>

        <!-- 返回首页 -->
        <a href="../../index.html" class="nav-item"
          style="margin-top: 20px; border-top: 1px solid #eee; padding-top: 20px;">
          <span class="icon"><i class="mdi mdi-home"></i></span>
          <span>返回首页</span>
        </a>
      </nav>
    </aside>

    <!-- 主内容 -->
    <main class="desktop-main">
      <!-- 顶部栏 -->
      <header class="desktop-header">
        <div class="desktop-header-left">
          <div class="breadcrumb">
            <span>系统设置</span>
            <span>/</span>
            <span>字典管理</span>
          </div>
        </div>
        <div class="desktop-header-right">
          <div class="desktop-header-user">
            <div class="desktop-header-avatar">管</div>
            <span class="desktop-header-username">管理员</span>
          </div>
        </div>
      </header>

      <!-- 内容区 -->
      <div class="desktop-content">
        <!-- 页面标题 -->
        <div class="page-header">
          <h1>字典管理</h1>
          <p>管理系统中的各类数据字典，如品种、地区、认证类型等</p>
        </div>

        <!-- 字典管理布局 -->
        <div class="dict-layout">
          <!-- 左侧：字典类型列表 -->
          <div class="dict-types">
            <div class="dict-types-header">
              <h3><i class="mdi mdi-bookshelf"></i> 字典分类</h3>
              <div class="dict-types-search">
                <input type="text" placeholder="搜索字典类型..." oninput="filterTypes(this.value)">
              </div>
            </div>
            <div class="dict-types-list" id="dictTypesList">
              <!-- JS 渲染 -->
            </div>
          </div>

          <!-- 右侧：字典项列表 -->
          <div class="dict-items">
            <div class="dict-items-header">
              <div class="dict-items-title">
                <h3 id="currentDictTitle"><i class="mdi mdi-cow"></i> 活牛品种</h3>
                <p id="currentDictDesc">管理平台支持的活牛品种分类</p>
              </div>
              <div class="dict-items-actions">
                <button class="action-btn secondary" onclick="refreshItems()">
                  <span><i class="mdi mdi-refresh"></i></span>
                  <span>刷新</span>
                </button>
                <button class="action-btn primary" onclick="showAddModal()">
                  <span><i class="mdi mdi-plus"></i></span>
                  <span>新增字典项</span>
                </button>
              </div>
            </div>
            <div class="dict-items-content" id="dictItemsContent">
              <!-- JS 渲染 -->
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- 新增/编辑弹窗 -->
  <div class="modal-overlay" id="modalOverlay" onclick="closeModal()">
    <div class="modal" onclick="event.stopPropagation()">
      <div class="modal-header">
        <h3 id="modalTitle">新增字典项</h3>
        <button class="modal-close" onclick="closeModal()"><i class="mdi mdi-close"></i></button>
      </div>
      <div class="modal-body">
        <div class="form-row">
          <div class="form-group">
            <label>字典编码 <span>*</span></label>
            <input type="text" id="itemCode" placeholder="如: SIMMENTAL">
          </div>
          <div class="form-group">
            <label>排序值</label>
            <input type="number" id="itemSort" value="0" min="0">
          </div>
        </div>
        <div class="form-group">
          <label>字典名称 <span>*</span></label>
          <input type="text" id="itemName" placeholder="如: 西门塔尔牛">
        </div>
        <div class="form-group">
          <label>字典值</label>
          <input type="text" id="itemValue" placeholder="如: simmental">
        </div>
        <div class="form-group">
          <label>备注说明</label>
          <textarea id="itemRemark" placeholder="可选，补充说明..."></textarea>
        </div>
        <div class="form-group">
          <div class="form-switch">
            <div class="switch active" id="itemStatus" onclick="toggleSwitch(this)"></div>
            <span>启用状态</span>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="modal-btn cancel" onclick="closeModal()">取消</button>
        <button class="modal-btn confirm" onclick="saveItem()">保存</button>
      </div>
    </div>
  </div>

  <!-- JS -->
  <script>
    // 字典类型数据
    // 字典类型数据
    const dictTypes = [
      { id: 'cattle_breed', name: '活牛品种', icon: '<i class="mdi mdi-cow"></i>', count: 12, desc: '管理平台支持的活牛品种分类' },
      { id: 'cattle_purpose', name: '用途分类', icon: '<i class="mdi mdi-target"></i>', count: 5, desc: '活牛的用途分类，如肉牛、奶牛、种牛等' },
      { id: 'cattle_age', name: '年龄段', icon: '<i class="mdi mdi-calendar"></i>', count: 6, desc: '活牛年龄段划分' },
      { id: 'region', name: '地区', icon: '<i class="mdi mdi-map-marker"></i>', count: 34, desc: '省份和地区信息' },
      { id: 'enterprise_type', name: '企业类型', icon: '<i class="mdi mdi-office-building"></i>', count: 8, desc: '入驻企业的类型分类' },
      { id: 'cert_type', name: '认证类型', icon: '<i class="mdi mdi-certificate"></i>', count: 6, desc: '企业和产品认证类型' },
      { id: 'trade_method', name: '交易方式', icon: '<i class="mdi mdi-cash"></i>', count: 4, desc: '活牛交易的支付和结算方式' },
      { id: 'logistics_type', name: '物流方式', icon: '<i class="mdi mdi-truck"></i>', count: 3, desc: '活牛运输物流方式' },
      { id: 'violation_type', name: '违规类型', icon: '<i class="mdi mdi-alert"></i>', count: 10, desc: '内容审核的违规类型分类' },
    ];

    // 字典项数据（模拟）
    const dictItemsData = {
      cattle_breed: [
        { code: 'SIMMENTAL', name: '西门塔尔牛', value: 'simmental', sort: 1, status: true, remark: '原产瑞士，肉乳兼用' },
        { code: 'LIMOUSIN', name: '利木赞牛', value: 'limousin', sort: 2, status: true, remark: '原产法国，肉用' },
        { code: 'CHAROLAIS', name: '夏洛莱牛', value: 'charolais', sort: 3, status: true, remark: '原产法国，肉用' },
        { code: 'ANGUS', name: '安格斯牛', value: 'angus', sort: 4, status: true, remark: '原产英国，肉用' },
        { code: 'HEREFORD', name: '海福特牛', value: 'hereford', sort: 5, status: true, remark: '原产英国，肉用' },
        { code: 'LUXI', name: '鲁西黄牛', value: 'luxi', sort: 6, status: true, remark: '中国本土品种' },
        { code: 'QINCHUAN', name: '秦川牛', value: 'qinchuan', sort: 7, status: true, remark: '中国本土品种' },
        { code: 'NANYANG', name: '南阳牛', value: 'nanyang', sort: 8, status: true, remark: '中国本土品种' },
        { code: 'MONGOLIAN', name: '蒙古牛', value: 'mongolian', sort: 9, status: true, remark: '中国本土品种' },
        { code: 'YANBIAN', name: '延边牛', value: 'yanbian', sort: 10, status: true, remark: '中国本土品种' },
        { code: 'HYBRID', name: '杂交牛', value: 'hybrid', sort: 11, status: true, remark: '各种杂交品种' },
        { code: 'OTHER', name: '其他品种', value: 'other', sort: 99, status: true, remark: '其他未分类品种' },
      ],
      cattle_purpose: [
        { code: 'BEEF', name: '肉牛', value: 'beef', sort: 1, status: true, remark: '用于肉类生产' },
        { code: 'DAIRY', name: '奶牛', value: 'dairy', sort: 2, status: true, remark: '用于乳制品生产' },
        { code: 'BREEDING', name: '种牛', value: 'breeding', sort: 3, status: true, remark: '用于繁殖育种' },
        { code: 'DUAL', name: '肉乳兼用', value: 'dual', sort: 4, status: true, remark: '既产肉又产奶' },
        { code: 'DRAFT', name: '役用牛', value: 'draft', sort: 5, status: false, remark: '用于劳作（已少见）' },
      ],
      cattle_age: [
        { code: 'CALF', name: '犊牛', value: 'calf', sort: 1, status: true, remark: '0-6个月' },
        { code: 'WEANED', name: '断奶牛', value: 'weaned', sort: 2, status: true, remark: '6-12个月' },
        { code: 'YEARLING', name: '育成牛', value: 'yearling', sort: 3, status: true, remark: '12-24个月' },
        { code: 'ADULT', name: '成年牛', value: 'adult', sort: 4, status: true, remark: '24-60个月' },
        { code: 'MATURE', name: '成熟牛', value: 'mature', sort: 5, status: true, remark: '60个月以上' },
        { code: 'AGED', name: '老龄牛', value: 'aged', sort: 6, status: true, remark: '96个月以上' },
      ],
    };

    let currentTypeId = 'cattle_breed';
    let editingItem = null;

    // 渲染字典类型列表
    function renderDictTypes(filter = '') {
      const list = document.getElementById('dictTypesList');
      const filtered = dictTypes.filter(t =>
        t.name.includes(filter) || t.id.includes(filter)
      );

      list.innerHTML = filtered.map(type => `
        <div class="dict-type-item ${type.id === currentTypeId ? 'active' : ''}"
             onclick="selectType('${type.id}')">
          <div class="dict-type-info">
            <div class="dict-type-icon">${type.icon}</div>
            <div class="dict-type-name">${type.name}</div>
          </div>
          <div class="dict-type-count">${type.count}</div>
        </div>
      `).join('');
    }

    // 选择字典类型
    function selectType(typeId) {
      currentTypeId = typeId;
      const type = dictTypes.find(t => t.id === typeId);

      document.getElementById('currentDictTitle').innerHTML = `${type.icon} ${type.name}`;
      document.getElementById('currentDictDesc').textContent = type.desc;

      renderDictTypes();
      renderDictItems();
    }

    // 渲染字典项列表
    function renderDictItems() {
      const content = document.getElementById('dictItemsContent');
      const items = dictItemsData[currentTypeId] || [];

      if (items.length === 0) {
        content.innerHTML = `
          <div class="empty-state">
            <div class="empty-state-icon"><i class="mdi mdi-inbox-outline"></i></div>
            <h4>暂无字典项</h4>
            <p>点击"新增字典项"添加数据</p>
          </div>
        `;
        return;
      }

      content.innerHTML = `
        <table class="dict-table">
          <thead>
            <tr>
              <th style="width: 50px;">排序</th>
              <th>编码</th>
              <th>名称</th>
              <th>值</th>
              <th>状态</th>
              <th>备注</th>
              <th style="width: 120px;">操作</th>
            </tr>
          </thead>
          <tbody>
            ${items.map((item, index) => `
              <tr>
                <td>
                  <span class="drag-handle"><i class="mdi mdi-drag"></i></span>
                </td>
                <td><span class="dict-code">${item.code}</span></td>
                <td><span class="dict-value">${item.name}</span></td>
                <td>${item.value}</td>
                <td>
                  <span class="dict-status ${item.status ? 'enabled' : 'disabled'}">
                    ${item.status ? '<i class="mdi mdi-check"></i> 启用' : '<i class="mdi mdi-circle-outline"></i> 禁用'}
                  </span>
                </td>
                <td>${item.remark || '-'}</td>
                <td>
                  <div class="dict-actions">
                    <button class="dict-action-btn" onclick="editItem(${index})" title="编辑">
                      <i class="mdi mdi-pencil"></i>
                    </button>
                    <button class="dict-action-btn delete" onclick="deleteItem(${index})" title="删除">
                      <i class="mdi mdi-delete"></i>
                    </button>
                  </div>
                </td>
              </tr>
            `).join('')}
          </tbody>
        </table>
      `;
    }

    // 过滤字典类型
    function filterTypes(keyword) {
      renderDictTypes(keyword);
    }

    // 刷新字典项
    function refreshItems() {
      renderDictItems();
      alert('已刷新');
    }

    // 显示新增弹窗
    function showAddModal() {
      editingItem = null;
      document.getElementById('modalTitle').textContent = '新增字典项';
      document.getElementById('itemCode').value = '';
      document.getElementById('itemName').value = '';
      document.getElementById('itemValue').value = '';
      document.getElementById('itemSort').value = '0';
      document.getElementById('itemRemark').value = '';
      document.getElementById('itemStatus').classList.add('active');
      document.getElementById('modalOverlay').classList.add('show');
    }

    // 编辑字典项
    function editItem(index) {
      const items = dictItemsData[currentTypeId] || [];
      const item = items[index];
      editingItem = index;

      document.getElementById('modalTitle').textContent = '编辑字典项';
      document.getElementById('itemCode').value = item.code;
      document.getElementById('itemName').value = item.name;
      document.getElementById('itemValue').value = item.value;
      document.getElementById('itemSort').value = item.sort;
      document.getElementById('itemRemark').value = item.remark || '';

      const statusSwitch = document.getElementById('itemStatus');
      if (item.status) {
        statusSwitch.classList.add('active');
      } else {
        statusSwitch.classList.remove('active');
      }

      document.getElementById('modalOverlay').classList.add('show');
    }

    // 删除字典项
    function deleteItem(index) {
      if (confirm('确定要删除该字典项吗？')) {
        const items = dictItemsData[currentTypeId] || [];
        items.splice(index, 1);
        renderDictItems();

        // 更新类型计数
        const type = dictTypes.find(t => t.id === currentTypeId);
        if (type) {
          type.count = items.length;
          renderDictTypes();
        }
      }
    }

    // 关闭弹窗
    function closeModal() {
      document.getElementById('modalOverlay').classList.remove('show');
    }

    // 切换开关
    function toggleSwitch(el) {
      el.classList.toggle('active');
    }

    // 保存字典项
    function saveItem() {
      const code = document.getElementById('itemCode').value.trim();
      const name = document.getElementById('itemName').value.trim();
      const value = document.getElementById('itemValue').value.trim();
      const sort = parseInt(document.getElementById('itemSort').value) || 0;
      const remark = document.getElementById('itemRemark').value.trim();
      const status = document.getElementById('itemStatus').classList.contains('active');

      if (!code || !name) {
        alert('请填写编码和名称');
        return;
      }

      const newItem = { code, name, value: value || code.toLowerCase(), sort, status, remark };

      if (!dictItemsData[currentTypeId]) {
        dictItemsData[currentTypeId] = [];
      }

      if (editingItem !== null) {
        dictItemsData[currentTypeId][editingItem] = newItem;
      } else {
        dictItemsData[currentTypeId].push(newItem);
      }

      // 按排序值排序
      dictItemsData[currentTypeId].sort((a, b) => a.sort - b.sort);

      // 更新类型计数
      const type = dictTypes.find(t => t.id === currentTypeId);
      if (type) {
        type.count = dictItemsData[currentTypeId].length;
        renderDictTypes();
      }

      renderDictItems();
      closeModal();
    }

    // 侧边栏折叠功能
    document.querySelectorAll('.nav-group-title').forEach(title => {
      title.addEventListener('click', () => {
        const group = title.parentElement;
        group.classList.toggle('expanded');
      });
    });

    // 初始化
    renderDictTypes();
    renderDictItems();

    console.log('字典管理页面加载完成');
  </script>
</body>

</html>