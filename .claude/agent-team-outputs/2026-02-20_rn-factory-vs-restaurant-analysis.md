# RN App 工厂版 vs 餐饮版对比验证 + 行业标杆分析

**日期**: 2026-02-20
**范围约束**: 餐饮部分只需进销存和数据分析（不含POS/点餐/桌台/会员）

---

## 执行摘要

当前RN App餐饮版基于工厂版条件分支适配，框架层（isRestaurant判断、空值防护）基本可用，但业务层存在三个阻塞项：语义映射错误、进销存后半程缺失、种子数据为零。按修正工期，P0需3天、P1需3周方可达到可演示状态。

---

## 置信度评估

| 结论 | 置信度 | 共识/分歧 |
|------|--------|-----------|
| isRestaurant()空值防护完整 | **高(95%)** | 全员共识 |
| todayOutputKg语义映射错误，必须修复 | **高(98%)** | 全员共识，P0级别 |
| 进销存后半程缺失（领料/损耗/盘点） | **高(95%)** | 全员共识，核心功能差距 |
| AI意图零餐饮专属 | **高(95%)** | 全员共识，但优先级有分歧（P2可接受） |
| 种子数据阻塞演示 | **高(95%)** | 全员共识 |
| 实体语义污染严重度 | **中(65%)** | 分析师"高风险" vs 批评者"中风险"。采纳批评者：nullable字段不使用不产生运行时错误，但长期维护成本上升。定性为"中风险、需监控" |
| P0工期2天可完成 | **中低(50%)** | 修正为**3天**（含种子数据+E2E走查） |
| P1工期2周可完成 | **低(40%)** | 修正为**3周**（4个CRUD模块含BOM） |
| 策略模式适用性 | **中(60%)** | 对仅2种类型可能过度设计 |

---

## 对比矩阵

| 功能模块 | 工厂版现状 | 餐饮版现状 | 行业标杆(进销存+BI) | 差距 |
|----------|-----------|-----------|---------------------|------|
| **采购入库** | 完整 | 可用（复用） | 供应商+采购+入库验收 | 小 |
| **销售出库** | 完整 | 基本可用 | 销售单+出库+客户 | 小 |
| **库存查询** | 完整 | 部分可用（预警缺阈值） | 实时+安全库存+保质期预警 | 中 |
| **领料/消耗** | 有 | **缺失** | BOM配方领料+日消耗 | **大** |
| **损耗管理** | 有 | **缺失** | 损耗登记+损耗率+预警 | **大** |
| **盘点** | 有 | **缺失** | 周期盘点+差异+盈亏 | **大** |
| **BOM/配方** | 有 | **缺失** | 菜品配方+成本核算 | **大** |
| **数据分析/BI** | SmartBI完整 | 可复用（框架有，模板缺） | 进销存报表+毛利+畅滞销 | 小 |
| **AI对话** | 140组意图 | **零覆盖** | 基础查询对话 | 大(P2) |
| **首页仪表盘** | 生产指标 | 有但**语义错误** | 营收/库存/畅销品 | 中 |
| **路由安全** | 完整 | **12+条泄露** | 按角色隔离 | 中 |
| **种子数据** | F001完整 | **5菜品/0批次** | 50+SKU完整数据 | **大(阻塞)** |

---

## 代码问题清单

### P0 — 阻塞项修复（3天）

| 任务 | 说明 | 文件 |
|------|------|------|
| 修复首页语义映射 | todayOutputKg→todayOrderCount/todayRevenue | FAHomeScreen.tsx:413-443 |
| 构造种子数据 | 50+菜品SKU、初始批次、采购/销售各10+ | seed_restaurant_R001.sql |
| 堵住路由泄露 | 12+设备路由添加isRestaurant过滤 | FAManagementStackNavigator.tsx |
| i18n硬编码修复 | 4处中文提取到i18n | FAManagementScreen.tsx:99,105,147,163 |
| E2E走查验证 | 餐饮账号逐页验证 | — |

### P1 — 进销存补全（3周）

| 任务 | 说明 | 依赖 |
|------|------|------|
| BOM配方管理 | 菜品-原料关联+配方CRUD+理论消耗 | 无 |
| 领料/日消耗 | 基于BOM的按日消耗登记，自动扣减库存 | BOM |
| 损耗管理 | 损耗登记+损耗率统计 | 无 |
| 盘点功能 | 周期盘点+差异计算+盈亏审批 | 无 |
| 保质期预警 | 餐饮食材短保(1-7天)专用阈值 | 无 |
| BI报表模板 | 畅滞销/食材成本/毛利/损耗率 | 损耗管理 |

### P2 — 增值功能（4-5周）

| 任务 | 说明 |
|------|------|
| 餐饮AI意图15-20组 | 规则引擎优先，积累数据后微调分类器 |
| 智能补货建议 | 历史消耗+BOM+安全库存→采购建议 |
| POS数据对接(预留) | 激活PosConnection实体，实现1品牌同步 |

---

## 架构决策

**决策：维持渐进适配，但设置Fork触发条件。**

理由：
1. 仅2种业务类型，餐饮是工厂的功能子集
2. P1的4个模块在工厂版已有对应物，改造成本远低于重建
3. 策略模式对2种类型属于过度设计，if/else足够

**Fork触发条件**：
- 业务类型扩展到3种以上
- 餐饮需求超出进销存范围
- isRestaurant分支数超过50处且产生过2次生产事故

---

## 行业标杆参考

| 竞品 | 进销存深度 | BI | AI | 适合场景 |
|------|-----------|-----|-----|---------|
| 哗啦啦 | 最强(批次追溯+损耗核算) | 大数据平台 | 较强 | 中大型连锁 |
| 客如云 | 较完整(供应链打通) | 较强 | 中等 | 中高端 |
| 美团RMS | 弱(偏前台) | 较强 | 中等(美团数据) | 小单店 |
| 二维火 | 基础全流程 | 中等 | 弱 | 传统中餐 |
| **Cretas餐饮版** | **前半程可用，后半程缺失** | **SmartBI框架强，模板缺** | **框架最强(140意图)，餐饮适配零** | **进销存+BI定位** |

---

## 开放问题

1. 餐饮版用户角色体系：复用工厂角色还是简化为"店长/店员"？
2. 种子数据菜品分类：用户提供菜单还是通用中餐模板？
3. BI数据源：Excel上传还是从进销存数据自动生成？
4. 后端API是否需要factoryType级别权限校验？
5. AI意图：复用现有分类器扩展还是独立训练？

---

### Process Note
- Mode: Full
- Researchers deployed: 3
- Total sources found: 21 (代码文件 + 竞品调研)
- Key disagreements: 3 resolved (实体风险降级、策略模式否决、工期修正), 2 unresolved (fork时机、AI训练方案)
- Phases completed: Research → Analysis → Critique → Integration
- Fact-check: disabled (报告以本地代码证据为主)
- Competitor profiles: 4 competitors analyzed (哗啦啦/客如云/美团RMS/二维火)
