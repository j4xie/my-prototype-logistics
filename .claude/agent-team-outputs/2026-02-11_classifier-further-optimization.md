# 意图分类器进一步优化分析报告

**日期**: 2026-02-11
**当前状态**: 170类, F1=89.91%, QUInt8 ONNX 103MB/10.8ms

---

## Executive Summary

意图分类器F1达89.91%，优化空间主要集中在长尾类合并与置信度校准。

- **核心发现**: 170类意图中约20类样本<50，是F1瓶颈；二次合并可无成本提升0.3-0.5%
- **最高优先级**: P0(意图合并) + P1(温度标度校准) + P2(ONNX集成)，三者均0成本，1周内可完成
- **需验证方向**: LLM数据增强的收益可能被高估(实际0.8-1.2%而非1.5-2%)，建议小规模试验
- **生产可靠性**: Fallback LLM策略可将生产准确率推至92%，成本仅50元/月

---

## 优化优先级排序

| 优先级 | 方案 | F1预期 | 工作量 | 成本 | 置信度 |
|--------|------|--------|--------|------|--------|
| **P0** | 二次意图合并(HRM_DELETE等) | +0.3-0.5% | 1天 | 0 | ★★★★★ |
| **P1** | 温度标度校准 | 可靠性+50% | 1-2天 | 0 | ★★★★★ |
| **P2** | ONNX Runtime生产集成 | 延迟→9ms | 2-3天 | 0 | ★★★★☆ |
| **P3** | LLM数据增强(低频20类) | +0.8-1.2% | 2-3天 | 500元 | ★★★☆☆ |
| **P4** | 低置信度Fallback LLM | 生产准确率→92% | 2-3天 | 50元/月 | ★★★★★ |
| **P5** | RoBERTa-large升级 | +1.5-2.1% | 3天 | 1000元 | ★★★☆☆ |

---

## 实施路线图

### Phase 1: 零成本快速赢 (本周)

1. **P0: 二次意图合并** (1天)
   - HRM_DELETE_EMPLOYEE → HR_DELETE_EMPLOYEE
   - EXCLUDE_SELECTED → SYSTEM_FILTER_EXCLUDE_SELECTED
   - 170类 → ~167类, 预期F1: 90.2-90.4%

2. **P1: 温度标度校准** (1-2天)
   - 在classifier/service.py添加温度参数T (T=1.5-2.0)
   - 验证: ECE < 0.05
   - 效果: 置信度阈值更可靠

3. **P2: ONNX Runtime A/B测试** (2-3天)
   - 先10%流量用ONNX，验证KL散度<0.01
   - Session单例 + intra_op=4, inter_op=2
   - 通过后全量，延迟28ms→9ms

### Phase 2: 数据增强+生产保险 (第2-3周)

4. **P4: Fallback LLM** (2-3天)
   - 置信度<0.7时调用Qwen二次分类
   - 成本: 50元/月
   - 生产准确率→92%

5. **P3: LLM数据增强小规模试验** (2-3天)
   - 先选3个长尾类生成1000条
   - 人工抽样验证质量
   - F1提升>0.5%再全量

### Phase 3: 条件执行 (仅F1<91.5%时)

6. **P5: RoBERTa-large** (3-5天)
   - 仅在P0-P4完成后仍不满足时
   - 延迟翻倍，需量化缓解

---

## 关键共识与分歧

| 话题 | 共识 | 分歧 |
|------|------|------|
| 二次合并 | 全部同意，0成本 | 无 |
| 温度标度 | 全部同意，必做 | 无 |
| ONNX集成 | 同意收益，需A/B测试 | Critic质疑直接替换风险 |
| LLM数据增强 | 方向正确 | 收益估计分歧(1.5% vs 0.8%) |
| Fallback LLM | 全部同意 | 无 |
| 理论上限 | 未验证 | 89.91%是否已接近天花板? |

---

## 预期目标

```
当前:     F1=89.91%, 延迟=28.8ms (PyTorch) / 10.8ms (ONNX未集成)
Phase 1:  F1=90.2-90.4%, 延迟=9ms (ONNX集成), 置信度可靠性+50%
Phase 2:  F1=91.0-91.5%, 生产准确率=92%
Phase 3:  F1=92%+ (条件)
```

---

## Process Note
- Mode: Full
- Researchers: 3 (低分类分析, ONNX集成, 高级优化)
- Analyst: 1, Critic: 1, Integrator: 1
- Key disagreements: 5 resolved, 2 unresolved
