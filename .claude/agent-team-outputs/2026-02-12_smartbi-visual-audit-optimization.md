# SmartBI生产环境可视化审计与优化报告

**日期**: 2026-02-12
**模式**: Full (5-agent pipeline)
**语言**: Chinese
**服务器**: 47.100.235.168:8088
**截图数**: 25张

---

## Executive Summary

部署到新服务器后的全量截图审计发现 **6个P0级功能阻断性Bug** 和 **12个P1/P2级体验优化点**。P0 Bug包括3个404页面（AI Query路由名拼写错误、Templates/Production懒加载失败）、3个数据加载失败（Dashboard/Sales/Finance）。UX综合评分2.4/5，核心短板是导航一致性（2/5）、首次使用体验（2/5）和功能发现性（2/5）。图表渲染质量较好（DataZoom/多类型/KPI卡片均正常），已实施的优化（标签人性化/近零值过滤/饼图截断）在生产环境验证通过。**建议立即修复6个P0（~7小时），本周完成6个P1（~13小时）。**

**置信度修正**: Critic指出B2/B3/B4置信度应下调（从3-4降至2-3），因审计基于截图而非Console日志/API返回值，部分根因为推测。建议修复前先用curl测试后端API确认实际返回值。

---

## 问题优先级矩阵

| ID | 问题 | 严重度 | 工时 | 影响 | 置信度 | 优先级 |
|----|------|--------|------|------|--------|--------|
| **B1** | AI Query 404（路由名拼写错误） | 5 | 0.5h | 100% | ★★★★★ | P0-立即 |
| **B2** | Templates/Production 404 | 5 | 1h | 100% | ★★☆☆☆ | P0-立即 |
| **B3** | Dashboard KPI全"--" | 5 | 2h | 100% | ★★★☆☆ | P0-立即 |
| **B5** | Finance全零(未调用loadData) | 5 | 1.5h | 100% | ★★★★☆ | P0-立即 |
| **B4** | Sales KPI部分零值 | 4 | 2h | 80% | ★★★☆☆ | P0-今日 |
| **B6** | 数据完整度API不存在 | 4 | 3h | 60% | ★★★★★ | P0-今日 |
| **U3** | Dashboard空状态无引导 | 4 | 2h | 100% | ★★★★★ | P1-本周 |
| **B8** | 数据源对话框遮罩残留 | 3 | 1h | 40% | ★★★★☆ | P1-本周 |
| **U2** | 侧边栏9项无分组 | 3 | 3h | 100% | ★★★★★ | P1-本周 |
| **U4** | Dashboard-Analysis数据不同步 | 4 | 4h | 70% | ★★☆☆☆ | P1-本周 |
| **U6** | 数据源切换无Loading | 3 | 1h | 60% | ★★★★★ | P1-本周 |
| **U7** | "Excel上传(旧)"标签混淆 | 3 | 2h | 50% | ★★★★☆ | P1-本周 |
| **C7** | 图表标题技术化 | 3 | 3h | 80% | ★★★★★ | P2-下周 |
| **C5** | X轴标签仍有重叠 | 3 | 2h | 60% | ★★★★★ | P2-下周 |
| **C6** | 配色不统一 | 2 | 4h | 40% | ★★★★☆ | P2-下周 |
| **U5** | 高级功能入口隐蔽 | 3 | 3h | 30% | ★★★★☆ | P2-下周 |
| **C8** | 对话框遮挡图表 | 3 | 1.5h | 40% | ★★★★☆ | P2-下周 |
| **B7** | toLocaleString Hermes不兼容 | 2 | 1h | 0%(web) | ★★★★★ | P3-延后 |

---

## 系统性根因分析

### R1: 前端生命周期管理缺陷 → 解释 B3, B4, B5, U4
Dashboard/Finance/Sales三页面均有`onMounted`异步逻辑不完整。B3缺少await、B5完全未调用加载函数、B4后端返回部分null未防御。没有统一的数据加载框架，各页面独立拉取数据，互不感知。

### R2: 路由配置与组件不一致 → 解释 B1, B2, U7
路由文件经历多次迭代但无自动验证。B1是名称拼写错误，B2是懒加载可能路径不对，U7是废弃路由未清理。缺少TypeScript路由类型约束和CI路由可达性测试。

### R3: 后端API契约不稳定 → 解释 B4, B6, B3
前端基于假设编码，部分端点（B6）完全不存在，部分端点（B3/B4）返回值不符合前端预期。缺少共享的OpenAPI规范。

### R4: 产品化程度不足 → 解释 U1, U2, U3, U5, C5-C7
UX 2.4/5反映系统从技术原型向可交付产品的转化尚未完成。菜单无分组、空状态无引导、高级功能深藏、配色不统一——均为"开发者视角"而非"用户视角"。

---

## 修复路线图

### 阶段一：今日（~7小时，消除所有P0）

| # | 任务 | 文件 | 工时 | 验证 |
|---|------|------|------|------|
| 1 | 修复AI Query路由名 SmartBIAIQuery→SmartBIQuery | Dashboard.vue, SalesAnalysis.vue | 0.5h | 菜单点击不404 |
| 2 | 修复Templates/Production路由 | smartbi.ts + 检查懒加载 | 1h | 9条路由全可达 |
| 3 | Dashboard onMounted加await + null防御 | Dashboard.vue | 2h | KPI显示数值 |
| 4 | Finance onMounted调用loadFinanceData | FinanceAnalysis.vue | 1.5h | 财务数据显示 |
| 5 | Sales后端排查orders/avg为零 | SalesAnalysis.vue + 后端 | 2h | 全部KPI非零 |

**前置步骤**: 先用curl测试后端API返回值（30min），避免"修了前端发现是后端问题"。

### 阶段二：本周（~13小时，消除所有P1）

| # | 任务 | 工时 |
|---|------|------|
| 6 | 后端实现数据完整度API | 3h |
| 7 | Dashboard空状态引导组件 | 2h |
| 8 | 侧边栏三级分组重构 | 3h |
| 9 | 数据源切换loading状态 | 1h |
| 10 | 对话框遮罩修复 | 1h |
| 11 | 清理废弃路由、删除"旧"入口 | 2h |

### 阶段三：下周（~13.5小时，P2改善）

| # | 任务 | 工时 |
|---|------|------|
| 12 | 图表标题人性化扩展 | 3h |
| 13 | X轴标签旋转/省略策略 | 2h |
| 14 | 统一ECharts配色theme | 4h |
| 15 | 高级功能卡片式入口 | 3h |
| 16 | 对话框改抽屉避免遮挡 | 1.5h |

**总工时**: 33.5小时（~4-5工作日），并行可压缩至3个工作日。

---

## Critic质疑（已纳入）

### 质疑1: B2置信度过高
"文件存在但Vite懒加载可能失败"是推测。实际可能是构建chunk分割问题、nginx配置问题，修复可能远超10分钟。置信度从3下调至2，需先检查DevTools Network面板确认404的实际资源路径。

### 质疑2: UX评分2.4/5混合了功能缺陷与设计质量
如果修复6个P0 bug（404页面、数据加载失败），UX评分可能自动从2.4升至3.5+，无需额外设计改动。建议将UX评分作为修复后的跟踪指标，而非驱动额外工作项。

### 审计缺失数据
1. **后端API实际返回值** — 未执行curl测试
2. **浏览器Console错误日志** — 截图未包含DevTools
3. **服务器端日志** — 未检查cretas-backend.log
4. **性能数据** — 页面加载时间、API响应时间未采集
5. **多角色测试** — 仅测试factory_admin1角色
6. **数据量边界** — 仅用11-sheet Test.xlsx
7. **跨浏览器兼容性** — 仅Chrome

---

## 已确认正常的部分（无需修复）

| 功能 | 评分 | 状态 |
|------|------|------|
| DataZoom (264行交互) | ★★★★★ | 优秀 |
| 图表类型多样性 | ★★★★☆ | 良好 |
| KPI卡片设计 | ★★★★☆ | 良好 |
| AI分析内容质量 | ★★★★☆ | 良好 |
| SSE流式上传 | ★★★★★ | 优秀 |
| Sheet索引+标签导航 | ★★★★★ | 优秀 |
| 标签人性化(humanize) | ★★★★☆ | 良好 |
| 近零值过滤 | ★★★★☆ | 良好 |

---

## Process Note
- Mode: Full
- Researchers deployed: 3 (Bug/路由、图表质量、UX/功能)
- Total findings: 24 (8 bugs + 8 chart + 8 UX)
- Key disagreements: 2 resolved (B2置信度、UX评分方法论)
- Phases completed: Research → Analysis → Critique → Integration
- Data gaps identified: 7 (API验证、Console日志、服务器日志、性能、多角色、边界、跨浏览器)
