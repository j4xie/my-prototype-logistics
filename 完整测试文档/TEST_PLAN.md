# 前后端集成测试计划

> 白垩纪食品溯源系统 (Cretas Food Traceability System)

## 目录

- [概述](#概述)
- [测试范围](#测试范围)
- [测试策略](#测试策略)
- [测试环境](#测试环境)
- [测试用例](#测试用例)
- [验收标准](#验收标准)

---

## 概述

| 项目 | 内容 |
|------|------|
| **目标** | 对白垩纪食品溯源系统进行全面的前后端集成测试 |
| **服务器** | http://139.196.165.140:10010 |
| **当前状态** | Phase 6 测试完成，整体通过率 87% |
| **最新测试日期** | 2026-01-02 |
| **相关文档** | [测试结果](./TEST_RESULTS.md) · [Bug清单](./BUG_TRACKER.md) · [API端点](./API_ENDPOINTS.md) |

---

## 测试范围

### 模块覆盖

| # | 模块 | Controller | 端点数 | 优先级 | 测试状态 |
|---|------|-----------|--------|--------|----------|
| 1 | 认证模块 | AuthController | 8 | P0 | ✅ 100% |
| 2 | 用户管理 | UserController | 12 | P0 | ✅ 100% |
| 3 | 工厂管理 | FactoryController | 15 | P0 | ✅ 100% |
| 4 | 原料批次 | MaterialBatchController | 20 | P1 | ✅ 87% |
| 5 | 加工批次 | ProcessingController | 25 | P1 | ✅ 85% |
| 6 | 质量检测 | QualityInspectionController | 18 | P1 | ✅ 75% |
| 7 | 设备管理 | EquipmentController | 22 | P2 | ✅ 80% |
| 8 | 排程调度 | SchedulingController | 48 | P2 | ✅ 87% |
| 9 | 报表统计 | ReportController | 30 | P2 | ✅ 85% |
| 10 | AI服务 | AIController | 15 | P3 | ✅ 70% |

### 测试阶段完成状态

| Phase | 描述 | 状态 | 通过率 |
|-------|------|------|--------|
| Phase 1 | 基础连通性验证 | ✅ 完成 | 100% |
| Phase 2 | Controller 级别测试 | ✅ 完成 | 96% |
| Phase 3 | 业务流程测试 | ✅ 完成 | 100% |
| Phase 4 | 模块功能测试 | ✅ 完成 | 75-87% |
| Phase 5 | 异常场景测试 | ✅ 完成 | 70% |
| Phase 6 | 性能测试 | ✅ 完成 | A+ 评分 |

### 测试类型

| 类型 | 描述 | 覆盖率目标 |
|------|------|-----------|
| API 集成测试 | 验证 REST API 响应格式、状态码、数据正确性 | 100% |
| 认证授权测试 | 验证 JWT Token、角色权限、401/403 处理 | 100% |
| 边界条件测试 | 空值、超长字符串、非法参数 | 80% |
| 并发测试 | 多用户同时操作场景 | 关键流程 |

---

## 测试策略

### Subagent 并行执行架构

```
┌─────────────────────────────────────────────────────────────┐
│                    测试编排器 (Orchestrator)                  │
├─────────────────────────────────────────────────────────────┤
│  Phase 1: 基础验证          Phase 2: Controller测试           │
│  ┌─────────┐ ┌─────────┐   ┌─────────┐ ┌─────────┐          │
│  │Subagent1│ │Subagent2│   │Subagent3│ │Subagent4│  ...     │
│  │ Auth    │ │ Health  │   │ User    │ │Equipment│          │
│  └────┬────┘ └────┬────┘   └────┬────┘ └────┬────┘          │
│       │           │             │           │                │
│       ▼           ▼             ▼           ▼                │
│  ┌─────────────────────────────────────────────────────┐    │
│  │              结果汇总 & Bug 记录                      │    │
│  └─────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────┘
```

### 执行规则

| 规则 | 说明 |
|------|------|
| 最大并行数 | 3 个 Subagent 同时执行 |
| 依赖顺序 | Phase 1 必须先完成，再启动 Phase 2 |
| 失败处理 | 记录 Bug，继续测试其他端点 |
| 超时设置 | 单个请求 30 秒，单个 Phase 10 分钟 |

---

## 测试环境

### 服务器配置

| 项目 | 配置 |
|------|------|
| 后端地址 | http://139.196.165.140:10010 |
| 数据库 | MySQL 8.0 @ 139.196.165.140:3306 |
| 数据库名 | creats-test |
| 用户/密码 | creats-test / R8mwtyFEDMDPBwC8 |

### 测试账号

| 角色 | 用户名 | 密码 | factoryId |
|------|--------|------|-----------|
| 平台管理员 | platform_admin | 123456 | - |
| 工厂超级管理员 | factory_admin1 | 123456 | F001 |
| 车间主管 | workshop_admin | 123456 | F001 |
| 质检员 | quality_inspector | 123456 | F001 |

### 测试数据 SQL

```sql
-- 确保测试工厂存在
INSERT IGNORE INTO factories (id, name, code, status)
VALUES ('F001', '测试工厂', 'FACTORY_001', 'ACTIVE');

-- 确保测试用户存在
INSERT IGNORE INTO users (id, username, password, factory_id, role)
VALUES (1, 'factory_admin1', '$2a$10$...', 'F001', 'factory_super_admin');
```

---

## 测试用例

### Phase 1: 基础连通性验证

| ID | 测试项 | 端点 | 预期结果 |
|----|--------|------|----------|
| T1.1 | 健康检查 | GET /api/mobile/health | 200 OK |
| T1.2 | 登录认证 | POST /api/mobile/auth/unified-login | 返回 accessToken |
| T1.3 | 用户信息 | GET /api/mobile/{factoryId}/users/current | 返回当前用户 |
| T1.4 | 工厂列表 | GET /api/mobile/{factoryId}/factories | 返回工厂数组 |

### Phase 2: Controller 级别测试

| Controller | 端点数 | 测试重点 |
|------------|--------|----------|
| SchedulingController | 48 | 排程计划 CRUD、时段查询 |
| ProcessingController | 25 | 批次创建、状态流转、原料消耗 |
| QualityInspectionController | 18 | 质检记录、处置申请、审批流程 |
| EquipmentController | 22 | 设备状态、维护记录、告警处理 |
| ReportController | 30 | Dashboard 数据、导出功能 |

### Phase 3: 业务流程测试

| 流程 | 步骤 | 验证点 |
|------|------|--------|
| 原料入库 | 创建批次→质检→入库确认 | 库存数量更新 |
| 生产加工 | 创建计划→消耗原料→产出成品 | 转换率计算 |
| 质量处置 | 发现问题→申请处置→审批→执行 | 状态流转 |
| 出货追溯 | 创建出货→绑定批次→生成溯源码 | 追溯链完整 |

### Phase 4: 异常场景测试

| 场景 | 测试方法 | 预期 |
|------|----------|------|
| Token 过期 | 使用过期 Token 请求 | 401 + 刷新提示 |
| 权限不足 | 质检员访问管理接口 | 403 Forbidden |
| 资源不存在 | 查询不存在的 ID | 404 + 明确错误信息 |
| 参数校验 | 提交空必填字段 | 400 + 字段错误提示 |

### Phase 5: 性能测试

| 指标 | 目标 | 测试方法 |
|------|------|----------|
| 响应时间 | < 500ms (P95) | 连续请求 100 次 |
| 并发处理 | 50 用户同时 | JMeter 压测 |
| 列表查询 | < 1s (1000条) | 分页查询验证 |

---

## 验收标准

### 通过条件

| 指标 | 阈值 | 当前状态 |
|------|------|----------|
| API 可用率 | >= 95% | 91% (接近达标) |
| 核心流程通过率 | 100% | ✅ 已达成 |
| P0/P1 Bug 数量 | 0 | ✅ 已清零 |
| 响应时间 P95 | < 500ms | ✅ 已达成 (<50ms) |

### 阻塞条件

以下任一情况将阻塞发布：
- 认证模块存在未修复 Bug
- 核心业务流程（原料→生产→出货）中断
- 数据一致性问题
- 安全漏洞（SQL注入、XSS等）

**当前阻塞项：**
- ✅ 无阻塞项 - P0/P1/P2 已全部修复 (2026-01-02 v1.2.0)

---

## 附录

### 相关文档

| 文档 | 说明 |
|------|------|
| [TEST_RESULTS.md](./TEST_RESULTS.md) | 详细测试执行结果 |
| [BUG_TRACKER.md](./BUG_TRACKER.md) | Bug 跟踪清单 |
| [API_ENDPOINTS.md](./API_ENDPOINTS.md) | 完整 API 端点清单 (791个) |

### 更新记录

| 日期 | 版本 | 变更 |
|------|------|------|
| 2026-01-01 | v1.0 | Phase 1 测试完成 |
| 2026-01-02 | v2.0 | Phase 2 测试完成，修复 27+ Bugs |
| 2026-01-02 | v3.0 | Phase 3-6 测试完成，整体通过率 87%，发现 P0 安全漏洞 |
