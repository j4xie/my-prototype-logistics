# 系统差异分析报告

> **生成日期**: 2026-01-22
> **分析范围**: 前后端字段一致性、API覆盖率、Admin Panel、权限映射

---

## 一、前后端字段一致性问题

### 1.1 Customer (客户)

| 问题类型 | 后端字段 | 前端字段 | 严重程度 |
|---------|---------|---------|---------|
| ❌ 字段不存在 | `type` | `businessType`, `customerType` | 🔴 高 |
| ⚠️ 前端精简 | `contactName`, `contactPhone`, `contactEmail` | 仅保留 `contactPerson`, `phone`, `email` | 🟡 中 |
| ⚠️ 前端精简 | `billingAddress` | 未定义 | 🟡 中 |
| ✅ MVP移除 | `taxNumber`, `businessLicense`, `paymentTerms`, `creditLimit`, `currentBalance`, `rating`, `ratingNotes` | 未定义 | 🟢 低 |

**修复建议**:
```java
// 后端 Customer.java 添加字段
@Column(name = "business_type", length = 50)
private String businessType;

@Column(name = "customer_type", length = 50)
private String customerType;
```

---

### 1.2 Supplier (供应商)

| 问题类型 | 后端字段 | 前端字段 | 严重程度 |
|---------|---------|---------|---------|
| ❌ 字段不存在 | 无 | `businessType` | 🔴 高 |
| ❌ 字段不存在 | 无 | `creditLevel` | 🔴 高 |
| ❌ 字段不匹配 | `deliveryDays` (Integer) | `deliveryArea` (String) | 🔴 高 |

**修复建议**:
```java
// 后端 Supplier.java 添加字段
@Column(name = "business_type", length = 50)
private String businessType;

@Column(name = "credit_level", length = 20)
private String creditLevel;

@Column(name = "delivery_area", length = 200)
private String deliveryArea;
```

---

### 1.3 MaterialBatch (原材料批次)

| 问题类型 | 后端字段 | 前端字段 | 严重程度 |
|---------|---------|---------|---------|
| ❌ 字段名不同 | `receiptQuantity` | `inboundQuantity` | 🟡 中 |
| ❌ 拼写不同 | `expireDate` | `expiryDate` | 🟡 中 |
| ❌ 概念不同 | `qualityCertificate` | `qualityGrade` | 🟡 中 |
| ⚠️ 前端缺失 | `quantityUnit`, `weightPerUnit`, `purchaseDate` | 未定义 | 🟡 中 |
| ✅ 关联字段 | 无 | `materialName`, `supplierName`, `createdByName` | 🟢 DTO返回 |

**修复建议**: 统一命名 (建议后端向前端对齐)
```java
// 后端 MaterialBatch.java (或在DTO层转换)
// 方案1: 添加别名getter
@Transient
public BigDecimal getInboundQuantity() {
    return receiptQuantity;
}

@Transient
public LocalDate getExpiryDate() {
    return expireDate;
}
```

---

## 二、后端API无前端界面

### 2.1 完全无界面的API模块

| 模块 | Controller | 端点数 | 可访问角色 | 实现建议 |
|------|-----------|--------|----------|---------|
| **行为校准** | BehaviorCalibrationController | 9 | platform_admin | 需要Admin Panel页面 |
| **合成数据** | SyntheticDataController | 4 | platform_admin | AI训练用，可保持API |
| **LinUCB推荐** | LinUCBController | 12 | factory_super_admin | 内部算法，无需界面 |
| **策略权重** | StrategyWeightAdaptationController | 10 | factory_super_admin | 可整合到AI设置 |
| **调度优化** | SchedulingOptimizationController | 19 | dispatcher | 已有调度页面，需增强 |
| **标签识别** | LabelRecognitionController | 10 | all | 需要扫码结果页 |
| **语音识别** | VoiceRecognitionController | 12 | quality_inspector | 需要语音质检页 |
| **边缘网关** | EdgeGatewayController | 6 | equipment_admin | 需要设备管理增强 |

### 2.2 部分功能无界面

| 模块 | 有界面功能 | 无界面功能 | 缺失界面 |
|------|----------|----------|---------|
| **调度** | 计划列表、创建、详情 | AI重排、概率预测详情 | AI调度分析页 |
| **质检** | 质检表单、记录 | 质检项绑定、统计分析 | 质检配置页 |
| **设备** | 设备列表、详情 | ISAPI智能分析、边缘网关 | 智能分析页 |
| **AI** | AI聊天、成本分析 | 意图配置、规则管理 | AI配置中心 |
| **报表** | 基础报表 | 自定义报表、Excel上传分析 | 高级报表中心 |

### 2.3 按角色统计无界面功能

| 角色 | 可用API | 有界面API | 无界面API | 覆盖率 |
|------|--------|----------|----------|--------|
| factory_super_admin | ~1300 | ~800 | ~500 | 61% |
| dispatcher | ~300 | ~200 | ~100 | 67% |
| quality_inspector | ~100 | ~60 | ~40 | 60% |
| warehouse_manager | ~150 | ~120 | ~30 | 80% |
| workshop_supervisor | ~180 | ~130 | ~50 | 72% |
| hr_admin | ~80 | ~70 | ~10 | 87% |
| operator | ~50 | ~40 | ~10 | 80% |

---

## 三、Admin Panel (Web管理后台)

### 3.1 已实现页面

| 模块 | 页面 | 路由 | 状态 |
|------|------|------|------|
| 仪表板 | DashboardView | /dashboard | ✅ 完整 |
| 工厂管理 | FactoryListView, FactoryDetailView | /factories/* | ✅ 完整 |
| 用户管理 | UserListView, UserDetailView | /users/* | ✅ 完整 |
| 角色管理 | RoleListView | /roles | ✅ 完整 |
| 蓝图管理 | BlueprintListView | /blueprints | ✅ 完整 |
| 配额管理 | QuotaOverviewView | /quotas | ✅ 完整 |
| AI配置 | AIConfigView | /ai-config | ⚠️ 部分 |
| 审计日志 | AuditLogView | /audit | ✅ 完整 |

### 3.2 未实现/缺失页面

| 模块 | 缺失功能 | 后端API | 优先级 |
|------|---------|---------|--------|
| **行为校准管理** | 校准规则配置、校准历史 | /api/admin/calibration/* (9个) | 🔴 高 |
| **SmartBI配置** | 数据源配置、图表模板 | /api/admin/smartbi-config/* (40+个) | 🔴 高 |
| **合成数据管理** | 数据生成、训练集管理 | /api/admin/synthetic/* (4个) | 🟡 中 |
| **系统监控** | 服务健康、性能指标 | /api/mobile/system/* (3个) | 🟡 中 |
| **公告管理** | 公告发布、历史 | 前端有入口但功能不完整 | 🟡 中 |
| **产品类型** | 产品类型配置详情页 | /api/mobile/{fid}/product-types/* | 🟢 低 |
| **原材料类型** | 原材料类型配置详情页 | /api/mobile/{fid}/raw-material-types/* | 🟢 低 |

### 3.3 Admin Panel API覆盖分析

```
Admin专用API总数: ~55个
├── /api/admin/calibration: 9个
├── /api/admin/smartbi-config: 40+个
└── /api/admin/synthetic: 4个

Web Admin Panel覆盖率: ~20% (仅基础CRUD)
需要新建页面: 8个
需要增强功能: 12个
```

---

## 四、角色权限与界面映射

### 4.1 角色导航器分配

| 角色代码 | 导航器 | Tab数 | 主要功能模块 |
|---------|-------|-------|------------|
| `factory_super_admin` | FactoryAdminNavigator | 6 | 首页、AI、报表、SmartBI、管理、我的 |
| `dispatcher` | DispatcherNavigator | 6 | 首页、计划、AI调度、SmartBI、人员、我的 |
| `workshop_supervisor` | WorkshopSupervisorNavigator | 5 | 首页、批次、人员、设备、我的 |
| `warehouse_manager` | WarehouseManagerNavigator | 5 | 首页、入库、出货、库存、我的 |
| `hr_admin` | HRNavigator | 5 | 首页、人员、考勤、白名单、我的 |
| `quality_inspector` | QualityInspectorNavigator | 5 | 首页、质检、记录、分析、我的 |
| `operator` | OperatorNavigator | 3 | 首页、生产、我的 |
| `platform_admin` | MainNavigator → Platform | - | 平台管理专属入口 |

### 4.2 功能模块权限矩阵

| 模块 | factory_super_admin | dispatcher | workshop_supervisor | warehouse_manager | quality_inspector | hr_admin | operator |
|------|:------------------:|:----------:|:------------------:|:-----------------:|:-----------------:|:--------:|:--------:|
| 生产管理 | ✓ RW | ✓ RW | ✓ RW | ○ R | ○ R | - | ✓ W |
| 仓储管理 | ✓ RW | ○ R | ○ R | ✓ RW | - | - | - |
| 质量管理 | ✓ RW | ○ R | ✓ W | - | ✓ W | - | - |
| 人员管理 | ✓ RW | ○ R | ○ R | - | - | ✓ RW | - |
| 设备管理 | ✓ RW | ○ R | ○ R | - | - | - | - |
| 调度计划 | ✓ RW | ✓ RW | - | - | - | - | - |
| 报表分析 | ✓ RW | ✓ RW | - | ✓ RW | - | - | - |
| SmartBI | ✓ RW | ✓ RW | - | - | - | - | - |
| AI意图 | ✓ RW | ✓ RW | - | - | - | - | - |
| 系统配置 | ✓ RW | ○ R | - | - | - | - | - |

> 图例: ✓ RW=读写, ○ R=只读, ✓ W=仅写, -=无权限

### 4.3 缺失界面与权限对照

| 缺失界面 | 应有权限的角色 | 后端API已就绪 | 开发优先级 |
|---------|--------------|--------------|----------|
| AI意图配置页 | factory_super_admin | ✅ 32个端点 | 🔴 高 |
| 质检项配置详情 | factory_super_admin, quality_manager | ✅ 22个端点 | 🔴 高 |
| 调度AI分析页 | dispatcher | ✅ 19个端点 | 🔴 高 |
| 语音质检结果页 | quality_inspector | ✅ 12个端点 | 🟡 中 |
| 设备智能分析 | factory_super_admin, equipment_admin | ✅ 7个端点 | 🟡 中 |
| 库存预警处理 | warehouse_manager | ✅ 5个端点 | 🟡 中 |
| 成本深度分析 | factory_super_admin, finance_manager | ✅ 15个端点 | 🟡 中 |
| 行为校准管理 | platform_admin | ✅ 9个端点 | 🔴 高 (Admin) |
| SmartBI配置 | platform_admin | ✅ 40+个端点 | 🔴 高 (Admin) |

---

## 五、按角色的待实现功能清单

### 5.1 factory_super_admin (工厂总监)

**已实现**: 85%
| 功能 | 界面 | API | 状态 |
|------|------|-----|------|
| 首页Dashboard | ✅ | ✅ | 完整 |
| AI聊天分析 | ✅ | ✅ | 完整 |
| 生产计划管理 | ✅ | ✅ | 完整 |
| 设备管理 | ✅ | ✅ | 完整 |
| 报表中心 | ✅ | ✅ | 完整 |
| AI意图配置 | ⚠️ 入口有 | ✅ 32个 | **需完善详情页** |
| 质检项配置 | ⚠️ 列表有 | ✅ 22个 | **需完善详情页** |
| 编码规则配置 | ⚠️ 入口有 | ✅ 15个 | **需完善编辑页** |
| 工厂蓝图管理 | ❌ | ✅ 9个 | **需新建页面** |

### 5.2 dispatcher (调度员)

**已实现**: 75%
| 功能 | 界面 | API | 状态 |
|------|------|-----|------|
| 调度工作台 | ✅ | ✅ | 完整 |
| 生产计划 | ✅ | ✅ | 完整 |
| Gantt图 | ✅ | ✅ | 完整 |
| 紧急插单 | ✅ | ✅ | 完整 |
| AI排班生成 | ✅ | ✅ | 完整 |
| AI概率预测 | ⚠️ 简单展示 | ✅ 5个 | **需详情页** |
| AI重排分析 | ❌ | ✅ 10个 | **需新建页面** |
| 调度优化建议 | ❌ | ✅ 19个 | **需新建页面** |

### 5.3 quality_inspector (质检员)

**已实现**: 70%
| 功能 | 界面 | API | 状态 |
|------|------|-----|------|
| 质检表单 | ✅ | ✅ | 完整 |
| 扫码质检 | ✅ | ✅ | 完整 |
| 拍照质检 | ✅ | ✅ | 完整 |
| 检验记录 | ✅ | ✅ | 完整 |
| 语音质检 | ⚠️ 入口有 | ✅ 12个 | **需结果展示页** |
| 趋势分析 | ⚠️ 简单 | ✅ 8个 | **需增强** |
| 质检报告生成 | ⚠️ 基础 | ✅ 5个 | **需增强** |

### 5.4 warehouse_manager (仓储主管)

**已实现**: 85%
| 功能 | 界面 | API | 状态 |
|------|------|-----|------|
| 入库管理 | ✅ | ✅ | 完整 |
| 出货管理 | ✅ | ✅ | 完整 |
| 库存盘点 | ✅ | ✅ | 完整 |
| 批次溯源 | ✅ | ✅ | 完整 |
| 转化分析 | ✅ | ✅ | 完整 |
| 库存预警处理 | ⚠️ 列表有 | ✅ 5个 | **需处理详情页** |
| 过期批次处理 | ⚠️ 入口有 | ✅ 3个 | **需完善** |

### 5.5 platform_admin (平台管理员)

**已实现**: 60% (Web Admin Panel)
| 功能 | 界面 | API | 状态 |
|------|------|-----|------|
| 工厂管理 | ✅ | ✅ | 完整 |
| 用户管理 | ✅ | ✅ | 完整 |
| 角色权限 | ✅ | ✅ | 完整 |
| 蓝图管理 | ✅ | ✅ | 完整 |
| 配额管理 | ✅ | ✅ | 完整 |
| 审计日志 | ✅ | ✅ | 完整 |
| 行为校准 | ❌ | ✅ 9个 | **需新建页面** |
| SmartBI配置 | ❌ | ✅ 40+个 | **需新建页面** |
| 合成数据 | ❌ | ✅ 4个 | **需新建页面** |
| 系统监控 | ❌ | ✅ 3个 | **需新建页面** |

---

## 六、优先级修复建议

### P0 - 立即修复 (影响核心功能)

1. **Customer/Supplier 字段不一致**
   - 后端添加 `businessType`, `customerType`, `creditLevel`, `deliveryArea` 字段
   - 或前端移除这些字段定义

2. **Admin Panel 行为校准页面**
   - 新建 `/calibration` 路由和页面
   - 对接 `/api/admin/calibration/*` 9个API

3. **Admin Panel SmartBI配置页面**
   - 新建 `/smartbi-config` 路由和页面
   - 对接 `/api/admin/smartbi-config/*` 40+个API

### P1 - 本周修复

4. **AI意图配置详情页** (factory_super_admin)
5. **调度AI分析页** (dispatcher)
6. **质检项配置详情页** (factory_super_admin)
7. **MaterialBatch 字段名统一**

### P2 - 近期完善

8. 语音质检结果页 (quality_inspector)
9. 设备智能分析页 (equipment_admin)
10. 库存预警处理页 (warehouse_manager)
11. 编码规则编辑页 (factory_super_admin)

---

## 七、统计摘要

| 指标 | 数量 |
|------|------|
| **后端Controller** | 89个 |
| **后端API端点** | ~1,300个 |
| **前端Screen** | 338个 |
| **前端导航器** | 8个角色特定 |
| **系统角色** | 14个工厂 + 4个平台 |
| **字段不一致问题** | 11处 |
| **无界面API模块** | 8个完全无界面 |
| **Admin Panel缺失页面** | 4个主要模块 |
| **整体API界面覆盖率** | ~65% |

---

*报告生成完成，请根据优先级逐步修复上述问题。*
