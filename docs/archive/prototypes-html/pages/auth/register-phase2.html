<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å®Œå–„ä¿¡æ¯ - ç™½å©çºªé£Ÿå“æº¯æºç³»ç»Ÿ</title>
    <link rel="stylesheet" href="../../assets/css/common.css">
    <link rel="stylesheet" href="../../assets/css/flow-annotations.css">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 16px;
            max-width: 428px;
            margin: 0 auto;
        }

        .register-container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            width: 100%;
            overflow: hidden;
        }

        .register-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 40px 24px 32px 24px;
            text-align: center;
            color: white;
            position: relative;
        }

        .back-button {
            position: absolute;
            top: 16px;
            left: 16px;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .back-button:active {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(0.95);
        }

        .register-header h1 {
            font-size: 24px;
            margin-bottom: 8px;
        }

        .register-header .subtitle {
            opacity: 0.9;
            font-size: 14px;
            color: rgba(255, 255, 255, 0.85);
        }

        .progress-indicator {
            margin-top: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .progress-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
        }

        .progress-circle {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: 600;
            position: relative;
        }

        .progress-step.completed .progress-circle {
            background: #52c41a;
            color: white;
        }

        .progress-step.completed .progress-circle::after {
            content: 'âœ“';
            position: absolute;
            font-size: 16px;
        }

        .progress-step.active .progress-circle {
            background: white;
            color: #667eea;
        }

        .progress-label {
            font-size: 12px;
            white-space: nowrap;
        }

        .progress-divider {
            width: 32px;
            height: 2px;
            background: rgba(255, 255, 255, 0.3);
            margin-bottom: 20px;
        }

        .status-badge {
            position: fixed;
            top: 80px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(82, 196, 26, 0.9);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            z-index: 100;
            box-shadow: 0 4px 12px rgba(82, 196, 26, 0.3);
        }

        .register-body {
            padding: 32px 24px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #333;
            font-size: 15px;
        }

        .form-label .required {
            color: #ff4d4f;
            margin-left: 2px;
        }

        .input-wrapper {
            position: relative;
        }

        .form-control {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s;
            min-height: 48px;
        }

        .form-control:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-control.error {
            border-color: #ff4d4f;
        }

        .password-toggle {
            position: absolute;
            right: 14px;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
            font-size: 20px;
            color: #999;
            user-select: none;
        }

        .password-toggle:active {
            transform: translateY(-50%) scale(0.95);
        }

        .form-hint {
            font-size: 12px;
            color: #8c8c8c;
            margin-top: 6px;
            line-height: 1.4;
        }

        .form-hint.error {
            color: #ff4d4f;
        }

        .form-hint.success {
            color: #52c41a;
        }

        .password-strength {
            margin-top: 8px;
            display: none;
        }

        .password-strength.visible {
            display: block;
        }

        .strength-bar {
            height: 4px;
            background: #f0f0f0;
            border-radius: 2px;
            overflow: hidden;
            margin-bottom: 6px;
        }

        .strength-fill {
            height: 100%;
            width: 0%;
            transition: all 0.3s;
            border-radius: 2px;
        }

        .strength-fill.weak {
            width: 33%;
            background: #ff4d4f;
        }

        .strength-fill.medium {
            width: 66%;
            background: #faad14;
        }

        .strength-fill.strong {
            width: 100%;
            background: #52c41a;
        }

        .strength-text {
            font-size: 12px;
        }

        .strength-text.weak {
            color: #ff4d4f;
        }

        .strength-text.medium {
            color: #faad14;
        }

        .strength-text.strong {
            color: #52c41a;
        }

        .select-wrapper {
            position: relative;
        }

        .form-select {
            width: 100%;
            padding: 14px 40px 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s;
            min-height: 48px;
            background: white;
            cursor: pointer;
            appearance: none;
        }

        .form-select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .select-arrow {
            position: absolute;
            right: 16px;
            top: 50%;
            transform: translateY(-50%);
            pointer-events: none;
            color: #999;
            font-size: 12px;
        }

        .agreement-wrapper {
            display: flex;
            align-items: flex-start;
            gap: 8px;
            margin-bottom: 24px;
            padding: 12px;
            background: #f5f5f5;
            border-radius: 8px;
        }

        .agreement-checkbox {
            width: 18px;
            height: 18px;
            cursor: pointer;
            margin-top: 2px;
            flex-shrink: 0;
        }

        .agreement-text {
            font-size: 13px;
            color: #595959;
            line-height: 1.6;
        }

        .agreement-text a {
            color: #667eea;
            text-decoration: none;
        }

        .agreement-text a:hover {
            text-decoration: underline;
        }

        .button-group {
            display: flex;
            gap: 12px;
            margin-bottom: 24px;
        }

        .btn-secondary {
            flex: 1;
            padding: 16px;
            background: white;
            color: #667eea;
            border: 2px solid #667eea;
            border-radius: 12px;
            font-size: 17px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            min-height: 52px;
        }

        .btn-secondary:active {
            transform: scale(0.98);
            background: #f5f7ff;
        }

        .btn-primary {
            flex: 2;
            padding: 16px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 17px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            min-height: 52px;
            position: relative;
        }

        .btn-primary:active {
            transform: scale(0.98);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .flow-annotation {
            text-align: center;
            margin-bottom: 12px;
        }

        .flow-arrow {
            color: #52c41a;
            font-size: 13px;
            font-weight: 500;
            margin-bottom: 4px;
        }

        .flow-hint {
            color: #8c8c8c;
            font-size: 12px;
        }

        .login-prompt {
            text-align: center;
            font-size: 14px;
            color: #666;
        }

        .login-prompt a {
            color: #667eea;
            text-decoration: none;
            font-weight: 600;
        }

        .login-prompt a:hover {
            text-decoration: underline;
        }
    </style>
    <link rel="stylesheet" href="../../assets/css/mobile.css">
</head>
<body>
    <div class="status-badge">
        âœ“ æ‰‹æœºéªŒè¯å·²å®Œæˆï¼Œè¯·å¡«å†™ç”¨æˆ·ä¿¡æ¯
    </div>

    <div class="register-container">
        <div class="register-header">
            <button class="back-button clickable-hotspot" data-flow-to="è¿”å›ä¸Šä¸€æ­¥" onclick="navigateToPage('register-phase1.html')">
                â†
            </button>
            <h1>å®Œå–„ä¿¡æ¯</h1>
            <p class="subtitle">ç¬¬äºŒæ­¥ / å…±ä¸¤æ­¥</p>
            <div class="progress-indicator">
                <div class="progress-step completed">
                    <div class="progress-circle"></div>
                    <div class="progress-label">æ‰‹æœºéªŒè¯</div>
                </div>
                <div class="progress-divider"></div>
                <div class="progress-step active">
                    <div class="progress-circle">2</div>
                    <div class="progress-label">å®Œå–„ä¿¡æ¯</div>
                </div>
            </div>
        </div>

        <div class="register-body">
            <form id="registerForm">
                <!-- ç”¨æˆ·å -->
                <div class="form-group">
                    <label class="form-label">
                        ç”¨æˆ·å <span class="required">*</span>
                    </label>
                    <div class="input-wrapper">
                        <input type="text"
                               class="form-control"
                               placeholder="è¯·è¾“å…¥ç”¨æˆ·åï¼ˆå­—æ¯æ•°å­—ç»„åˆï¼‰"
                               id="username"
                               autocomplete="username">
                    </div>
                    <div class="form-hint" id="usernameHint">
                        4-20ä½å­—ç¬¦ï¼Œæ”¯æŒå­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿
                    </div>
                </div>

                <!-- å¯†ç  -->
                <div class="form-group">
                    <label class="form-label">
                        å¯†ç  <span class="required">*</span>
                    </label>
                    <div class="input-wrapper">
                        <input type="password"
                               class="form-control"
                               placeholder="è¯·è¾“å…¥å¯†ç ï¼ˆ8-20ä½ï¼‰"
                               id="password"
                               autocomplete="new-password">
                        <span class="password-toggle" id="passwordToggle1">ğŸ‘ï¸</span>
                    </div>
                    <div class="password-strength" id="passwordStrength">
                        <div class="strength-bar">
                            <div class="strength-fill" id="strengthFill"></div>
                        </div>
                        <div class="strength-text" id="strengthText">å¯†ç å¼ºåº¦ï¼šå¼±</div>
                    </div>
                    <div class="form-hint">
                        8-20ä½ï¼ŒåŒ…å«å¤§å°å†™å­—æ¯ã€æ•°å­—å’Œç‰¹æ®Šå­—ç¬¦
                    </div>
                </div>

                <!-- ç¡®è®¤å¯†ç  -->
                <div class="form-group">
                    <label class="form-label">
                        ç¡®è®¤å¯†ç  <span class="required">*</span>
                    </label>
                    <div class="input-wrapper">
                        <input type="password"
                               class="form-control"
                               placeholder="è¯·å†æ¬¡è¾“å…¥å¯†ç "
                               id="confirmPassword"
                               autocomplete="new-password">
                        <span class="password-toggle" id="passwordToggle2">ğŸ‘ï¸</span>
                    </div>
                    <div class="form-hint" id="confirmPasswordHint">
                        è¯·ç¡®ä¿ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸€è‡´
                    </div>
                </div>

                <!-- å§“å -->
                <div class="form-group">
                    <label class="form-label">
                        å§“å <span class="required">*</span>
                    </label>
                    <div class="input-wrapper">
                        <input type="text"
                               class="form-control"
                               placeholder="è¯·è¾“å…¥çœŸå®å§“å"
                               id="fullName"
                               autocomplete="name">
                    </div>
                    <div class="form-hint">
                        è¯·å¡«å†™çœŸå®å§“åï¼Œç”¨äºç³»ç»Ÿè®°å½•
                    </div>
                </div>

                <!-- éƒ¨é—¨é€‰æ‹© -->
                <div class="form-group">
                    <label class="form-label">
                        éƒ¨é—¨ <span class="required">*</span>
                    </label>
                    <div class="select-wrapper">
                        <select class="form-select" id="department">
                            <option value="">è¯·é€‰æ‹©æ‰€å±éƒ¨é—¨</option>
                            <option value="production">ğŸ“¦ ç”Ÿäº§éƒ¨</option>
                            <option value="quality">âœ… è´¨æ£€éƒ¨</option>
                            <option value="warehouse">ğŸ“¦ ä»“å‚¨éƒ¨</option>
                            <option value="management">ğŸ’¼ ç®¡ç†éƒ¨</option>
                        </select>
                        <span class="select-arrow">â–¼</span>
                    </div>
                </div>

                <!-- å·¥ç§é€‰æ‹© -->
                <div class="form-group">
                    <label class="form-label">
                        å·¥ç§ <span class="required">*</span>
                    </label>
                    <div class="select-wrapper">
                        <select class="form-select" id="jobType">
                            <option value="">è¯·é€‰æ‹©å·¥ç§</option>
                            <option value="worker">ğŸ‘· ç”Ÿäº§å·¥</option>
                            <option value="inspector">ğŸ” è´¨æ£€å‘˜</option>
                            <option value="keeper">ğŸ“‹ ä»“ç®¡å‘˜</option>
                            <option value="admin">ğŸ’¼ ç®¡ç†å‘˜</option>
                        </select>
                        <span class="select-arrow">â–¼</span>
                    </div>
                </div>

                <!-- ç”¨æˆ·åè®® -->
                <div class="agreement-wrapper">
                    <input type="checkbox"
                           class="agreement-checkbox"
                           id="agreement">
                    <label class="agreement-text" for="agreement">
                        æˆ‘å·²é˜…è¯»å¹¶åŒæ„ <a href="#">ã€Šç”¨æˆ·åè®®ã€‹</a> å’Œ <a href="#">ã€Šéšç§æ”¿ç­–ã€‹</a>
                    </label>
                </div>

                <!-- æµç¨‹æ ‡æ³¨ -->
                <div class="flow-annotation">
                    <div class="flow-arrow">â†“ ç‚¹å‡»å®Œæˆæ³¨å†Œ</div>
                    <div class="flow-hint">æ³¨å†ŒæˆåŠŸåè·³è½¬åˆ° â†’ è®¾å¤‡æ¿€æ´»é¡µ</div>
                </div>

                <!-- æŒ‰é’®ç»„ -->
                <div class="button-group">
                    <button type="button"
                            class="btn-secondary clickable-hotspot"
                            data-flow-to="è¿”å›æ‰‹æœºéªŒè¯æ­¥éª¤"
                            onclick="navigateToPage('register-phase1.html')">
                        ä¸Šä¸€æ­¥
                    </button>
                    <button type="submit"
                            class="btn-primary clickable-hotspot"
                            id="submitBtn"
                            data-flow-to="å®Œæˆæ³¨å†Œè·³è½¬æ¿€æ´»é¡µ"
                            disabled>
                        å®Œæˆæ³¨å†Œ
                    </button>
                </div>

                <div class="login-prompt clickable-hotspot" data-flow-to="è¿”å›ç™»å½•é¡µ">
                    å·²æœ‰è´¦å·ï¼Ÿ<a href="login.html">ç«‹å³ç™»å½•</a>
                </div>
            </form>
        </div>
    </div>

    <script>
        // è¡¨å•éªŒè¯çŠ¶æ€
        const formState = {
            username: false,
            password: false,
            confirmPassword: false,
            fullName: false,
            department: false,
            jobType: false,
            agreement: false
        };

        // å¯†ç æ˜¾ç¤º/éšè—åˆ‡æ¢
        document.getElementById('passwordToggle1').addEventListener('click', function() {
            const passwordInput = document.getElementById('password');
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                this.textContent = 'ğŸ™ˆ';
            } else {
                passwordInput.type = 'password';
                this.textContent = 'ğŸ‘ï¸';
            }
        });

        document.getElementById('passwordToggle2').addEventListener('click', function() {
            const passwordInput = document.getElementById('confirmPassword');
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                this.textContent = 'ğŸ™ˆ';
            } else {
                passwordInput.type = 'password';
                this.textContent = 'ğŸ‘ï¸';
            }
        });

        // ç”¨æˆ·åéªŒè¯
        document.getElementById('username').addEventListener('input', function(e) {
            const value = this.value;
            const hint = document.getElementById('usernameHint');
            const regex = /^[a-zA-Z0-9_]{4,20}$/;

            if (!value) {
                this.classList.remove('error');
                hint.className = 'form-hint';
                hint.textContent = '4-20ä½å­—ç¬¦ï¼Œæ”¯æŒå­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿';
                formState.username = false;
            } else if (!regex.test(value)) {
                this.classList.add('error');
                hint.className = 'form-hint error';
                hint.textContent = 'ç”¨æˆ·åæ ¼å¼ä¸æ­£ç¡®';
                formState.username = false;
            } else {
                this.classList.remove('error');
                hint.className = 'form-hint success';
                hint.textContent = 'âœ“ ç”¨æˆ·åå¯ç”¨';
                formState.username = true;
            }

            checkFormValidity();
        });

        // å¯†ç å¼ºåº¦æ£€æµ‹
        document.getElementById('password').addEventListener('input', function(e) {
            const value = this.value;
            const strengthSection = document.getElementById('passwordStrength');
            const strengthFill = document.getElementById('strengthFill');
            const strengthText = document.getElementById('strengthText');

            if (!value) {
                strengthSection.classList.remove('visible');
                formState.password = false;
                checkFormValidity();
                return;
            }

            strengthSection.classList.add('visible');

            // è®¡ç®—å¯†ç å¼ºåº¦
            let strength = 0;
            if (value.length >= 8) strength++;
            if (value.length >= 12) strength++;
            if (/[a-z]/.test(value) && /[A-Z]/.test(value)) strength++;
            if (/[0-9]/.test(value)) strength++;
            if (/[^a-zA-Z0-9]/.test(value)) strength++;

            // æ›´æ–°å¼ºåº¦æ˜¾ç¤º
            strengthFill.className = 'strength-fill';
            strengthText.className = 'strength-text';

            if (strength <= 2) {
                strengthFill.classList.add('weak');
                strengthText.classList.add('weak');
                strengthText.textContent = 'å¯†ç å¼ºåº¦ï¼šå¼±';
                formState.password = false;
            } else if (strength <= 3) {
                strengthFill.classList.add('medium');
                strengthText.classList.add('medium');
                strengthText.textContent = 'å¯†ç å¼ºåº¦ï¼šä¸­ç­‰';
                formState.password = value.length >= 8;
            } else {
                strengthFill.classList.add('strong');
                strengthText.classList.add('strong');
                strengthText.textContent = 'å¯†ç å¼ºåº¦ï¼šå¼º';
                formState.password = true;
            }

            // éªŒè¯ç¡®è®¤å¯†ç 
            validateConfirmPassword();
            checkFormValidity();
        });

        // ç¡®è®¤å¯†ç éªŒè¯
        document.getElementById('confirmPassword').addEventListener('input', validateConfirmPassword);

        function validateConfirmPassword() {
            const password = document.getElementById('password').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            const confirmInput = document.getElementById('confirmPassword');
            const hint = document.getElementById('confirmPasswordHint');

            if (!confirmPassword) {
                confirmInput.classList.remove('error');
                hint.className = 'form-hint';
                hint.textContent = 'è¯·ç¡®ä¿ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸€è‡´';
                formState.confirmPassword = false;
            } else if (password !== confirmPassword) {
                confirmInput.classList.add('error');
                hint.className = 'form-hint error';
                hint.textContent = 'âœ— ä¸¤æ¬¡å¯†ç è¾“å…¥ä¸ä¸€è‡´';
                formState.confirmPassword = false;
            } else {
                confirmInput.classList.remove('error');
                hint.className = 'form-hint success';
                hint.textContent = 'âœ“ å¯†ç åŒ¹é…';
                formState.confirmPassword = true;
            }

            checkFormValidity();
        }

        // å§“åéªŒè¯
        document.getElementById('fullName').addEventListener('input', function(e) {
            const value = this.value.trim();
            formState.fullName = value.length >= 2;
            checkFormValidity();
        });

        // éƒ¨é—¨é€‰æ‹©éªŒè¯
        document.getElementById('department').addEventListener('change', function(e) {
            formState.department = this.value !== '';
            checkFormValidity();
        });

        // å·¥ç§é€‰æ‹©éªŒè¯
        document.getElementById('jobType').addEventListener('change', function(e) {
            formState.jobType = this.value !== '';
            checkFormValidity();
        });

        // åè®®å¤é€‰æ¡†
        document.getElementById('agreement').addEventListener('change', function(e) {
            formState.agreement = this.checked;
            checkFormValidity();
        });

        // æ£€æŸ¥è¡¨å•æ•´ä½“æœ‰æ•ˆæ€§
        function checkFormValidity() {
            const submitBtn = document.getElementById('submitBtn');
            const isValid = Object.values(formState).every(val => val === true);
            submitBtn.disabled = !isValid;
        }

        // è¡¨å•æäº¤
        document.getElementById('registerForm').addEventListener('submit', function(e) {
            e.preventDefault();

            // æ”¶é›†è¡¨å•æ•°æ®
            const formData = {
                username: document.getElementById('username').value,
                password: document.getElementById('password').value,
                fullName: document.getElementById('fullName').value,
                department: document.getElementById('department').value,
                jobType: document.getElementById('jobType').value
            };

            // ç¦ç”¨æäº¤æŒ‰é’®
            const submitBtn = document.getElementById('submitBtn');
            submitBtn.disabled = true;
            submitBtn.textContent = 'æ³¨å†Œä¸­...';

            // æ¨¡æ‹ŸAPIè°ƒç”¨
            setTimeout(() => {
                console.log('æ³¨å†Œæ•°æ®ï¼š', formData);
                alert('æ³¨å†ŒæˆåŠŸï¼\n\nå³å°†è·³è½¬åˆ°è®¾å¤‡æ¿€æ´»é¡µé¢\n\nç”¨æˆ·åï¼š' + formData.username + '\nå§“åï¼š' + formData.fullName);

                // å®é™…åº”ç”¨ä¸­è·³è½¬åˆ°è®¾å¤‡æ¿€æ´»é¡µ
                // window.location.href = 'activation.html';

                // æ¼”ç¤ºç”¨ï¼šé‡ç½®æŒ‰é’®
                submitBtn.textContent = 'å®Œæˆæ³¨å†Œ';
                submitBtn.disabled = false;
            }, 1500);
        });

        // é¡µé¢è·³è½¬å‡½æ•°
        function navigateToPage(page) {
            window.location.href = page;
        }

        // é¡µé¢åŠ è½½æ—¶çš„åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // å¯ä»¥ä»URLå‚æ•°è·å–æ‰‹æœºå·ç­‰ä¿¡æ¯
            const urlParams = new URLSearchParams(window.location.search);
            const phone = urlParams.get('phone');

            if (phone) {
                console.log('æ¥è‡ªæ‰‹æœºéªŒè¯ï¼š', phone);
            }

            console.log('æ³¨å†Œç¬¬äºŒæ­¥é¡µé¢å·²åŠ è½½');
        });
    </script>
    <script src="../../assets/js/flow-annotations.js"></script>
    <script src="../../assets/js/visual-flow.js"></script>
</body>
</html>
