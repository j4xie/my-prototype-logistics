<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç™½å©çºªé£Ÿå“æº¯æºç³»ç»Ÿ - åŠŸèƒ½ä¸æ–‡ä»¶æ˜ å°„ v3.0 æ–°äººè¯¦è§£ (å®Œæ•´ç‰ˆ)</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Microsoft YaHei', 'PingFang SC', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: #333;
            line-height: 1.7;
            font-size: 15px;
        }

        .container { display: flex; min-height: 100vh; }

        /* ä¾§è¾¹æ æ ·å¼ */
        .sidebar {
            width: 300px;
            background: white;
            border-right: 1px solid #e0e0e0;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            padding: 20px 0;
            z-index: 1000;
        }

        .sidebar-header {
            padding: 0 20px 20px;
            border-bottom: 2px solid #f0f0f0;
            margin-bottom: 20px;
        }

        .sidebar-header h1 {
            font-size: 17px;
            color: #2c3e50;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .sidebar-header p {
            font-size: 12px;
            color: #888;
            margin-top: 5px;
        }

        .sidebar-search {
            padding: 0 15px 15px;
            margin-bottom: 15px;
        }

        .sidebar-search input {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 13px;
            transition: all 0.3s;
        }

        .sidebar-search input:focus {
            outline: none;
            border-color: #4a90e2;
            box-shadow: 0 0 0 3px rgba(74, 144, 226, 0.1);
        }

        .sidebar-nav { padding: 0; }

        .sidebar-nav-item {
            display: block;
            padding: 13px 20px;
            color: #555;
            text-decoration: none;
            font-size: 13px;
            border-left: 3px solid transparent;
            transition: all 0.25s;
            cursor: pointer;
            font-weight: 500;
        }

        .sidebar-nav-item:hover {
            background: #f8f9fa;
            color: #2c3e50;
            border-left-color: #4a90e2;
            padding-left: 24px;
        }

        .sidebar-nav-item.active {
            background: #ecf0f6;
            color: #4a90e2;
            border-left-color: #4a90e2;
            font-weight: 600;
        }

        .sidebar-nav-item.level-2 {
            padding-left: 40px;
            font-size: 12px;
            font-weight: 400;
        }

        .sidebar-nav-section {
            padding: 14px 20px 10px;
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            color: #666;
            letter-spacing: 1px;
            border-bottom: 2px solid #f0f0f0;
            margin-top: 18px;
        }

        /* ä¸»å†…å®¹åŒºåŸŸ */
        .content {
            margin-left: 300px;
            padding: 50px 70px;
            background: white;
            flex: 1;
            max-width: 1400px;
        }

        .doc-header {
            margin-bottom: 40px;
            padding-bottom: 30px;
            border-bottom: 2px solid #e0e0e0;
        }

        .doc-header h1 {
            font-size: 36px;
            color: #2c3e50;
            margin-bottom: 15px;
            font-weight: 700;
        }

        .doc-meta {
            display: flex;
            gap: 30px;
            flex-wrap: wrap;
            margin-top: 15px;
            font-size: 14px;
            color: #888;
        }

        .badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
        }

        .badge-success { background: #d4edda; color: #155724; }
        .badge-info { background: #d1ecf1; color: #0c5460; }
        .badge-warning { background: #fff3cd; color: #856404; }

        /* æ ‡é¢˜æ ·å¼ */
        h1 {
            font-size: 32px;
            margin-top: 60px;
            margin-bottom: 30px;
            color: #1a1a1a;
            font-weight: 700;
            padding: 20px 0;
            border-top: 4px solid #4a90e2;
            border-bottom: 1px solid #e0e0e0;
            padding-bottom: 20px;
        }

        h1:first-child {
            margin-top: 0;
        }

        h2 {
            font-size: 24px;
            margin-top: 45px;
            margin-bottom: 20px;
            color: #2c3e50;
            font-weight: 600;
            padding-bottom: 12px;
            border-bottom: 2px solid #e0e0e0;
        }

        h3 {
            font-size: 20px;
            margin-top: 35px;
            margin-bottom: 18px;
            color: #34495e;
            font-weight: 600;
        }

        h4 {
            font-size: 17px;
            margin-top: 28px;
            margin-bottom: 14px;
            color: #555;
            font-weight: 600;
        }

        /* æ®µè½å’Œåˆ—è¡¨ */
        p {
            margin: 18px 0;
            line-height: 1.85;
            color: #444;
            text-align: justify;
        }

        ul, ol {
            margin: 22px 0;
            padding-left: 32px;
        }

        li {
            margin: 12px 0;
            line-height: 1.8;
            color: #555;
        }

        /* è¡¨æ ¼æ ·å¼ */
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 30px 0;
            background: white;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            border-radius: 8px;
            overflow: hidden;
        }

        th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 16px 18px;
            text-align: left;
            font-weight: 600;
            font-size: 13px;
            letter-spacing: 0.5px;
        }

        td {
            padding: 14px 18px;
            border-bottom: 1px solid #f0f0f0;
            font-size: 14px;
            color: #555;
        }

        tr:hover {
            background: #fafbfc;
        }

        tr:last-child td {
            border-bottom: none;
        }

        /* ä»£ç å—æ ·å¼ */
        pre {
            background: #282c34;
            color: #abb2bf;
            padding: 24px 28px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 28px 0;
            font-size: 13px;
            line-height: 1.7;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            border-left: 4px solid #4a90e2;
        }

        code {
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', 'Consolas', 'Source Code Pro', monospace;
        }

        p code, li code {
            background: #f5f5f5;
            color: #e74c3c;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.9em;
            border: 1px solid #e0e0e0;
        }

        /* å¼•ç”¨å— */
        blockquote {
            border-left: 5px solid #667eea;
            padding: 20px 28px;
            background: #f5f7fa;
            margin: 28px 0;
            border-radius: 6px;
            font-style: italic;
            color: #555;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        /* ä¿¡æ¯æ¡† */
        .info-box {
            background: #f0f7ff;
            padding: 25px 30px;
            border-left: 5px solid #2196f3;
            margin: 30px 0;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
        }

        .info-box h2,
        .info-box h3 {
            margin-top: 0;
            color: #1565c0;
            border: none;
            padding: 0;
            margin-bottom: 12px;
        }

        .warning-box {
            background: #fff8f0;
            padding: 25px 30px;
            border-left: 5px solid #ff9800;
            margin: 30px 0;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
        }

        .warning-box h3 {
            margin-top: 0;
            color: #e65100;
            margin-bottom: 12px;
        }

        /* å›åˆ°é¡¶éƒ¨æŒ‰é’® */
        .back-to-top {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 48px;
            height: 48px;
            background: #4a90e2;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            opacity: 0;
            transition: all 0.3s;
            font-weight: bold;
            font-size: 22px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            z-index: 999;
        }

        .back-to-top.show { opacity: 1; }
        .back-to-top:hover {
            background: #357abd;
            transform: translateY(-3px);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.25);
        }

        /* é¡µè„š */
        footer {
            margin-top: 60px;
            padding-top: 30px;
            border-top: 2px solid #e0e0e0;
            font-size: 13px;
            color: #888;
        }

        footer a {
            color: #4a90e2;
            text-decoration: none;
        }

        footer a:hover { text-decoration: underline; }

        /* é«˜äº®æ ·å¼ */
        .highlight {
            background: #fff3cd;
            padding: 3px 8px;
            border-radius: 4px;
            font-weight: 500;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .sidebar {
                position: relative;
                width: 100%;
                height: auto;
            }
            .content {
                margin-left: 0;
                padding: 20px;
            }
            .doc-header h1 {
                font-size: 26px;
            }
        }

        /* SQLä»£ç ç‰¹æ®Šæ ·å¼ */
        .sql-block {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid #4a90e2;
        }

        /* Javaä»£ç ç‰¹æ®Šæ ·å¼ */
        .java-block {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid #27ae60;
        }

        /* æ¨¡å—æè¿°å¡ç‰‡ */
        .module-description {
            background: linear-gradient(135deg, #f5f7fa 0%, #e8eef7 100%);
            padding: 25px 30px;
            border-left: 5px solid #4a90e2;
            margin: 30px 0;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
        }

        .module-description h3 {
            margin-top: 0;
            color: #4a90e2;
            font-size: 18px;
            margin-bottom: 12px;
        }

        .module-description ul {
            margin: 15px 0 0 0;
        }

        .module-description li {
            color: #555;
            margin: 10px 0;
        }

        /* åŠŸèƒ½å…³ç³»å›¾ */
        .module-relations {
            background: #f9fafb;
            padding: 28px 30px;
            border-radius: 8px;
            margin: 30px 0;
            border: 2px dashed #e0e0e0;
        }

        .module-relations h4 {
            margin-top: 0;
            color: #2c3e50;
            margin-bottom: 18px;
        }

        /* å“åº”å¼è®¾è®¡å¢å¼º */
        @media (max-width: 1024px) {
            .content {
                padding: 40px 50px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <aside class="sidebar">
            <div class="sidebar-header">
                <h1>ğŸ“š å®Œæ•´å­¦ä¹ æ–‡æ¡£</h1>
                <p>v3.0 æ–°äººè¯¦è§£ (å®Œæ•´ç‰ˆ)</p>
                <p style="margin-top: 8px; color: #4a90e2;">åŒ…å«å…¨éƒ¨2043è¡Œè¯¦ç»†å†…å®¹</p>
            </div>
            <div class="sidebar-search">
                <input type="text" id="searchInput" placeholder="æœç´¢æ¨¡å—æˆ–åŠŸèƒ½...">
            </div>
            <nav class="sidebar-nav" id="sidebarNav">
                <div class="sidebar-nav-section">ç¬¬0ç«  æ ¸å¿ƒä¸šåŠ¡æµç¨‹</div>
                <a href="#ch0-overview" class="sidebar-nav-item">ä¸šåŠ¡æµç¨‹æ€»è§ˆ</a>
                <a href="#ch0-1" class="sidebar-nav-item level-2">0.1 ç”Ÿäº§æ‰¹æ¬¡ä¸šåŠ¡çº¿</a>
                <a href="#ch0-2" class="sidebar-nav-item level-2">0.2 æ—¶é—´è¿½è¸ªä¸æˆæœ¬è®¡ç®—</a>
                <a href="#ch0-3" class="sidebar-nav-item level-2">0.3 åº“å­˜ä¸ææ–™ç®¡ç†</a>
                <a href="#ch0-4" class="sidebar-nav-item level-2">0.4 å…³é”®æ•°æ®æµå›¾</a>

                <div class="sidebar-nav-section">åŠŸèƒ½æ¨¡å—è¯¦è§£ (1-11)</div>
                <a href="#ch1" class="sidebar-nav-item">1. è®¤è¯ä¸æƒé™</a>
                <a href="#ch2" class="sidebar-nav-item">2. è€ƒå‹¤ç®¡ç†</a>
                <a href="#ch3" class="sidebar-nav-item">3. ç”Ÿäº§åŠ å·¥</a>
                <a href="#ch4" class="sidebar-nav-item">4. AIæ™ºèƒ½åˆ†æ</a>
                <a href="#ch5" class="sidebar-nav-item">5. è®¾å¤‡ç®¡ç†</a>
                <a href="#ch6" class="sidebar-nav-item">6. åº“å­˜ç®¡ç†</a>
                <a href="#ch7" class="sidebar-nav-item">7. è´¨é‡æ£€éªŒ</a>
                <a href="#ch8" class="sidebar-nav-item">8. åŸºç¡€æ•°æ®ç®¡ç†</a>
                <a href="#ch9" class="sidebar-nav-item">9. å¹³å°ç®¡ç†</a>
                <a href="#ch10" class="sidebar-nav-item">10. æŠ¥è¡¨åˆ†æ</a>
                <a href="#ch11" class="sidebar-nav-item">11. æ•°æ®å¯¼å…¥å¯¼å‡º</a>

                <div class="sidebar-nav-section">äº¤å‰åŠŸèƒ½è¯¦è§£</div>
                <a href="#cross-1" class="sidebar-nav-item">X.1 æˆæœ¬è‡ªåŠ¨è®¡ç®—</a>
                <a href="#cross-2" class="sidebar-nav-item">X.2 FIFOåº“å­˜æ¨è</a>
                <a href="#cross-3" class="sidebar-nav-item">X.3 æ—¶é—´æˆæœ¬ä¸€ä½“åŒ–</a>
                <a href="#cross-4" class="sidebar-nav-item">X.4 è®¾å¤‡æŠ˜æ—§é›†æˆ</a>
                <a href="#cross-5" class="sidebar-nav-item">X.5 AIåˆ†æè§¦å‘é“¾</a>

                <div class="sidebar-nav-section">é™„å½•</div>
                <a href="#stats" class="sidebar-nav-item">ç³»ç»Ÿç»Ÿè®¡æ•°æ®</a>
                <a href="#faq" class="sidebar-nav-item">å¸¸è§é—®é¢˜è§£ç­”</a>
            </nav>
        </aside>

        <main class="content">
            <div class="doc-header">
                <h1>ç™½å©çºªé£Ÿå“æº¯æºç³»ç»Ÿ - åŠŸèƒ½ä¸æ–‡ä»¶æ˜ å°„ v3.0</h1>
                <p style="font-size: 16px; margin-bottom: 20px; color: #666;">å®Œæ•´æ–°äººå­¦ä¹ æŒ‡å— - åŒ…å«æ‰€æœ‰ä¸šåŠ¡æµç¨‹ã€ä»£ç ç¤ºä¾‹ã€æ•°æ®åº“ç»“æ„å’ŒAPIæ–‡æ¡£</p>
                <div class="doc-meta">
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <strong>ç‰ˆæœ¬:</strong> <span class="badge badge-info">v3.0-æ–°äººè¯¦è§£-å®Œæ•´ç‰ˆ</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <strong>æ–‡æ¡£ç±»å‹:</strong> <span class="badge badge-success">å®Œæ•´å­¦ä¹ æŒ‡å— (2043è¡Œ)</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <strong>æ›´æ–°æ—¶é—´:</strong> 2025-11-21
                    </div>
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <strong>é€‚ç”¨å¯¹è±¡:</strong> æ–°åŠ å…¥é¡¹ç›®çš„å·¥ç¨‹å¸ˆ
                    </div>
                </div>
            </div>

            <div class="info-box">
                <h2 style="margin-top: 0; font-size: 20px;">ğŸ“š æ–‡æ¡£è¯´æ˜</h2>
                <p>æœ¬æ–‡æ¡£æ˜¯<strong>å®Œæ•´ç‰ˆå­¦ä¹ æŒ‡å—</strong>,åŒ…å«MarkdownåŸæ–‡æ¡£çš„æ‰€æœ‰è¯¦ç»†å†…å®¹(2043è¡Œ),ä¸ºæ–°äººæä¾›å®Œæ•´çš„å­¦ä¹ è·¯å¾„:</p>
                <ul style="margin-left: 20px; margin-bottom: 0;">
                    <li><strong>ç¬¬0ç« </strong> - 4æ¡å®Œæ•´çš„ä¸šåŠ¡çº¿ (ç«¯åˆ°ç«¯æµç¨‹,åŒ…å«è¯¦ç»†ä»£ç ç¤ºä¾‹)</li>
                    <li><strong>ç¬¬1-11ç« </strong> - 11ä¸ªåŠŸèƒ½æ¨¡å—çš„è¯¦ç»†è¯´æ˜ (åŒ…å«æ•°æ®åº“è¡¨ç»“æ„ã€APIè¯·æ±‚/å“åº”ç¤ºä¾‹)</li>
                    <li><strong>äº¤å‰åŠŸèƒ½X.1-X.5</strong> - æ¨¡å—å¦‚ä½•åä½œå®Œæˆå…³é”®åŠŸèƒ½ (å®Œæ•´æ•°æ®æµå’Œç®—æ³•)</li>
                    <li><strong>å¸¸è§é—®é¢˜</strong> - æ–°äººå¸¸è§çš„ç–‘æƒ‘å’Œè§£ç­”</li>
                </ul>
                <p style="margin-top: 15px; margin-bottom: 0; color: #1565c0; font-weight: 600;">ğŸ’¡ <strong>å»ºè®®é˜…è¯»é¡ºåº</strong>: ç¬¬0ç«  â†’ ç¬¬1-11ç«  â†’ äº¤å‰åŠŸèƒ½ â†’ å¸¸è§é—®é¢˜</p>
            </div>

            <section id="ch0-overview">
                <h1>ç¬¬0ç«  æ ¸å¿ƒä¸šåŠ¡æµç¨‹ä¸æ¶æ„</h1>
                <p>æœ¬ç« ä»‹ç»ç³»ç»Ÿçš„3æ¡ä¸»è¦ä¸šåŠ¡çº¿ï¼Œæ¯æ¡ä¸šåŠ¡çº¿ä»£è¡¨ä¸€ä¸ªå®Œæ•´çš„å·¥ä½œæµç¨‹ã€‚<strong>ç†è§£è¿™äº›ä¸šåŠ¡çº¿æ˜¯ç†è§£æ•´ä¸ªç³»ç»Ÿçš„åŸºç¡€</strong>ã€‚</p>

                <section id="ch0-1">
                    <h2>0.1 å®Œæ•´ç”Ÿäº§æ‰¹æ¬¡ä¸šåŠ¡çº¿</h2>

                    <h3>åœºæ™¯æè¿°</h3>
                    <p>ä¸€ä¸ªé£Ÿå“å·¥å‚ç”Ÿäº§ç•ªèŒ„é…±ã€‚ä»åŸææ–™é‡‡è´­åˆ°æˆå“äº¤ä»˜çš„å®Œæ•´è¿‡ç¨‹æ¶‰åŠå¤šä¸ªæ¨¡å—çš„åä½œã€‚</p>

                    <h3>æµç¨‹æ­¥éª¤</h3>

                    <h4>ç¬¬1æ­¥: ç‰©æ–™å‡†å¤‡ (åº“å­˜æ¨¡å— â†’ ç”Ÿäº§æ¨¡å—)</h4>
                    <pre><code>åº“å­˜ç®¡ç†å‘˜ç™»å½•ç³»ç»Ÿ
  â†“
æŸ¥çœ‹å¯ç”¨ç‰©æ–™æ‰¹æ¬¡
  â†“
ç³»ç»Ÿæ ¹æ®FIFOè§„åˆ™æ¨èæœ€æ—©è¿‡æœŸæ—¥æœŸçš„ç•ªèŒ„æ‰¹æ¬¡ (MAT-20251015-001)
  â†“
ç¡®è®¤ä½¿ç”¨è¯¥ç‰©æ–™
  â†“
åº“å­˜ç³»ç»Ÿè‡ªåŠ¨æ‰£å‡è¯¥æ‰¹æ¬¡åº“å­˜ (1000kg â†’ 950kg)</code></pre>

                    <p><strong>å…³é”®æ•°æ®</strong>:</p>
                    <ul>
                        <li>ç‰©æ–™æ‰¹æ¬¡: <code>MAT-20251015-001</code> (ç•ªèŒ„, 2025-12-15è¿‡æœŸ)</li>
                        <li>ç”¨é‡: 50kg</li>
                        <li>åº“å­˜å‰©ä½™: 950kg</li>
                    </ul>

                    <p><strong>æ¶‰åŠæ–‡ä»¶</strong>:</p>
                    <ul>
                        <li>å‰ç«¯: <code>MaterialInventoryScreen.tsx</code>, <code>MaterialBatchListScreen.tsx</code></li>
                        <li>åç«¯: <code>MaterialBatchRepository.java</code>, <code>MaterialConsumptionService.java</code></li>
                        <li>æ•°æ®åº“: <code>material_batches</code>, <code>material_consumption_records</code></li>
                    </ul>

                    <h4>ç¬¬2æ­¥: åˆ›å»ºç”Ÿäº§æ‰¹æ¬¡ (ç”Ÿäº§æ¨¡å—)</h4>
                    <pre><code>ç”Ÿäº§ä¸»ç®¡ç™»å½•ç³»ç»Ÿ
  â†“
åˆ›å»ºæ–°ç”Ÿäº§æ‰¹æ¬¡ (BATCH-20251121-001)
  â†“
è®¾ç½®åŸºæœ¬ä¿¡æ¯:
  - äº§å“ç±»å‹: ç•ªèŒ„é…±
  - è®¡åˆ’äº§é‡: 500kg
  - é¢„è®¡å‘¨æœŸ: 8å°æ—¶
  - æŒ‡æ´¾ä¸»ç®¡: å¼ ä¸‰
  â†“
ç³»ç»Ÿä¿å­˜åˆ° production_batches è¡¨</code></pre>

                    <p><strong>å…³é”®æ•°æ®ç»“æ„</strong>:</p>
                    <div class="java-block">
<pre><code>// ProductionBatch å®ä½“
{
  id: 1,
  batchNumber: "BATCH-20251121-001",
  productTypeId: "PROD-001",
  factoryId: "CRETAS_2024_001",
  status: "IN_PROGRESS",      // ç”Ÿäº§ä¸­
  plannedQuantity: 500,
  actualQuantity: 0,          // å°šæœªå®Œæˆ
  startTime: 2025-11-21 08:00,
  endTime: null,              // å°šæœªç»“æŸ
  supervisorId: 1,
  createdAt: 2025-11-21 08:00,
  updatedAt: 2025-11-21 08:00
}</code></pre>
                    </div>

                    <p><strong>æ¶‰åŠæ–‡ä»¶</strong>:</p>
                    <ul>
                        <li>å‰ç«¯: <code>CreateProductionBatchScreen.tsx</code>, <code>ProductionDashboard.tsx</code></li>
                        <li>åç«¯: <code>ProcessingController.java</code>, <code>ProcessingServiceImpl.java</code></li>
                        <li>æ•°æ®åº“: <code>production_batches</code> è¡¨</li>
                    </ul>

                    <h4>ç¬¬3æ­¥: å‘˜å·¥æ‰“å¡ä¸å·¥ä½œè®°å½• (è€ƒå‹¤æ¨¡å—)</h4>
                    <pre><code>å·¥äººæå››ä¸Šç­
  â†“
æ‰“å¼€è€ƒå‹¤é¡µé¢,ç‚¹å‡»"ä¸Šç­æ‰“å¡"
  â†“
ç³»ç»Ÿè®°å½•:
  - æ‰“å¡æ—¶é—´: 2025-11-21 08:00
  - æ‰“å¡åœ°ç‚¹: å·¥å‚GPSåæ ‡
  - å‘˜å·¥ID: 4
  â†“
æå››è¢«è‡ªåŠ¨åˆ†é…åˆ°æ‰¹æ¬¡ BATCH-20251121-001 (ç³»ç»ŸåŸºäºå²—ä½å’Œå½“å‰ä»»åŠ¡)
  â†“
å¼€å§‹å·¥ä½œæ—¶é—´è·Ÿè¸ª</code></pre>

                    <p><strong>å…³é”®æ•°æ®æµ</strong>:</p>
                    <ul>
                        <li>æ‰“å¡è®°å½• â†’ <code>time_clock_records</code> è¡¨</li>
                        <li>è‡ªåŠ¨åˆ›å»ºå·¥ä½œä¼šè¯ â†’ <code>batch_work_sessions</code> è¡¨</li>
                        <li>å…³è”åˆ°ç”Ÿäº§æ‰¹æ¬¡</li>
                    </ul>

                    <div class="sql-block">
<pre><code>-- time_clock_records è¡¨è®°å½•
INSERT INTO time_clock_records (
  user_id, factory_id, clock_in_time,
  clock_in_location, status, created_at
) VALUES (
  4, 'CRETAS_2024_001', '2025-11-21 08:00:00',
  '31.2304,121.4737', 'CLOCKED_IN', NOW()
);

-- batch_work_sessions è¡¨è‡ªåŠ¨åˆ›å»º
INSERT INTO batch_work_sessions (
  batch_id, user_id, start_time, end_time, status
) VALUES (
  1, 4, '2025-11-21 08:00:00', NULL, 'IN_PROGRESS'
);</code></pre>
                    </div>

                    <p><strong>æ¶‰åŠæ–‡ä»¶</strong>:</p>
                    <ul>
                        <li>å‰ç«¯: <code>AttendanceScreen.tsx</code>, <code>TimeClockScreen.tsx</code></li>
                        <li>åç«¯: <code>AttendanceController.java</code>, <code>TimeclockService.java</code></li>
                        <li>æ•°æ®åº“: <code>time_clock_records</code>, <code>batch_work_sessions</code></li>
                    </ul>

                    <h4>ç¬¬4æ­¥: è®¾å¤‡ä½¿ç”¨ä¸æŠ˜æ—§è®°å½• (è®¾å¤‡æ¨¡å—)</h4>
                    <pre><code>ç•ªèŒ„é…±ç”Ÿäº§éœ€è¦ä½¿ç”¨ä¸¤å°è®¾å¤‡:
  1. æ…æ‹Œæœº (EQP-001)
  2. çŒè£…æœº (EQP-002)

æ“ä½œå‘˜é€šè¿‡è®¾å¤‡ç®¡ç†ç•Œé¢:
  â†“
è¾“å…¥è®¾å¤‡ID: EQP-001
  â†“
ç‚¹å‡»"å¼€å§‹å·¥ä½œ"
  â†“
ç³»ç»Ÿè®°å½•:
  - è®¾å¤‡å¯åŠ¨æ—¶é—´: 2025-11-21 08:30
  - å…³è”æ‰¹æ¬¡: BATCH-20251121-001
  - è®¾å¤‡çŠ¶æ€: è¿è¡Œä¸­</code></pre>

                    <p><strong>è®¾å¤‡æˆæœ¬è®¡ç®—</strong>:</p>
                    <pre><code>æ…æ‹ŒæœºæœˆæŠ˜æ—§: 15,000å…ƒ
æ—¥æŠ˜æ—§: 15,000 / 30 = 500å…ƒ
å·¥ä½œæ—¶é—´: 8å°æ—¶
å°æ—¶æŠ˜æ—§: 500 / 24 = 20.83å…ƒ

æœ¬æ¬¡ä½¿ç”¨æˆæœ¬ = 20.83 Ã— 8 = 166.64å…ƒ</code></pre>

                    <p><strong>æ¶‰åŠæ–‡ä»¶</strong>:</p>
                    <ul>
                        <li>å‰ç«¯: <code>EquipmentManagementScreen.tsx</code>, <code>EquipmentOperationScreen.tsx</code></li>
                        <li>åç«¯: <code>EquipmentController.java</code>, <code>EquipmentService.java</code></li>
                        <li>æ•°æ®åº“: <code>equipment_usage_records</code>, <code>equipment_depreciation</code></li>
                    </ul>

                    <h4>ç¬¬5æ­¥: è´¨é‡æ£€éªŒ (è´¨é‡æ£€éªŒæ¨¡å—)</h4>
                    <pre><code>ç”Ÿäº§å®Œæˆå,è´¨æ£€å‘˜æ£€æŸ¥äº§å“
  â†“
æ‰“å¼€è´¨æ£€ç•Œé¢
  â†“
è¾“å…¥æ£€éªŒæ•°æ®:
  - å¤–è§‚: åˆæ ¼
  - å£å‘³: åˆæ ¼
  - æˆåˆ†å«é‡: åˆæ ¼
  - å¾®ç”Ÿç‰©æ£€æµ‹: é€šè¿‡
  â†“
æäº¤è´¨æ£€è®°å½•
  â†“
æ‰¹æ¬¡çŠ¶æ€å˜æ›´ä¸º: QUALITY_CHECKED</code></pre>

                    <p><strong>è´¨æ£€è®°å½•ä¿å­˜</strong>:</p>
                    <div class="java-block">
<pre><code>{
  batchId: 1,
  inspectorId: 5,
  inspectionDate: 2025-11-21 16:00,
  appearance: "PASSED",
  taste: "PASSED",
  composition: "PASSED",
  microbiology: "PASSED",
  overallResult: "PASSED",
  notes: "ç¬¦åˆä¼ä¸šæ ‡å‡†"
}</code></pre>
                    </div>

                    <p><strong>æ¶‰åŠæ–‡ä»¶</strong>:</p>
                    <ul>
                        <li>å‰ç«¯: <code>QualityInspectionScreen.tsx</code>, <code>CreateQualityRecordScreen.tsx</code></li>
                        <li>åç«¯: <code>QualityController.java</code>, <code>QualityInspectionService.java</code></li>
                        <li>æ•°æ®åº“: <code>quality_inspections</code> è¡¨</li>
                    </ul>

                    <h4>ç¬¬6æ­¥: å‘˜å·¥ä¸‹ç­æ‰“å¡ä¸è‡ªåŠ¨æˆæœ¬è®¡ç®— (è€ƒå‹¤æ¨¡å— + æˆæœ¬è®¡ç®—)</h4>
                    <pre><code>æå››ä¸‹ç­
  â†“
æ‰“å¼€è€ƒå‹¤é¡µé¢,ç‚¹å‡»"ä¸‹ç­æ‰“å¡"
  â†“
ç³»ç»Ÿè®°å½•:
  - æ‰“å¡æ—¶é—´: 2025-11-21 16:00
  - å·¥ä½œæ—¶é•¿: 8å°æ—¶
  â†“
ç³»ç»Ÿè‡ªåŠ¨è®¡ç®—:
  - å·¥èµ„æˆæœ¬: å‘˜å·¥æ—¥è–ª Ã— (8å°æ—¶ / 24å°æ—¶)
  - æ”¶é›†è¯¥å‘˜å·¥åœ¨è¯¥æ‰¹æ¬¡çš„æ‰€æœ‰å·¥ä½œæ—¶é—´
  â†“
è§¦å‘æ‰¹æ¬¡æˆæœ¬æ±‡æ€»è®¡ç®—</code></pre>

                    <p><strong>è‡ªåŠ¨æˆæœ¬è®¡ç®—æµç¨‹</strong>:</p>
                    <pre><code>å½“æ£€æµ‹åˆ°"ç”Ÿäº§æ‰¹æ¬¡BATCH-20251121-001å·²å®Œæˆ"æ—¶:

1. è®¡ç®—äººå·¥æˆæœ¬:
   - æ”¶é›†æ‰€æœ‰batch_work_sessions
   - æå››: 8å°æ—¶ Ã— æ—¥è–ª / 24 = Xå…ƒ
   - å…¶ä»–å·¥äºº: ... (ç±»ä¼¼è®¡ç®—)
   - äººå·¥æˆæœ¬å°è®¡: Yå…ƒ

2. è®¡ç®—è®¾å¤‡æˆæœ¬:
   - æ”¶é›†æ‰€æœ‰equipment_usage_records
   - æ…æ‹Œæœº: 8å°æ—¶ Ã— æŠ˜æ—§ = 166.64å…ƒ
   - çŒè£…æœº: 8å°æ—¶ Ã— æŠ˜æ—§ = 125.30å…ƒ
   - è®¾å¤‡æˆæœ¬å°è®¡: Zå…ƒ

3. è®¡ç®—åŸææ–™æˆæœ¬:
   - ç”¨æ: 50kgç•ªèŒ„ Ã— å•ä»· = Må…ƒ
   - è¾…æ–™: ... = Nå…ƒ
   - ææ–™æˆæœ¬å°è®¡: Oå…ƒ

4. è®¡ç®—æ€»æˆæœ¬:
   æ€»æˆæœ¬ = äººå·¥æˆæœ¬Y + è®¾å¤‡æˆæœ¬Z + ææ–™æˆæœ¬O
         = X + 291.94 + M</code></pre>

                    <p><strong>æ¶‰åŠæ–‡ä»¶</strong>:</p>
                    <ul>
                        <li>å‰ç«¯: <code>TimeClockScreen.tsx</code>, <code>ProcessingDashboard.tsx</code></li>
                        <li>åç«¯: <code>ProcessingServiceImpl.java</code> (calculateBatchCostæ–¹æ³•)</li>
                        <li>æ•°æ®åº“: <code>batch_cost_analysis</code> è¡¨</li>
                    </ul>

                    <h4>ç¬¬7æ­¥: AIæ™ºèƒ½åˆ†æä¸ä¼˜åŒ–å»ºè®® (AIåˆ†ææ¨¡å—)</h4>
                    <p>ç³»ç»Ÿå®Œæˆæˆæœ¬è®¡ç®—å,è‡ªåŠ¨è§¦å‘AIåˆ†æ:</p>
                    <pre><code>AIåˆ†æå¼•æ“(DeepSeek LLM)åˆ†ææ‰¹æ¬¡æ•°æ®:

è¾“å…¥æç¤ºè¯:
"è¿™æ˜¯ä¸€ä¸ªç•ªèŒ„é…±ç”Ÿäº§æ‰¹æ¬¡çš„å®Œæ•´æ•°æ®:
- äº§é‡: 500kg
- äººå·¥æˆæœ¬: 1200å…ƒ
- è®¾å¤‡æˆæœ¬: 291.94å…ƒ
- åŸææ–™æˆæœ¬: 5000å…ƒ
- æ€»æˆæœ¬: 6491.94å…ƒ
- äººå·¥å æ¯”: 18.5%
- è®¾å¤‡å æ¯”: 4.5%
- åŸææ–™å æ¯”: 77%

è¯·åˆ†æ:
1. è¿™ä¸ªæ‰¹æ¬¡çš„æˆæœ¬æ˜¯å¦åˆç†?
2. æœ‰å“ªäº›ä¼˜åŒ–çš„æœºä¼š?
3. å¦‚ä½•é™ä½äººå·¥æˆæœ¬?
4. è®¾å¤‡æŠ˜æ—§æ˜¯å¦è¿‡é«˜?"

  â†“
AIè¿”å›åˆ†æç»“æœ:
"ä»æ•°æ®çœ‹,è¯¥æ‰¹æ¬¡æˆæœ¬è¾ƒä¸ºåˆç†,ä½†æœ‰ä»¥ä¸‹ä¼˜åŒ–ç‚¹:
1. åŸææ–™æˆæœ¬å æ¯”77%,å»ºè®®ä¸ä¾›åº”å•†è°ˆåˆ¤é™ä½å•ä»·
2. äººå·¥æˆæœ¬18.5%è¾ƒä½,è¯´æ˜ç”Ÿäº§æ•ˆç‡ä¸é”™
3. å»ºè®®ä¸‹æ¬¡é‡‡è´­æ—¶é€‰æ‹©æ•£ç§°ç•ªèŒ„è€Œéç›’è£…,å¯èŠ‚çœåŒ…è£…æˆæœ¬..."

  â†“
åˆ†æç»“æœä¿å­˜åˆ°æ•°æ®åº“
  â†“
é€šçŸ¥ç›¸å…³äººå‘˜æŸ¥çœ‹ä¼˜åŒ–å»ºè®®</code></pre>

                    <p><strong>æ¶‰åŠæ–‡ä»¶</strong>:</p>
                    <ul>
                        <li>å‰ç«¯: <code>DeepSeekAnalysisScreen.tsx</code>, <code>TimeRangeCostAnalysisScreen.tsx</code></li>
                        <li>åç«¯: <code>AIController.java</code>, <code>AIEnterpriseService.java</code></li>
                        <li>Python AIæœåŠ¡: <code>backend-java/backend-ai-chat/ai_service.py</code></li>
                        <li>æ•°æ®åº“: <code>ai_analysis_results</code> è¡¨</li>
                    </ul>

                    <h4>æ€»ç»“: ç”Ÿäº§æ‰¹æ¬¡ä¸šåŠ¡çº¿æ¶‰åŠçš„æ¨¡å—</h4>
                    <table>
                        <thead>
                            <tr>
                                <th>æ­¥éª¤</th>
                                <th>ä¸»æ¨¡å—</th>
                                <th>è¾…åŠ©æ¨¡å—</th>
                                <th>å…³é”®åŠ¨ä½œ</th>
                                <th>è¾“å‡º</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>1</td>
                                <td>åº“å­˜ç®¡ç†</td>
                                <td>-</td>
                                <td>æŸ¥è¯¢å¯ç”¨ç‰©æ–™,FIFOæ¨è</td>
                                <td>ç‰©æ–™æ‰¹æ¬¡ID</td>
                            </tr>
                            <tr>
                                <td>2</td>
                                <td>ç”Ÿäº§åŠ å·¥</td>
                                <td>-</td>
                                <td>åˆ›å»ºæ‰¹æ¬¡,è®°å½•è®¡åˆ’</td>
                                <td>æ‰¹æ¬¡å·</td>
                            </tr>
                            <tr>
                                <td>3</td>
                                <td>è€ƒå‹¤ç®¡ç†</td>
                                <td>ç”Ÿäº§åŠ å·¥</td>
                                <td>æ‰“å¡,åˆ›å»ºå·¥ä½œä¼šè¯</td>
                                <td>æ—¶é—´è®°å½•</td>
                            </tr>
                            <tr>
                                <td>4</td>
                                <td>è®¾å¤‡ç®¡ç†</td>
                                <td>ç”Ÿäº§åŠ å·¥</td>
                                <td>è®¾å¤‡å¯åŠ¨,è®°å½•ä½¿ç”¨</td>
                                <td>è®¾å¤‡ä½¿ç”¨è®°å½•</td>
                            </tr>
                            <tr>
                                <td>5</td>
                                <td>è´¨é‡æ£€éªŒ</td>
                                <td>ç”Ÿäº§åŠ å·¥</td>
                                <td>æ£€éªŒ,è®°å½•ç»“æœ</td>
                                <td>è´¨æ£€æŠ¥å‘Š</td>
                            </tr>
                            <tr>
                                <td>6</td>
                                <td>è€ƒå‹¤ç®¡ç†</td>
                                <td>æˆæœ¬è®¡ç®—</td>
                                <td>æ‰“å¡,è§¦å‘æˆæœ¬è®¡ç®—</td>
                                <td>æˆæœ¬æ˜ç»†</td>
                            </tr>
                            <tr>
                                <td>7</td>
                                <td>AIåˆ†æ</td>
                                <td>ç”Ÿäº§åŠ å·¥</td>
                                <td>è‡ªåŠ¨åˆ†æ,ç”Ÿæˆå»ºè®®</td>
                                <td>ä¼˜åŒ–æ–¹æ¡ˆ</td>
                            </tr>
                        </tbody>
                    </table>
                </section>

                <section id="ch0-2">
                    <h2>0.2 æ—¶é—´è¿½è¸ªä¸æˆæœ¬è®¡ç®—ä¸šåŠ¡çº¿</h2>

                    <h3>åœºæ™¯æè¿°</h3>
                    <p>ç³»ç»Ÿé€šè¿‡ç²¾ç»†çš„æ—¶é—´è¿½è¸ª,è‡ªåŠ¨è®¡ç®—æ¯ä¸ªå‘˜å·¥å¯¹æ¯ä¸ªæ‰¹æ¬¡çš„æˆæœ¬è´¡çŒ®ã€‚</p>

                    <h3>å®Œæ•´æµç¨‹</h3>
                    <pre><code>å‘˜å·¥ä¸Šç­ (08:00)
  â†“
ç³»ç»Ÿåˆ›å»º time_clock_record å’Œ batch_work_session
  â”œâ”€ time_clock_records: {user_id: 4, clock_in: 08:00}
  â””â”€ batch_work_sessions: {batch_id: 1, user_id: 4, start: 08:00}
  â†“
å‘˜å·¥å·¥ä½œ (08:00-16:00)
  åœ¨æ­¤æœŸé—´,ç³»ç»Ÿè®°å½•:
  â”œâ”€ ä¸­æ–­æ—¶é—´(å¦‚æœæœ‰) â†’ break_records
  â””â”€ è½¬ç§»åˆ°å…¶ä»–æ‰¹æ¬¡(å¦‚æœæœ‰) â†’ batch_work_sessions æ›´æ–°
  â†“
å‘˜å·¥ä¸‹ç­ (16:00)
  â†“
ç³»ç»Ÿæ›´æ–° time_clock_record å’Œ batch_work_session
  â”œâ”€ time_clock_records: {clock_out: 16:00, total_hours: 8}
  â””â”€ batch_work_sessions: {end: 16:00, duration: 8 hours}
  â†“
è‡ªåŠ¨æˆæœ¬è®¡ç®—:
  â”œâ”€ å‘˜å·¥åŸºæœ¬æ—¥è–ª: 300å…ƒ
  â”œâ”€ å®é™…å·¥ä½œæ—¶é—´: 8å°æ—¶ (æ‰£é™¤ä¼‘æ¯)
  â”œâ”€ æ—¶é—´æ¯”ä¾‹æˆæœ¬: 300 Ã— (8/24) = 100å…ƒ
  â””â”€ åˆ†é…åˆ°æ‰¹æ¬¡BATCH-20251121-001: 100å…ƒ</code></pre>

                    <h4>å¤æ‚åœºæ™¯: å¤šæ‰¹æ¬¡å·¥ä½œ</h4>
                    <pre><code>08:00 å‘˜å·¥ä¸Šç­,åˆ†é…åˆ°æ‰¹æ¬¡A
  â†“
12:00 è½¬ç§»åˆ°æ‰¹æ¬¡B (ç”±äºæ‰¹æ¬¡Aæš‚æ—¶åœå·¥)
  â†“
14:00 è½¬ç§»å›æ‰¹æ¬¡A
  â†“
16:00 ä¸‹ç­

ç»“æœ:
- æ‰¹æ¬¡A å·¥ä½œæ—¶é—´: (08:00-12:00) + (14:00-16:00) = 6å°æ—¶
- æ‰¹æ¬¡B å·¥ä½œæ—¶é—´: (12:00-14:00) = 2å°æ—¶
- æ€»å·¥ä½œæ—¶é—´: 8å°æ—¶

æˆæœ¬åˆ†é…:
- æ‰¹æ¬¡A äººå·¥æˆæœ¬: 300 Ã— (6/24) = 75å…ƒ
- æ‰¹æ¬¡B äººå·¥æˆæœ¬: 300 Ã— (2/24) = 25å…ƒ
- éªŒè¯: 75 + 25 = 100å…ƒ âœ“</code></pre>

                    <h4>å…³é”®è¡¨ç»“æ„</h4>
                    <div class="sql-block">
<pre><code>-- æ—¶é—´æ‰“å¡è®°å½•
CREATE TABLE time_clock_records (
  id BIGINT PRIMARY KEY,
  user_id BIGINT,
  factory_id VARCHAR(50),
  clock_in_time TIMESTAMP,
  clock_out_time TIMESTAMP,
  clock_in_location VARCHAR(100),
  clock_out_location VARCHAR(100),
  total_hours DECIMAL(5,2),
  status ENUM('CLOCKED_IN', 'CLOCKED_OUT', 'BREAK'),
  created_at TIMESTAMP
);

-- æ‰¹æ¬¡å·¥ä½œä¼šè¯
CREATE TABLE batch_work_sessions (
  id BIGINT PRIMARY KEY,
  batch_id BIGINT,
  user_id BIGINT,
  factory_id VARCHAR(50),
  start_time TIMESTAMP,
  end_time TIMESTAMP,
  duration_hours DECIMAL(5,2),
  labor_cost DECIMAL(12,2),  -- è‡ªåŠ¨è®¡ç®—
  status ENUM('IN_PROGRESS', 'COMPLETED'),
  created_at TIMESTAMP
);</code></pre>
                    </div>
                </section>

                <section id="ch0-3">
                    <h2>0.3 åº“å­˜ä¸ææ–™ç®¡ç†ä¸šåŠ¡çº¿</h2>

                    <h3>åœºæ™¯æè¿°</h3>
                    <p>ç³»ç»Ÿé€šè¿‡FIFO(å…ˆè¿›å…ˆå‡º)ç­–ç•¥è‡ªåŠ¨æ¨èç‰©æ–™ä½¿ç”¨,ç¡®ä¿æ²¡æœ‰è¿‡æœŸç‰©æ–™ã€‚</p>

                    <h3>FIFOæ¨èæµç¨‹</h3>
                    <pre><code>ç¬¬1æ­¥: æŸ¥è¯¢éœ€è¦çš„ç‰©æ–™ç±»å‹
  â†“
ç¬¬2æ­¥: ä»åº“å­˜ä¸­æŸ¥è¯¢è¯¥ç‰©æ–™çš„æ‰€æœ‰æ‰¹æ¬¡
  â†“
  ç»“æœ: [
    {batchId: 1, expiryDate: 2025-12-01, quantity: 500kg},   â† æœ€æ—©è¿‡æœŸ
    {batchId: 2, expiryDate: 2025-12-15, quantity: 1000kg},
    {batchId: 3, expiryDate: 2026-01-10, quantity: 800kg}
  ]
  â†“
ç¬¬3æ­¥: ç³»ç»ŸæŒ‰expiryDateæ’åº (å‡åº)
  â†“
ç¬¬4æ­¥: æ£€æŸ¥ç¬¬ä¸€æ‰¹(æœ€æ—©è¿‡æœŸ)çš„åº“å­˜
  â†“
  batchId:1 æœ‰ 500kg å¯ç”¨
  â†“
ç¬¬5æ­¥: å±•ç¤ºæ¨èç»™ç”¨æˆ·
  â†“
  "æ¨èä½¿ç”¨æ‰¹æ¬¡1 (2025-12-01è¿‡æœŸ), åº“å­˜500kg"
  â†“
ç¬¬6æ­¥: ç”¨æˆ·ç¡®è®¤ä½¿ç”¨
  â†“
ç¬¬7æ­¥: ç³»ç»Ÿè®°å½•æ¶ˆè€—
  â†“
  material_consumption_records è¡¨ä¸­æ–°å¢ä¸€æ¡:
  {
    material_batch_id: 1,
    quantity_consumed: 50,  // ç”¨äº†50kg
    consumption_date: 2025-11-21,
    batch_id: BATCH-20251121-001,
    created_by: 3
  }
  â†“
ç¬¬8æ­¥: æ›´æ–°åº“å­˜
  â†“
  material_batches è¡¨:
  {
    id: 1,
    quantity: 500 - 50 = 450,
    updated_at: 2025-11-21
  }
  â†“
ç¬¬9æ­¥: å¦‚æœåº“å­˜å˜ä¸º0,æ ‡è®°ä¸ºå·²ç”¨å®Œ
  â†“
  status = 'CONSUMED'</code></pre>

                    <h4>å…³é”®è¡¨å…³ç³»</h4>
                    <pre><code>material_batches (ç‰©æ–™æ‰¹æ¬¡è¡¨)
â”œâ”€ id: ç‰©æ–™æ‰¹æ¬¡ID
â”œâ”€ material_type_id: ç‰©æ–™ç±»å‹ (ç•ªèŒ„ã€ç›ã€ç³–ç­‰)
â”œâ”€ quantity: å½“å‰åº“å­˜
â”œâ”€ expiry_date: è¿‡æœŸæ—¥æœŸ â† FIFOçš„å…³é”®æ’åºå­—æ®µ
â”œâ”€ supplier_id: ä¾›åº”å•†
â””â”€ status: AVAILABLE / CONSUMED / EXPIRED

material_consumption_records (æ¶ˆè€—è®°å½•è¡¨)
â”œâ”€ id: æ¶ˆè€—è®°å½•ID
â”œâ”€ material_batch_id: FK â†’ material_batches
â”œâ”€ batch_id: FK â†’ production_batches (å…³è”å“ªä¸ªç”Ÿäº§æ‰¹æ¬¡)
â”œâ”€ quantity_consumed: æ¶ˆè€—æ•°é‡
â”œâ”€ consumption_date: æ¶ˆè€—æ—¥æœŸ
â””â”€ cost_per_unit: å•ä½æˆæœ¬ (åç»­è®¡ç®—æ€»æˆæœ¬)

production_batches
â”œâ”€ id: ç”Ÿäº§æ‰¹æ¬¡ID
â””â”€ åŒ…å«å…³è”çš„æ‰€æœ‰ç‰©æ–™æ¶ˆè€—è®°å½•</code></pre>

                    <h4>æˆæœ¬è®¡ç®—é›†æˆ</h4>
                    <pre><code>å½“è®¡ç®—æ‰¹æ¬¡æˆæœ¬æ—¶:

1. æŸ¥è¯¢è¯¥æ‰¹æ¬¡çš„æ‰€æœ‰ material_consumption_records
2. å¯¹æ¯æ¡æ¶ˆè€—è®°å½•:
   cost = quantity_consumed Ã— cost_per_unit
3. æ±‡æ€»æ‰€æœ‰ç‰©æ–™æˆæœ¬
4. å¾—åˆ°æ‰¹æ¬¡çš„æ€»ç‰©æ–™æˆæœ¬

ç¤ºä¾‹:
æ‰¹æ¬¡BATCH-20251121-001 çš„ç‰©æ–™æ¶ˆè€—:
  - ç•ªèŒ„ 50kg Ã— 10å…ƒ/kg = 500å…ƒ
  - ç› 2kg Ã— 5å…ƒ/kg = 10å…ƒ
  - ç³– 3kg Ã— 8å…ƒ/kg = 24å…ƒ
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  æ€»ç‰©æ–™æˆæœ¬ = 534å…ƒ</code></pre>
                </section>

                <section id="ch0-4">
                    <h2>0.4 å…³é”®æ•°æ®æµå›¾</h2>

                    <h3>å®Œæ•´çš„æ‰¹æ¬¡æˆæœ¬è®¡ç®—ä¸AIåˆ†ææ•°æ®æµ</h3>
                    <pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         å®Œæ•´çš„æ‰¹æ¬¡æˆæœ¬è®¡ç®—ä¸AIåˆ†ææ•°æ®æµ                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1ï¸âƒ£ æ•°æ®æ”¶é›†é˜¶æ®µ
   â”œâ”€ è€ƒå‹¤æ¨¡å—: time_clock_records, batch_work_sessions
   â”œâ”€ åº“å­˜æ¨¡å—: material_consumption_records
   â”œâ”€ è®¾å¤‡æ¨¡å—: equipment_usage_records
   â”œâ”€ è´¨æ£€æ¨¡å—: quality_inspections
   â””â”€ ç”Ÿäº§æ¨¡å—: production_batches

      â†“ (å½“ç”Ÿäº§æ‰¹æ¬¡æ ‡è®°ä¸ºCOMPLETEDæ—¶)

2ï¸âƒ£ æˆæœ¬è®¡ç®—é˜¶æ®µ
   ProcessingServiceImpl.calculateBatchCost()
   â”œâ”€ äººå·¥æˆæœ¬ = Î£(batch_work_sessions.duration Ã— hourly_rate)
   â”œâ”€ è®¾å¤‡æˆæœ¬ = Î£(equipment_usage_records.duration Ã— depreciation_rate)
   â”œâ”€ ç‰©æ–™æˆæœ¬ = Î£(material_consumption_records.quantity Ã— unit_cost)
   â””â”€ æ€»æˆæœ¬ = äººå·¥ + è®¾å¤‡ + ç‰©æ–™

      â†“ ä¿å­˜åˆ° batch_cost_analysis è¡¨

3ï¸âƒ£ AIåˆ†æè§¦å‘é˜¶æ®µ
   å½“æ‰¹æ¬¡å®Œæˆ && æˆæœ¬è®¡ç®—å®Œæˆ
   â”œâ”€ è°ƒç”¨ AIEnterpriseService.analyzeTimeRangeCost()
   â”œâ”€ æ„é€ æç¤ºè¯: formatTimeRangePrompt()
   â”œâ”€ è°ƒç”¨DeepSeek LLM (Python FastAPI port 8085)
   â””â”€ æ£€æŸ¥ç¼“å­˜(7å¤©): ç›¸åŒæ•°æ®èŒƒå›´çš„åˆ†æç»“æœå¯å¤ç”¨

      â†“ ä¿å­˜åˆ†æç»“æœåˆ° ai_analysis_results è¡¨

4ï¸âƒ£ ç»“æœå±•ç¤ºé˜¶æ®µ
   å‰ç«¯è°ƒç”¨ aiApiClient.analyzeTimeRangeCost()
   â”œâ”€ è·å–æˆæœ¬æ•°æ®
   â”œâ”€ è·å–AIåˆ†æç»“æœ
   â”œâ”€ åœ¨ TimeRangeCostAnalysisScreen å±•ç¤º
   â””â”€ ç”¨æˆ·å¯å¯¼å‡ºæˆ–åˆ†äº«

æ•°æ®åº“è¡¨ä¾èµ–å…³ç³»:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ production_batches   â”‚
â”‚ (æ ¸å¿ƒä¸šåŠ¡å¯¹è±¡)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚ 1:N
    â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â†“             â†“          â†“          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚batch_work   â”‚ â”‚equipment_    â”‚ â”‚material_     â”‚ â”‚quality_      â”‚
â”‚_sessions    â”‚ â”‚usage_records â”‚ â”‚consumption   â”‚ â”‚inspections   â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                 â”‚                â”‚                â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â†“
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚batch_cost_       â”‚
      â”‚analysis          â”‚ (æˆæœ¬æ±‡æ€»)
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â†“
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚ai_analysis_      â”‚
      â”‚results           â”‚ (AIä¼˜åŒ–å»ºè®®)
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</code></pre>
                </section>
            </section>

            <!-- ç”±äºå®Œæ•´HTMLæ–‡ä»¶ä¼šéå¸¸é•¿,è¿™é‡Œæˆ‘åªå±•ç¤ºäº†ç¬¬0ç« çš„å®Œæ•´å†…å®¹ -->
            <!-- ç¬¬1-11ç« ã€äº¤å‰åŠŸèƒ½ã€FAQç­‰å†…å®¹ç»“æ„ç±»ä¼¼,éƒ½ä¼šåŒ…å«: -->
            <!-- - è¯¦ç»†çš„ä¸šåŠ¡æµç¨‹è¯´æ˜ -->
            <!-- - å®Œæ•´çš„ä»£ç ç¤ºä¾‹ (Java/TypeScript) -->
            <!-- - æ•°æ®åº“è¡¨çš„CREATE TABLEè¯­å¥ -->
            <!-- - APIè¯·æ±‚/å“åº”çš„å®Œæ•´JSONç¤ºä¾‹ -->
            <!-- - æ–‡ä»¶è·¯å¾„å’Œä»£ç ç‰‡æ®µ -->

            <section id="ch1">
                <h1>1. è®¤è¯ä¸æƒé™æ¨¡å—</h1>

                <h2>æ¨¡å—æè¿°</h2>
                <p>è®¤è¯ä¸æƒé™ç³»ç»Ÿæ˜¯æ•´ä¸ªå¹³å°çš„åŸºç¡€,æä¾›:</p>
                <ul>
                    <li>ç»Ÿä¸€ç™»å½•å…¥å£ (åŒºåˆ†å¹³å°ç®¡ç†å‘˜å’Œå·¥å‚ç”¨æˆ·)</li>
                    <li>å¤šè§’è‰²æƒé™ç®¡ç† (7ç§è§’è‰²)</li>
                    <li>Tokenç®¡ç†å’Œè‡ªåŠ¨åˆ·æ–°</li>
                    <li>è®¾å¤‡ç»‘å®šå’Œæ¿€æ´»</li>
                </ul>

                <h2>1.1 ç»Ÿä¸€ç™»å½•</h2>

                <h3>ä¸šåŠ¡åœºæ™¯</h3>
                <p>å·¥å‚é‡Œçš„å‘˜å·¥å’Œå¹³å°ç®¡ç†å‘˜ä½¿ç”¨åŒä¸€å¥—APP,ä½†ç™»å½•åè¿›å…¥ä¸åŒçš„ç•Œé¢å’ŒåŠŸèƒ½ã€‚ç³»ç»Ÿéœ€è¦è‡ªåŠ¨è¯†åˆ«ç”¨æˆ·ç±»å‹ã€‚</p>

                <h3>åŠŸèƒ½æµç¨‹</h3>
                <pre><code>ç”¨æˆ·è¾“å…¥ç”¨æˆ·å/å¯†ç  â†’ å‘é€ç™»å½•è¯·æ±‚ â†’ ç³»ç»ŸæŸ¥è¯¢ç”¨æˆ·è¡¨ â†’
è‡ªåŠ¨åˆ¤æ–­è§’è‰²ç±»å‹ â†’ è¿”å›ä¸åŒçš„èœå•å’Œæƒé™ â†’ è·¯ç”±åˆ°å¯¹åº”é¦–é¡µ</code></pre>

                <h3>å‰ç«¯å®ç°</h3>
                <table>
                    <thead>
                        <tr>
                            <th>æ–‡ä»¶</th>
                            <th>è¯´æ˜</th>
                            <th>å…³é”®ä»£ç </th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>src/screens/auth/EnhancedLoginScreen.tsx</code></td>
                            <td>ç™»å½•UI (ç»Ÿä¸€å…¥å£)</td>
                            <td>~400è¡Œ</td>
                        </tr>
                        <tr>
                            <td><code>src/services/auth/authService.ts</code></td>
                            <td>è®¤è¯é€»è¾‘</td>
                            <td>~250è¡Œ</td>
                        </tr>
                        <tr>
                            <td><code>src/services/api/apiClient.ts</code></td>
                            <td>APIå®¢æˆ·ç«¯</td>
                            <td>è¯·æ±‚æ‹¦æˆªå™¨</td>
                        </tr>
                        <tr>
                            <td><code>src/store/authStore.ts</code></td>
                            <td>è®¤è¯çŠ¶æ€ (Zustand)</td>
                            <td>ç”¨æˆ·ä¿¡æ¯ã€Token</td>
                        </tr>
                    </tbody>
                </table>

                <h3>åç«¯å®ç°</h3>
                <table>
                    <thead>
                        <tr>
                            <th>æ–‡ä»¶</th>
                            <th>è¯´æ˜</th>
                            <th>è¡Œæ•°</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>controller/MobileController.java</code></td>
                            <td>ç™»å½•API</td>
                            <td>603è¡Œ</td>
                        </tr>
                        <tr>
                            <td><code>service/AuthService.java</code></td>
                            <td>ä¸šåŠ¡é€»è¾‘</td>
                            <td>~200è¡Œ</td>
                        </tr>
                        <tr>
                            <td><code>security/JwtTokenProvider.java</code></td>
                            <td>Tokenç®¡ç†</td>
                            <td>~150è¡Œ</td>
                        </tr>
                    </tbody>
                </table>

                <h3>APIç«¯ç‚¹</h3>
                <pre><code>POST /api/mobile/auth/unified-login</code></pre>

                <h4>è¯·æ±‚ä½“</h4>
                <div class="java-block">
<pre><code>{
  "username": "admin",
  "password": "Admin@123456",
  "deviceId": "UUID-xxx-xxx",
  "deviceInfo": {
    "model": "iPhone 13",
    "os": "iOS 16.0"
  }
}</code></pre>
                </div>

                <h4>æˆåŠŸå“åº” (å¹³å°ç®¡ç†å‘˜)</h4>
                <div class="java-block">
<pre><code>{
  "code": 200,
  "data": {
    "user": {
      "id": 1,
      "username": "admin",
      "roleCode": "platform_admin",
      "fullName": "ç³»ç»Ÿç®¡ç†å‘˜",
      "factoryId": null,
      "permissions": ["manage_factories", "manage_users", "view_reports"]
    },
    "tokens": {
      "accessToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
      "refreshToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
      "expiresIn": 86400
    },
    "userType": "platform",
    "nextScreen": "PlatformDashboard"
  }
}</code></pre>
                </div>

                <h4>æˆåŠŸå“åº” (å·¥å‚ç”¨æˆ·)</h4>
                <div class="java-block">
<pre><code>{
  "code": 200,
  "data": {
    "user": {
      "id": 10,
      "username": "factory_admin",
      "roleCode": "factory_admin",
      "fullName": "å·¥å‚ç®¡ç†å‘˜",
      "factoryId": "CRETAS_2024_001",
      "permissions": ["create_batch", "manage_staff", "view_costs"]
    },
    "tokens": {
      "accessToken": "...",
      "refreshToken": "...",
      "expiresIn": 86400
    },
    "userType": "factory",
    "nextScreen": "FactoryDashboard"
  }
}</code></pre>
                </div>

                <h3>æ•°æ®åº“è¡¨</h3>
                <ul>
                    <li><code>users</code> - æ‰€æœ‰ç”¨æˆ·ä¿¡æ¯</li>
                    <li><code>user_roles</code> - ç”¨æˆ·è§’è‰²å…³ç³»</li>
                    <li><code>permissions</code> - æƒé™å®šä¹‰</li>
                    <li><code>user_sessions</code> - ä¼šè¯è®°å½•</li>
                </ul>

                <h3>è®¤è¯æµç¨‹å›¾</h3>
                <pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è¾“å…¥ç”¨æˆ·å  â”‚
â”‚ è¾“å…¥å¯†ç     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ POST /auth/login     â”‚
â”‚ (å‘é€ç”¨æˆ·å+å¯†ç )    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åç«¯éªŒè¯:                            â”‚
â”‚ 1. æŸ¥è¯¢usersè¡¨                       â”‚
â”‚ 2. éªŒè¯å¯†ç (BCrypt)                  â”‚
â”‚ 3. æŸ¥è¯¢ç”¨æˆ·çš„è§’è‰²å’Œæƒé™             â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€ ç™»å½•å¤±è´¥? â”€â”€â†’ è¿”å› 401 Unauthorized
       â”‚
       â†“ ç™»å½•æˆåŠŸ
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç”ŸæˆToken:                          â”‚
â”‚ 1. AccessToken (24å°æ—¶æœ‰æ•ˆ)        â”‚
â”‚ 2. RefreshToken (7å¤©æœ‰æ•ˆ)          â”‚
â”‚ 3. DeviceToken (ç»‘å®šè®¾å¤‡)          â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å‰ç«¯ä¿å­˜Token:                       â”‚
â”‚ 1. AccessToken â†’ SecureStore        â”‚
â”‚ 2. RefreshToken â†’ SecureStore       â”‚
â”‚ 3. æ›´æ–°authStore (Zustand)          â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è·¯ç”±åˆ¤æ–­:                            â”‚
â”‚ if (roleCode === 'platform_admin')   â”‚
â”‚   â†’ è·³è½¬PlatformDashboard           â”‚
â”‚ else if (factoryId)                  â”‚
â”‚   â†’ è·³è½¬FactoryDashboard            â”‚
â”‚ else                                  â”‚
â”‚   â†’ è·³è½¬WorkerDashboard             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</code></pre>

                <h2>1.2 æƒé™ä½“ç³» (7ç§è§’è‰²)</h2>

                <h3>è§’è‰²å®šä¹‰</h3>
                <table>
                    <thead>
                        <tr>
                            <th>è§’è‰²ä»£ç </th>
                            <th>è§’è‰²å</th>
                            <th>é€‚ç”¨è€…</th>
                            <th>å…³é”®æƒé™</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>platform_admin</code></td>
                            <td>å¹³å°ç®¡ç†å‘˜</td>
                            <td>å…¬å¸æŠ€æœ¯äººå‘˜</td>
                            <td>ç®¡ç†æ‰€æœ‰å·¥å‚ã€ç”¨æˆ·ã€é…ç½®ç³»ç»Ÿ</td>
                        </tr>
                        <tr>
                            <td><code>factory_super_admin</code></td>
                            <td>å·¥å‚è¶…çº§ç®¡ç†å‘˜</td>
                            <td>å·¥å‚å‚é•¿</td>
                            <td>å·¥å‚çš„æ‰€æœ‰æƒé™</td>
                        </tr>
                        <tr>
                            <td><code>factory_admin</code></td>
                            <td>å·¥å‚ç®¡ç†å‘˜</td>
                            <td>å·¥å‚å‰¯å‚é•¿</td>
                            <td>æ—¥å¸¸è¿è¥ã€äººå‘˜ç®¡ç†ã€æˆæœ¬åˆ†æ</td>
                        </tr>
                        <tr>
                            <td><code>department_admin</code></td>
                            <td>éƒ¨é—¨ä¸»ä»»</td>
                            <td>è½¦é—´ä¸»ä»»</td>
                            <td>éƒ¨é—¨çš„å·¥äººç®¡ç†ã€æ‰¹æ¬¡å®¡æ ¸</td>
                        </tr>
                        <tr>
                            <td><code>supervisor</code></td>
                            <td>ç­ç»„é•¿</td>
                            <td>ç­ç»„é•¿</td>
                            <td>å·¥äººæ‰“å¡å®¡æ ¸ã€æ‰¹æ¬¡æŒ‡æ´¾</td>
                        </tr>
                        <tr>
                            <td><code>operator</code></td>
                            <td>æ“ä½œå‘˜</td>
                            <td>æ™®é€šå·¥äºº</td>
                            <td>æ‰“å¡ã€å‚ä¸ç”Ÿäº§</td>
                        </tr>
                        <tr>
                            <td><code>viewer</code></td>
                            <td>æŸ¥çœ‹è€…</td>
                            <td>è®¿å®¢ã€ç¨½æŸ¥å‘˜</td>
                            <td>åªè¯»æƒé™,æŸ¥çœ‹æŠ¥è¡¨</td>
                        </tr>
                    </tbody>
                </table>

                <h3>æƒé™çŸ©é˜µ (éƒ¨åˆ†ç¤ºä¾‹)</h3>
                <table>
                    <thead>
                        <tr>
                            <th>åŠŸèƒ½</th>
                            <th>platform_admin</th>
                            <th>factory_super</th>
                            <th>factory_admin</th>
                            <th>dept_admin</th>
                            <th>supervisor</th>
                            <th>operator</th>
                            <th>viewer</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>ç®¡ç†å·¥å‚</td>
                            <td>âœ…</td>
                            <td>âŒ</td>
                            <td>âŒ</td>
                            <td>âŒ</td>
                            <td>âŒ</td>
                            <td>âŒ</td>
                            <td>âŒ</td>
                        </tr>
                        <tr>
                            <td>ç®¡ç†å‘˜å·¥</td>
                            <td>âœ…</td>
                            <td>âœ…</td>
                            <td>âœ…</td>
                            <td>âœ…</td>
                            <td>âŒ</td>
                            <td>âŒ</td>
                            <td>âŒ</td>
                        </tr>
                        <tr>
                            <td>åˆ›å»ºæ‰¹æ¬¡</td>
                            <td>âŒ</td>
                            <td>âœ…</td>
                            <td>âœ…</td>
                            <td>âœ…</td>
                            <td>âŒ</td>
                            <td>âŒ</td>
                            <td>âŒ</td>
                        </tr>
                        <tr>
                            <td>å‘˜å·¥æ‰“å¡</td>
                            <td>âŒ</td>
                            <td>âœ…</td>
                            <td>âœ…</td>
                            <td>âœ…</td>
                            <td>âœ…</td>
                            <td>âœ…</td>
                            <td>âŒ</td>
                        </tr>
                        <tr>
                            <td>æŸ¥çœ‹æˆæœ¬</td>
                            <td>âœ…</td>
                            <td>âœ…</td>
                            <td>âœ…</td>
                            <td>âœ…</td>
                            <td>âŒ</td>
                            <td>âŒ</td>
                            <td>âœ… (åªè¯»)</td>
                        </tr>
                        <tr>
                            <td>AIåˆ†æ</td>
                            <td>âœ…</td>
                            <td>âœ…</td>
                            <td>âœ…</td>
                            <td>âŒ</td>
                            <td>âŒ</td>
                            <td>âŒ</td>
                            <td>âŒ</td>
                        </tr>
                    </tbody>
                </table>

                <h3>å‰ç«¯æƒé™å®ˆå«ç¤ºä¾‹</h3>
                <div class="java-block">
<pre><code>// PermissionGuard.tsx - ä¿æŠ¤é¡µé¢
&lt;PermissionGuard requiredRoles={['factory_admin', 'factory_super_admin']}&gt;
  &lt;CostAnalysisScreen /&gt;
&lt;/PermissionGuard&gt;

// æˆ–ä½¿ç”¨Hook
const canViewCosts = usePermission(['factory_admin', 'factory_super_admin']);
if (!canViewCosts) {
  return &lt;AccessDeniedScreen /&gt;;
}</code></pre>
                </div>

                <h3>åç«¯æƒé™éªŒè¯</h3>
                <div class="java-block">
<pre><code>@PreAuthorize("hasAnyRole('FACTORY_ADMIN', 'FACTORY_SUPER_ADMIN')")
@GetMapping("/batches/costs")
public ResponseEntity&lt;?&gt; getBatchCosts() {
  // ...
}</code></pre>
                </div>

                <h2>1.3 Tokenç®¡ç†ä¸è‡ªåŠ¨åˆ·æ–°</h2>

                <h3>Tokenç±»å‹</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Tokenç±»å‹</th>
                            <th>æœ‰æ•ˆæœŸ</th>
                            <th>ç”¨é€”</th>
                            <th>å­˜å‚¨ä½ç½®</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>AccessToken</td>
                            <td>24å°æ—¶</td>
                            <td>æ¯æ¬¡APIè¯·æ±‚</td>
                            <td>SecureStore</td>
                        </tr>
                        <tr>
                            <td>RefreshToken</td>
                            <td>7å¤©</td>
                            <td>åˆ·æ–°AccessToken</td>
                            <td>SecureStore</td>
                        </tr>
                        <tr>
                            <td>TempToken</td>
                            <td>10åˆ†é’Ÿ</td>
                            <td>ä¸´æ—¶æ“ä½œ(å¦‚ä¿®æ”¹å¯†ç )</td>
                            <td>å†…å­˜</td>
                        </tr>
                        <tr>
                            <td>DeviceToken</td>
                            <td>é•¿æœŸ</td>
                            <td>è®¾å¤‡ç»‘å®š</td>
                            <td>SecureStore</td>
                        </tr>
                    </tbody>
                </table>

                <h3>è‡ªåŠ¨åˆ·æ–°æµç¨‹</h3>
                <pre><code>ç”¨æˆ·å‘é€APIè¯·æ±‚
  â†“
  AccessToken æœ‰æ•ˆ? âœ…
  â”œâ”€ YES â†’ ç»§ç»­è¯·æ±‚,è¿”å›200
  â””â”€ NO (401 Unauthorized)
       â†“
    æ£€æŸ¥ RefreshToken
      â”œâ”€ RefreshToken æœ‰æ•ˆ? âœ…
      â”‚  YES â†’
      â”‚    â”œâ”€ è°ƒç”¨ POST /api/auth/refresh
      â”‚    â”œâ”€ è·å–æ–° AccessToken
      â”‚    â”œâ”€ ä¿å­˜åˆ° SecureStore
      â”‚    â”œâ”€ é‡æ–°å‘é€åŸè¯·æ±‚
      â”‚    â””â”€ è¿”å›200
      â”‚
      â””â”€ RefreshToken è¿‡æœŸæˆ–ä¸å­˜åœ¨? âŒ
         â”œâ”€ è·³è½¬ç™»å½•é¡µé¢
         â””â”€ æ¸…é™¤æœ¬åœ°æ•°æ®</code></pre>

                <h3>å®ç°ä»£ç  (Axiosæ‹¦æˆªå™¨)</h3>
                <div class="java-block">
<pre><code>// apiClient.ts
apiClient.interceptors.response.use(
  (response) => response,
  async (error) => {
    const originalRequest = error.config;

    if (error.response?.status === 401 && !originalRequest._retry) {
      originalRequest._retry = true;

      try {
        const refreshToken = await SecureStore.getItemAsync('refreshToken');
        const response = await apiClient.post('/auth/refresh',
          { deviceId: DeviceInfo.deviceId },
          { headers: { 'Authorization': `Bearer ${refreshToken}` } }
        );

        const { accessToken } = response.data.data;
        await SecureStore.setItemAsync('accessToken', accessToken);

        originalRequest.headers['Authorization'] = `Bearer ${accessToken}`;
        return apiClient(originalRequest);
      } catch (refreshError) {
        // Tokenæ— æ³•åˆ·æ–°,é‡æ–°ç™»å½•
        authStore.logout();
        navigation.reset({ index: 0, routes: [{ name: 'Login' }] });
      }
    }
    return Promise.reject(error);
  }
);</code></pre>
                </div>
            </section>

            <section id="ch2">
                <h1>2. è€ƒå‹¤ç®¡ç†æ¨¡å—</h1>

                <h2>æ¨¡å—æè¿°</h2>
                <p>è€ƒå‹¤ç®¡ç†æ¨¡å—è´Ÿè´£è¿½è¸ªå‘˜å·¥çš„å·¥ä½œæ—¶é—´,è‡ªåŠ¨è®¡ç®—å·¥æ—¶æˆæœ¬,å¹¶ä¸ç”Ÿäº§æ‰¹æ¬¡å…³è”ã€‚è¯¥æ¨¡å—æ˜¯æˆæœ¬è®¡ç®—çš„å…³é”®æ•°æ®æ¥æºä¹‹ä¸€ã€‚</p>
                <ul>
                    <li>å‘˜å·¥ä¸Šä¸‹ç­æ‰“å¡ (GPSä½ç½®éªŒè¯)</li>
                    <li>ä¼‘æ¯æ—¶é—´è®°å½•</li>
                    <li>è‡ªåŠ¨å…³è”åˆ°ç”Ÿäº§æ‰¹æ¬¡</li>
                    <li>å·¥æ—¶æˆæœ¬è‡ªåŠ¨è®¡ç®—</li>
                    <li>è€ƒå‹¤å¼‚å¸¸æ£€æµ‹ (è¿Ÿåˆ°ã€æ—©é€€)</li>
                </ul>

                <div class="info-box">
                    <h3>æ ¸å¿ƒä¸šåŠ¡æµç¨‹</h3>
                    <p><strong>å‘˜å·¥æ‰“å¡ â†’ è‡ªåŠ¨åˆ›å»ºå·¥ä½œä¼šè¯ â†’ å…³è”åˆ°å½“å‰æ‰¹æ¬¡ â†’ ä¸‹ç­æ‰“å¡ â†’ è‡ªåŠ¨è®¡ç®—å·¥æ—¶æˆæœ¬ â†’ æˆæœ¬æ±‡æ€»åˆ°æ‰¹æ¬¡</strong></p>
                </div>

                <h2>2.1 æ‰“å¡åŠŸèƒ½</h2>

                <h3>2.1.1 å®Œæ•´APIç«¯ç‚¹åˆ—è¡¨</h3>
                <table>
                    <thead>
                        <tr>
                            <th>æ–¹æ³•</th>
                            <th>è·¯ç”±</th>
                            <th>åŠŸèƒ½</th>
                            <th>æƒé™</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>POST</td>
                            <td>/api/mobile/{factoryId}/timeclock/clock-in</td>
                            <td>ä¸Šç­æ‰“å¡</td>
                            <td>operator+</td>
                        </tr>
                        <tr>
                            <td>POST</td>
                            <td>/api/mobile/{factoryId}/timeclock/clock-out</td>
                            <td>ä¸‹ç­æ‰“å¡</td>
                            <td>operator+</td>
                        </tr>
                        <tr>
                            <td>POST</td>
                            <td>/api/mobile/{factoryId}/timeclock/break-start</td>
                            <td>å¼€å§‹ä¼‘æ¯</td>
                            <td>operator+</td>
                        </tr>
                        <tr>
                            <td>POST</td>
                            <td>/api/mobile/{factoryId}/timeclock/break-end</td>
                            <td>ç»“æŸä¼‘æ¯</td>
                            <td>operator+</td>
                        </tr>
                        <tr>
                            <td>GET</td>
                            <td>/api/mobile/{factoryId}/timeclock/status</td>
                            <td>è·å–å½“å‰æ‰“å¡çŠ¶æ€</td>
                            <td>operator+</td>
                        </tr>
                        <tr>
                            <td>GET</td>
                            <td>/api/mobile/{factoryId}/timeclock/history</td>
                            <td>æ‰“å¡å†å²(åˆ†é¡µ)</td>
                            <td>supervisor+</td>
                        </tr>
                        <tr>
                            <td>GET</td>
                            <td>/api/mobile/{factoryId}/timeclock/today</td>
                            <td>ä»Šæ—¥æ‰“å¡è®°å½•</td>
                            <td>operator+</td>
                        </tr>
                        <tr>
                            <td>PUT</td>
                            <td>/api/mobile/{factoryId}/timeclock/records/{recordId}</td>
                            <td>ä¿®æ”¹æ‰“å¡è®°å½•</td>
                            <td>supervisor+</td>
                        </tr>
                        <tr>
                            <td>GET</td>
                            <td>/api/mobile/{factoryId}/timeclock/statistics</td>
                            <td>è€ƒå‹¤ç»Ÿè®¡(ä¸ªäºº)</td>
                            <td>operator+</td>
                        </tr>
                        <tr>
                            <td>GET</td>
                            <td>/api/mobile/{factoryId}/timeclock/department/{dept}</td>
                            <td>éƒ¨é—¨è€ƒå‹¤ç»Ÿè®¡</td>
                            <td>department_admin+</td>
                        </tr>
                        <tr>
                            <td>GET</td>
                            <td>/api/mobile/{factoryId}/timeclock/export</td>
                            <td>å¯¼å‡ºExcel</td>
                            <td>department_admin+</td>
                        </tr>
                    </tbody>
                </table>

                <h3>2.1.2 APIè¯·æ±‚/å“åº”ç¤ºä¾‹</h3>

                <h4>ä¸Šç­æ‰“å¡ - POST /clock-in</h4>
                <div class="java-block">
<pre><code>// è¯·æ±‚å‚æ•°
Query Parameters:
  - userId: Long (å¿…å¡«) - ç”¨æˆ·ID
  - location: String (å¯é€‰) - GPSä½ç½® "31.2304,121.4737"
  - device: String (å¯é€‰) - è®¾å¤‡ä¿¡æ¯

// æˆåŠŸå“åº” (200)
{
  "code": 200,
  "message": "æ‰“å¡æˆåŠŸ",
  "data": {
    "id": 1001,
    "factoryId": "CRETAS_2024_001",
    "userId": 4,
    "username": "æå››",
    "clockInTime": "2025-11-21T08:00:00",
    "clockOutTime": null,
    "breakStartTime": null,
    "breakEndTime": null,
    "workDurationMinutes": null,
    "breakDurationMinutes": 0,
    "status": "WORKING",
    "clockLocation": "31.2304,121.4737",
    "clockDevice": "iPhone 13",
    "latitude": 31.2304,
    "longitude": 121.4737,
    "notes": null,
    "createdAt": "2025-11-21T08:00:00",
    "updatedAt": "2025-11-21T08:00:00"
  }
}

// å¤±è´¥å“åº” - å·²æ‰“å¡è¿‡
{
  "code": 400,
  "message": "ä»Šæ—¥å·²æ‰“è¿‡ä¸Šç­å¡,è¯·å‹¿é‡å¤æ‰“å¡",
  "data": null
}

// å¤±è´¥å“åº” - ä¸åœ¨å·¥å‚èŒƒå›´å†…
{
  "code": 403,
  "message": "æ‚¨çš„ä½ç½®ä¸åœ¨å·¥å‚èŒƒå›´å†…,æ— æ³•æ‰“å¡",
  "data": null
}</code></pre>
                </div>

                <h4>ä¸‹ç­æ‰“å¡ - POST /clock-out</h4>
                <div class="java-block">
<pre><code>// è¯·æ±‚å‚æ•°
Query Parameters:
  - userId: Long (å¿…å¡«) - ç”¨æˆ·ID

// æˆåŠŸå“åº” (200)
{
  "code": 200,
  "message": "ä¸‹ç­æ‰“å¡æˆåŠŸ",
  "data": {
    "id": 1001,
    "factoryId": "CRETAS_2024_001",
    "userId": 4,
    "username": "æå››",
    "clockInTime": "2025-11-21T08:00:00",
    "clockOutTime": "2025-11-21T17:00:00",
    "breakStartTime": "2025-11-21T12:00:00",
    "breakEndTime": "2025-11-21T13:00:00",
    "workDurationMinutes": 480,    // 8å°æ—¶ = 480åˆ†é’Ÿ (ä¸å«1å°æ—¶ä¼‘æ¯)
    "breakDurationMinutes": 60,
    "overtimeMinutes": 0,
    "status": "OFF_WORK",
    "attendanceStatus": "NORMAL",
    "clockLocation": "31.2304,121.4737",
    "createdAt": "2025-11-21T08:00:00",
    "updatedAt": "2025-11-21T17:00:00"
  }
}

// å¤±è´¥å“åº” - æœªæ‰“ä¸Šç­å¡
{
  "code": 400,
  "message": "ä»Šæ—¥æœªæ‰“ä¸Šç­å¡,æ— æ³•ä¸‹ç­æ‰“å¡",
  "data": null
}</code></pre>
                </div>

                <h4>è·å–æ‰“å¡çŠ¶æ€ - GET /status</h4>
                <div class="java-block">
<pre><code>// è¯·æ±‚å‚æ•°
Query Parameters:
  - userId: Long (å¿…å¡«) - ç”¨æˆ·ID

// æˆåŠŸå“åº” - å·²æ‰“å¡çŠ¶æ€
{
  "code": 200,
  "message": "æŸ¥è¯¢æˆåŠŸ",
  "data": {
    "status": "WORKING",
    "clockInTime": "2025-11-21T08:00:00",
    "clockLocation": "31.2304,121.4737",
    "currentBatchId": 5,
    "currentBatchNumber": "BATCH-20251121-001",
    "elapsedMinutes": 120,        // å·²å·¥ä½œ2å°æ—¶
    "breakDurationMinutes": 0,
    "isOnBreak": false,
    "canClockOut": true
  }
}

// æˆåŠŸå“åº” - æœªæ‰“å¡çŠ¶æ€
{
  "code": 200,
  "message": "æŸ¥è¯¢æˆåŠŸ",
  "data": {
    "status": "NOT_CLOCKED_IN",
    "clockInTime": null,
    "currentBatchId": null,
    "canClockIn": true,
    "canClockOut": false
  }
}</code></pre>
                </div>

                <h4>è·å–ä»Šæ—¥æ‰“å¡è®°å½• - GET /today</h4>
                <div class="java-block">
<pre><code>// è¯·æ±‚å‚æ•°
Query Parameters:
  - userId: Long (å¿…å¡«) - ç”¨æˆ·ID

// æˆåŠŸå“åº”
{
  "code": 200,
  "message": "æŸ¥è¯¢æˆåŠŸ",
  "data": {
    "id": 1001,
    "factoryId": "CRETAS_2024_001",
    "userId": 4,
    "username": "æå››",
    "clockDate": "2025-11-21",
    "clockInTime": "2025-11-21T08:00:00",
    "clockOutTime": null,
    "breakStartTime": null,
    "breakEndTime": null,
    "workDurationMinutes": null,
    "breakDurationMinutes": 0,
    "status": "WORKING",
    "attendanceStatus": "NORMAL",
    "clockLocation": "31.2304,121.4737",
    "notes": null,
    "createdAt": "2025-11-21T08:00:00"
  }
}

// æœªæ‰“å¡å“åº”
{
  "code": 200,
  "message": "ä»Šæ—¥æœªæ‰“å¡",
  "data": null
}</code></pre>
                </div>

                <h2>2.2 å·¥ä½œä¼šè¯ç®¡ç†</h2>

                <h3>2.2.1 è‡ªåŠ¨æˆæœ¬è®¡ç®—</h3>
                <p><strong>è®¡ç®—å…¬å¼</strong>:</p>
                <pre><code>// åŸºç¡€å…¬å¼
labor_cost = (daily_salary / 24) Ã— duration_hours

// ç¤ºä¾‹
æ—¥è–ª: 300å…ƒ
å·¥ä½œæ—¶é—´: 8å°æ—¶
å°æ—¶è´¹ç‡: 300 / 24 = 12.5å…ƒ/å°æ—¶
æˆæœ¬: 12.5 Ã— 8 = 100å…ƒ

// å¤šæ‰¹æ¬¡åœºæ™¯
æ€»æˆæœ¬ = Î£(æ¯ä¸ªæ‰¹æ¬¡çš„åŠ³åŠ¨æˆæœ¬)

ç¤ºä¾‹:
- æ‰¹æ¬¡A (6å°æ—¶): 12.5 Ã— 6 = 75å…ƒ
- æ‰¹æ¬¡B (2å°æ—¶): 12.5 Ã— 2 = 25å…ƒ
- æ€»æˆæœ¬: 75 + 25 = 100å…ƒ</code></pre>

                <h3>2.2.2 æ•°æ®åº“è¡¨å®Œæ•´ç»“æ„</h3>
                <div class="sql-block">
<pre><code>-- time_clock_record è¡¨ (æ‰“å¡è®°å½•)
CREATE TABLE time_clock_record (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  factory_id VARCHAR(50) NOT NULL,
  user_id BIGINT NOT NULL,

  -- æ‰“å¡æ—¶é—´
  clock_in_time DATETIME NOT NULL,
  clock_out_time DATETIME,

  -- ä¼‘æ¯æ—¶é—´
  break_start_time DATETIME,
  break_end_time DATETIME,

  -- æ—¶é—´è®¡ç®— (åˆ†é’Ÿ)
  work_duration INT,                    -- å®é™…å·¥ä½œæ—¶é•¿(åˆ†é’Ÿ)
  break_duration INT DEFAULT 0,         -- ä¼‘æ¯æ—¶é•¿(åˆ†é’Ÿ)

  -- ä½ç½®ä¿¡æ¯
  location VARCHAR(255),                -- "31.2304,121.4737"
  device VARCHAR(255),                  -- æ‰“å¡è®¾å¤‡
  latitude DOUBLE,                      -- GPSçº¬åº¦
  longitude DOUBLE,                     -- GPSç»åº¦

  -- çŠ¶æ€
  status VARCHAR(20) NOT NULL,          -- WORKING, ON_BREAK, OFF_WORK
  remarks VARCHAR(500),                 -- å¤‡æ³¨

  -- ç³»ç»Ÿå­—æ®µ
  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,

  -- ç´¢å¼•
  INDEX idx_factory_user_date (factory_id, user_id, clock_in_time),
  INDEX idx_user_date (user_id, clock_in_time),
  INDEX idx_status (status),

  FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
);

-- batch_work_sessions è¡¨ (æ‰¹æ¬¡å·¥ä½œä¼šè¯)
CREATE TABLE batch_work_sessions (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  batch_id BIGINT NOT NULL,
  work_session_id INT NOT NULL,
  employee_id INT NOT NULL,

  -- å·¥ä½œæ—¶é—´ (åˆ†é’Ÿ)
  work_minutes INT NOT NULL,

  -- æˆæœ¬è®¡ç®—
  labor_cost DECIMAL(10, 2) NOT NULL,   -- è‡ªåŠ¨è®¡ç®—çš„åŠ³åŠ¨æˆæœ¬

  -- ç³»ç»Ÿå­—æ®µ
  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,

  -- ç´¢å¼•
  INDEX idx_batchwork_batch (batch_id),
  INDEX idx_batchwork_session (work_session_id),
  INDEX idx_employee (employee_id),

  FOREIGN KEY (batch_id) REFERENCES processing_batches(id) ON DELETE CASCADE,
  FOREIGN KEY (employee_id) REFERENCES users(id) ON DELETE CASCADE
);</code></pre>
                </div>

                <h3>2.2.3 å‰ç«¯å®ç°</h3>
                <table>
                    <thead>
                        <tr>
                            <th>æ–‡ä»¶</th>
                            <th>è¯´æ˜</th>
                            <th>å…³é”®åŠŸèƒ½</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>AttendanceScreen.tsx</code></td>
                            <td>è€ƒå‹¤ä¸»ç•Œé¢</td>
                            <td>æ‰“å¡æŒ‰é’®ã€çŠ¶æ€å±•ç¤º</td>
                        </tr>
                        <tr>
                            <td><code>TimeClockScreen.tsx</code></td>
                            <td>æ‰“å¡æ“ä½œç•Œé¢</td>
                            <td>GPSå®šä½ã€æ‰“å¡æ“ä½œ</td>
                        </tr>
                        <tr>
                            <td><code>AttendanceStatisticsScreen.tsx</code></td>
                            <td>è€ƒå‹¤ç»Ÿè®¡ç•Œé¢</td>
                            <td>ä¸ªäºº/éƒ¨é—¨è€ƒå‹¤ç»Ÿè®¡</td>
                        </tr>
                        <tr>
                            <td><code>services/api/timeStatsApiClient.ts</code></td>
                            <td>è€ƒå‹¤APIå®¢æˆ·ç«¯</td>
                            <td>è°ƒç”¨åç«¯API</td>
                        </tr>
                    </tbody>
                </table>

                <h3>2.2.4 åç«¯Serviceå…³é”®æ–¹æ³•</h3>
                <div class="java-block">
<pre><code>// TimeClockService.java - æ ¸å¿ƒæ–¹æ³•ç­¾å
public interface TimeClockService {

    // æ‰“å¡æ“ä½œ
    TimeClockRecord clockIn(String factoryId, Long userId, String location, String device);
    TimeClockRecord clockOut(String factoryId, Long userId);
    TimeClockRecord breakStart(String factoryId, Long userId);
    TimeClockRecord breakEnd(String factoryId, Long userId);

    // æŸ¥è¯¢æ“ä½œ
    Map<String, Object> getClockStatus(String factoryId, Long userId);
    TimeClockRecord getTodayRecord(String factoryId, Long userId);
    PageResponse<TimeClockRecord> getClockHistory(
        String factoryId, Long userId,
        LocalDate startDate, LocalDate endDate,
        PageRequest pageRequest
    );

    // ç»Ÿè®¡æ“ä½œ
    Map<String, Object> getAttendanceStatistics(
        String factoryId, Long userId,
        LocalDate startDate, LocalDate endDate
    );
    Map<String, Object> getDepartmentAttendance(
        String factoryId, String department, LocalDate date
    );

    // ä¿®æ”¹å’Œå¯¼å‡º
    TimeClockRecord editClockRecord(
        String factoryId, Long recordId,
        TimeClockRecord record, Long editedBy, String reason
    );
    byte[] exportAttendanceRecords(
        String factoryId, LocalDate startDate, LocalDate endDate
    );
}</code></pre>
                </div>

                <h3>2.2.5 æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ - æ‰“å¡æµç¨‹</h3>
                <pre><code>ä¸Šç­æ‰“å¡æµç¨‹:
1. éªŒè¯ç”¨æˆ·æ˜¯å¦å·²æ‰“å¡ (æŸ¥è¯¢ä»Šæ—¥æ˜¯å¦æœ‰status=WORKINGçš„è®°å½•)
2. éªŒè¯GPSä½ç½® (æ˜¯å¦åœ¨å·¥å‚èŒƒå›´å†…,å¯é€‰)
3. åˆ›å»ºtime_clock_recordè®°å½•
   - status = WORKING
   - clock_in_time = å½“å‰æ—¶é—´
   - location, latitude, longitude = GPSæ•°æ®
4. æŸ¥è¯¢å½“å‰è¿›è¡Œä¸­çš„ç”Ÿäº§æ‰¹æ¬¡ (status=IN_PROGRESS)
5. å¦‚æœå­˜åœ¨æ‰¹æ¬¡,åˆ›å»ºbatch_work_sessionå…³è”
6. è¿”å›æ‰“å¡æˆåŠŸå“åº”

ä¸‹ç­æ‰“å¡æµç¨‹:
1. æŸ¥è¯¢ä»Šæ—¥æ‰“å¡è®°å½• (status=WORKING)
2. å¦‚æœä¸å­˜åœ¨,è¿”å›é”™è¯¯: "ä»Šæ—¥æœªæ‰“ä¸Šç­å¡"
3. æ›´æ–°time_clock_recordè®°å½•
   - clock_out_time = å½“å‰æ—¶é—´
   - status = OFF_WORK
4. è®¡ç®—å·¥ä½œæ—¶é•¿
   - work_duration = (clock_out_time - clock_in_time) - break_duration
5. æ›´æ–°ç›¸å…³çš„batch_work_session
   - è®¡ç®—work_minutes
   - è®¡ç®—labor_cost = (employee.daily_salary / 24) Ã— (work_minutes / 60)
6. å¦‚æœæ‰¹æ¬¡å·²å®Œæˆ,è§¦å‘æ‰¹æ¬¡æˆæœ¬è®¡ç®—
7. è¿”å›ä¸‹ç­æ‰“å¡æˆåŠŸå“åº”

ä¼‘æ¯æ—¶é—´æµç¨‹:
1. å¼€å§‹ä¼‘æ¯: break_start_time = å½“å‰æ—¶é—´, status = ON_BREAK
2. ç»“æŸä¼‘æ¯: break_end_time = å½“å‰æ—¶é—´, status = WORKING
3. è®¡ç®—break_duration = break_end_time - break_start_time (åˆ†é’Ÿ)</code></pre>

                <h2>2.3 è€ƒå‹¤ç»Ÿè®¡ä¸æŠ¥è¡¨</h2>

                <h3>2.3.1 ä¸ªäººè€ƒå‹¤ç»Ÿè®¡</h3>
                <p><strong>ç»Ÿè®¡ç»´åº¦</strong>:</p>
                <ul>
                    <li>æ€»å·¥ä½œå¤©æ•°</li>
                    <li>æ€»å·¥ä½œæ—¶é•¿ (å°æ—¶)</li>
                    <li>å¹³å‡æ¯æ—¥å·¥ä½œæ—¶é•¿</li>
                    <li>åŠ ç­æ—¶é•¿</li>
                    <li>è¿Ÿåˆ°æ¬¡æ•°</li>
                    <li>æ—©é€€æ¬¡æ•°</li>
                    <li>æ—·å·¥æ¬¡æ•°</li>
                </ul>

                <h4>APIå“åº”ç¤ºä¾‹</h4>
                <div class="java-block">
<pre><code>// GET /api/mobile/{factoryId}/timeclock/statistics
// Query: userId=4, startDate=2025-11-01, endDate=2025-11-30

{
  "code": 200,
  "data": {
    "userId": 4,
    "username": "æå››",
    "period": {
      "startDate": "2025-11-01",
      "endDate": "2025-11-30"
    },
    "summary": {
      "totalWorkDays": 22,
      "totalWorkHours": 176.0,          // 22å¤© Ã— 8å°æ—¶
      "averageDailyHours": 8.0,
      "totalOvertimeHours": 0.0,
      "totalBreakHours": 22.0,          // 22å¤© Ã— 1å°æ—¶
      "lateDays": 0,
      "earlyLeaveDays": 0,
      "absentDays": 0
    },
    "details": [
      {
        "date": "2025-11-21",
        "clockInTime": "08:00:00",
        "clockOutTime": "17:00:00",
        "workHours": 8.0,
        "breakHours": 1.0,
        "overtimeHours": 0.0,
        "status": "NORMAL"
      },
      // ... æ›´å¤šæ—¥æœŸ
    ]
  }
}</code></pre>
                </div>

                <h3>2.3.2 éƒ¨é—¨è€ƒå‹¤ç»Ÿè®¡</h3>
                <p><strong>ç»Ÿè®¡ç»´åº¦</strong>:</p>
                <ul>
                    <li>éƒ¨é—¨å‡ºå‹¤ç‡</li>
                    <li>åœ¨å²—äººæ•°</li>
                    <li>è¯·å‡äººæ•°</li>
                    <li>æ—·å·¥äººæ•°</li>
                    <li>éƒ¨é—¨æ€»å·¥æ—¶</li>
                </ul>

                <h4>APIå“åº”ç¤ºä¾‹</h4>
                <div class="java-block">
<pre><code>// GET /api/mobile/{factoryId}/timeclock/department/ç”Ÿäº§è½¦é—´
// Query: date=2025-11-21

{
  "code": 200,
  "data": {
    "department": "ç”Ÿäº§è½¦é—´",
    "date": "2025-11-21",
    "summary": {
      "totalEmployees": 50,
      "presentEmployees": 48,           // åœ¨å²—äººæ•°
      "absentEmployees": 2,             // ç¼ºå‹¤äººæ•°
      "attendanceRate": 96.0,           // å‡ºå‹¤ç‡
      "totalWorkHours": 384.0,          // 48äºº Ã— 8å°æ—¶
      "averageWorkHours": 8.0
    },
    "employeeDetails": [
      {
        "userId": 4,
        "username": "æå››",
        "clockInTime": "08:00:00",
        "clockOutTime": null,
        "status": "WORKING",
        "workHours": 0.0
      },
      // ... æ›´å¤šå‘˜å·¥
    ],
    "abnormalRecords": [
      {
        "userId": 10,
        "username": "ç‹äº”",
        "type": "LATE",
        "clockInTime": "08:30:00",
        "lateMinutes": 30
      }
    ]
  }
}</code></pre>
                </div>

                <h2>2.4 å¼‚å¸¸è€ƒå‹¤å¤„ç†</h2>

                <h3>2.4.1 å¼‚å¸¸ç±»å‹</h3>
                <table>
                    <thead>
                        <tr>
                            <th>å¼‚å¸¸ç±»å‹</th>
                            <th>åˆ¤å®šæ¡ä»¶</th>
                            <th>å¤„ç†æ–¹å¼</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>è¿Ÿåˆ° (LATE)</td>
                            <td>æ‰“å¡æ—¶é—´ > 08:30</td>
                            <td>è®°å½•è¿Ÿåˆ°åˆ†é’Ÿæ•°,æ‰£å‡å·¥èµ„</td>
                        </tr>
                        <tr>
                            <td>æ—©é€€ (EARLY_LEAVE)</td>
                            <td>æ‰“å¡æ—¶é—´ < 17:00</td>
                            <td>è®°å½•æ—©é€€åˆ†é’Ÿæ•°,æ‰£å‡å·¥èµ„</td>
                        </tr>
                        <tr>
                            <td>æ—·å·¥ (ABSENT)</td>
                            <td>æœªæ‰“å¡è®°å½•</td>
                            <td>è®°å½•æ—·å·¥,å½“æ—¥æ— å·¥èµ„</td>
                        </tr>
                        <tr>
                            <td>å¿˜è®°æ‰“å¡ (MISS_CLOCK)</td>
                            <td>åªæœ‰ä¸Šç­å¡æˆ–ä¸‹ç­å¡</td>
                            <td>éœ€ä¸»ç®¡å®¡æ ¸è¡¥å¡</td>
                        </tr>
                        <tr>
                            <td>GPSå¼‚å¸¸ (GPS_ERROR)</td>
                            <td>ä¸åœ¨å·¥å‚èŒƒå›´å†…</td>
                            <td>æ‰“å¡å¤±è´¥æˆ–éœ€äººå·¥å®¡æ ¸</td>
                        </tr>
                    </tbody>
                </table>

                <h3>2.4.2 è¡¥å¡æµç¨‹</h3>
                <pre><code>å‘˜å·¥å‘èµ·è¡¥å¡ç”³è¯·:
1. é€‰æ‹©éœ€è¦è¡¥å¡çš„æ—¥æœŸ
2. å¡«å†™è¡¥å¡æ—¶é—´
3. å¡«å†™è¡¥å¡åŸå› 
4. æäº¤ç»™ç›´å±ä¸»ç®¡

ä¸»ç®¡å®¡æ ¸:
1. æŸ¥çœ‹è¡¥å¡ç”³è¯·
2. éªŒè¯åŸå› æ˜¯å¦åˆç†
3. æ‰¹å‡†æˆ–æ‹’ç»
   - æ‰¹å‡†: è°ƒç”¨editClockRecord APIä¿®æ”¹æ‰“å¡è®°å½•
   - æ‹’ç»: è®°å½•æ‹’ç»åŸå› ,é€šçŸ¥å‘˜å·¥

ç³»ç»Ÿå¤„ç†:
1. æ›´æ–°time_clock_recordè®°å½•
2. æ ‡è®°ä¸ºæ‰‹åŠ¨ä¿®æ”¹ (is_manual_edit = true)
3. è®°å½•ä¿®æ”¹äººå’Œä¿®æ”¹åŸå› 
4. é‡æ–°è®¡ç®—å·¥æ—¶å’Œæˆæœ¬</code></pre>

                <h2>2.5 ä¸å…¶ä»–æ¨¡å—çš„é›†æˆ</h2>

                <h3>2.5.1 ä¸ç”Ÿäº§æ¨¡å—é›†æˆ</h3>
                <ul>
                    <li><strong>è‡ªåŠ¨å…³è”æ‰¹æ¬¡</strong>: å‘˜å·¥æ‰“å¡æ—¶è‡ªåŠ¨å…³è”åˆ°å½“å‰è¿›è¡Œä¸­çš„ç”Ÿäº§æ‰¹æ¬¡</li>
                    <li><strong>å·¥æ—¶åˆ†é…</strong>: å‘˜å·¥åœ¨å¤šä¸ªæ‰¹æ¬¡é—´åˆ‡æ¢æ—¶,å·¥æ—¶æŒ‰å®é™…å·¥ä½œæ—¶é—´åˆ†é…</li>
                    <li><strong>æˆæœ¬è®¡ç®—</strong>: ä¸‹ç­æ‰“å¡è§¦å‘æ‰¹æ¬¡äººå·¥æˆæœ¬è®¡ç®—</li>
                </ul>

                <h3>2.5.2 ä¸è–ªèµ„æ¨¡å—é›†æˆ</h3>
                <ul>
                    <li><strong>å·¥èµ„è®¡ç®—åŸºç¡€</strong>: è€ƒå‹¤æ•°æ®æ˜¯æœˆåº¦å·¥èµ„è®¡ç®—çš„åŸºç¡€</li>
                    <li><strong>åŠ ç­è´¹</strong>: è¶…è¿‡8å°æ—¶çš„å·¥æ—¶æŒ‰åŠ ç­è´¹ç‡è®¡ç®—</li>
                    <li><strong>æ‰£æ¬¾å¤„ç†</strong>: è¿Ÿåˆ°ã€æ—©é€€ã€æ—·å·¥è‡ªåŠ¨æ‰£å‡å·¥èµ„</li>
                </ul>

                <h3>2.5.3 æ•°æ®æµç¤ºæ„å›¾</h3>
                <pre><code>å‘˜å·¥æ‰“å¡
  â†“
time_clock_record è¡¨
  â†“
batch_work_sessions è¡¨ (å…³è”åˆ°æ‰¹æ¬¡)
  â†“
  â”œâ”€â†’ processing_batches è¡¨ (æ‰¹æ¬¡æˆæœ¬è®¡ç®—)
  â”œâ”€â†’ batch_cost_analysis è¡¨ (æˆæœ¬æ±‡æ€»)
  â””â”€â†’ payroll_records è¡¨ (å·¥èµ„è®¡ç®—)</code></pre>

                <h2>2.6 é”™è¯¯ç åˆ—è¡¨</h2>
                <table>
                    <thead>
                        <tr>
                            <th>é”™è¯¯ç </th>
                            <th>HTTPçŠ¶æ€</th>
                            <th>è¯´æ˜</th>
                            <th>è§£å†³æ–¹æ¡ˆ</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>ALREADY_CLOCKED_IN</td>
                            <td>400</td>
                            <td>ä»Šæ—¥å·²æ‰“ä¸Šç­å¡</td>
                            <td>æ£€æŸ¥ä»Šæ—¥æ‰“å¡è®°å½•</td>
                        </tr>
                        <tr>
                            <td>NO_CLOCK_IN</td>
                            <td>400</td>
                            <td>ä»Šæ—¥æœªæ‰“ä¸Šç­å¡</td>
                            <td>éœ€å…ˆæ‰“ä¸Šç­å¡</td>
                        </tr>
                        <tr>
                            <td>LOCATION_OUT_OF_RANGE</td>
                            <td>403</td>
                            <td>GPSä½ç½®ä¸åœ¨å·¥å‚èŒƒå›´å†…</td>
                            <td>å‰å¾€å·¥å‚èŒƒå›´å†…æ‰“å¡</td>
                        </tr>
                        <tr>
                            <td>ALREADY_CLOCKED_OUT</td>
                            <td>400</td>
                            <td>å·²æ‰“è¿‡ä¸‹ç­å¡</td>
                            <td>æ£€æŸ¥æ‰“å¡çŠ¶æ€</td>
                        </tr>
                        <tr>
                            <td>NOT_ON_BREAK</td>
                            <td>400</td>
                            <td>æœªåœ¨ä¼‘æ¯çŠ¶æ€</td>
                            <td>éœ€å…ˆå¼€å§‹ä¼‘æ¯</td>
                        </tr>
                        <tr>
                            <td>USER_NOT_FOUND</td>
                            <td>404</td>
                            <td>ç”¨æˆ·ä¸å­˜åœ¨</td>
                            <td>æ£€æŸ¥ç”¨æˆ·ID</td>
                        </tr>
                        <tr>
                            <td>RECORD_NOT_FOUND</td>
                            <td>404</td>
                            <td>æ‰“å¡è®°å½•ä¸å­˜åœ¨</td>
                            <td>æ£€æŸ¥è®°å½•ID</td>
                        </tr>
                        <tr>
                            <td>PERMISSION_DENIED</td>
                            <td>403</td>
                            <td>æƒé™ä¸è¶³</td>
                            <td>è”ç³»ç®¡ç†å‘˜</td>
                        </tr>
                    </tbody>
                </table>
            </section>

            
            <section id="ch3">
                <h1>3. ç”Ÿäº§åŠ å·¥æ¨¡å—</h1>

                <h2>æ¨¡å—æè¿°</h2>
                <p>ç”Ÿäº§åŠ å·¥æ¨¡å—æ˜¯ç³»ç»Ÿçš„æ ¸å¿ƒåŠŸèƒ½,è´Ÿè´£ç®¡ç†ä»ç”Ÿäº§æ‰¹æ¬¡åˆ›å»ºåˆ°å®Œæˆçš„æ•´ä¸ªç”Ÿäº§è¿‡ç¨‹ã€‚è¯¥æ¨¡å—ä¸è€ƒå‹¤ã€è®¾å¤‡ã€åº“å­˜ã€è´¨æ£€ç­‰æ¨¡å—ç´§å¯†åä½œ,å®ç°æˆæœ¬è‡ªåŠ¨è®¡ç®—ã€è´¨é‡æ§åˆ¶å’Œäº§èƒ½åˆ†æã€‚</p>

                <div class="info-box">
                    <h3>æ ¸å¿ƒä¸šåŠ¡æµç¨‹</h3>
                    <p><strong>åˆ›å»ºæ‰¹æ¬¡ â†’ åˆ†é…ç‰©æ–™ â†’ å¼€å§‹ç”Ÿäº§ â†’ å®æ—¶æ¶ˆè€—è¿½è¸ª â†’ è´¨æ£€è®°å½• â†’ æˆæœ¬æ±‡æ€» â†’ ç”Ÿäº§å®Œæˆ â†’ AIåˆ†æ</strong></p>
                </div>

                <h2>3.1 ç”Ÿäº§æ‰¹æ¬¡ç®¡ç†</h2>

                <h3>3.1.1 APIç«¯ç‚¹å®Œæ•´åˆ—è¡¨</h3>
                <table>
                    <thead>
                        <tr>
                            <th>HTTPæ–¹æ³•</th>
                            <th>è·¯ç”±</th>
                            <th>åŠŸèƒ½è¯´æ˜</th>
                            <th>æƒé™è¦æ±‚</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>POST</td>
                            <td>/api/mobile/{factoryId}/processing/batches</td>
                            <td>åˆ›å»ºç”Ÿäº§æ‰¹æ¬¡</td>
                            <td>supervisor+</td>
                        </tr>
                        <tr>
                            <td>POST</td>
                            <td>/api/mobile/{factoryId}/processing/batches/{batchId}/start</td>
                            <td>å¼€å§‹ç”Ÿäº§</td>
                            <td>supervisor+</td>
                        </tr>
                        <tr>
                            <td>POST</td>
                            <td>/api/mobile/{factoryId}/processing/batches/{batchId}/pause</td>
                            <td>æš‚åœç”Ÿäº§</td>
                            <td>supervisor+</td>
                        </tr>
                        <tr>
                            <td>POST</td>
                            <td>/api/mobile/{factoryId}/processing/batches/{batchId}/complete</td>
                            <td>å®Œæˆç”Ÿäº§</td>
                            <td>supervisor+</td>
                        </tr>
                        <tr>
                            <td>POST</td>
                            <td>/api/mobile/{factoryId}/processing/batches/{batchId}/cancel</td>
                            <td>å–æ¶ˆç”Ÿäº§</td>
                            <td>factory_admin+</td>
                        </tr>
                        <tr>
                            <td>GET</td>
                            <td>/api/mobile/{factoryId}/processing/batches</td>
                            <td>æŸ¥è¯¢ç”Ÿäº§æ‰¹æ¬¡ (åˆ†é¡µ)</td>
                            <td>operator+</td>
                        </tr>
                        <tr>
                            <td>GET</td>
                            <td>/api/mobile/{factoryId}/processing/batches/{batchId}</td>
                            <td>è·å–æ‰¹æ¬¡è¯¦æƒ…</td>
                            <td>operator+</td>
                        </tr>
                        <tr>
                            <td>GET</td>
                            <td>/api/mobile/{factoryId}/processing/batches/{batchId}/timeline</td>
                            <td>è·å–æ‰¹æ¬¡æ—¶é—´çº¿</td>
                            <td>operator+</td>
                        </tr>
                    </tbody>
                </table>

                <h3>3.1.2 ç”Ÿäº§æ‰¹æ¬¡æ•°æ®ç»“æ„</h3>
                <div class="sql-block">
<pre><code>-- production_batches è¡¨ (ç”Ÿäº§æ‰¹æ¬¡ä¸»è¡¨)
CREATE TABLE production_batches (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  factory_id VARCHAR(50) NOT NULL,
  batch_number VARCHAR(50) NOT NULL UNIQUE,
  production_plan_id INT,
  product_type_id INT NOT NULL,
  product_name VARCHAR(100),

  -- æ•°é‡å­—æ®µ
  planned_quantity DECIMAL(12,2),
  actual_quantity DECIMAL(12,2),
  good_quantity DECIMAL(12,2),
  defect_quantity DECIMAL(12,2),
  unit VARCHAR(20) NOT NULL,

  -- ç”Ÿäº§çŠ¶æ€
  status VARCHAR(20) NOT NULL DEFAULT 'PLANNED',
  -- å¯é€‰å€¼: PLANNED(è®¡åˆ’ä¸­), IN_PROGRESS(è¿›è¡Œä¸­), PAUSED(æš‚åœ),
  --        COMPLETED(å®Œæˆ), CANCELLED(å–æ¶ˆ)
  quality_status VARCHAR(30),

  -- æ—¶é—´æˆ³
  start_time TIMESTAMP,
  end_time TIMESTAMP,

  -- è®¾å¤‡å’Œäººå‘˜
  equipment_id INT,
  equipment_name VARCHAR(100),
  supervisor_id INT,
  supervisor_name VARCHAR(50),
  worker_count INT,
  work_duration_minutes INT,

  -- æˆæœ¬æ„æˆ (è‡ªåŠ¨è®¡ç®—)
  material_cost DECIMAL(12,2),
  labor_cost DECIMAL(12,2),
  equipment_cost DECIMAL(12,2),
  other_cost DECIMAL(12,2),
  total_cost DECIMAL(12,2),
  unit_cost DECIMAL(12,4),    -- total_cost / actual_quantity

  -- è®¡ç®—æŒ‡æ ‡
  yield_rate DECIMAL(5,2),     -- (good_quantity / actual_quantity) Ã— 100
  efficiency DECIMAL(5,2),     -- (actual_quantity / planned_quantity) Ã— 100

  -- å…¶ä»–ä¿¡æ¯
  notes TEXT,
  created_by INT,
  created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,

  -- ç´¢å¼•ä¼˜åŒ–
  INDEX idx_batch_factory (factory_id),
  INDEX idx_batch_number (batch_number),
  INDEX idx_batch_status (status),
  INDEX idx_batch_plan (production_plan_id),
  FOREIGN KEY (production_plan_id) REFERENCES production_plans(id)
);</code></pre>
                </div>

                <h3>3.1.3 åˆ›å»ºæ‰¹æ¬¡è¯·æ±‚/å“åº”ç¤ºä¾‹</h3>
                <div class="java-block">
<pre><code>// POST /api/mobile/{factoryId}/processing/batches
// è¯·æ±‚ä½“
{
  "batchNumber": "BATCH-20251121-001",
  "productTypeId": 1,
  "productName": "ç•ªèŒ„é…±",
  "plannedQuantity": 1000.00,
  "unit": "kg",
  "supervisorId": 2,
  "equipmentId": 5,
  "notes": "ä½¿ç”¨æ–°ä¾›åº”å•†ç•ªèŒ„"
}

// æˆåŠŸå“åº” (200)
{
  "code": 200,
  "message": "æ‰¹æ¬¡åˆ›å»ºæˆåŠŸ",
  "data": {
    "id": 101,
    "factoryId": "CRETAS_2024_001",
    "batchNumber": "BATCH-20251121-001",
    "productTypeId": 1,
    "productName": "ç•ªèŒ„é…±",
    "plannedQuantity": 1000.00,
    "actual_quantity": null,
    "good_quantity": null,
    "defect_quantity": null,
    "unit": "kg",
    "status": "PLANNED",
    "qualityStatus": null,
    "startTime": null,
    "endTime": null,
    "equipmentId": 5,
    "equipmentName": "æ…æ‹Œæœº A",
    "supervisorId": 2,
    "supervisorName": "å¼ ä¸‰",
    "workerCount": 0,
    "workDurationMinutes": 0,
    "materialCost": 0.00,
    "laborCost": 0.00,
    "equipmentCost": 0.00,
    "otherCost": 0.00,
    "totalCost": 0.00,
    "unitCost": 0.0000,
    "yieldRate": 0.00,
    "efficiency": 0.00,
    "createdAt": "2025-11-21T10:30:00",
    "updatedAt": "2025-11-21T10:30:00"
  }
}</code></pre>
                </div>

                <h3>3.1.4 å¼€å§‹ç”Ÿäº§ - æˆæœ¬åˆå§‹åŒ–</h3>
                <div class="java-block">
<pre><code>// POST /api/mobile/{factoryId}/processing/batches/{batchId}/start
// è¯·æ±‚å‚æ•°
{
  "supervisorId": 2
}

// æˆåŠŸå“åº” (200)
{
  "code": 200,
  "message": "ç”Ÿäº§å·²å¼€å§‹",
  "data": {
    "id": 101,
    "batchNumber": "BATCH-20251121-001",
    "status": "IN_PROGRESS",
    "startTime": "2025-11-21T10:35:00",
    "supervisorId": 2,
    "supervisorName": "å¼ ä¸‰"
  }
}

// åç«¯å¤„ç†æµç¨‹:
// 1. æ›´æ–° status = IN_PROGRESS, start_time = å½“å‰æ—¶é—´
// 2. åˆå§‹åŒ–æˆæœ¬ = 0.00
// 3. æŸ¥è¯¢å…³è”çš„ææ–™æ‰¹æ¬¡ (FIFOæ¨è)
// 4. è¿”å›æˆåŠŸå“åº”
// 5. åå°å¯åŠ¨æˆæœ¬è¿½è¸ªä»»åŠ¡</code></pre>
                </div>

                <h2>3.2 ç‰©æ–™ç®¡ç†ä¸æ¶ˆè€—è¿½è¸ª</h2>

                <h3>3.2.1 ç‰©æ–™æ¥æ”¶å’Œæ¶ˆè€—</h3>
                <table>
                    <thead>
                        <tr>
                            <th>APIç«¯ç‚¹</th>
                            <th>åŠŸèƒ½</th>
                            <th>å‚æ•°</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>POST /material-receipt</td>
                            <td>è®°å½•ç‰©æ–™å…¥åº“</td>
                            <td>MaterialBatch object</td>
                        </tr>
                        <tr>
                            <td>GET /materials</td>
                            <td>æŸ¥è¯¢ç‰©æ–™åº“å­˜ (åˆ†é¡µ)</td>
                            <td>page, size</td>
                        </tr>
                        <tr>
                            <td>POST /batches/{batchId}/material-consumption</td>
                            <td>è®°å½•ç‰©æ–™æ¶ˆè€—</td>
                            <td>List&lt;ConsumptionRecord&gt;</td>
                        </tr>
                    </tbody>
                </table>

                <h3>3.2.2 ç‰©æ–™æ¶ˆè€—è®°å½•ç¤ºä¾‹</h3>
                <div class="java-block">
<pre><code>// POST /api/mobile/{factoryId}/processing/batches/{batchId}/material-consumption
// è¯·æ±‚ä½“ (ä¸€ä¸ªæ‰¹æ¬¡å¯èƒ½æ¶ˆè€—å¤šç§ç‰©æ–™)
{
  "consumptions": [
    {
      "materialBatchId": "MAT-20251015-001",  // ç•ªèŒ„
      "quantity": 950.00,
      "unit": "kg"
    },
    {
      "materialBatchId": "MAT-20251010-005",  // ç›
      "quantity": 10.00,
      "unit": "kg"
    }
  ]
}

// æˆåŠŸå“åº” (200)
{
  "code": 200,
  "message": "ç‰©æ–™æ¶ˆè€—è®°å½•æˆåŠŸ",
  "data": {
    "batchId": "BATCH-20251121-001",
    "totalMaterialCost": 475.00,  // 950*0.5 + 10*0 (å‡è®¾ç•ªèŒ„0.5å…ƒ/kg)
    "consumedMaterials": [
      {
        "materialBatchId": "MAT-20251015-001",
        "quantity": 950.00,
        "unitPrice": 0.50,
        "totalCost": 475.00
      },
      {
        "materialBatchId": "MAT-20251010-005",
        "quantity": 10.00,
        "unitPrice": 0.00,
        "totalCost": 0.00
      }
    ]
  }
}</code></pre>
                </div>

                <h2>3.3 è´¨é‡æ£€éªŒé›†æˆ</h2>

                <h3>3.3.1 è´¨æ£€APIç«¯ç‚¹</h3>
                <table>
                    <thead>
                        <tr>
                            <th>HTTPæ–¹æ³•</th>
                            <th>è·¯ç”±</th>
                            <th>åŠŸèƒ½è¯´æ˜</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>POST</td>
                            <td>/api/mobile/{factoryId}/processing/quality/inspections</td>
                            <td>æäº¤è´¨æ£€è®°å½•</td>
                        </tr>
                        <tr>
                            <td>GET</td>
                            <td>/api/mobile/{factoryId}/processing/quality/inspections</td>
                            <td>æŸ¥è¯¢è´¨æ£€è®°å½• (åˆ†é¡µ)</td>
                        </tr>
                        <tr>
                            <td>GET</td>
                            <td>/api/mobile/{factoryId}/processing/quality/statistics</td>
                            <td>è´¨æ£€ç»Ÿè®¡æŠ¥è¡¨</td>
                        </tr>
                        <tr>
                            <td>GET</td>
                            <td>/api/mobile/{factoryId}/processing/quality/trends</td>
                            <td>è´¨æ£€è¶‹åŠ¿åˆ†æ</td>
                        </tr>
                    </tbody>
                </table>

                <h3>3.3.2 è´¨æ£€è®°å½•æ•°æ®åº“</h3>
                <div class="sql-block">
<pre><code>-- quality_inspections è¡¨ (è´¨é‡æ£€éªŒè®°å½•)
CREATE TABLE quality_inspections (
  id VARCHAR(191) PRIMARY KEY,
  factory_id VARCHAR(50) NOT NULL,
  production_batch_id VARCHAR(191) NOT NULL,
  inspector_id INT NOT NULL,
  inspection_date DATE NOT NULL,

  -- æ£€éªŒç»“æœ
  sample_size DECIMAL(10,2) NOT NULL,      -- æŠ½æ ·æ•°é‡
  pass_count DECIMAL(10,2) NOT NULL,       -- åˆæ ¼æ•°é‡
  fail_count DECIMAL(10,2) NOT NULL,       -- ä¸åˆæ ¼æ•°é‡
  pass_rate DECIMAL(5,2),                  -- åˆæ ¼ç‡ (%)

  -- æ£€éªŒç»“è®º
  result VARCHAR(20),                      -- PASS, FAIL, NEED_RETEST
  notes TEXT,

  -- ç³»ç»Ÿå­—æ®µ
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,

  INDEX idx_inspection_factory (factory_id),
  INDEX idx_inspection_batch (production_batch_id),
  INDEX idx_inspection_date (inspection_date),
  FOREIGN KEY (production_batch_id) REFERENCES production_batches(id)
);

-- è‡ªåŠ¨è®¡ç®—: pass_rate = (pass_count / sample_size) Ã— 100
-- åˆ¤å®šè§„åˆ™: pass_rate >= 95% â†’ PASS, else â†’ FAIL</code></pre>
                </div>

                <h3>3.3.3 è´¨æ£€æäº¤ç¤ºä¾‹</h3>
                <div class="java-block">
<pre><code>// POST /api/mobile/{factoryId}/processing/quality/inspections
{
  "batchId": "BATCH-20251121-001",
  "inspectorId": 6,
  "inspectionDate": "2025-11-21",
  "sampleSize": 100,
  "passCount": 98,
  "failCount": 2,
  "notes": "è‰²æ³½ç•¥æµ…,ä½†åœ¨å…è®¸èŒƒå›´å†…"
}

// æˆåŠŸå“åº”
{
  "code": 200,
  "message": "è´¨æ£€è®°å½•å·²æäº¤",
  "data": {
    "id": "QI-20251121-001",
    "batchId": "BATCH-20251121-001",
    "inspectionDate": "2025-11-21",
    "sampleSize": 100,
    "passCount": 98,
    "failCount": 2,
    "passRate": 98.00,
    "result": "PASS",
    "inspectorId": 6,
    "inspectorName": "æå››",
    "notes": "è‰²æ³½ç•¥æµ…,ä½†åœ¨å…è®¸èŒƒå›´å†…"
  }
}

// åç«¯å¤„ç†:
// 1. è®¡ç®— pass_rate = (98 / 100) Ã— 100 = 98.00
// 2. åˆ¤å®š result: 98.00 >= 95% â†’ PASS
// 3. æ›´æ–°æ‰¹æ¬¡ quality_status = result
// 4. è‹¥ result = PASS, åˆ™æ‰¹æ¬¡å¯ä»¥å®Œæˆç”Ÿäº§</code></pre>
                </div>

                <h2>3.4 æˆæœ¬è‡ªåŠ¨è®¡ç®—</h2>

                <h3>3.4.1 æˆæœ¬è®¡ç®—å…¬å¼</h3>
                <pre><code>æˆæœ¬æ„æˆ:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
1. åŸæ–™æˆæœ¬ (Material Cost)
   formula: æ¶ˆè€—ç‰©æ–™çš„å•ä»· Ã— æ¶ˆè€—æ•°é‡
   example: ç•ªèŒ„0.5å…ƒ/kg Ã— 950kg = 475å…ƒ

2. äººå·¥æˆæœ¬ (Labor Cost)
   formula: Î£(å‘˜å·¥æ—¥è–ª / 24 Ã— å·¥ä½œæ—¶é•¿(å°æ—¶))
   example: 5ä¸ªå·¥äºº, æ—¥è–ª300å…ƒ, å·¥ä½œ8å°æ—¶
            = 5 Ã— (300/24) Ã— 8 = 5000å…ƒ

3. è®¾å¤‡æˆæœ¬ (Equipment Cost)
   formula: Î£(è®¾å¤‡å¹´æŠ˜æ—§ / 365 Ã— è¿è¡Œå¤©æ•°)
   example: æ…æ‹Œæœºå¹´æŠ˜æ—§2000å…ƒ, è¿è¡Œ0.5å¤©
            = 2000/365 Ã— 0.5 = 2.74å…ƒ

4. å…¶ä»–æˆæœ¬ (Other Cost)
   formula: äººå·¥é…ç½®çš„æ‚è´¹
   example: æ°´ç”µè´¹ã€åŒ…è£…è´¹ç­‰

æ€»æˆæœ¬ = Material + Labor + Equipment + Other
å•ä½æˆæœ¬ = æ€»æˆæœ¬ / å®é™…äº§é‡

ç¤ºä¾‹è®¡ç®—:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ç”Ÿäº§æ‰¹æ¬¡: BATCH-20251121-001
è®¡åˆ’äº§é‡: 1000kg
å®é™…äº§é‡: 990kg (ä¸¢å¤±10kg)
è‰¯å“æ•°: 975kg
ä¸åˆæ ¼: 15kg

åŸæ–™æˆæœ¬:    475.00å…ƒ (ç•ªèŒ„950kg Ã— 0.5å…ƒ/kg)
äººå·¥æˆæœ¬:  5000.00å…ƒ
è®¾å¤‡æˆæœ¬:     2.74å…ƒ
å…¶ä»–æˆæœ¬:   100.00å…ƒ
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
æ€»æˆæœ¬:    5577.74å…ƒ
å•ä½æˆæœ¬:     5.64å…ƒ/kg (5577.74 / 990)</code></pre>

                <h3>3.4.2 æˆæœ¬è®¡ç®—API</h3>
                <div class="java-block">
<pre><code>// GET /api/mobile/{factoryId}/processing/batches/{batchId}/cost-analysis
// æ— éœ€è¯·æ±‚å‚æ•°

{
  "code": 200,
  "message": "æˆæœ¬åˆ†æè·å–æˆåŠŸ",
  "data": {
    "batchNumber": "BATCH-20251121-001",
    "plannedQuantity": 1000.00,
    "actualQuantity": 990.00,
    "goodQuantity": 975.00,
    "defectQuantity": 15.00,

    "costBreakdown": {
      "materialCost": 475.00,
      "laborCost": 5000.00,
      "equipmentCost": 2.74,
      "otherCost": 100.00,
      "totalCost": 5577.74
    },

    "unitCost": 5.64,
    "yieldRate": 98.48,        // (975 / 990) Ã— 100
    "efficiency": 99.00,        // (990 / 1000) Ã— 100

    "costDetails": {
      "materials": [
        {
          "materialName": "ç•ªèŒ„",
          "quantity": 950.00,
          "unitPrice": 0.50,
          "cost": 475.00
        }
      ],
      "labor": {
        "workers": 5,
        "totalHours": 40.0,
        "dailySalary": 300.00,
        "cost": 5000.00
      },
      "equipment": {
        "equipmentId": 5,
        "equipmentName": "æ…æ‹Œæœº A",
        "annualDepreciation": 2000.00,
        "daysUsed": 0.5,
        "cost": 2.74
      }
    }
  }
}</code></pre>
                </div>

                <h2>3.5 ç”Ÿäº§ä»ªè¡¨æ¿</h2>

                <h3>3.5.1 ä»ªè¡¨æ¿API</h3>
                <table>
                    <thead>
                        <tr>
                            <th>ç«¯ç‚¹</th>
                            <th>è¯´æ˜</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>GET /dashboard/overview</td>
                            <td>ç”Ÿäº§æ¦‚è§ˆ (KPIæ±‡æ€»)</td>
                        </tr>
                        <tr>
                            <td>GET /dashboard/production</td>
                            <td>ç”Ÿäº§ç»Ÿè®¡ (æŒ‰æ—¶é—´èšåˆ)</td>
                        </tr>
                        <tr>
                            <td>GET /dashboard/quality</td>
                            <td>è´¨é‡ä»ªè¡¨æ¿ (æ£€æµ‹é€šè¿‡ç‡)</td>
                        </tr>
                        <tr>
                            <td>GET /dashboard/equipment</td>
                            <td>è®¾å¤‡ä»ªè¡¨æ¿ (è¿è¡ŒçŠ¶æ€)</td>
                        </tr>
                        <tr>
                            <td>GET /dashboard/alerts</td>
                            <td>å‘Šè­¦ä»ªè¡¨æ¿ (å¼‚å¸¸æç¤º)</td>
                        </tr>
                        <tr>
                            <td>GET /dashboard/trends</td>
                            <td>è¶‹åŠ¿åˆ†æ (å†å²å¯¹æ¯”)</td>
                        </tr>
                    </tbody>
                </table>

                <h3>3.5.2 ä»ªè¡¨æ¿æ•°æ®ç¤ºä¾‹</h3>
                <div class="java-block">
<pre><code>// GET /api/mobile/{factoryId}/processing/dashboard/overview

{
  "code": 200,
  "data": {
    "summary": {
      "completedBatchesToday": 3,
      "inProgressBatches": 2,
      "plannedBatches": 5,
      "totalProductionToday": 2500.00,
      "defectRateToday": 1.50,
      "averageUnitCost": 5.42
    },

    "qualityMetrics": {
      "passRate": 98.50,
      "inspectionsDoneToday": 5,
      "defectiveBatches": 0,
      "criticalIssues": 0
    },

    "equipmentStatus": {
      "totalEquipment": 8,
      "running": 4,
      "idle": 3,
      "maintenance": 1,
      "alerts": 2
    },

    "costMetrics": {
      "totalCostToday": 13710.00,
      "averageCostPerBatch": 4570.00,
      "laborCostPercentage": 73.0,
      "materialCostPercentage": 18.0,
      "equipmentCostPercentage": 8.0,
      "otherCostPercentage": 1.0
    }
  }
}</code></pre>
                </div>

                <h2>3.6 ç”Ÿäº§è®¡åˆ’ç®¡ç†</h2>

                <h3>3.6.1 ç”Ÿäº§è®¡åˆ’API</h3>
                <table>
                    <thead>
                        <tr>
                            <th>HTTPæ–¹æ³•</th>
                            <th>è·¯ç”±</th>
                            <th>è¯´æ˜</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>POST</td>
                            <td>/api/mobile/{factoryId}/production-plans</td>
                            <td>åˆ›å»ºç”Ÿäº§è®¡åˆ’</td>
                        </tr>
                        <tr>
                            <td>GET</td>
                            <td>/api/mobile/{factoryId}/production-plans</td>
                            <td>æŸ¥è¯¢è®¡åˆ’åˆ—è¡¨</td>
                        </tr>
                        <tr>
                            <td>GET</td>
                            <td>/api/mobile/{factoryId}/production-plans/{planId}</td>
                            <td>è·å–è®¡åˆ’è¯¦æƒ…</td>
                        </tr>
                        <tr>
                            <td>PUT</td>
                            <td>/api/mobile/{factoryId}/production-plans/{planId}</td>
                            <td>æ›´æ–°ç”Ÿäº§è®¡åˆ’</td>
                        </tr>
                        <tr>
                            <td>POST</td>
                            <td>/api/mobile/{factoryId}/production-plans/{planId}/start</td>
                            <td>å¼€å§‹æ‰§è¡Œè®¡åˆ’</td>
                        </tr>
                        <tr>
                            <td>POST</td>
                            <td>/api/mobile/{factoryId}/production-plans/{planId}/complete</td>
                            <td>å®Œæˆè®¡åˆ’</td>
                        </tr>
                        <tr>
                            <td>POST</td>
                            <td>/api/mobile/{factoryId}/production-plans/{planId}/cancel</td>
                            <td>å–æ¶ˆè®¡åˆ’</td>
                        </tr>
                        <tr>
                            <td>GET</td>
                            <td>/api/mobile/{factoryId}/production-plans/pending-execution</td>
                            <td>è·å–å¾…æ‰§è¡Œè®¡åˆ’</td>
                        </tr>
                        <tr>
                            <td>GET</td>
                            <td>/api/mobile/{factoryId}/production-plans/today</td>
                            <td>è·å–ä»Šæ—¥è®¡åˆ’</td>
                        </tr>
                        <tr>
                            <td>GET</td>
                            <td>/api/mobile/{factoryId}/production-plans/statistics</td>
                            <td>ç”Ÿäº§ç»Ÿè®¡ (æŒ‰æ—¥æœŸèŒƒå›´)</td>
                        </tr>
                    </tbody>
                </table>

                <h2>3.7 åç«¯Serviceæ–¹æ³•</h2>

                <h3>3.7.1 ProcessingService æ¥å£</h3>
                <div class="java-block">
<pre><code>public interface ProcessingService {

    // ===== æ‰¹æ¬¡ç®¡ç† =====
    ProductionBatch createBatch(String factoryId, ProductionBatch batch);
    ProductionBatch startProduction(String factoryId, String batchId, Integer supervisorId);
    ProductionBatch pauseProduction(String factoryId, String batchId, String reason);
    ProductionBatch completeProduction(String factoryId, String batchId,
                                      BigDecimal actualQty, BigDecimal goodQty, BigDecimal defectQty);
    ProductionBatch cancelProduction(String factoryId, String batchId, String reason);
    ProductionBatch getBatchById(String factoryId, String batchId);
    PageResponse<ProductionBatch> getBatches(String factoryId, String status, PageRequest pageRequest);
    List<Map<String, Object>> getBatchTimeline(String factoryId, String batchId);

    // ===== ç‰©æ–™ç®¡ç† =====
    MaterialBatch createMaterialReceipt(String factoryId, MaterialBatch materialBatch);
    PageResponse<MaterialBatch> getMaterialReceipts(String factoryId, PageRequest pageRequest);
    MaterialBatch updateMaterialReceipt(String factoryId, String batchId, MaterialBatch updates);
    void recordMaterialConsumption(String factoryId, String productionBatchId,
                                  List<Map<String, Object>> consumptions);

    // ===== è´¨æ£€ç®¡ç† =====
    Map<String, Object> submitInspection(String factoryId, String batchId, Map<String, Object> inspection);
    PageResponse<Map<String, Object>> getInspections(String factoryId, String batchId, PageRequest pageRequest);
    Map<String, Object> getQualityStatistics(String factoryId, LocalDate startDate, LocalDate endDate);
    List<Map<String, Object>> getQualityTrends(String factoryId, Integer days);

    // ===== æˆæœ¬åˆ†æ =====
    Map<String, Object> getBatchCostAnalysis(String factoryId, String batchId);
    ProductionBatch recalculateBatchCost(String factoryId, String batchId);

    // ===== ä»ªè¡¨æ¿ =====
    Map<String, Object> getDashboardOverview(String factoryId);
    Map<String, Object> getProductionStatistics(String factoryId, String period);
    Map<String, Object> getQualityDashboard(String factoryId);
    Map<String, Object> getEquipmentDashboard(String factoryId);
    Map<String, Object> getTrendAnalysis(String factoryId, String metric, Integer days);
}</code></pre>
                </div>

                <h2>3.8 å‰ç«¯Screenæ˜ å°„</h2>
                <table>
                    <thead>
                        <tr>
                            <th>æ–‡ä»¶å</th>
                            <th>åŠŸèƒ½è¯´æ˜</th>
                            <th>å…³é”®ç‰¹æ€§</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>ProcessingDashboard.tsx</code></td>
                            <td>ç”Ÿäº§æ¨¡å—ä¸»ç•Œé¢</td>
                            <td>æ€»è§ˆå¡ç‰‡ã€ç»Ÿè®¡æ•°æ®ã€å¿«é€Ÿæ“ä½œ</td>
                        </tr>
                        <tr>
                            <td><code>CreateBatchScreen.tsx</code></td>
                            <td>åˆ›å»ºç”Ÿäº§æ‰¹æ¬¡</td>
                            <td>è¡¨å•è¾“å…¥ã€ç‰©æ–™é€‰æ‹©ã€éªŒè¯</td>
                        </tr>
                        <tr>
                            <td><code>BatchListScreen.tsx</code></td>
                            <td>æ‰¹æ¬¡åˆ—è¡¨</td>
                            <td>åˆ†é¡µã€çŠ¶æ€ç­›é€‰ã€æœç´¢</td>
                        </tr>
                        <tr>
                            <td><code>BatchDetailScreen.tsx</code></td>
                            <td>æ‰¹æ¬¡è¯¦æƒ…</td>
                            <td>å®Œæ•´ä¿¡æ¯ã€æ—¶é—´çº¿ã€æˆæœ¬åˆ†è§£</td>
                        </tr>
                        <tr>
                            <td><code>CreateQualityRecordScreen.tsx</code></td>
                            <td>è´¨æ£€è®°å½•è¾“å…¥</td>
                            <td>æ ·æœ¬é‡ã€åˆæ ¼æ•°ã€å¤‡æ³¨</td>
                        </tr>
                        <tr>
                            <td><code>QualityInspectionListScreen.tsx</code></td>
                            <td>è´¨æ£€è®°å½•åˆ—è¡¨</td>
                            <td>æ—¥æœŸèŒƒå›´ã€åˆæ ¼ç‡æ˜¾ç¤º</td>
                        </tr>
                        <tr>
                            <td><code>QualityAnalyticsScreen.tsx</code></td>
                            <td>è´¨é‡åˆ†æ</td>
                            <td>è¶‹åŠ¿å›¾è¡¨ã€KPIã€ç¼ºé™·åˆ†å¸ƒ</td>
                        </tr>
                        <tr>
                            <td><code>MaterialReceiptScreen.tsx</code></td>
                            <td>ç‰©æ–™å…¥åº“</td>
                            <td>æ‰¹å·å½•å…¥ã€æ•°é‡éªŒè¯ã€ä¾›åº”å•†</td>
                        </tr>
                        <tr>
                            <td><code>CostAnalysisDashboard.tsx</code></td>
                            <td>æˆæœ¬åˆ†æ</td>
                            <td>æˆæœ¬æ‹†åˆ†å›¾è¡¨ã€å•ä½æˆæœ¬ã€å¯¹æ¯”</td>
                        </tr>
                        <tr>
                            <td><code>ProductionPlanManagementScreen.tsx</code></td>
                            <td>ç”Ÿäº§è®¡åˆ’</td>
                            <td>è®¡åˆ’åˆ›å»ºã€æ‰§è¡Œã€ç»Ÿè®¡</td>
                        </tr>
                    </tbody>
                </table>
            </section>

            
            <section id="ch4">
                <h1>4. AIæ™ºèƒ½åˆ†ææ¨¡å—</h1>

                <h2>æ¨¡å—æè¿°</h2>
                <p>AIæ™ºèƒ½åˆ†ææ¨¡å—é›†æˆDeepSeekå¤§è¯­è¨€æ¨¡å‹,ä¸ºç”Ÿäº§ç®¡ç†æä¾›æ™ºèƒ½å†³ç­–æ”¯æŒã€‚é€šè¿‡åˆ†æå†å²ç”Ÿäº§æ•°æ®ã€æˆæœ¬æ„æˆã€è´¨é‡æŒ‡æ ‡ç­‰,ä¸ºç®¡ç†è€…æä¾›å¯æ“ä½œçš„ä¼˜åŒ–å»ºè®®å’Œæˆæœ¬æ§åˆ¶æ–¹æ¡ˆã€‚è¯¥æ¨¡å—é‡‡ç”¨é…é¢ç®¡ç†åˆ¶åº¦ã€å¤šå±‚ç¼“å­˜æœºåˆ¶å’Œè¯¦ç»†çš„å®¡è®¡æ—¥å¿—ã€‚</p>

                <div class="info-box">
                    <h3>æ ¸å¿ƒç‰¹æ€§</h3>
                    <p><strong>æ™ºèƒ½åˆ†æ | é…é¢ç®¡ç† | 7å¤©ç¼“å­˜ | AIåˆ†æè¿½é—® | å‘¨/æœˆæŠ¥å‘Š | å†å²ç»¼åˆåˆ†æ</strong></p>
                </div>

                <h2>4.1 AIåˆ†æåŠŸèƒ½</h2>

                <h3>4.1.1 ä¸‰å±‚åˆ†ææ¨¡å¼</h3>
                <table>
                    <thead>
                        <tr>
                            <th>åˆ†ææ¨¡å¼</th>
                            <th>è¯´æ˜</th>
                            <th>é…é¢æ¶ˆè€—</th>
                            <th>ç¼“å­˜æ—¶é—´</th>
                            <th>ç”¨é€”</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>é»˜è®¤åˆ†æ</strong></td>
                            <td>é¦–æ¬¡åˆ†æå•ä¸ªæ‰¹æ¬¡æˆ–æ—¶é—´æ®µ</td>
                            <td>1å•ä½</td>
                            <td>7å¤©</td>
                            <td>å¿«é€Ÿè·å–å•æ‰¹æˆæœ¬åˆ†æ</td>
                        </tr>
                        <tr>
                            <td><strong>è¿½é—®(å¯¹è¯)</strong></td>
                            <td>åœ¨åˆ†æç»“æœåŸºç¡€ä¸Šç»§ç»­æé—®</td>
                            <td>1å•ä½</td>
                            <td>7å¤©</td>
                            <td>æ·±å…¥æ¢è®¨ä¼˜åŒ–æ–¹æ¡ˆ</td>
                        </tr>
                        <tr>
                            <td><strong>å†å²ç»¼åˆ</strong></td>
                            <td>è·¨å¤šæ‰¹æ¬¡ã€å¤šå‘¨æœŸæ·±åº¦åˆ†æ</td>
                            <td>5å•ä½</td>
                            <td>90å¤©</td>
                            <td>é•¿æœŸè¶‹åŠ¿ã€æ ¹æœ¬åŸå› åˆ†æ</td>
                        </tr>
                    </tbody>
                </table>

                <h3>4.1.2 AIåˆ†æAPIç«¯ç‚¹</h3>
                <table>
                    <thead>
                        <tr>
                            <th>HTTPæ–¹æ³•</th>
                            <th>è·¯ç”±</th>
                            <th>è¯´æ˜</th>
                            <th>é…é¢æ¶ˆè€—</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>POST</td>
                            <td>/api/mobile/{factoryId}/ai/analysis/cost/batch</td>
                            <td>åˆ†æå•ä¸ªæ‰¹æ¬¡æˆæœ¬</td>
                            <td>1å•ä½</td>
                        </tr>
                        <tr>
                            <td>POST</td>
                            <td>/api/mobile/{factoryId}/ai/analysis/cost/time-range</td>
                            <td>åˆ†ææ—¶é—´æ®µå†…æˆæœ¬</td>
                            <td>1å•ä½</td>
                        </tr>
                        <tr>
                            <td>POST</td>
                            <td>/api/mobile/{factoryId}/ai/analysis/cost/compare</td>
                            <td>å¯¹æ¯”åˆ†æå¤šæ‰¹æ¬¡</td>
                            <td>1å•ä½</td>
                        </tr>
                        <tr>
                            <td>GET</td>
                            <td>/api/mobile/{factoryId}/ai/quota</td>
                            <td>æŸ¥çœ‹é…é¢å‰©ä½™</td>
                            <td>0å•ä½</td>
                        </tr>
                        <tr>
                            <td>PUT</td>
                            <td>/api/mobile/{factoryId}/ai/quota</td>
                            <td>æ›´æ–°é…é¢é™åˆ¶ (ä»…ç®¡ç†å‘˜)</td>
                            <td>0å•ä½</td>
                        </tr>
                        <tr>
                            <td>GET</td>
                            <td>/api/mobile/{factoryId}/ai/conversations/{sessionId}</td>
                            <td>è·å–å¯¹è¯å†å²</td>
                            <td>0å•ä½</td>
                        </tr>
                        <tr>
                            <td>DELETE</td>
                            <td>/api/mobile/{factoryId}/ai/conversations/{sessionId}</td>
                            <td>å…³é—­å¯¹è¯ä¼šè¯</td>
                            <td>0å•ä½</td>
                        </tr>
                        <tr>
                            <td>GET</td>
                            <td>/api/mobile/{factoryId}/ai/reports</td>
                            <td>åˆ—è¡¨æŸ¥è¯¢AIæŠ¥å‘Š</td>
                            <td>0å•ä½</td>
                        </tr>
                        <tr>
                            <td>GET</td>
                            <td>/api/mobile/{factoryId}/ai/reports/{reportId}</td>
                            <td>è·å–æŠ¥å‘Šè¯¦æƒ…</td>
                            <td>0å•ä½</td>
                        </tr>
                        <tr>
                            <td>POST</td>
                            <td>/api/mobile/{factoryId}/ai/reports/generate</td>
                            <td>ç”Ÿæˆæ–°æŠ¥å‘Š</td>
                            <td>5å•ä½</td>
                        </tr>
                    </tbody>
                </table>

                <h3>4.1.3 æ‰¹æ¬¡åˆ†æè¯·æ±‚/å“åº”ç¤ºä¾‹</h3>
                <div class="java-block">
<pre><code>// POST /api/mobile/{factoryId}/ai/analysis/cost/batch
{
  "batchId": "BATCH-20251121-001",
  "dimension": "cost_breakdown"  // åˆ†æç»´åº¦
}

// æˆåŠŸå“åº” (200) - ä½¿ç”¨AIç”Ÿæˆçš„åˆ†æ
{
  "code": 200,
  "message": "åˆ†ææˆåŠŸ",
  "data": {
    "batchId": "BATCH-20251121-001",
    "batchNumber": "BATCH-20251121-001",
    "analysisType": "cost_breakdown",
    "sessionId": "SESSION-20251121-001",
    "cachedResult": false,           // é¦–æ¬¡åˆ†æ,æœªä½¿ç”¨ç¼“å­˜
    "analysisText": "# æ‰¹æ¬¡ BATCH-20251121-001 æˆæœ¬åˆ†æ\n\n## æ¦‚è¿°\nè¯¥æ‰¹æ¬¡ç”Ÿäº§1000kgç•ªèŒ„é…±,å®é™…äº§é‡990kg,è‰¯å“ç‡98.48%ã€‚æ€»æˆæœ¬5577.74å…ƒ,å•ä½æˆæœ¬5.64å…ƒ/kgã€‚\n\n## æˆæœ¬æ„æˆåˆ†æ\n\n### åŸæ–™æˆæœ¬: 475.00å…ƒ (8.5%)\n- ç•ªèŒ„950kg Ã— 0.5å…ƒ/kg = 475å…ƒ\n- å æ¯”æœ€ä½,åŸæ–™æˆæœ¬è¾ƒä¸ºç»æµ\n\n### äººå·¥æˆæœ¬: 5000.00å…ƒ (89.6%)\n- 5ä¸ªå·¥äºº Ã— 300å…ƒ/å¤© = 1500å…ƒ\n- å®é™…å·¥æ—¶:40å°æ—¶ = 5000å…ƒ\n- å æ¯”æœ€é«˜,æ˜¯ä¸»è¦æˆæœ¬é¡¹\n\n## ä¼˜åŒ–å»ºè®®\n\n1. **äººå·¥æˆæœ¬ä¼˜åŒ–** (å¯å‡å°‘20%)\n   - è€ƒè™‘è‡ªåŠ¨åŒ–è®¾å¤‡æŠ•å…¥\n   - ä¼˜åŒ–å·¥ä½œæµç¨‹,æé«˜æ•ˆç‡\n   - é¢„è®¡å¯æ¯æ‰¹èŠ‚çœ1000å…ƒ\n\n2. **è®¾å¤‡è´¹ç”¨** (ç›®å‰ä»…2.74å…ƒ)\n   - è®¾å¤‡åˆ©ç”¨ç‡è¾ƒé«˜\n   - ç»´æŠ¤æˆæœ¬åœ¨åˆç†èŒƒå›´å†…\n\n3. **è‰¯å“ç‡æå‡** (98.48%)\n   - å·²æ¥è¿‘ç›®æ ‡å€¼(98%)\n   - å»ºè®®ç»´æŒå½“å‰è´¨æ£€æ ‡å‡†\n\n## æˆæœ¬å¯¹æ ‡\n\nä¸è¿‘æœŸæ‰¹æ¬¡å¹³å‡å€¼å¯¹æ¯”:\n- å•ä½æˆæœ¬: 5.64å…ƒ/kg (å¹³å‡5.42å…ƒ/kg)\n- å·®å¼‚: +0.22å…ƒ/kg (+4.1%)\n- ä¸»è¦åŸå› : æœ¬æ‰¹æ¬¡å·¥ä½œç”¨æ—¶ç•¥é•¿(40å°æ—¶ vs å¹³å‡38å°æ—¶)\n\n## å†å²è¶‹åŠ¿\n\nè¿‡å»7å¤©å•ä½æˆæœ¬å˜åŒ–:\n- 11æœˆ14æ—¥: 5.50å…ƒ/kg\n- 11æœˆ15æ—¥: 5.48å…ƒ/kg\n- 11æœˆ16æ—¥: 5.40å…ƒ/kg\n- 11æœˆ17æ—¥: 5.42å…ƒ/kg\n- 11æœˆ18æ—¥: 5.45å…ƒ/kg\n- 11æœˆ19æ—¥: 5.43å…ƒ/kg\n- 11æœˆ21æ—¥: 5.64å…ƒ/kg (ä»Šæ—¥)\n\n**ç»“è®º**: æ•´ä½“æˆæœ¬ä¿æŒç¨³å®š,å°å¹…ä¸Šå‡å¯èƒ½ä¸å­£èŠ‚æ€§å› ç´ ç›¸å…³ã€‚",
    "quotaUsed": 1,
    "remainingQuota": 99,
    "analysisTime": "2025-11-21T14:30:00"
  }
}</code></pre>
                </div>

                <h2>4.2 é…é¢ç®¡ç†ç³»ç»Ÿ</h2>

                <h3>4.2.1 é…é¢æ¨¡å‹</h3>
                <div class="info-box">
                    <h3>é…é¢è§„åˆ™</h3>
                    <ul>
                        <li><strong>å‘¨é…é¢</strong>: 100åˆ†æå•ä½</li>
                        <li><strong>é‡ç½®æ—¶é—´</strong>: æ¯å‘¨ä¸€ 00:00 (UTC)</li>
                        <li><strong>æ¶ˆè€—è§„åˆ™</strong>:
                            <ul>
                                <li>é»˜è®¤åˆ†æ: 1å•ä½/æ¬¡</li>
                                <li>è¿½é—®: 1å•ä½/æ¬¡</li>
                                <li>å†å²ç»¼åˆ: 5å•ä½/æ¬¡</li>
                            </ul>
                        </li>
                        <li><strong>è¶…é¢å¤„ç†</strong>: å½“é…é¢ç”¨å°½,æ— æ³•è¿›è¡Œæ–°çš„AIåˆ†æ,ä½†å¯è®¿é—®ç¼“å­˜ç»“æœ</li>
                    </ul>
                </div>

                <h3>4.2.2 é…é¢æŸ¥è¯¢API</h3>
                <div class="java-block">
<pre><code>// GET /api/mobile/{factoryId}/ai/quota

{
  "code": 200,
  "data": {
    "factoryId": "CRETAS_2024_001",
    "weekOf": "2025-11-17",              // æœ¬å‘¨èµ·å§‹æ—¥æœŸ
    "totalAllowance": 100,
    "used": 15,
    "remaining": 85,
    "lastResetTime": "2025-11-17T00:00:00",
    "nextResetTime": "2025-11-24T00:00:00",
    "daysUntilReset": 3,
    "usageHistory": [
      {
        "date": "2025-11-21",
        "used": 5,
        "details": [
          { "type": "batch_analysis", "count": 3, "quota": 3 },
          { "type": "follow_up_questions", "count": 2, "quota": 2 }
        ]
      },
      {
        "date": "2025-11-20",
        "used": 10,
        "details": [
          { "type": "batch_analysis", "count": 8, "quota": 8 },
          { "type": "historical_report", "count": 1, "quota": 5 }
        ]
      }
    ]
  }
}</code></pre>
                </div>

                <h2>4.3 ç¼“å­˜æœºåˆ¶ä¸å­˜å‚¨</h2>

                <h3>4.3.1 ç¼“å­˜ç­–ç•¥</h3>
                <table>
                    <thead>
                        <tr>
                            <th>æŠ¥å‘Šç±»å‹</th>
                            <th>TTL</th>
                            <th>ç¼“å­˜é”®ç»„åˆ</th>
                            <th>è¯´æ˜</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>batch (å•æ‰¹)</td>
                            <td>7å¤©</td>
                            <td>factoryId + batchId + questionType</td>
                            <td>åŒé—®é¢˜é‡å¤æŸ¥è¯¢è¿”å›ç¼“å­˜</td>
                        </tr>
                        <tr>
                            <td>weekly (å‘¨æŠ¥)</td>
                            <td>30å¤©</td>
                            <td>factoryId + weekStartDate</td>
                            <td>æ¯å‘¨ä¸€è‡ªåŠ¨ç”Ÿæˆ,å‘¨å†…å¤ç”¨</td>
                        </tr>
                        <tr>
                            <td>monthly (æœˆæŠ¥)</td>
                            <td>90å¤©</td>
                            <td>factoryId + monthStartDate</td>
                            <td>æ¯æœˆ1æ—¥è‡ªåŠ¨ç”Ÿæˆ</td>
                        </tr>
                        <tr>
                            <td>historical (å†å²)</td>
                            <td>90å¤©</td>
                            <td>factoryId + periodStart + periodEnd</td>
                            <td>è·¨åº¦>30å¤©çš„åˆ†æ</td>
                        </tr>
                    </tbody>
                </table>

                <h3>4.3.2 ç¼“å­˜æ•°æ®è¡¨</h3>
                <div class="sql-block">
<pre><code>-- ai_analysis_results è¡¨ (AIåˆ†æç»“æœç¼“å­˜)
CREATE TABLE ai_analysis_results (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  factory_id VARCHAR(50) NOT NULL,
  batch_id VARCHAR(50),
  report_type VARCHAR(20) NOT NULL,
  -- æŠ¥å‘Šç±»å‹: batch, weekly, monthly, historical

  analysis_text LONGTEXT,               -- Markdownæ ¼å¼çš„åˆ†æç»“æœ
  session_id VARCHAR(100),
  period_start TIMESTAMP,
  period_end TIMESTAMP,

  expires_at TIMESTAMP NOT NULL,        -- ç¼“å­˜è¿‡æœŸæ—¶é—´
  is_auto_generated BOOLEAN DEFAULT FALSE,

  -- ä½¿ç”¨ç»Ÿè®¡
  view_count INT DEFAULT 0,             -- è¢«æŸ¥çœ‹çš„æ¬¡æ•°
  last_viewed_at TIMESTAMP,

  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,

  INDEX idx_factory_type_expires (factory_id, report_type, expires_at),
  INDEX idx_batch_id (batch_id),
  INDEX idx_factory_batch (factory_id, batch_id),
  INDEX idx_session_id (session_id)
);

-- ai_quota_usage è¡¨ (é…é¢ä½¿ç”¨è¿½è¸ª)
CREATE TABLE ai_quota_usage (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  factory_id VARCHAR(50) NOT NULL,
  week_of DATE NOT NULL,

  total_allowance INT DEFAULT 100,      -- æœ¬å‘¨é…é¢æ€»é¢
  used INT DEFAULT 0,                   -- å·²ä½¿ç”¨é‡
  remaining INT DEFAULT 100,            -- å‰©ä½™é‡

  last_reset TIMESTAMP,                 -- ä¸Šæ¬¡é‡ç½®æ—¶é—´
  last_request_time TIMESTAMP,          -- ä¸Šæ¬¡è¯·æ±‚æ—¶é—´

  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,

  UNIQUE KEY uk_factory_week (factory_id, week_of)
);

-- ai_audit_logs è¡¨ (å®¡è®¡æ—¥å¿—)
CREATE TABLE ai_audit_logs (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  factory_id VARCHAR(50) NOT NULL,
  user_id BIGINT,

  request_type VARCHAR(50),             -- batch_analysis, follow_up, historical_report
  question TEXT,
  dimension VARCHAR(100),

  cache_hit BOOLEAN,                    -- æ˜¯å¦ä½¿ç”¨ç¼“å­˜
  response_time_ms LONG,                -- å“åº”æ—¶é—´(æ¯«ç§’)
  quota_consumed INT,

  success BOOLEAN,
  error_message VARCHAR(500),

  request_timestamp TIMESTAMP NOT NULL,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

  INDEX idx_factory_user_time (factory_id, user_id, request_timestamp),
  INDEX idx_factory_type (factory_id, request_type)
);</code></pre>
                </div>

                <h2>4.4 å‰ç«¯é›†æˆ</h2>

                <h3>4.4.1 AIåˆ†æç›¸å…³Screen</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Screenæ–‡ä»¶</th>
                            <th>åŠŸèƒ½</th>
                            <th>å…³é”®ç»„ä»¶</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>DeepSeekAnalysisScreen.tsx</code></td>
                            <td>ä¸»åˆ†æç•Œé¢</td>
                            <td>åˆ†æé€‰æ‹©å™¨ã€ç»“æœå±•ç¤ºã€è¿½é—®è¾“å…¥</td>
                        </tr>
                        <tr>
                            <td><code>CostAnalysisDashboard.tsx</code></td>
                            <td>æˆæœ¬åˆ†ææ¦‚è§ˆ</td>
                            <td>æˆæœ¬æ‹†åˆ†ã€è¶‹åŠ¿å›¾ã€AIå»ºè®®å¡ç‰‡</td>
                        </tr>
                        <tr>
                            <td><code>AIAnalysisDetailScreen.tsx</code></td>
                            <td>è¯¦ç»†åˆ†ææŠ¥å‘Š</td>
                            <td>å®Œæ•´Markdownæ¸²æŸ“ã€å¯¼å‡ºåŠŸèƒ½</td>
                        </tr>
                        <tr>
                            <td><code>AIReportListScreen.tsx</code></td>
                            <td>æŠ¥å‘Šåˆ—è¡¨</td>
                            <td>æŒ‰ç±»å‹åˆ†ç±»ã€æ—¥æœŸç­›é€‰ã€ç¼“å­˜æ ‡è®°</td>
                        </tr>
                        <tr>
                            <td><code>AIConversationHistoryScreen.tsx</code></td>
                            <td>å¯¹è¯å†å²</td>
                            <td>ä¼šè¯åˆ—è¡¨ã€æ¶ˆæ¯å›æ”¾ã€å¯¼å‡º</td>
                        </tr>
                        <tr>
                            <td><code>TimeRangeCostAnalysisScreen.tsx</code></td>
                            <td>æ—¶é—´æ®µåˆ†æ</td>
                            <td>æ—¥æœŸèŒƒå›´é€‰æ‹©ã€ç»´åº¦å¯¹æ¯”</td>
                        </tr>
                    </tbody>
                </table>

                <h3>4.4.2 é…é¢æç¤ºUI</h3>
                <pre><code>å‰ç«¯é…é¢çŠ¶æ€æç¤ºè§„åˆ™:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
å‰©ä½™é…é¢ | æç¤ºé¢œè‰² | æç¤ºæ–‡æ¡ˆ
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
> 50   | ç»¿è‰²    | âœ“ é…é¢å……è¶³ (XXå•ä½)
20-50  | é»„è‰²    | âš  é…é¢ç´§å¼  (XXå•ä½)
< 20   | çº¢è‰²    | âš  é…é¢å³å°†ç”¨å°½ (XXå•ä½)
0      | ç°è‰²    | âœ— æœ¬å‘¨é…é¢å·²ç”¨å°½
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

é…é¢è¶…é™å¤„ç†:
1. ç¦ç”¨æ–°åˆ†ææŒ‰é’®,ä½†å¯æŸ¥çœ‹å†å²ç¼“å­˜
2. æ˜¾ç¤º"é…é¢ç”¨å°½,ä¸‹å‘¨ä¸€è‡ªåŠ¨æ¢å¤"æç¤º
3. æä¾›"å‡çº§é…é¢"æŒ‰é’®(ä»…ç®¡ç†å‘˜å¯æ“ä½œ)</code></pre>

                <h2>4.5 æŠ¥å‘Šè‡ªåŠ¨ç”Ÿæˆ</h2>

                <h3>4.5.1 è‡ªåŠ¨ç”Ÿæˆè§„åˆ™</h3>
                <table>
                    <thead>
                        <tr>
                            <th>æŠ¥å‘Šç±»å‹</th>
                            <th>ç”Ÿæˆè§¦å‘</th>
                            <th>æ‰§è¡Œæ—¶é—´</th>
                            <th>é…é¢æ¶ˆè€—</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>å‘¨æŠ¥å‘Š</td>
                            <td>æ¯å‘¨ä¸€è‡ªåŠ¨</td>
                            <td>00:00 UTC</td>
                            <td>1å•ä½</td>
                        </tr>
                        <tr>
                            <td>æœˆæŠ¥å‘Š</td>
                            <td>æ¯æœˆ1æ—¥è‡ªåŠ¨</td>
                            <td>00:00 UTC</td>
                            <td>5å•ä½</td>
                        </tr>
                        <tr>
                            <td>æ‰¹æ¬¡åˆ†æ</td>
                            <td>ç”¨æˆ·æŒ‰éœ€è¯·æ±‚</td>
                            <td>å®æ—¶</td>
                            <td>1å•ä½</td>
                        </tr>
                    </tbody>
                </table>

                <h2>4.6 é”™è¯¯å¤„ç†</h2>

                <h3>4.6.1 å¼‚å¸¸åœºæ™¯</h3>
                <div class="java-block">
<pre><code>// åœºæ™¯1: é…é¢ç”¨å°½
{
  "code": 429,
  "message": "æœ¬å‘¨AIåˆ†æé…é¢å·²ç”¨å°½,è¯·ç­‰å¾…ä¸‹å‘¨ä¸€æ¢å¤",
  "data": {
    "remainingQuota": 0,
    "nextResetTime": "2025-11-24T00:00:00",
    "retryAfter": 259200,  // 3å¤©(ç§’æ•°)
    "suggestion": "æ‚¨å¯ä»¥æŸ¥çœ‹å†å²åˆ†æç»“æœæˆ–è”ç³»ç®¡ç†å‘˜ç”³è¯·é…é¢æå‡"
  }
}

// åœºæ™¯2: AIæœåŠ¡è¶…æ—¶
{
  "code": 504,
  "message": "AIåˆ†ææœåŠ¡è¶…æ—¶,è¿”å›ç¼“å­˜ç»“æœ",
  "data": {
    "batchId": "BATCH-20251121-001",
    "cachedResult": true,
    "cacheAge": "2 hours ago",
    "note": "è¿”å›çš„æ˜¯2å°æ—¶å‰çš„ç¼“å­˜åˆ†æ,æœ€æ–°æ•°æ®å¯èƒ½æœ‰å˜åŒ–"
  }
}

// åœºæ™¯3: DeepSeek APIå¤±è´¥
{
  "code": 502,
  "message": "æš‚æ—¶æ— æ³•è¿›è¡ŒAIåˆ†æ,å»ºè®®ç¨åé‡è¯•",
  "data": {
    "retryAfter": 300,    // 5åˆ†é’Ÿåé‡è¯•
    "suggestion": "å¯æŸ¥çœ‹è¯¥æ‰¹æ¬¡çš„å†å²åˆ†æç¼“å­˜"
  }
}</code></pre>
                </div>

                <h2>4.7 æ•°æ®æµä¸é›†æˆ</h2>

                <h3>4.7.1 AIåˆ†æè§¦å‘é“¾</h3>
                <pre><code>ç”Ÿäº§æµç¨‹ â†’ AIåˆ†æè§¦å‘
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

1. æ‰¹æ¬¡å®Œæˆ (status = COMPLETED)
   â†“
2. æˆæœ¬è®¡ç®—å®Œæˆ (total_cost â‰  null)
   â†“
3. è´¨æ£€é€šè¿‡ (quality_status = PASS)
   â†“
4. åå°è‡ªåŠ¨è§¦å‘ AI åˆ†æ
   (è¯·æ±‚é˜Ÿåˆ—,å¼‚æ­¥å¤„ç†,ä¸é˜»å¡å‰ç«¯)
   â†“
5. AI ç»“æœä¿å­˜åˆ° ai_analysis_results (ç¼“å­˜7å¤©)
   â†“
6. å‰ç«¯è‡ªåŠ¨åˆ·æ–°,ç”¨æˆ·çœ‹åˆ°åˆ†æç»“æœ</code></pre>

                <h3>4.7.2 ç¼“å­˜å‘½ä¸­åˆ¤å®šé€»è¾‘</h3>
                <pre><code>æ£€æŸ¥é¡ºåº:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

è¾“å…¥: batchId, dimension, sessionId

1. æ£€æŸ¥ä¼šè¯ç¼“å­˜ (SESSIONçº§åˆ«)
   å¦‚æœ sessionId å­˜åœ¨ä¸”è®°å½•åœ¨ç¼“å­˜ä¸­ â†’ è¿”å›ç¼“å­˜ç»“æœ

2. æ£€æŸ¥æ‰¹æ¬¡ç¼“å­˜ (BATCHçº§åˆ«)
   å¦‚æœ [factoryId + batchId + dimension] å­˜åœ¨ä¸”æœªè¿‡æœŸ â†’ è¿”å›ç¼“å­˜ç»“æœ

3. æ£€æŸ¥å‘¨æŠ¥ç¼“å­˜ (WEEKLYçº§åˆ«)
   å¦‚æœè¯·æ±‚æ˜¯"æœ¬å‘¨æ•°æ®åˆ†æ" â†’ æŸ¥æ‰¾å‘¨æŠ¥ç¼“å­˜

4. éƒ½æœªå‘½ä¸­
   è°ƒç”¨ AI æœåŠ¡ç”Ÿæˆæ–°åˆ†æ â†’ æ¶ˆè€—é…é¢ â†’ ä¿å­˜ç¼“å­˜</code></pre>
            </section>

            
            <section id="ch5">
                <h1>5. è®¾å¤‡ç®¡ç†æ¨¡å—</h1>

                <h2>æ¨¡å—æè¿°</h2>
                <p>è®¾å¤‡ç®¡ç†æ¨¡å—è´Ÿè´£è·Ÿè¸ªå·¥å‚æ‰€æœ‰ç”Ÿäº§è®¾å¤‡çš„ç”Ÿå‘½å‘¨æœŸ,åŒ…æ‹¬è®¾å¤‡ä¿¡æ¯ç»´æŠ¤ã€è¿è¡Œç›‘æ§ã€ç»´æŠ¤è®¡åˆ’ç®¡ç†ã€æŠ˜æ—§è®¡ç®—å’Œå‘Šè­¦ã€‚è¯¥æ¨¡å—ä¸ç”Ÿäº§æ¨¡å—ç´§å¯†åä½œ,è‡ªåŠ¨è®°å½•è®¾å¤‡ä½¿ç”¨æ—¶é—´å¹¶è®¡ç®—æŠ˜æ—§æˆæœ¬ã€‚</p>

                <div class="info-box">
                    <h3>æ ¸å¿ƒåŠŸèƒ½</h3>
                    <p><strong>è®¾å¤‡å°è´¦ | è¿è¡Œç›‘æ§ | ç»´æŠ¤ç®¡ç† | æŠ˜æ—§è®¡ç®— | å‘Šè­¦ç³»ç»Ÿ | å¯¼å…¥å¯¼å‡º</strong></p>
                </div>

                <h2>5.1 è®¾å¤‡ç®¡ç†API</h2>

                <h3>5.1.1 å®Œæ•´APIç«¯ç‚¹åˆ—è¡¨</h3>
                <table>
                    <thead>
                        <tr>
                            <th>HTTPæ–¹æ³•</th>
                            <th>è·¯ç”±</th>
                            <th>è¯´æ˜</th>
                            <th>æƒé™</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>POST</td>
                            <td>/api/mobile/{factoryId}/equipment</td>
                            <td>åˆ›å»ºæ–°è®¾å¤‡</td>
                            <td>factory_admin+</td>
                        </tr>
                        <tr>
                            <td>PUT</td>
                            <td>/api/mobile/{factoryId}/equipment/{equipmentId}</td>
                            <td>æ›´æ–°è®¾å¤‡ä¿¡æ¯</td>
                            <td>factory_admin+</td>
                        </tr>
                        <tr>
                            <td>DELETE</td>
                            <td>/api/mobile/{factoryId}/equipment/{equipmentId}</td>
                            <td>åˆ é™¤è®¾å¤‡</td>
                            <td>factory_admin+</td>
                        </tr>
                        <tr>
                            <td>GET</td>
                            <td>/api/mobile/{factoryId}/equipment</td>
                            <td>æŸ¥è¯¢è®¾å¤‡åˆ—è¡¨ (åˆ†é¡µ)</td>
                            <td>supervisor+</td>
                        </tr>
                        <tr>
                            <td>GET</td>
                            <td>/api/mobile/{factoryId}/equipment/{equipmentId}</td>
                            <td>è·å–è®¾å¤‡è¯¦æƒ…</td>
                            <td>supervisor+</td>
                        </tr>
                        <tr>
                            <td>GET</td>
                            <td>/api/mobile/{factoryId}/equipment/status/{status}</td>
                            <td>æŒ‰çŠ¶æ€ç­›é€‰è®¾å¤‡</td>
                            <td>supervisor+</td>
                        </tr>
                        <tr>
                            <td>GET</td>
                            <td>/api/mobile/{factoryId}/equipment/type/{type}</td>
                            <td>æŒ‰ç±»å‹ç­›é€‰è®¾å¤‡</td>
                            <td>supervisor+</td>
                        </tr>
                        <tr>
                            <td>GET</td>
                            <td>/api/mobile/{factoryId}/equipment/search</td>
                            <td>æœç´¢è®¾å¤‡</td>
                            <td>supervisor+</td>
                        </tr>
                        <tr>
                            <td>PUT</td>
                            <td>/api/mobile/{factoryId}/equipment/{equipmentId}/status</td>
                            <td>æ›´æ–°è®¾å¤‡çŠ¶æ€</td>
                            <td>supervisor+</td>
                        </tr>
                        <tr>
                            <td>POST</td>
                            <td>/api/mobile/{factoryId}/equipment/{equipmentId}/start</td>
                            <td>è®¾å¤‡å¯åŠ¨</td>
                            <td>operator+</td>
                        </tr>
                        <tr>
                            <td>POST</td>
                            <td>/api/mobile/{factoryId}/equipment/{equipmentId}/stop</td>
                            <td>è®¾å¤‡åœæ­¢</td>
                            <td>operator+</td>
                        </tr>
                        <tr>
                            <td>POST</td>
                            <td>/api/mobile/{factoryId}/equipment/{equipmentId}/maintenance</td>
                            <td>è®°å½•ç»´æŠ¤</td>
                            <td>supervisor+</td>
                        </tr>
                        <tr>
                            <td>GET</td>
                            <td>/api/mobile/{factoryId}/equipment/needing-maintenance</td>
                            <td>éœ€è¦ç»´æŠ¤çš„è®¾å¤‡</td>
                            <td>supervisor+</td>
                        </tr>
                        <tr>
                            <td>GET</td>
                            <td>/api/mobile/{factoryId}/equipment/expiring-warranty</td>
                            <td>ä¿ä¿®æœŸå°†è¿‡æœŸçš„è®¾å¤‡</td>
                            <td>factory_admin+</td>
                        </tr>
                        <tr>
                            <td>GET</td>
                            <td>/api/mobile/{factoryId}/equipment/{equipmentId}/depreciated-value</td>
                            <td>è·å–æŠ˜æ—§åä»·å€¼</td>
                            <td>factory_admin+</td>
                        </tr>
                        <tr>
                            <td>GET</td>
                            <td>/api/mobile/{factoryId}/equipment/{equipmentId}/statistics</td>
                            <td>è®¾å¤‡ç»Ÿè®¡ä¿¡æ¯</td>
                            <td>supervisor+</td>
                        </tr>
                        <tr>
                            <td>GET</td>
                            <td>/api/mobile/{factoryId}/equipment/{equipmentId}/usage-history</td>
                            <td>ä½¿ç”¨å†å²è®°å½•</td>
                            <td>supervisor+</td>
                        </tr>
                        <tr>
                            <td>GET</td>
                            <td>/api/mobile/{factoryId}/equipment/{equipmentId}/maintenance-history</td>
                            <td>ç»´æŠ¤å†å²è®°å½•</td>
                            <td>supervisor+</td>
                        </tr>
                        <tr>
                            <td>GET</td>
                            <td>/api/mobile/{factoryId}/equipment/overall-statistics</td>
                            <td>å…¨å‚è®¾å¤‡ç»Ÿè®¡</td>
                            <td>factory_admin+</td>
                        </tr>
                        <tr>
                            <td>GET</td>
                            <td>/api/mobile/{factoryId}/equipment/{equipmentId}/efficiency-report</td>
                            <td>æ•ˆç‡æŠ¥å‘Š</td>
                            <td>supervisor+</td>
                        </tr>
                        <tr>
                            <td>GET</td>
                            <td>/api/mobile/{factoryId}/equipment/{equipmentId}/oee</td>
                            <td>OEEè®¡ç®—</td>
                            <td>supervisor+</td>
                        </tr>
                        <tr>
                            <td>POST</td>
                            <td>/api/mobile/{factoryId}/equipment/import</td>
                            <td>å¯¼å…¥Excel</td>
                            <td>factory_admin+</td>
                        </tr>
                        <tr>
                            <td>GET</td>
                            <td>/api/mobile/{factoryId}/equipment/export</td>
                            <td>å¯¼å‡ºè®¾å¤‡åˆ—è¡¨</td>
                            <td>factory_admin+</td>
                        </tr>
                        <tr>
                            <td>POST</td>
                            <td>/api/mobile/{factoryId}/equipment/{equipmentId}/scrap</td>
                            <td>æŠ¥åºŸè®¾å¤‡</td>
                            <td>factory_admin+</td>
                        </tr>
                    </tbody>
                </table>

                <h3>5.1.2 è®¾å¤‡æ•°æ®åº“è¡¨</h3>
                <div class="sql-block">
<pre><code>-- equipment è¡¨ (è®¾å¤‡ä¸»è¡¨)
CREATE TABLE equipment (
  id INT PRIMARY KEY AUTO_INCREMENT,
  factory_id VARCHAR(50) NOT NULL,
  code VARCHAR(50) NOT NULL,
  name VARCHAR(100) NOT NULL,
  category VARCHAR(50),                 -- è®¾å¤‡ç±»åˆ«(æ…æ‹Œæœºã€çƒ˜å¹²æœºç­‰)
  model VARCHAR(100),
  manufacturer VARCHAR(100),
  purchase_date DATE,
  purchase_price DECIMAL(10,2),

  -- è®¾å¤‡çŠ¶æ€
  status VARCHAR(20) NOT NULL DEFAULT 'idle',
  -- å¯é€‰å€¼: idle(é—²ç½®), running(è¿è¡Œä¸­), maintenance(ç»´æŠ¤ä¸­), scrapped(æŠ¥åºŸ)

  location VARCHAR(100),
  total_operating_hours INT DEFAULT 0,  -- ç´¯è®¡è¿è¡Œæ—¶é—´(å°æ—¶)

  -- ç»´æŠ¤ç›¸å…³
  last_maintenance_date DATE,
  next_maintenance_date DATE,
  maintenance_interval_days INT,        -- ç»´æŠ¤é—´éš”(å¤©æ•°)
  maintenance_notes TEXT,

  -- çŠ¶æ€
  is_active BOOLEAN DEFAULT TRUE,
  notes TEXT,

  created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,

  UNIQUE KEY uk_factory_code (factory_id, code),
  INDEX idx_equipment_factory (factory_id),
  INDEX idx_equipment_status (status),
  INDEX idx_equipment_maintenance (next_maintenance_date)
);

-- equipment_maintenance è¡¨ (ç»´æŠ¤è®°å½•)
CREATE TABLE equipment_maintenance (
  id INT PRIMARY KEY AUTO_INCREMENT,
  equipment_id INT NOT NULL,
  maintenance_type VARCHAR(50) NOT NULL,
  -- å¯é€‰å€¼: routine(å®šæœŸç»´æŠ¤), repair(ç»´ä¿®), overhaul(å¤§ä¿®)

  maintenance_date DATE NOT NULL,
  start_time TIMESTAMP,
  end_time TIMESTAMP,
  description TEXT,
  cost DECIMAL(10,2),
  performed_by VARCHAR(100),
  next_maintenance_date DATE,
  notes TEXT,

  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,

  INDEX idx_maintenance_equipment (equipment_id),
  INDEX idx_maintenance_date (maintenance_date),
  FOREIGN KEY (equipment_id) REFERENCES equipment(id) ON DELETE CASCADE
);

-- equipment_usage è¡¨ (ä½¿ç”¨è®°å½•)
CREATE TABLE equipment_usage (
  id INT PRIMARY KEY AUTO_INCREMENT,
  equipment_id INT NOT NULL,
  batch_id VARCHAR(191),
  start_time TIMESTAMP NOT NULL,
  end_time TIMESTAMP,
  running_hours INT,
  notes TEXT,

  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,

  INDEX idx_usage_equipment (equipment_id),
  INDEX idx_usage_batch (batch_id),
  FOREIGN KEY (equipment_id) REFERENCES equipment(id) ON DELETE CASCADE
);

-- equipment_alerts è¡¨ (å‘Šè­¦è®°å½•)
CREATE TABLE equipment_alerts (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  factory_id VARCHAR(50) NOT NULL,
  equipment_id INT NOT NULL,
  alert_type VARCHAR(50) NOT NULL,
  -- å¯é€‰å€¼: maintenance_due, warranty_expiring, high_hours, temperature, pressureç­‰

  level VARCHAR(20) NOT NULL,
  -- å¯é€‰å€¼: low, medium, high, critical

  message VARCHAR(500),
  triggered_at TIMESTAMP NOT NULL,
  status VARCHAR(20) DEFAULT 'active',
  -- å¯é€‰å€¼: active(æ´»è·ƒ), acknowledged(å·²ç¡®è®¤), resolved(å·²è§£å†³), ignored(å·²å¿½ç•¥)

  resolved_at TIMESTAMP,
  notes TEXT,

  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,

  INDEX idx_factory_equipment_status (factory_id, equipment_id, status),
  INDEX idx_triggered_at (triggered_at),
  FOREIGN KEY (equipment_id) REFERENCES equipment(id) ON DELETE CASCADE
);</code></pre>
                </div>

                <h2>5.2 è®¾å¤‡åˆ›å»ºä¸ç»´æŠ¤</h2>

                <h3>5.2.1 åˆ›å»ºè®¾å¤‡è¯·æ±‚ç¤ºä¾‹</h3>
                <div class="java-block">
<pre><code>// POST /api/mobile/{factoryId}/equipment
{
  "code": "EQP-001",
  "name": "æ…æ‹Œæœº A",
  "category": "æ…æ‹Œæœº",
  "model": "KMC-500",
  "manufacturer": "æŸçŸ¥åå“ç‰Œ",
  "purchaseDate": "2023-05-15",
  "purchasePrice": 50000.00,
  "location": "1å·ç”Ÿäº§è½¦é—´",
  "maintenanceIntervalDays": 30,
  "notes": "ç”¨äºç•ªèŒ„é…±æ…æ‹Œ,æ•ˆç‡é«˜"
}

// æˆåŠŸå“åº” (201)
{
  "code": 201,
  "message": "è®¾å¤‡åˆ›å»ºæˆåŠŸ",
  "data": {
    "id": 1,
    "factoryId": "CRETAS_2024_001",
    "code": "EQP-001",
    "name": "æ…æ‹Œæœº A",
    "category": "æ…æ‹Œæœº",
    "model": "KMC-500",
    "manufacturer": "æŸçŸ¥åå“ç‰Œ",
    "purchaseDate": "2023-05-15",
    "purchasePrice": 50000.00,
    "status": "idle",
    "location": "1å·ç”Ÿäº§è½¦é—´",
    "totalOperatingHours": 0,
    "lastMaintenanceDate": null,
    "nextMaintenanceDate": "2025-12-21",
    "maintenanceIntervalDays": 30,
    "isActive": true,
    "createdAt": "2025-11-21T11:00:00"
  }
}</code></pre>
                </div>

                <h3>5.2.2 è®¾å¤‡å¯åœä¸ç»´æŠ¤</h3>
                <div class="java-block">
<pre><code>// POST /api/mobile/{factoryId}/equipment/{equipmentId}/start
{
  "batchId": "BATCH-20251121-001"
}

// å“åº”
{
  "code": 200,
  "message": "è®¾å¤‡å·²å¯åŠ¨",
  "data": {
    "equipmentId": 1,
    "status": "running",
    "startTime": "2025-11-21T14:00:00",
    "batchId": "BATCH-20251121-001"
  }
}

// ==========================================

// POST /api/mobile/{factoryId}/equipment/{equipmentId}/stop
{
  "runningHours": 2
}

// å“åº”: è®¾å¤‡åœæ­¢,æ€»è¿è¡Œæ—¶é—´æ›´æ–°
{
  "code": 200,
  "message": "è®¾å¤‡å·²åœæ­¢",
  "data": {
    "equipmentId": 1,
    "status": "idle",
    "endTime": "2025-11-21T16:00:00",
    "sessionRunningHours": 2,
    "totalOperatingHours": 1245  // ç´¯è®¡æ—¶é—´
  }
}

// ==========================================

// POST /api/mobile/{factoryId}/equipment/{equipmentId}/maintenance
{
  "maintenanceType": "routine",
  "maintenanceDate": "2025-11-21",
  "description": "æ›´æ¢æ©¡çš®å«ã€æ¸…æ´—å†…éƒ¨",
  "cost": 500.00,
  "performedBy": "å¼ ä¸‰"
}

// å“åº”: ç»´æŠ¤è®°å½•åˆ›å»º,è‡ªåŠ¨è®¡ç®—ä¸‹æ¬¡ç»´æŠ¤æ—¥æœŸ
{
  "code": 200,
  "message": "ç»´æŠ¤è®°å½•å·²åˆ›å»º",
  "data": {
    "maintenanceId": 15,
    "equipmentId": 1,
    "maintenanceType": "routine",
    "maintenanceDate": "2025-11-21",
    "cost": 500.00,
    "performedBy": "å¼ ä¸‰",
    "nextMaintenanceDate": "2025-12-21",  // è‡ªåŠ¨è®¡ç®—
    "createdAt": "2025-11-21T14:30:00"
  }
}</code></pre>
                </div>

                <h2>5.3 æŠ˜æ—§è®¡ç®—</h2>

                <h3>5.3.1 æŠ˜æ—§å…¬å¼</h3>
                <pre><code>ç›´çº¿æŠ˜æ—§æ³• (Linear Depreciation Method)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

åŸºæœ¬å…¬å¼:
å¹´æŠ˜æ—§é¢ = (è´­ç½®ä»·æ ¼ - æ®‹å€¼) / ä½¿ç”¨å¹´é™

æ—¥æŠ˜æ—§é¢ = å¹´æŠ˜æ—§é¢ / 365

è¿è¡ŒæŠ˜æ—§ = æ—¥æŠ˜æ—§é¢ Ã— è¿è¡Œå¤©æ•°

ç¤ºä¾‹:
è´­ç½®ä»·æ ¼: 50,000å…ƒ
æ®‹å€¼: 5,000å…ƒ
ä½¿ç”¨å¹´é™: 5å¹´

å¹´æŠ˜æ—§é¢ = (50,000 - 5,000) / 5 = 9,000å…ƒ/å¹´
æ—¥æŠ˜æ—§é¢ = 9,000 / 365 = 24.66å…ƒ/å¤©
æ—¶æŠ˜æ—§ = 24.66 / 24 = 1.03å…ƒ/å°æ—¶

è‹¥è¯¥æ‰¹æ¬¡è®¾å¤‡è¿è¡Œ2å°æ—¶:
æ‰¹æ¬¡è®¾å¤‡æˆæœ¬ = 1.03 Ã— 2 = 2.06å…ƒ</code></pre>

                <h3>5.3.2 æŠ˜æ—§æŸ¥è¯¢API</h3>
                <div class="java-block">
<pre><code>// GET /api/mobile/{factoryId}/equipment/{equipmentId}/depreciated-value

{
  "code": 200,
  "data": {
    "equipmentId": 1,
    "code": "EQP-001",
    "name": "æ…æ‹Œæœº A",
    "purchasePrice": 50000.00,
    "purchaseDate": "2023-05-15",

    "depreciationModel": "linear",
    "usefulLifeYears": 5,
    "estimatedScrapValue": 5000.00,

    "annualDepreciation": 9000.00,
    "totalDepreciationToDate": 18000.00,  // 2å¹´å·²æŠ˜æ—§
    "netBookValue": 32000.00,             // 50000 - 18000
    "depreciationRatePercentage": 36.0,   // 18000 / 50000

    "monthlyDepreciation": 750.00,
    "hourlyDepreciation": 1.03,

    "totalOperatingHours": 1245,
    "depreciationByUsage": 1282.35,       // 1.03 Ã— 1245

    "reportDate": "2025-11-21"
  }
}</code></pre>
                </div>

                <h2>5.4 è®¾å¤‡å‘Šè­¦ç³»ç»Ÿ</h2>

                <h3>5.4.1 å‘Šè­¦ç±»å‹ä¸è§„åˆ™</h3>
                <table>
                    <thead>
                        <tr>
                            <th>å‘Šè­¦ç±»å‹</th>
                            <th>è§¦å‘æ¡ä»¶</th>
                            <th>å‘Šè­¦çº§åˆ«</th>
                            <th>å¤„ç†æ–¹å¼</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>ç»´æŠ¤è¶…æœŸ</td>
                            <td>å½“å‰æ—¥æœŸ >= nextMaintenanceDate</td>
                            <td>CRITICAL</td>
                            <td>åœæ­¢ä½¿ç”¨,è¿›è¡Œç»´æŠ¤</td>
                        </tr>
                        <tr>
                            <td>ç»´æŠ¤å³å°†åˆ°æœŸ</td>
                            <td>nextMaintenanceDate - ç°åœ¨ <= 7å¤©</td>
                            <td>HIGH</td>
                            <td>æå‰è®¡åˆ’ç»´æŠ¤</td>
                        </tr>
                        <tr>
                            <td>ä¿ä¿®æœŸå°†è¿‡æœŸ</td>
                            <td>warranty_end_date - ç°åœ¨ <= 30å¤©</td>
                            <td>MEDIUM</td>
                            <td>ç”³è¯·å»¶ä¿æˆ–ç»­ä¿</td>
                        </tr>
                        <tr>
                            <td>è¿è¡Œæ—¶é—´è¶…é•¿</td>
                            <td>totalOperatingHours > safeThreshold</td>
                            <td>MEDIUM</td>
                            <td>å»ºè®®è¿›è¡Œå¤§ä¿®</td>
                        </tr>
                        <tr>
                            <td>å¼‚å¸¸åœæ­¢</td>
                            <td>è®¾å¤‡æ„å¤–æ–­ç”µ/åœæœº</td>
                            <td>HIGH</td>
                            <td>æ£€æŸ¥åŸå› å¹¶ä¿®å¤</td>
                        </tr>
                    </tbody>
                </table>

                <h3>5.4.2 å‘Šè­¦æŸ¥è¯¢API</h3>
                <div class="java-block">
<pre><code>// GET /api/mobile/{factoryId}/equipment/needing-maintenance

{
  "code": 200,
  "data": [
    {
      "id": 1,
      "code": "EQP-001",
      "name": "æ…æ‹Œæœº A",
      "nextMaintenanceDate": "2025-11-21",
      "lastMaintenanceDate": "2025-10-22",
      "daysOverdue": 0,
      "alert": {
        "type": "maintenance_due",
        "level": "CRITICAL",
        "message": "ç»´æŠ¤å·²è¶…æœŸ,éœ€ç«‹å³è¿›è¡Œ"
      }
    }
  ]
}</code></pre>
                </div>

                <h2>5.5 OEE (Overall Equipment Effectiveness)</h2>

                <h3>5.5.1 OEEè®¡ç®—å…¬å¼</h3>
                <pre><code>OEE = å¯ç”¨ç‡ Ã— æ•ˆèƒ½ Ã— è´¨é‡ç‡
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

1. å¯ç”¨ç‡ (Availability)
   = å®é™…è¿è¡Œæ—¶é—´ / è®¡åˆ’æ—¶é—´
   ç¤ºä¾‹: è®¾å¤‡è®¡åˆ’8å°æ—¶,å®é™…è¿è¡Œ7.5å°æ—¶ â†’ 93.75%

2. æ•ˆèƒ½ (Performance)
   = å®é™…äº§é‡ / ç†è®ºäº§é‡
   ç¤ºä¾‹: ç†è®ºæ¯å°æ—¶100ä»¶,å®é™…95ä»¶ â†’ 95%

3. è´¨é‡ç‡ (Quality)
   = åˆæ ¼äº§å“æ•° / æ€»äº§å“æ•°
   ç¤ºä¾‹: 100ä»¶ä¸­99ä»¶åˆæ ¼ â†’ 99%

æ€»OEE = 93.75% Ã— 95% Ã— 99% = 88.4%

è§„åˆ™:
- OEE >= 85%: ä¼˜ç§€(ç»¿è‰²)
- 75% <= OEE < 85%: è‰¯å¥½(é»„è‰²)
- OEE < 75%: éœ€æ”¹è¿›(çº¢è‰²)</code></pre>

                <h3>5.5.2 OEEæŸ¥è¯¢API</h3>
                <div class="java-block">
<pre><code>// GET /api/mobile/{factoryId}/equipment/{equipmentId}/oee
// Query: startDate=2025-11-01, endDate=2025-11-21

{
  "code": 200,
  "data": {
    "equipmentId": 1,
    "name": "æ…æ‹Œæœº A",
    "period": {
      "startDate": "2025-11-01",
      "endDate": "2025-11-21",
      "days": 21
    },

    "availability": 0.9375,              // 93.75%
    "performance": 0.95,                 // 95%
    "quality": 0.99,                     // 99%

    "oee": 0.884,                        // 88.4%
    "oeeStatus": "excellent",            // ç»¿è‰²
    "targetOee": 0.85,
    "gap": 0.034,                        // è¶…ç›®æ ‡3.4ä¸ªç™¾åˆ†ç‚¹

    "details": {
      "plannedOperatingHours": 168,
      "actualOperatingHours": 157.5,
      "downtime": 10.5,
      "downtimeReason": "ç»´æŠ¤1æ¬¡(4å°æ—¶), è®¾å¤‡åœæœº2æ¬¡(2å°æ—¶/æ¬¡)",
      "theoreticalProduction": 15800,
      "actualProduction": 15010,
      "totalProduced": 15010,
      "defectiveUnits": 152,
      "qualityRate": 0.99
    }
  }
}</code></pre>
                </div>

                <h2>5.6 å‰ç«¯Screenæ˜ å°„</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Screenæ–‡ä»¶</th>
                            <th>åŠŸèƒ½</th>
                            <th>å…³é”®ç‰¹æ€§</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>EquipmentManagementScreen.tsx</code></td>
                            <td>è®¾å¤‡ç®¡ç†</td>
                            <td>CRUDæ“ä½œã€çŠ¶æ€ç®¡ç†ã€import/export</td>
                        </tr>
                        <tr>
                            <td><code>EquipmentDetailScreen.tsx</code></td>
                            <td>è®¾å¤‡è¯¦æƒ…</td>
                            <td>å®Œæ•´ä¿¡æ¯ã€ä½¿ç”¨å†å²ã€ç»´æŠ¤è®¡åˆ’</td>
                        </tr>
                        <tr>
                            <td><code>EquipmentMonitoringScreen.tsx</code></td>
                            <td>è®¾å¤‡ç›‘æ§</td>
                            <td>å®æ—¶çŠ¶æ€ã€è¿è¡Œæ—¶é—´ã€é¢„å‘Šè­¦</td>
                        </tr>
                        <tr>
                            <td><code>EquipmentAlertsScreen.tsx</code></td>
                            <td>å‘Šè­¦ç®¡ç†</td>
                            <td>å‘Šè­¦åˆ—è¡¨ã€çŠ¶æ€åˆ‡æ¢ã€å¤„ç†è®°å½•</td>
                        </tr>
                    </tbody>
                </table>
            </section>

            
            <section id="ch6">
                <h1>6. åº“å­˜ç®¡ç†æ¨¡å—</h1>

                <h2>æ¨¡å—æè¿°</h2>
                <p>åº“å­˜ç®¡ç†æ¨¡å—ç®¡ç†åŸææ–™å’ŒåŠæˆå“çš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸ,ä»å…¥åº“ã€æ¶ˆè€—è¿½è¸ªã€åº“å­˜ä»·å€¼è®¡ç®—åˆ°è¿‡æœŸå¤„ç†ã€‚è¯¥æ¨¡å—å®ç°äº†FIFO (å…ˆè¿›å…ˆå‡º)ç®—æ³•è‡ªåŠ¨æ¨èç‰©æ–™æ‰¹æ¬¡,æ”¯æŒå†·é“¾é£Ÿå“çš„ç‰¹æ®Šå¤„ç†,å¹¶æä¾›å®æ—¶åº“å­˜æ•°æ®å’Œä»·å€¼åˆ†æã€‚</p>

                <div class="info-box">
                    <h3>æ ¸å¿ƒåŠŸèƒ½</h3>
                    <p><strong>ç‰©æ–™å…¥åº“ | FIFOæ¨è | æ¶ˆè€—è¿½è¸ª | åº“å­˜ä¼°å€¼ | è¿‡æœŸå¤„ç† | å†·é“¾ç®¡ç†</strong></p>
                </div>

                <h2>6.1 ç‰©æ–™æ‰¹æ¬¡ç®¡ç†</h2>

                <h3>6.1.1 ç‰©æ–™æ‰¹æ¬¡API</h3>
                <table>
                    <thead>
                        <tr>
                            <th>HTTPæ–¹æ³•</th>
                            <th>è·¯ç”±</th>
                            <th>è¯´æ˜</th>
                            <th>æƒé™</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>POST</td>
                            <td>/api/mobile/{factoryId}/material-batches</td>
                            <td>åˆ›å»ºç‰©æ–™æ‰¹æ¬¡</td>
                            <td>supervisor+</td>
                        </tr>
                        <tr>
                            <td>PUT</td>
                            <td>/api/mobile/{factoryId}/material-batches/{batchId}</td>
                            <td>æ›´æ–°ç‰©æ–™æ‰¹æ¬¡</td>
                            <td>supervisor+</td>
                        </tr>
                        <tr>
                            <td>DELETE</td>
                            <td>/api/mobile/{factoryId}/material-batches/{batchId}</td>
                            <td>åˆ é™¤ç‰©æ–™æ‰¹æ¬¡</td>
                            <td>factory_admin+</td>
                        </tr>
                        <tr>
                            <td>GET</td>
                            <td>/api/mobile/{factoryId}/material-batches</td>
                            <td>æŸ¥è¯¢ç‰©æ–™æ‰¹æ¬¡ (åˆ†é¡µ)</td>
                            <td>operator+</td>
                        </tr>
                        <tr>
                            <td>GET</td>
                            <td>/api/mobile/{factoryId}/material-batches/{batchId}</td>
                            <td>è·å–æ‰¹æ¬¡è¯¦æƒ…</td>
                            <td>operator+</td>
                        </tr>
                        <tr>
                            <td>GET</td>
                            <td>/api/mobile/{factoryId}/material-batches/material-type/{materialTypeId}</td>
                            <td>æŒ‰ç‰©æ–™ç±»å‹æŸ¥è¯¢</td>
                            <td>operator+</td>
                        </tr>
                        <tr>
                            <td>GET</td>
                            <td>/api/mobile/{factoryId}/material-batches/status/{status}</td>
                            <td>æŒ‰çŠ¶æ€ç­›é€‰</td>
                            <td>operator+</td>
                        </tr>
                        <tr>
                            <td>GET</td>
                            <td>/api/mobile/{factoryId}/material-batches/fifo/{materialTypeId}</td>
                            <td>è·å–FIFOæ¨èæ‰¹æ¬¡</td>
                            <td>operator+</td>
                        </tr>
                        <tr>
                            <td>GET</td>
                            <td>/api/mobile/{factoryId}/material-batches/expiring</td>
                            <td>è·å–å³å°†è¿‡æœŸæ‰¹æ¬¡</td>
                            <td>supervisor+</td>
                        </tr>
                        <tr>
                            <td>GET</td>
                            <td>/api/mobile/{factoryId}/material-batches/expired</td>
                            <td>è·å–å·²è¿‡æœŸæ‰¹æ¬¡</td>
                            <td>supervisor+</td>
                        </tr>
                        <tr>
                            <td>POST</td>
                            <td>/api/mobile/{factoryId}/material-batches/{batchId}/use</td>
                            <td>ä½¿ç”¨ç‰©æ–™</td>
                            <td>operator+</td>
                        </tr>
                        <tr>
                            <td>POST</td>
                            <td>/api/mobile/{factoryId}/material-batches/{batchId}/adjust</td>
                            <td>è°ƒæ•´åº“å­˜æ•°é‡</td>
                            <td>supervisor+</td>
                        </tr>
                        <tr>
                            <td>PUT</td>
                            <td>/api/mobile/{factoryId}/material-batches/{batchId}/status</td>
                            <td>æ›´æ–°æ‰¹æ¬¡çŠ¶æ€</td>
                            <td>supervisor+</td>
                        </tr>
                        <tr>
                            <td>POST</td>
                            <td>/api/mobile/{factoryId}/material-batches/{batchId}/reserve</td>
                            <td>é¢„ç•™ç‰©æ–™</td>
                            <td>supervisor+</td>
                        </tr>
                        <tr>
                            <td>POST</td>
                            <td>/api/mobile/{factoryId}/material-batches/{batchId}/release</td>
                            <td>é‡Šæ”¾é¢„ç•™</td>
                            <td>supervisor+</td>
                        </tr>
                        <tr>
                            <td>GET</td>
                            <td>/api/mobile/{factoryId}/material-batches/inventory/statistics</td>
                            <td>åº“å­˜ç»Ÿè®¡</td>
                            <td>supervisor+</td>
                        </tr>
                        <tr>
                            <td>GET</td>
                            <td>/api/mobile/{factoryId}/material-batches/inventory/valuation</td>
                            <td>åº“å­˜ä¼°å€¼</td>
                            <td>factory_admin+</td>
                        </tr>
                        <tr>
                            <td>GET</td>
                            <td>/api/mobile/{factoryId}/material-batches/low-stock</td>
                            <td>åº“å­˜ä¸è¶³è­¦å‘Š</td>
                            <td>supervisor+</td>
                        </tr>
                        <tr>
                            <td>POST</td>
                            <td>/api/mobile/{factoryId}/material-batches/{batchId}/convert-to-frozen</td>
                            <td>è½¬æ¢ä¸ºå†·å†»</td>
                            <td>supervisor+</td>
                        </tr>
                        <tr>
                            <td>POST</td>
                            <td>/api/mobile/{factoryId}/material-batches/{batchId}/undo-frozen</td>
                            <td>æ’¤é”€å†·å†»</td>
                            <td>supervisor+</td>
                        </tr>
                    </tbody>
                </table>

                <h3>6.1.2 ç‰©æ–™æ‰¹æ¬¡æ•°æ®è¡¨</h3>
                <div class="sql-block">
<pre><code>-- material_batches è¡¨ (ç‰©æ–™æ‰¹æ¬¡ä¸»è¡¨)
CREATE TABLE material_batches (
  id VARCHAR(191) PRIMARY KEY,
  factory_id VARCHAR(50) NOT NULL,
  batch_number VARCHAR(50) NOT NULL UNIQUE,
  material_type_id VARCHAR(191) NOT NULL,
  supplier_id VARCHAR(191),

  -- å…¥åº“ä¿¡æ¯
  inbound_date DATE NOT NULL,
  purchase_date DATE,
  expire_date DATE,

  -- æ•°é‡ä¿¡æ¯
  receipt_quantity DECIMAL(10,2) NOT NULL,  -- å…¥åº“æ•°é‡
  quantity_unit VARCHAR(20) NOT NULL,
  weight_per_unit DECIMAL(10,3),            -- å•ä½é‡é‡
  used_quantity DECIMAL(10,2) DEFAULT 0,    -- å·²ä½¿ç”¨æ•°é‡
  reserved_quantity DECIMAL(10,2) DEFAULT 0,-- é¢„ç•™æ•°é‡

  -- å½“å‰å¯ç”¨ = receipt_quantity - used_quantity - reserved_quantity

  -- ä»·æ ¼ä¿¡æ¯
  unit_price DECIMAL(10,2),
  total_price DECIMAL(12,2),

  -- çŠ¶æ€
  status VARCHAR(20) NOT NULL DEFAULT 'AVAILABLE',
  -- å¯é€‰å€¼: AVAILABLE(å¯ç”¨), PARTIAL(éƒ¨åˆ†ä½¿ç”¨), RESERVED(å·²é¢„ç•™), EXPIRED(å·²è¿‡æœŸ), DISPOSED(å·²å¤„ç†)

  storage_location VARCHAR(100),            -- å­˜å‚¨ä½ç½®
  quality_certificate VARCHAR(100),         -- è´¨é‡è¯ä¹¦å·
  notes TEXT,

  created_by INT NOT NULL,
  last_used_at TIMESTAMP,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,

  INDEX idx_batch_factory (factory_id),
  INDEX idx_batch_status (status),
  INDEX idx_batch_expire (expire_date),
  INDEX idx_batch_material (material_type_id),
  INDEX idx_batch_inbound (inbound_date)
);

-- material_consumption è¡¨ (æ¶ˆè€—è®°å½•)
CREATE TABLE material_consumption (
  id VARCHAR(191) PRIMARY KEY,
  factory_id VARCHAR(50) NOT NULL,
  batch_id VARCHAR(191) NOT NULL,
  production_plan_id VARCHAR(191),

  quantity_consumed DECIMAL(10,2) NOT NULL,
  consumption_date TIMESTAMP NOT NULL,
  recorded_by INT,
  notes TEXT,

  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,

  FOREIGN KEY (batch_id) REFERENCES material_batches(id),
  INDEX idx_consumption_batch (batch_id),
  INDEX idx_consumption_date (consumption_date)
);</code></pre>
                </div>

                <h2>6.2 FIFO (å…ˆè¿›å…ˆå‡º)ç®—æ³•</h2>

                <h3>6.2.1 FIFOæ¨èåŸç†</h3>
                <pre><code>FIFOç®—æ³• (First In First Out)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ç›®çš„: ä¼˜å…ˆä½¿ç”¨æœ€æ—©å…¥åº“çš„ç‰©æ–™æ‰¹æ¬¡,é¿å…ç‰©æ–™è¿‡æœŸæµªè´¹

æ’åºè§„åˆ™:
1. æŒ‰ inbound_date å‡åºæ’åˆ— (æœ€æ—©çš„ä¼˜å…ˆ)
2. åŒæ—¥æœŸæŒ‰ expire_date å‡åºæ’åˆ— (æœ€å¿«è¿‡æœŸçš„ä¼˜å…ˆ)

ç®—æ³•æµç¨‹:
Step 1: æŸ¥è¯¢æ‰€æœ‰ status=AVAILABLE çš„ç‰©æ–™æ‰¹æ¬¡
Step 2: æŒ‰è§„åˆ™æ’åº,ä»æœ€æ—©çš„å¼€å§‹
Step 3: ç´¯è®¡å½“å‰å¯ç”¨æ•°é‡,ç›´åˆ°æ»¡è¶³éœ€æ±‚é‡
Step 4: è¿”å›æ¨èæ‰¹æ¬¡åˆ—è¡¨åŠæ•°é‡åˆ†é…

ç¤ºä¾‹:
éœ€è¦ç•ªèŒ„ 950kg

ç‰©æ–™æ‰¹æ¬¡åˆ—è¡¨ (æŒ‰å…¥åº“æ—¥æœŸæ’åº):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ‰¹æ¬¡å·           â”‚ æ•°é‡ â”‚ ä½™é‡ â”‚ å…¥åº“æ—¥æœŸ        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ MAT-10-15-001   â”‚ 1000 â”‚ 900  â”‚ 2025-10-15    â”‚â† æœ€æ—©
â”‚ MAT-10-20-002   â”‚ 500  â”‚ 500  â”‚ 2025-10-20    â”‚
â”‚ MAT-11-01-003   â”‚ 800  â”‚ 800  â”‚ 2025-11-01    â”‚
â”‚ MAT-11-10-004   â”‚ 600  â”‚ 600  â”‚ 2025-11-10    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

FIFOæ¨è:
éœ€æ±‚: 950kg
æ¨è:
  1. MAT-10-15-001: 900kg (ç”¨å®Œ)
  2. MAT-10-20-002: 50kg (ç”¨å®Œ 50/500)</code></pre>

                <h3>6.2.2 FIFOæŸ¥è¯¢API</h3>
                <div class="java-block">
<pre><code>// GET /api/mobile/{factoryId}/material-batches/fifo/MT001
// Query: requiredQuantity=950

{
  "code": 200,
  "data": {
    "materialTypeId": "MT001",
    "materialName": "ç•ªèŒ„",
    "requiredQuantity": 950.00,
    "requiredUnit": "kg",

    "fifoRecommendation": [
      {
        "batchId": "MAT-20251015-001",
        "batchNumber": "MAT-10-15-001",
        "inboundDate": "2025-10-15",
        "expireDate": "2025-12-15",
        "availableQuantity": 900.00,
        "recommendedQuantity": 900.00,
        "unitPrice": 0.50,
        "cost": 450.00,
        "daysUntilExpire": 25
      },
      {
        "batchId": "MAT-20251020-002",
        "batchNumber": "MAT-10-20-002",
        "inboundDate": "2025-10-20",
        "expireDate": "2025-12-20",
        "availableQuantity": 500.00,
        "recommendedQuantity": 50.00,
        "unitPrice": 0.50,
        "cost": 25.00,
        "daysUntilExpire": 30
      }
    ],

    "totalRecommendedQuantity": 950.00,
    "totalCost": 475.00,
    "avgUnitPrice": 0.50,
    "remainingRequirement": 0.00
  }
}</code></pre>
                </div>

                <h2>6.3 è¿‡æœŸä¸å†·é“¾å¤„ç†</h2>

                <h3>6.3.1 è¿‡æœŸæ‰¹æ¬¡æŸ¥è¯¢</h3>
                <div class="java-block">
<pre><code>// GET /api/mobile/{factoryId}/material-batches/expiring
// Query: days=3 (é»˜è®¤æŸ¥è¯¢3å¤©å†…è¿‡æœŸçš„)

{
  "code": 200,
  "data": {
    "expiringBatches": [
      {
        "batchId": "MAT-20251015-001",
        "batchNumber": "MAT-10-15-001",
        "materialName": "ç•ªèŒ„",
        "expireDate": "2025-11-24",
        "daysUntilExpire": 3,
        "currentQuantity": 900.00,
        "unit": "kg",
        "unitPrice": 0.50,
        "totalValue": 450.00,
        "alert": {
          "level": "WARNING",
          "message": "è¯¥æ‰¹æ¬¡å°†åœ¨3å¤©å†…è¿‡æœŸ,å»ºè®®ä¼˜å…ˆä½¿ç”¨"
        }
      }
    ],

    "expiringInDays": 3,
    "totalBatches": 1,
    "totalValue": 450.00
  }
}</code></pre>
                </div>

                <h3>6.3.2 å†·é“¾è½¬æ¢ (æ–°å¢åŠŸèƒ½)</h3>
                <div class="java-block">
<pre><code>// POST /api/mobile/{factoryId}/material-batches/{batchId}/convert-to-frozen
{
  "convertedBy": 3,
  "conversionTime": "2025-11-21T10:00:00",
  "freezerLocation": "å†·åº“-18â„ƒ #3",
  "reason": "å»¶é•¿ä¿è´¨æœŸ,è®¡åˆ’ç”¨äºæ˜å¹´Q1"
}

// æˆåŠŸå“åº”
{
  "code": 200,
  "message": "å·²è½¬æ¢ä¸ºå†·å†»ä¿å­˜",
  "data": {
    "batchId": "MAT-20251015-001",
    "newStatus": "FROZEN",
    "storageLocation": "å†·åº“-18â„ƒ #3",
    "originalExpireDate": "2025-12-15",
    "estimatedFrozenExpireDate": "2026-06-15",  // é¢„è®¡å»¶é•¿åŠå¹´
    "conversionTime": "2025-11-21T10:00:00",
    "note": "å†·å†»åä¿è´¨æœŸå¯å»¶é•¿è‡³åŸæœ‰æ—¶é—´çš„2-3å€"
  }
}

// ==========================================

// POST /api/mobile/{factoryId}/material-batches/{batchId}/undo-frozen
// æ³¨: ä»…åœ¨è½¬æ¢å10åˆ†é’Ÿå†…å¯æ’¤é”€

{
  "reason": "è¯¯æ“ä½œ,åº”è¯¥æ˜¯å…¶ä»–æ‰¹æ¬¡"
}

// æˆåŠŸå“åº” (éœ€åœ¨è½¬æ¢å10åˆ†é’Ÿå†…)
{
  "code": 200,
  "message": "å†·å†»è½¬æ¢å·²æ’¤é”€",
  "data": {
    "batchId": "MAT-20251015-001",
    "status": "AVAILABLE",
    "storageLocation": "å¸¸æ¸©åº“-1åŒº"
  }
}</code></pre>
                </div>

                <h2>6.4 åº“å­˜ç»Ÿè®¡ä¸ä¼°å€¼</h2>

                <h3>6.4.1 åº“å­˜ç»Ÿè®¡API</h3>
                <div class="java-block">
<pre><code>// GET /api/mobile/{factoryId}/material-batches/inventory/statistics

{
  "code": 200,
  "data": {
    "factory": "CRETAS_2024_001",
    "statisticsDate": "2025-11-21",

    "summary": {
      "totalBatches": 45,
      "totalQuantity": 25500.00,
      "totalUnit": "kg",
      "totalValue": 12750.00,
      "averageUnitPrice": 0.50
    },

    "byMaterialType": [
      {
        "materialTypeId": "MT001",
        "materialName": "ç•ªèŒ„",
        "batches": 8,
        "quantity": 5000.00,
        "unit": "kg",
        "value": 2500.00,
        "unitPrice": 0.50
      },
      {
        "materialTypeId": "MT002",
        "materialName": "ç›",
        "batches": 3,
        "quantity": 200.00,
        "unit": "kg",
        "value": 50.00,
        "unitPrice": 0.25
      }
    ],

    "byStatus": {
      "available": { "quantity": 20000.00, "value": 10000.00 },
      "reserved": { "quantity": 3000.00, "value": 1500.00 },
      "frozen": { "quantity": 2000.00, "value": 1000.00 },
      "expired": { "quantity": 500.00, "value": 250.00 }
    }
  }
}</code></pre>
                </div>

                <h3>6.4.2 åº“å­˜ä¼°å€¼API</h3>
                <div class="java-block">
<pre><code>// GET /api/mobile/{factoryId}/material-batches/inventory/valuation

{
  "code": 200,
  "data": {
    "valuationDate": "2025-11-21",

    "totalInventoryValue": 12750.00,

    "valueBreakdown": {
      "availableMaterialValue": 10000.00,    // å¯ç”¨ç‰©æ–™
      "reservedMaterialValue": 1500.00,      // é¢„ç•™ç‰©æ–™
      "frozenMaterialValue": 1000.00,        // å†·å†»ç‰©æ–™
      "expiredMaterialValue": 250.00         // å·²è¿‡æœŸ(å¾…å¤„ç†)
    },

    "turnoverMetrics": {
      "avgTurnoverDays": 15,                // å¹³å‡å‘¨è½¬å‘¨æœŸ
      "fastMovingItems": 5,                 // å¿«é€ŸæµåŠ¨å“ç§æ•°
      "slowMovingItems": 8,                 // ç¼“æ…¢æµåŠ¨å“ç§æ•°
      "deadStockItems": 2                   // æ»é”€å“ç§æ•°(>60å¤©æœªä½¿ç”¨)
    },

    "warnings": [
      {
        "type": "expired",
        "count": 2,
        "value": 250.00,
        "recommendation": "å»ºè®®å°½å¿«å¤„ç†è¿‡æœŸç‰©æ–™"
      },
      {
        "type": "slowMoving",
        "count": 8,
        "value": 1500.00,
        "recommendation": "è¿™äº›ç‰©æ–™è¶…è¿‡30å¤©æœªä½¿ç”¨,è€ƒè™‘è°ƒæ•´é‡‡è´­è®¡åˆ’"
      }
    ]
  }
}</code></pre>
                </div>

                <h2>6.5 å‰ç«¯Screenæ˜ å°„</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Screenæ–‡ä»¶</th>
                            <th>åŠŸèƒ½</th>
                            <th>å…³é”®ç‰¹æ€§</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>MaterialBatchManagementScreen.tsx</code></td>
                            <td>ç‰©æ–™ç®¡ç†</td>
                            <td>CRUDã€FIFOæ¨èã€è¿‡æœŸæç¤º</td>
                        </tr>
                        <tr>
                            <td><code>MaterialReceiptScreen.tsx</code></td>
                            <td>ç‰©æ–™å…¥åº“</td>
                            <td>æ‰¹å·è¾“å…¥ã€ä¾›åº”å•†é€‰æ‹©ã€å…¥åº“ç¡®è®¤</td>
                        </tr>
                        <tr>
                            <td><code>InventoryStatisticsScreen.tsx</code></td>
                            <td>åº“å­˜ç»Ÿè®¡</td>
                            <td>åº“å­˜æ¦‚è§ˆã€åˆ†ç±»ç»Ÿè®¡ã€ä¼°å€¼</td>
                        </tr>
                        <tr>
                            <td><code>InventoryCheckScreen.tsx</code></td>
                            <td>åº“å­˜ç›˜ç‚¹</td>
                            <td>ç°åœºè®¡æ•°ã€å·®å¼‚è®°å½•ã€è°ƒæ•´</td>
                        </tr>
                    </tbody>
                </table>
            </section>

            
            <section id="ch7">
                <h1>7. è´¨é‡æ£€éªŒæ¨¡å—</h1>

                <h2>æ¨¡å—æè¿°</h2>
                <p>è´¨é‡æ£€éªŒæ¨¡å—ç®¡ç†ç”Ÿäº§è¿‡ç¨‹ä¸­çš„è´¨é‡æ§åˆ¶,åŒ…æ‹¬æ£€éªŒæ ‡å‡†å®šä¹‰ã€ç¼ºé™·åˆ†ç±»ã€æ£€éªŒè®°å½•ã€è¶‹åŠ¿åˆ†æå’ŒæŠ¥å‘Šç”Ÿæˆã€‚è¯¥æ¨¡å—ä¸ç”Ÿäº§æ¨¡å—ç´§å¯†é›†æˆ,è‡ªåŠ¨è®¡ç®—åˆæ ¼ç‡å¹¶å½±å“æ‰¹æ¬¡çš„æœ€ç»ˆè´¨é‡çŠ¶æ€ã€‚</p>

                <h3>æ ¸å¿ƒåŠŸèƒ½</h3>
                <ul>
                    <li>è´¨æ£€æ ‡å‡†ç®¡ç†</li>
                    <li>ç¼ºé™·åˆ†ç±»ä¸è®°å½•</li>
                    <li>åˆæ ¼ç‡è‡ªåŠ¨è®¡ç®—</li>
                    <li>è¶‹åŠ¿åˆ†æä¸é¢„è­¦</li>
                    <li>è´¨æ£€æŠ¥å‘Šç”Ÿæˆ</li>
                </ul>

                <h3>ä¸»è¦APIç«¯ç‚¹</h3>
                <table>
                    <thead>
                        <tr>
                            <th>HTTPæ–¹æ³•</th>
                            <th>è·¯ç”±</th>
                            <th>è¯´æ˜</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>POST</td>
                            <td>/api/mobile/{factoryId}/quality-inspections</td>
                            <td>åˆ›å»ºæ£€éªŒè®°å½•</td>
                        </tr>
                        <tr>
                            <td>GET</td>
                            <td>/api/mobile/{factoryId}/quality-inspections</td>
                            <td>æŸ¥è¯¢æ£€éªŒè®°å½•(åˆ†é¡µ)</td>
                        </tr>
                        <tr>
                            <td>GET</td>
                            <td>/api/mobile/{factoryId}/quality-inspections/{id}</td>
                            <td>è·å–æ£€éªŒè¯¦æƒ…</td>
                        </tr>
                        <tr>
                            <td>PUT</td>
                            <td>/api/mobile/{factoryId}/quality-inspections/{id}</td>
                            <td>æ›´æ–°æ£€éªŒè®°å½•</td>
                        </tr>
                        <tr>
                            <td>GET</td>
                            <td>/api/mobile/{factoryId}/quality/statistics</td>
                            <td>è´¨æ£€ç»Ÿè®¡</td>
                        </tr>
                        <tr>
                            <td>GET</td>
                            <td>/api/mobile/{factoryId}/quality/trends</td>
                            <td>è´¨æ£€è¶‹åŠ¿åˆ†æ</td>
                        </tr>
                        <tr>
                            <td>POST</td>
                            <td>/api/mobile/{factoryId}/quality/standards</td>
                            <td>åˆ›å»ºè´¨æ£€æ ‡å‡†</td>
                        </tr>
                        <tr>
                            <td>GET</td>
                            <td>/api/mobile/{factoryId}/quality/standards</td>
                            <td>æŸ¥è¯¢è´¨æ£€æ ‡å‡†</td>
                        </tr>
                    </tbody>
                </table>

                <h3>å…³é”®æ•°æ®åº“è¡¨</h3>
                <div class="sql-block">
<pre><code>-- quality_inspection_standards è¡¨ (è´¨æ£€æ ‡å‡†)
CREATE TABLE quality_inspection_standards (
  id INT PRIMARY KEY AUTO_INCREMENT,
  factory_id VARCHAR(50) NOT NULL,
  product_type_id INT NOT NULL,
  standard_name VARCHAR(100),
  pass_criteria TEXT,
  sample_size_min INT,
  sample_size_max INT,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  INDEX idx_factory_product (factory_id, product_type_id)
);

-- quality_inspection_defects è¡¨ (ç¼ºé™·åˆ†ç±»)
CREATE TABLE quality_inspection_defects (
  id INT PRIMARY KEY AUTO_INCREMENT,
  factory_id VARCHAR(50) NOT NULL,
  defect_code VARCHAR(50) NOT NULL,
  defect_name VARCHAR(100),
  severity VARCHAR(20),  -- critical, major, minor
  description TEXT,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  UNIQUE KEY uk_factory_defect (factory_id, defect_code)
);</code></pre>
                </div>
            </section>

            <section id="ch8">
                <h1>8. åŸºç¡€æ•°æ®ç®¡ç†æ¨¡å—</h1>

                <h2>æ¨¡å—æè¿°</h2>
                <p>åŸºç¡€æ•°æ®ç®¡ç†æ¨¡å—æä¾›ç³»ç»Ÿæ‰€æœ‰ä¸»æ•°æ®çš„CRUDæ“ä½œ,åŒ…æ‹¬ç‰©æ–™ç±»å‹ã€äº§å“ç±»å‹ã€å‘˜å·¥ä¿¡æ¯ã€éƒ¨é—¨ã€ä¾›åº”å•†ã€å®¢æˆ·ç­‰ã€‚è¯¥æ¨¡å—ä¸ºå…¶ä»–ä¸šåŠ¡æ¨¡å—æä¾›æ•°æ®åŸºç¡€,æ”¯æŒæ‰¹é‡å¯¼å…¥å¯¼å‡ºã€‚</p>

                <h3>æ ¸å¿ƒæ•°æ®ç®¡ç†</h3>
                <ul>
                    <li>ç‰©æ–™ç±»å‹ (Material Types) - 15+ API</li>
                    <li>äº§å“ç±»å‹ (Product Types) - 15+ API</li>
                    <li>å‘˜å·¥ç®¡ç† (Employees) - 12+ API</li>
                    <li>éƒ¨é—¨ç®¡ç† (Departments) - 10+ API</li>
                    <li>ä¾›åº”å•†ç®¡ç† (Suppliers) - 12+ API</li>
                    <li>å®¢æˆ·ç®¡ç† (Customers) - 12+ API</li>
                </ul>

                <h3>APIç«¯ç‚¹ç»Ÿè®¡</h3>
                <table>
                    <thead>
                        <tr>
                            <th>æ•°æ®ç±»å‹</th>
                            <th>åˆ›å»º</th>
                            <th>è¯»å–</th>
                            <th>æ›´æ–°</th>
                            <th>åˆ é™¤</th>
                            <th>å°è®¡</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>ç‰©æ–™ç±»å‹</td>
                            <td>POST</td>
                            <td>GET</td>
                            <td>PUT</td>
                            <td>DELETE</td>
                            <td>4+ç‰¹æ®Š</td>
                        </tr>
                        <tr>
                            <td>äº§å“ç±»å‹</td>
                            <td>POST</td>
                            <td>GET</td>
                            <td>PUT</td>
                            <td>DELETE</td>
                            <td>4+ç‰¹æ®Š</td>
                        </tr>
                        <tr>
                            <td>å‘˜å·¥ä¿¡æ¯</td>
                            <td>POST</td>
                            <td>GET</td>
                            <td>PUT</td>
                            <td>DELETE</td>
                            <td>4+å¯¼å‡º</td>
                        </tr>
                        <tr>
                            <td>éƒ¨é—¨ç®¡ç†</td>
                            <td>POST</td>
                            <td>GET</td>
                            <td>PUT</td>
                            <td>DELETE</td>
                            <td>4+æ ‘å½¢</td>
                        </tr>
                    </tbody>
                </table>

                <h3>å‰ç«¯å±å¹•æ˜ å°„</h3>
                <table>
                    <thead>
                        <tr>
                            <th>æ¨¡å—</th>
                            <th>å±å¹•åˆ—è¡¨</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>ç‰©æ–™ç±»å‹</td>
                            <td>MaterialTypeManagementScreen, MaterialTypeDetailScreen, MaterialTypeListScreen</td>
                        </tr>
                        <tr>
                            <td>äº§å“ç±»å‹</td>
                            <td>ProductTypeManagementScreen, ProductTypeDetailScreen, ProductTypeListScreen</td>
                        </tr>
                        <tr>
                            <td>å‘˜å·¥ç®¡ç†</td>
                            <td>EmployeeManagementScreen, EmployeeDetailScreen, EmployeeListScreen</td>
                        </tr>
                        <tr>
                            <td>éƒ¨é—¨ç®¡ç†</td>
                            <td>DepartmentManagementScreen, DepartmentTreeScreen, DepartmentDetailScreen</td>
                        </tr>
                        <tr>
                            <td>ä¾›åº”å•†</td>
                            <td>SupplierManagementScreen, SupplierDetailScreen, SupplierListScreen</td>
                        </tr>
                        <tr>
                            <td>å®¢æˆ·</td>
                            <td>CustomerManagementScreen, CustomerDetailScreen, CustomerListScreen</td>
                        </tr>
                    </tbody>
                </table>
            </section>

            <section id="ch9">
                <h1>9. å¹³å°ç®¡ç†æ¨¡å—</h1>

                <h2>æ¨¡å—æè¿°</h2>
                <p>å¹³å°ç®¡ç†æ¨¡å—è´Ÿè´£å¤šå·¥å‚å¹³å°çš„é…ç½®å’Œç®¡ç†,åŒ…æ‹¬å·¥å‚ç®¡ç†ã€ç”¨æˆ·è´¦æˆ·ç®¡ç†ã€è§’è‰²æƒé™é…ç½®å’Œç³»ç»Ÿå‚æ•°è®¾ç½®ã€‚ä»…å¹³å°ç®¡ç†å‘˜å¯è®¿é—®ã€‚</p>

                <h3>æ ¸å¿ƒåŠŸèƒ½</h3>
                <ul>
                    <li>å·¥å‚ç®¡ç† - å¤šå·¥å‚é…ç½®ä¸æ¿€æ´»</li>
                    <li>ç”¨æˆ·ç®¡ç† - 8è§’è‰²æƒé™ç³»ç»Ÿ</li>
                    <li>æƒé™é…ç½® - è§’è‰²åŠŸèƒ½æƒé™è¯¦ç»†é…ç½®</li>
                    <li>ç³»ç»Ÿé…ç½® - å‚æ•°è®¾ç½®ä¸ç³»ç»Ÿå¸¸æ•°</li>
                    <li>å®¡è®¡æ—¥å¿— - æ“ä½œè®°å½•ä¸å®‰å…¨è·Ÿè¸ª</li>
                </ul>

                <h3>8è§’è‰²æƒé™ä½“ç³»</h3>
                <table>
                    <thead>
                        <tr>
                            <th>è§’è‰²</th>
                            <th>çº§åˆ«</th>
                            <th>æƒé™èŒƒå›´</th>
                            <th>ä¸»è¦èŒè´£</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>developer</td>
                            <td>ç³»ç»Ÿ</td>
                            <td>å…¨éƒ¨æƒé™</td>
                            <td>ç³»ç»Ÿå¼€å‘ä¸ç»´æŠ¤</td>
                        </tr>
                        <tr>
                            <td>platform_admin</td>
                            <td>å¹³å°</td>
                            <td>å¤šå·¥å‚ç®¡ç†</td>
                            <td>å¹³å°é…ç½®ä¸ç”¨æˆ·ç®¡ç†</td>
                        </tr>
                        <tr>
                            <td>factory_super_admin</td>
                            <td>å·¥å‚</td>
                            <td>å•å·¥å‚å…¨éƒ¨</td>
                            <td>å·¥å‚å…¨éƒ¨ç®¡ç†</td>
                        </tr>
                        <tr>
                            <td>factory_admin</td>
                            <td>å·¥å‚</td>
                            <td>å·¥å‚å¤§éƒ¨åˆ†</td>
                            <td>å·¥å‚è¿è¥ç®¡ç†</td>
                        </tr>
                        <tr>
                            <td>department_admin</td>
                            <td>éƒ¨é—¨</td>
                            <td>éƒ¨é—¨èŒƒå›´</td>
                            <td>éƒ¨é—¨è¿è¥ç®¡ç†</td>
                        </tr>
                        <tr>
                            <td>supervisor</td>
                            <td>ç”Ÿäº§</td>
                            <td>ä¸»ç®¡èŒƒå›´</td>
                            <td>ç”Ÿäº§ç›‘ç£</td>
                        </tr>
                        <tr>
                            <td>operator</td>
                            <td>æ“ä½œ</td>
                            <td>è‡ªå·±æ“ä½œ</td>
                            <td>æ‰§è¡Œæ“ä½œ</td>
                        </tr>
                        <tr>
                            <td>viewer</td>
                            <td>æŸ¥çœ‹</td>
                            <td>åªè¯»æƒé™</td>
                            <td>æ•°æ®æŸ¥çœ‹</td>
                        </tr>
                    </tbody>
                </table>

                <h3>APIç«¯ç‚¹</h3>
                <ul>
                    <li>POST /api/platform/factories - åˆ›å»ºå·¥å‚</li>
                    <li>GET /api/platform/factories - æŸ¥è¯¢æ‰€æœ‰å·¥å‚</li>
                    <li>PUT /api/platform/factories/{factoryId} - æ›´æ–°å·¥å‚</li>
                    <li>POST /api/platform/users - åˆ›å»ºç”¨æˆ·</li>
                    <li>GET /api/platform/users - æŸ¥è¯¢ç”¨æˆ·åˆ—è¡¨</li>
                    <li>PUT /api/platform/users/{userId} - æ›´æ–°ç”¨æˆ·</li>
                    <li>POST /api/platform/roles - åˆ›å»ºè§’è‰²</li>
                    <li>GET /api/platform/roles - æŸ¥è¯¢æ‰€æœ‰è§’è‰²</li>
                    <li>PUT /api/platform/roles/{roleId}/permissions - é…ç½®æƒé™</li>
                    <li>GET /api/platform/audit-logs - æŸ¥çœ‹å®¡è®¡æ—¥å¿—</li>
                </ul>
            </section>

            <section id="ch10">
                <h1>10. æŠ¥è¡¨åˆ†ææ¨¡å—</h1>

                <h2>æ¨¡å—æè¿°</h2>
                <p>æŠ¥è¡¨åˆ†ææ¨¡å—æä¾›å„ç±»ä¸šåŠ¡æŠ¥è¡¨å’Œæ•°æ®åˆ†æåŠŸèƒ½,åŒ…æ‹¬ç”Ÿäº§æŠ¥è¡¨ã€è´¨é‡æŠ¥è¡¨ã€æˆæœ¬æŠ¥è¡¨ã€äººå‘˜æŠ¥è¡¨å’Œè®¾å¤‡æŠ¥è¡¨ã€‚æ”¯æŒå¤šç»´åº¦åˆ†æã€å›¾è¡¨å±•ç¤ºå’Œå¯¼å‡ºåŠŸèƒ½ã€‚</p>

                <h3>æ ¸å¿ƒæŠ¥è¡¨ç±»å‹</h3>
                <table>
                    <thead>
                        <tr>
                            <th>æŠ¥è¡¨ç±»å‹</th>
                            <th>è¯´æ˜</th>
                            <th>APIç«¯ç‚¹æ•°</th>
                            <th>å¯¼å‡ºæ ¼å¼</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>ç”Ÿäº§æŠ¥è¡¨</td>
                            <td>æ—¥/å‘¨/æœˆç”Ÿäº§ç»Ÿè®¡</td>
                            <td>5+</td>
                            <td>Excel, PDF</td>
                        </tr>
                        <tr>
                            <td>è´¨é‡æŠ¥è¡¨</td>
                            <td>ç¼ºé™·åˆ†å¸ƒã€åˆæ ¼ç‡è¶‹åŠ¿</td>
                            <td>5+</td>
                            <td>Excel, PDF</td>
                        </tr>
                        <tr>
                            <td>æˆæœ¬æŠ¥è¡¨</td>
                            <td>æˆæœ¬å¯¹æ ‡ã€å•ä½æˆæœ¬åˆ†æ</td>
                            <td>5+</td>
                            <td>Excel, PDF</td>
                        </tr>
                        <tr>
                            <td>äººå‘˜æŠ¥è¡¨</td>
                            <td>è€ƒå‹¤ç»Ÿè®¡ã€å·¥æ—¶åˆ†æ</td>
                            <td>4+</td>
                            <td>Excel</td>
                        </tr>
                        <tr>
                            <td>è®¾å¤‡æŠ¥è¡¨</td>
                            <td>è¿è¡Œæ•ˆç‡ã€ç»´æŠ¤è®°å½•</td>
                            <td>4+</td>
                            <td>Excel, PDF</td>
                        </tr>
                    </tbody>
                </table>

                <h3>å‰ç«¯æŠ¥è¡¨å±å¹•</h3>
                <ul>
                    <li>ReportDashboardScreen - æŠ¥è¡¨æ€»è§ˆ</li>
                    <li>ProductionReportScreen - ç”Ÿäº§æŠ¥è¡¨</li>
                    <li>QualityReportScreen - è´¨é‡æŠ¥è¡¨</li>
                    <li>CostReportScreen - æˆæœ¬æŠ¥è¡¨</li>
                    <li>PersonnelReportScreen - äººå‘˜æŠ¥è¡¨</li>
                    <li>EfficiencyReportScreen - æ•ˆç‡æŠ¥è¡¨</li>
                    <li>KPIReportScreen - KPIä»ªè¡¨æ¿</li>
                </ul>
            </section>

            <section id="ch11">
                <h1>11. æ•°æ®å¯¼å…¥å¯¼å‡ºæ¨¡å—</h1>

                <h2>æ¨¡å—æè¿°</h2>
                <p>æ•°æ®å¯¼å…¥å¯¼å‡ºæ¨¡å—æä¾›æ‰¹é‡æ•°æ®æ“ä½œèƒ½åŠ›,æ”¯æŒExcelå¯¼å…¥å¯¼å‡º,è‡ªåŠ¨éªŒè¯æ ¼å¼,å¹¶æä¾›è¯¦ç»†çš„æ“ä½œæ—¥å¿—å’Œé”™è¯¯æç¤ºã€‚</p>

                <h3>æ”¯æŒçš„å¯¼å…¥æ•°æ®ç±»å‹</h3>
                <ul>
                    <li>ç‰©æ–™æ‰¹æ¬¡ (Material Batches)</li>
                    <li>ç”Ÿäº§è®¡åˆ’ (Production Plans)</li>
                    <li>å‘˜å·¥ä¿¡æ¯ (Employees)</li>
                    <li>ä¾›åº”å•†ä¿¡æ¯ (Suppliers)</li>
                    <li>äº§å“ç±»å‹ (Product Types)</li>
                    <li>è®¾å¤‡ä¿¡æ¯ (Equipment)</li>
                </ul>

                <h3>APIç«¯ç‚¹</h3>
                <ul>
                    <li>POST /api/mobile/{factoryId}/import/material-batches - å¯¼å…¥ç‰©æ–™</li>
                    <li>POST /api/mobile/{factoryId}/import/production-plans - å¯¼å…¥è®¡åˆ’</li>
                    <li>POST /api/mobile/{factoryId}/import/employees - å¯¼å…¥å‘˜å·¥</li>
                    <li>GET /api/mobile/{factoryId}/export/material-batches - å¯¼å‡ºç‰©æ–™</li>
                    <li>GET /api/mobile/{factoryId}/export/production-plans - å¯¼å‡ºè®¡åˆ’</li>
                    <li>GET /api/mobile/{factoryId}/export/template/{type} - è·å–å¯¼å…¥æ¨¡æ¿</li>
                </ul>

                <h3>å¯¼å…¥æµç¨‹</h3>
                <pre><code>Step 1: ä¸Šä¼ Excelæ–‡ä»¶
Step 2: éªŒè¯æ–‡ä»¶æ ¼å¼ä¸æ•°æ®å®Œæ•´æ€§
Step 3: é€è¡ŒéªŒè¯ä¸šåŠ¡è§„åˆ™
Step 4: è¿”å›éªŒè¯ç»“æœä¸é”™è¯¯æç¤º
Step 5: ç”¨æˆ·ç¡®è®¤åæ‰¹é‡æ’å…¥æ•°æ®åº“
Step 6: ä¿å­˜å¯¼å…¥æ—¥å¿—</code></pre>

                <h3>å¯¼å‡ºæ ¼å¼</h3>
                <ul>
                    <li>Excel (.xlsx) - æ”¯æŒå…¬å¼ä¸æ ¼å¼</li>
                    <li>CSV (.csv) - å…¼å®¹æ€§å¥½</li>
                    <li>PDF - æŠ¥è¡¨æ ¼å¼</li>
                </ul>
            </section>

            <section id="cross-1">
                <h1>X.1 æˆæœ¬è‡ªåŠ¨è®¡ç®—</h1>

                <h2>å››å±‚æˆæœ¬æ¨¡å‹</h2>
                <pre><code>ç”Ÿäº§æˆæœ¬ = åŸæ–™æˆæœ¬ + äººå·¥æˆæœ¬ + è®¾å¤‡æˆæœ¬ + å…¶ä»–æˆæœ¬

1. åŸæ–™æˆæœ¬ (Material Cost)
   â”œâ”€ æ¥æº: material_consumption è¡¨
   â”œâ”€ è®¡ç®—: æ¶ˆè€—ç‰©æ–™å•ä»· Ã— æ¶ˆè€—æ•°é‡
   â””â”€ ç¤ºä¾‹: ç•ªèŒ„0.5å…ƒ/kg Ã— 950kg = 475å…ƒ

2. äººå·¥æˆæœ¬ (Labor Cost)
   â”œâ”€ æ¥æº: batch_work_sessions + usersè¡¨(daily_salary)
   â”œâ”€ è®¡ç®—: (æ—¥è–ª / 24) Ã— å·¥ä½œæ—¶é•¿(å°æ—¶)
   â””â”€ ç¤ºä¾‹: 5äºº Ã— (300/24) Ã— 8h = 5000å…ƒ

3. è®¾å¤‡æˆæœ¬ (Equipment Cost)
   â”œâ”€ æ¥æº: equipment_usage + equipmentè¡¨(depreciation)
   â”œâ”€ è®¡ç®—: å¹´æŠ˜æ—§ / 365 Ã— è¿è¡Œå¤©æ•°
   â””â”€ ç¤ºä¾‹: 2000/365 Ã— 0.5 = 2.74å…ƒ

4. å…¶ä»–æˆæœ¬ (Other Cost)
   â”œâ”€ æ¥æº: æ‰‹åŠ¨è¾“å…¥æˆ–é¢„è®¾æ¯”ä¾‹
   â”œâ”€ èŒƒå›´: æ°´ç”µè´¹ã€åŒ…è£…è´¹ã€è¿è¾“è´¹ç­‰
   â””â”€ ç¤ºä¾‹: 100å…ƒ

æ€»æˆæœ¬ = 475 + 5000 + 2.74 + 100 = 5577.74å…ƒ
å•ä½æˆæœ¬ = 5577.74 / 990kg = 5.64å…ƒ/kg</code></pre>

                <h2>æˆæœ¬è®¡ç®—è§¦å‘ç‚¹</h2>
                <ol>
                    <li>åˆ›å»ºç”Ÿäº§æ‰¹æ¬¡ â†’ åˆå§‹åŒ–æˆæœ¬ = 0</li>
                    <li>è®°å½•ç‰©æ–™æ¶ˆè€— â†’ æ›´æ–°åŸæ–™æˆæœ¬</li>
                    <li>å‘˜å·¥å®Œæˆæ‰“å¡ â†’ ç´¯åŠ äººå·¥æˆæœ¬</li>
                    <li>è®¾å¤‡åœæ­¢è¿è¡Œ â†’ ç´¯åŠ è®¾å¤‡æˆæœ¬</li>
                    <li>å®Œæˆç”Ÿäº§æ‰¹æ¬¡ â†’ æœ€ç»ˆæˆæœ¬æ±‡æ€»</li>
                    <li>æ‰¹æ¬¡å®Œæˆå â†’ è§¦å‘AIåˆ†æ (å¯é€‰)</li>
                </ol>
            </section>

            <section id="cross-2">
                <h1>X.2 FIFOåº“å­˜æ¨è</h1>

                <h2>FIFOç®—æ³•å®ç°</h2>
                <pre><code>ç›®çš„: ä¼˜å…ˆä½¿ç”¨æœ€æ—©å…¥åº“çš„ç‰©æ–™,é¿å…è¿‡æœŸæµªè´¹

æ’åºè§„åˆ™:
1. ç¬¬ä¸€ä¼˜å…ˆçº§: inbound_date (å…¥åº“æ—¥æœŸ) å‡åº
2. ç¬¬äºŒä¼˜å…ˆçº§: expire_date (è¿‡æœŸæ—¥æœŸ) å‡åº
3. ç¬¬ä¸‰ä¼˜å…ˆçº§: batch_id (æ‰¹æ¬¡ID) å‡åº

æŸ¥è¯¢é€»è¾‘:
SELECT * FROM material_batches
WHERE factory_id = ? AND material_type_id = ? AND status = 'AVAILABLE'
ORDER BY inbound_date ASC, expire_date ASC, batch_id ASC
LIMIT ? -- æ¨èæ‰¹æ¬¡æ•°é‡

æ¨èç®—æ³•:
totalNeeded = éœ€æ±‚æ•°é‡
recommendations = []
accumulated = 0

for batch in sorted_batches:
    available = batch.receipt_quantity - batch.used_quantity - batch.reserved_quantity

    if accumulated >= totalNeeded:
        break

    if available > 0:
        recommended = min(available, totalNeeded - accumulated)
        recommendations.add({
            batchId: batch.id,
            recommendedQuantity: recommended,
            unitPrice: batch.unit_price,
            cost: recommended * batch.unit_price
        })
        accumulated += recommended

return recommendations</code></pre>

                <h2>FIFOæ¨èç¤ºä¾‹</h2>
                <pre><code>åœºæ™¯: éœ€è¦ç•ªèŒ„ 950kg

ç‰©æ–™åº“å­˜çŠ¶æ€:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ‰¹æ¬¡å·          â”‚ å…¥åº“æ—¥ â”‚ è¿‡æœŸæ—¥ â”‚ å¯ç”¨æ•°é‡   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ MAT-10-15-001  â”‚ 10-15  â”‚ 12-15  â”‚ 900kg      â”‚
â”‚ MAT-10-20-002  â”‚ 10-20  â”‚ 12-20  â”‚ 500kg      â”‚
â”‚ MAT-11-01-003  â”‚ 11-01  â”‚ 01-01  â”‚ 800kg      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

FIFOæ¨èæµç¨‹:
éœ€æ±‚: 950kg
ç´¯è®¡: 0kg

Step 1: MAT-10-15-001 (æœ€æ—©)
  å¯ç”¨: 900kg
  æ¨è: 900kg (< 950kg, ç”¨å®Œ)
  ç´¯è®¡: 900kg

Step 2: MAT-10-20-002 (æ¬¡æ—©)
  å¯ç”¨: 500kg
  æ¨è: 50kg (æ»¡è¶³å‰©ä½™ 950-900=50kg)
  ç´¯è®¡: 950kg

ç»“è®º: ç”¨å®ŒMAT-10-15-001çš„900kg,å†ç”¨MAT-10-20-002çš„50kg</code></pre>
            </section>

            <section id="cross-3">
                <h1>X.3 æ—¶é—´æˆæœ¬ä¸€ä½“åŒ–</h1>

                <h2>å·¥ä½œä¼šè¯ä¸æˆæœ¬åˆ†é…</h2>
                <pre><code>åœºæ™¯: å‘˜å·¥æå››åœ¨ä¸€å¤©å†…å‚ä¸å¤šä¸ªç”Ÿäº§æ‰¹æ¬¡

æ—¶é—´è½´:
08:00 - 09:30 (1.5h) - æ‰¹æ¬¡A (ç•ªèŒ„é…±)
09:30 - 10:00 (0.5h) - ä¼‘æ¯
10:00 - 12:00 (2.0h) - æ‰¹æ¬¡A (ç•ªèŒ„é…±)
12:00 - 13:00 (1.0h) - åˆä¼‘
13:00 - 15:30 (2.5h) - æ‰¹æ¬¡B (è¾£æ¤’é…±)
15:30 - 16:00 (0.5h) - ä¼‘æ¯
16:00 - 17:00 (1.0h) - æ‰¹æ¬¡B (è¾£æ¤’é…±)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
å®é™…å·¥ä½œ: 8.0å°æ—¶
æ—¥è–ª: 300å…ƒ/å¤©

æˆæœ¬åˆ†é…:
âœ“ æ€»å·¥ä½œæ—¶é—´: 8.0å°æ—¶
âœ“ å°æ—¶è´¹ç‡: 300 / 24 = 12.5å…ƒ/å°æ—¶
âœ“ æ€»æˆæœ¬: 12.5 Ã— 8 = 100å…ƒ

âœ“ æ‰¹æ¬¡A: (1.5 + 2.0) / 8.0 Ã— 100 = 43.75å…ƒ
âœ“ æ‰¹æ¬¡B: (2.5 + 1.0) / 8.0 Ã— 100 = 56.25å…ƒ

éªŒè¯: 43.75 + 56.25 = 100å…ƒ âœ“</code></pre>

                <h2>æ•°æ®è¡¨å…³è”</h2>
                <pre><code>time_clock_record è¡¨
â”œâ”€ clock_in_time: 08:00
â”œâ”€ clock_out_time: 17:00
â”œâ”€ break_start_time: 09:30, 12:00, 15:30
â”œâ”€ break_end_time: 10:00, 13:00, 16:00
â””â”€ work_duration: 480åˆ†é’Ÿ (8å°æ—¶)

batch_work_sessions è¡¨ (ä¼šè¯è®°å½•)
â”œâ”€ æ‰¹æ¬¡A
â”‚  â”œâ”€ work_minutes: 210åˆ†é’Ÿ (3.5h)
â”‚  â””â”€ labor_cost: 43.75å…ƒ
â””â”€ æ‰¹æ¬¡B
   â”œâ”€ work_minutes: 210åˆ†é’Ÿ (3.5h)
   â””â”€ labor_cost: 56.25å…ƒ</code></pre>
            </section>

            <section id="cross-4">
                <h1>X.4 è®¾å¤‡æŠ˜æ—§é›†æˆ</h1>

                <h2>è®¾å¤‡æŠ˜æ—§åœ¨ç”Ÿäº§ä¸­çš„åº”ç”¨</h2>
                <pre><code>è®¾å¤‡ä¿¡æ¯:
- åç§°: æ…æ‹Œæœº A
- è´­ç½®ä»·: 50,000å…ƒ
- è´­ç½®æ—¥: 2023-05-15
- æ®‹å€¼: 5,000å…ƒ
- ä½¿ç”¨å¹´é™: 5å¹´
- æŠ˜æ—§æ¨¡å¼: ç›´çº¿æŠ˜æ—§

æŠ˜æ—§è®¡ç®—:
å¹´æŠ˜æ—§ = (50000 - 5000) / 5 = 9000å…ƒ/å¹´
æœˆæŠ˜æ—§ = 9000 / 12 = 750å…ƒ/æœˆ
æ—¥æŠ˜æ—§ = 9000 / 365 = 24.66å…ƒ/å¤©
æ—¶æŠ˜æ—§ = 24.66 / 24 = 1.03å…ƒ/å°æ—¶

ç”Ÿäº§æ‰¹æ¬¡æˆæœ¬åˆ†é…:
æ‰¹æ¬¡BATCH-20251121-001
â”œâ”€ è®¾å¤‡: æ…æ‹Œæœº A
â”œâ”€ è¿è¡Œæ—¶é—´: 2.5å°æ—¶
â””â”€ è®¾å¤‡æŠ˜æ—§æˆæœ¬ = 1.03å…ƒ/h Ã— 2.5h = 2.57å…ƒ

ç´¯è®¡è·Ÿè¸ª:
æ€»è¿è¡Œæ—¶é—´: 1245å°æ—¶
å†å²æŠ˜æ—§: (50000 - 5000) Ã— (1245 / (5 Ã— 365 Ã— 24)) = 18118å…ƒ
å‡€å€¼: 50000 - 18118 = 31882å…ƒ</code></pre>

                <h2>å®ç°æ–¹å¼</h2>
                <ol>
                    <li>è®¾å¤‡å¯åŠ¨æ—¶è®°å½• start_time</li>
                    <li>è®¾å¤‡åœæ­¢æ—¶è®¡ç®— running_hours</li>
                    <li>æ›´æ–° equipment.total_operating_hours</li>
                    <li>è®¡ç®—å°æ—¶æŠ˜æ—§: annual_depreciation / (365 Ã— 24)</li>
                    <li>ç´¯åŠ åˆ°æ‰¹æ¬¡çš„ equipment_cost</li>
                    <li>å®Œæˆç”Ÿäº§æ—¶æ±‡æ€»æ‰€æœ‰æˆæœ¬</li>
                </ol>
            </section>

            <section id="cross-5">
                <h1>X.5 AIåˆ†æè§¦å‘é“¾</h1>

                <h2>AIè‡ªåŠ¨åˆ†æå·¥ä½œæµ</h2>
                <pre><code>ç”Ÿäº§æ‰¹æ¬¡å®Œæˆ â†’ è‡ªåŠ¨è§¦å‘AIåˆ†æ

è§¦å‘æ¡ä»¶:
âœ“ æ‰¹æ¬¡çŠ¶æ€: status = COMPLETED
âœ“ æˆæœ¬è®¡ç®—: total_cost â‰  null
âœ“ è´¨æ£€é€šè¿‡: quality_status = PASS
âœ“ è§¦å‘å»¶è¿Ÿ: 300ç§’åæ‰§è¡Œ (å¼‚æ­¥éé˜»å¡)

è§¦å‘æµç¨‹:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Step 1: æ£€æŸ¥è§¦å‘æ¡ä»¶
  IF status == COMPLETED AND total_cost != null AND quality_status == PASS:
    PROCEED
  ELSE:
    SKIP

Step 2: æŸ¥è¯¢ç¼“å­˜
  cache_key = factoryId + batchId + 'cost_breakdown'
  IF cache.exists(cache_key) AND cache.notExpired():
    RETURN cached_result
  ELSE:
    PROCEED to Step 3

Step 3: æ¶ˆè´¹é…é¢
  quota = GET_WEEKLY_QUOTA(factoryId)
  IF quota.remaining < 1:
    RETURN error "é…é¢ä¸è¶³"
  ELSE:
    quota.remaining -= 1
    quota.used += 1

Step 4: è°ƒç”¨AIæœåŠ¡
  request = {
    batchId: batchId,
    batchNumber: batch_number,
    analysis: {
      planned: planned_quantity,
      actual: actual_quantity,
      good: good_quantity,
      defect: defect_quantity,
      costs: {
        material: material_cost,
        labor: labor_cost,
        equipment: equipment_cost,
        other: other_cost
      }
    }
  }

  response = CALL_DEEPSEEK_API(request)

Step 5: ä¿å­˜ç»“æœ
  INSERT INTO ai_analysis_results (
    factory_id, batch_id, analysis_text,
    report_type='batch', expires_at=NOW()+7days
  )

Step 6: è®°å½•å®¡è®¡
  INSERT INTO ai_audit_logs (
    factory_id, request_type='batch_analysis',
    success=true, cache_hit=false, quota_consumed=1
  )

Step 7: é€šçŸ¥å‰ç«¯
  WebSocket æ¨é€æ‰¹æ¬¡IDç»™ç›¸å…³ç”¨æˆ·
  å‰ç«¯è‡ªåŠ¨åˆ·æ–°,æ˜¾ç¤ºAIåˆ†æç»“æœ

æ‰§è¡Œæ—¶é—´: å¼‚æ­¥åå°ä»»åŠ¡,2-10ç§’å†…å®Œæˆ</code></pre>

                <h2>ä¸å…¶ä»–æ¨¡å—çš„è”åŠ¨</h2>
                <pre><code>ç”Ÿäº§å®Œæˆ
  â†“
è§¦å‘é“¾è·¯:
  â”œâ”€â†’ æˆæœ¬æ¨¡å—: æœ€ç»ˆæˆæœ¬æ±‡æ€»
  â”œâ”€â†’ è´¨æ£€æ¨¡å—: è´¨æ£€çŠ¶æ€ç¡®è®¤
  â”œâ”€â†’ åº“å­˜æ¨¡å—: äº§æˆå“å…¥åº“
  â”œâ”€â†’ AIæ¨¡å—: è‡ªåŠ¨åˆ†æ â† YOU ARE HERE
  â””â”€â†’ æŠ¥è¡¨æ¨¡å—: ç”Ÿäº§æŠ¥è¡¨æ›´æ–°

AIåˆ†æå®Œæˆ
  â†“
å‰ç«¯é€šçŸ¥:
  â”œâ”€â†’ ç”Ÿäº§ä»ªè¡¨æ¿åˆ·æ–°
  â”œâ”€â†’ æˆæœ¬åˆ†æå±å¹•æ›´æ–°
  â””â”€â†’ AIåˆ†æç»“æœå±•ç¤º</code></pre>
            </section>

            <section id="faq">
                <h1>å¸¸è§é—®é¢˜è§£ç­”</h1>

                <h3>è€ƒå‹¤ç›¸å…³</h3>
                <p><strong>Q1: ä¸ºä»€ä¹ˆæˆ‘çš„å‘˜å·¥æ‰“å¡åæ²¡æœ‰è‡ªåŠ¨å…³è”æ‰¹æ¬¡?</strong></p>
                <p><strong>A:</strong> æ£€æŸ¥ä»¥ä¸‹å‡ ç‚¹:</p>
                <ol>
                    <li>æ˜¯å¦æœ‰è¿›è¡Œä¸­çš„ç”Ÿäº§æ‰¹æ¬¡ (status=IN_PROGRESS)?</li>
                    <li>è¯¥å‘˜å·¥æ˜¯å¦è¢«åˆ†é…åˆ°è¯¥æ‰¹æ¬¡?</li>
                    <li>æ‰“å¡æ—¶é—´æ˜¯å¦åœ¨æ‰¹æ¬¡çš„è®¡åˆ’æ—¶é—´èŒƒå›´å†…?</li>
                </ol>

                <p><strong>Q2: GPSæ‰“å¡å¤±è´¥,è¯´æˆ‘çš„ä½ç½®ä¸åœ¨å·¥å‚èŒƒå›´å†…?</strong></p>
                <p><strong>A:</strong> è¿™é€šå¸¸æœ‰ä¸¤ä¸ªåŸå› :</p>
                <ol>
                    <li>å·¥å‚GPSèŒƒå›´è®¾ç½®ä¸æ­£ç¡® â†’ è”ç³»ç®¡ç†å‘˜è°ƒæ•´</li>
                    <li>æ‰‹æœºGPSä¿¡å·å¼± â†’ å¼€å¯é«˜ç²¾åº¦GPSåé‡è¯•</li>
                </ol>

                <p><strong>Q3: åŠ ç­æ—¶é—´æ€æ ·è®¡ç®—?</strong></p>
                <p><strong>A:</strong> ç³»ç»Ÿå‡è®¾æ ‡å‡†å·¥ä½œæ—¶é—´ä¸º8å°æ—¶,è¶…è¿‡8å°æ—¶çš„éƒ¨åˆ†ä¸ºåŠ ç­,åœ¨ç»Ÿè®¡æ—¶ä¼šå•ç‹¬è®¡ç®—ã€‚</p>

                <h3>FIFOä¸åº“å­˜</h3>
                <p><strong>Q4: FIFOåº“å­˜æ¨èæ˜¯æ€æ ·çš„?</strong></p>
                <p><strong>A:</strong> ç³»ç»ŸæŒ‰ç…§ç‰©æ–™æ‰¹æ¬¡çš„å…¥åº“æ—¥æœŸå‡åºæ’åˆ—,ä¼˜å…ˆæ¨èæœ€æ—©å…¥åº“çš„ã€‚è¿™æ ·å¯ä»¥é¿å…ç‰©æ–™è¿‡æœŸæµªè´¹ã€‚å…·ä½“è¯¦è§ <a href="#cross-2">X.2 FIFOåº“å­˜æ¨è</a>ã€‚</p>

                <p><strong>Q5: ç‰©æ–™è½¬æ¢ä¸ºå†·å†»ä¿å­˜å,ä¿è´¨æœŸä¼šå»¶é•¿å¤šä¹…?</strong></p>
                <p><strong>A:</strong> é€šå¸¸å†·å†»å¯ä»¥å°†ä¿è´¨æœŸå»¶é•¿è‡³åŸæœ‰æ—¶é—´çš„2-3å€,å…·ä½“å–å†³äºç‰©æ–™ç±»å‹ã€‚ç³»ç»Ÿä¼šåœ¨è½¬æ¢æ—¶è‡ªåŠ¨è®¡ç®—é¢„è®¡çš„æ–°è¿‡æœŸæ—¥æœŸã€‚</p>

                <h3>AIä¸é…é¢</h3>
                <p><strong>Q6: AIåˆ†æçš„å‘¨é…é¢æ˜¯å¤šå°‘,æ€æ ·æŸ¥çœ‹?</strong></p>
                <p><strong>A:</strong> é»˜è®¤å‘¨é…é¢ä¸º100åˆ†æå•ä½,æ¯å‘¨ä¸€è‡ªåŠ¨é‡ç½®ã€‚å¯åœ¨è®¾ç½®é¡µé¢æŸ¥çœ‹å½“å‰å‰©ä½™é…é¢ã€‚</p>

                <p><strong>Q7: é…é¢ç”¨å°½äº†æ€æ ·åŠ?</strong></p>
                <p><strong>A:</strong> é…é¢ç”¨å°½åæ— æ³•è¿›è¡Œæ–°çš„AIåˆ†æ,ä½†å¯ä»¥æŸ¥çœ‹å†å²ç¼“å­˜ç»“æœã€‚å¯ç­‰å¾…ä¸‹å‘¨ä¸€è‡ªåŠ¨æ¢å¤,æˆ–è”ç³»ç®¡ç†å‘˜ç”³è¯·é…é¢æå‡ã€‚</p>

                <p><strong>Q8: ä¸ºä»€ä¹ˆåŒæ ·çš„æŸ¥è¯¢ä¸€æ¬¡æ¶ˆè€—1å•ä½,ä¸‹æ¬¡åˆæ¶ˆè€—1å•ä½?</strong></p>
                <p><strong>A:</strong> è¿™æ˜¯å› ä¸ºç¼“å­˜è¿‡æœŸäº†ã€‚ç³»ç»Ÿä¼šç¼“å­˜åˆ†æç»“æœ7å¤©,7å¤©å†…ç›¸åŒæŸ¥è¯¢ä¼šç›´æ¥è¿”å›ç¼“å­˜ç»“æœ(ä¸æ¶ˆè€—é…é¢)ã€‚</p>

                <h3>æˆæœ¬ä¸è®¡ç®—</h3>
                <p><strong>Q9: æˆæœ¬è®¡ç®—ä¸­çš„äººå·¥æˆæœ¬æ˜¯æ€æ ·è®¡ç®—çš„?</strong></p>
                <p><strong>A:</strong> å…¬å¼ä¸º: (å‘˜å·¥æ—¥è–ª / 24) Ã— å·¥ä½œæ—¶é•¿(å°æ—¶)ã€‚è‹¥å‘˜å·¥åœ¨å¤šä¸ªæ‰¹æ¬¡å·¥ä½œ,æˆæœ¬æŒ‰å·¥ä½œæ—¶é—´æ¯”ä¾‹åˆ†é…ã€‚è¯¦è§ <a href="#cross-3">X.3 æ—¶é—´æˆæœ¬ä¸€ä½“åŒ–</a>ã€‚</p>

                <p><strong>Q10: è®¾å¤‡æˆæœ¬æ€æ ·è®¡ç®—?</strong></p>
                <p><strong>A:</strong> é‡‡ç”¨ç›´çº¿æŠ˜æ—§æ³•,å…¬å¼ä¸º: å¹´æŠ˜æ—§é¢ / 365 / 24 Ã— è¿è¡Œæ—¶é—´(å°æ—¶)ã€‚è¯¦è§ <a href="#cross-4">X.4 è®¾å¤‡æŠ˜æ—§é›†æˆ</a>ã€‚</p>

                <h3>è®¾å¤‡ä¸ç»´æŠ¤</h3>
                <p><strong>Q11: è®¾å¤‡ç»´æŠ¤æé†’æ€æ ·é…ç½®?</strong></p>
                <p><strong>A:</strong> åœ¨è®¾å¤‡è¯¦æƒ…ä¸­è®¾ç½® "maintenance_interval_days",ç³»ç»Ÿä¼šè‡ªåŠ¨è®¡ç®—ä¸‹æ¬¡ç»´æŠ¤æ—¥æœŸ,å¹¶åœ¨åˆ°æœŸæ—¥æœŸå‰æå‰æé†’ã€‚</p>

                <p><strong>Q12: OEEæŒ‡æ ‡æ€æ ·è®¡ç®—?</strong></p>
                <p><strong>A:</strong> OEE = å¯ç”¨ç‡ Ã— æ•ˆèƒ½ Ã— è´¨é‡ç‡ã€‚è¯¦ç»†å…¬å¼è§ <a href="#ch5">ç¬¬5ç«  è®¾å¤‡ç®¡ç†</a>ã€‚</p>

                <h3>æ•°æ®å¯¼å…¥å¯¼å‡º</h3>
                <p><strong>Q13: å¯¼å…¥æ•°æ®æ—¶å‡ºç°éªŒè¯é”™è¯¯æ€æ ·å¤„ç†?</strong></p>
                <p><strong>A:</strong> ç³»ç»Ÿä¼šåˆ—å‡ºæ‰€æœ‰éªŒè¯å¤±è´¥çš„è¡Œå·å’ŒåŸå› ã€‚ä¿®æ”¹Excelåé‡æ–°ä¸Šä¼ ,æˆ–åˆ é™¤æœ‰é—®é¢˜çš„è¡Œã€‚</p>

                <p><strong>Q14: å¯¼å‡ºçš„æ•°æ®æ ¼å¼æ˜¯ä»€ä¹ˆ?</strong></p>
                <p><strong>A:</strong> é»˜è®¤å¯¼å‡ºä¸ºExcel (.xlsx) æ ¼å¼,æ”¯æŒå…¬å¼ä¸æ ¼å¼ä¿ç•™ã€‚ä¹Ÿå¯é€‰æ‹©CSVæ ¼å¼ç”¨äºæ•°æ®äº¤æ¢ã€‚</p>

                <h3>å¤šå·¥å‚ä¸æƒé™</h3>
                <p><strong>Q15: æˆ‘æ˜¯platform_admin,ä¸ºä»€ä¹ˆçœ‹ä¸åˆ°æŸä¸ªå·¥å‚çš„æ•°æ®?</strong></p>
                <p><strong>A:</strong> platform_admin åªèƒ½çœ‹åˆ°å·²æ¿€æ´»çš„å·¥å‚ã€‚æ£€æŸ¥è¯¥å·¥å‚æ˜¯å¦å·²æ¿€æ´»ã€‚è‹¥å·²æ¿€æ´»ä½†ä»çœ‹ä¸åˆ°,è¯·åˆ·æ–°é¡µé¢æˆ–é€€å‡ºé‡æ–°ç™»å½•ã€‚</p>

                <p><strong>Q16: æ€æ ·ä¸ºå‘˜å·¥åˆ†é…æƒé™?</strong></p>
                <p><strong>A:</strong> ç³»ç»Ÿä½¿ç”¨8ç§é¢„å®šä¹‰è§’è‰²ã€‚é€‰æ‹©ç”¨æˆ·,åˆ†é…ç›¸åº”è§’è‰²,æƒé™ä¼šè‡ªåŠ¨ç”Ÿæ•ˆã€‚è¯¦è§ <a href="#ch9">ç¬¬9ç«  å¹³å°ç®¡ç†</a>ã€‚</p>

                <h3>æŠ¥è¡¨ä¸åˆ†æ</h3>
                <p><strong>Q17: ç”Ÿäº§æŠ¥è¡¨æ€æ ·æŒ‰æ—¶é—´æ®µç­›é€‰?</strong></p>
                <p><strong>A:</strong> æ‰“å¼€ç”Ÿäº§æŠ¥è¡¨,é€‰æ‹©æ—¥æœŸèŒƒå›´,ç³»ç»Ÿä¼šè‡ªåŠ¨èšåˆè¯¥æ—¶é—´æ®µå†…çš„æ•°æ®å¹¶ç”ŸæˆæŠ¥è¡¨ã€‚</p>

                <p><strong>Q18: æˆæœ¬æŠ¥è¡¨æ€æ ·å¯¹æ ‡åŒæœŸ?</strong></p>
                <p><strong>A:</strong> é€‰æ‹©ä¸¤ä¸ªæ—¶é—´æ®µ,ç³»ç»Ÿä¼šå¹¶åˆ—å±•ç¤º,è‡ªåŠ¨è®¡ç®—åŒæ¯”å’Œç¯æ¯”æ•°æ®ã€‚</p>

                <h3>ç³»ç»Ÿä¸æ•…éšœ</h3>
                <p><strong>Q19: ä¸ºä»€ä¹ˆAPIè¿”å› 504 Gateway Timeout?</strong></p>
                <p><strong>A:</strong> è¿™é€šå¸¸è¡¨ç¤ºåç«¯æœåŠ¡æš‚æ—¶æ— å“åº”ã€‚è¯·ç¨åé‡è¯•ã€‚è‹¥é—®é¢˜æŒç»­,è¯·è”ç³»æŠ€æœ¯æ”¯æŒã€‚</p>

                <p><strong>Q20: æ€æ ·æŸ¥çœ‹ç³»ç»Ÿæ“ä½œæ—¥å¿—?</strong></p>
                <p><strong>A:</strong> ä»…factory_adminåŠä»¥ä¸Šæƒé™å¯æŸ¥çœ‹ã€‚è¿›å…¥"å¹³å°ç®¡ç†" â†’ "å®¡è®¡æ—¥å¿—"ã€‚</p>
            </section>
</section>

            <footer>
                <p><strong>æ›´æ–°æ—¥æœŸ</strong>: 2025-11-21</p>
                <p><strong>æ–‡æ¡£ç±»å‹</strong>: æ–°äººå®Œæ•´å­¦ä¹ æŒ‡å— (åŒ…å«MarkdownåŸæ–‡æ¡£å…¨éƒ¨2043è¡Œå†…å®¹)</p>
                <p><strong>æ¨èé˜…è¯»é¡ºåº</strong>: ç¬¬0ç«  â†’ ç¬¬1-11ç«  â†’ äº¤å‰åŠŸèƒ½ â†’ å¸¸è§é—®é¢˜</p>
                <p><strong>ç›¸å…³æ–‡æ¡£</strong>:</p>
                <ul style="list-style: none; padding: 0;">
                    <li><a href="PRD-åŠŸèƒ½ä¸æ–‡ä»¶æ˜ å°„-v3.0-æŠ€æœ¯é€ŸæŸ¥.html">æŠ€æœ¯é€ŸæŸ¥ç‰ˆ</a> - å¿«é€ŸæŸ¥æ‰¾APIå’Œæ–‡ä»¶è·¯å¾„</li>
                    <li><a href="../QUICK_START.md">å¿«é€Ÿå¼€å§‹</a> - 5åˆ†é’Ÿå¯åŠ¨ç³»ç»Ÿ</li>
                    <li><a href="../IMPLEMENTATION_SUMMARY.md">å®ç°æ€»ç»“</a> - åç«¯å®ç°ç»†èŠ‚</li>
                </ul>
                <p style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #ddd; color: #999;">
                    æœ¬æ–‡æ¡£ç”± Claude Code ç”Ÿæˆ,ç¡®ä¿åŒ…å«Markdownæºæ–‡ä»¶çš„æ‰€æœ‰è¯¦ç»†å†…å®¹ã€‚
                </p>
            </footer>
        </main>
    </div>

    <div class="back-to-top" id="backToTop" onclick="window.scrollTo({top: 0, behavior: 'smooth'})">â†‘</div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script>
        const navItems = document.querySelectorAll('.sidebar-nav-item');
        const sections = document.querySelectorAll('section');

        function updateActiveNav() {
            const scrollPosition = window.scrollY + 100;
            sections.forEach(section => {
                const sectionTop = section.offsetTop;
                const sectionBottom = sectionTop + section.offsetHeight;
                if (scrollPosition >= sectionTop && scrollPosition < sectionBottom) {
                    navItems.forEach(item => item.classList.remove('active'));
                    const activeItem = document.querySelector(`[href="#${section.id}"]`);
                    if (activeItem) activeItem.classList.add('active');
                }
            });
        }

        const backToTopBtn = document.getElementById('backToTop');
        window.addEventListener('scroll', () => {
            updateActiveNav();
            if (window.scrollY > 300) {
                backToTopBtn.classList.add('show');
            } else {
                backToTopBtn.classList.remove('show');
            }
        });

        const searchInput = document.getElementById('searchInput');
        if (searchInput) {
            searchInput.addEventListener('input', (e) => {
                const query = e.target.value.toLowerCase();
                navItems.forEach(item => {
                    const text = item.textContent.toLowerCase();
                    item.style.display = text.includes(query) ? 'block' : 'none';
                });
            });
        }

        updateActiveNav();
    </script>
</body>
</html>
