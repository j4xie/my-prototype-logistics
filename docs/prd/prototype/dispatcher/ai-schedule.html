<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI智能排产 - 调度员</title>
  <link rel="stylesheet" href="../styles.css">
  <link rel="stylesheet" href="../components.css">
  <link rel="stylesheet" href="styles.css">
  <style>
    /* AI 特色样式 */
    .ai-header {
      background: linear-gradient(135deg, #722ed1 0%, #a18cd1 50%, #fbc2eb 100%);
      color: white;
      padding: 20px 16px;
      text-align: center;
    }
    .ai-header-icon {
      width: 60px;
      height: 60px;
      background: rgba(255,255,255,0.2);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 12px;
      font-size: 28px;
    }
    .ai-header-title {
      font-size: 20px;
      font-weight: 600;
      margin-bottom: 4px;
    }
    .ai-header-subtitle {
      font-size: 14px;
      opacity: 0.9;
    }

    /* AI 卡片 */
    .ai-card {
      background: white;
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 12px;
      box-shadow: 0 2px 8px rgba(114, 46, 209, 0.1);
      border: 1px solid rgba(114, 46, 209, 0.1);
    }
    .ai-card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }
    .ai-card-title {
      font-size: 16px;
      font-weight: 500;
      color: #333;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .ai-badge {
      background: linear-gradient(135deg, #722ed1 0%, #a18cd1 100%);
      color: white;
      padding: 2px 8px;
      border-radius: 4px;
      font-size: 10px;
      font-weight: 500;
    }

    /* 日期选择器 */
    .date-picker-row {
      display: flex;
      gap: 12px;
      margin-bottom: 16px;
    }
    .date-picker-item {
      flex: 1;
    }
    .date-picker-label {
      font-size: 12px;
      color: #999;
      margin-bottom: 4px;
    }
    .date-picker-input {
      width: 100%;
      padding: 10px 12px;
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      font-size: 14px;
      box-sizing: border-box;
    }

    /* 批次列表 */
    .batch-item {
      display: flex;
      align-items: center;
      padding: 12px;
      background: #f9f9f9;
      border-radius: 8px;
      margin-bottom: 8px;
    }
    .batch-checkbox {
      width: 20px;
      height: 20px;
      border: 2px solid #d9d9d9;
      border-radius: 4px;
      margin-right: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
    }
    .batch-checkbox.checked {
      background: #722ed1;
      border-color: #722ed1;
      color: white;
    }
    .batch-info {
      flex: 1;
    }
    .batch-name {
      font-size: 14px;
      font-weight: 500;
      color: #333;
    }
    .batch-meta {
      font-size: 12px;
      color: #999;
      margin-top: 2px;
    }
    .batch-priority {
      padding: 2px 8px;
      border-radius: 4px;
      font-size: 11px;
    }
    .batch-priority.high { background: #fff1f0; color: #ff4d4f; }
    .batch-priority.normal { background: #f5f5f5; color: #999; }

    /* AI 按钮 */
    .btn-ai {
      background: linear-gradient(135deg, #722ed1 0%, #a18cd1 100%);
      color: white;
      border: none;
      padding: 14px 24px;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 500;
      width: 100%;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
    .btn-ai:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }
    .btn-ai-icon {
      font-size: 20px;
    }

    /* AI 结果区域 */
    .ai-result {
      margin-top: 16px;
      padding-top: 16px;
      border-top: 1px dashed #e0e0e0;
    }
    .ai-result-title {
      font-size: 14px;
      font-weight: 500;
      color: #722ed1;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    /* 产线分配卡片 */
    .line-assignment {
      background: #f9f5ff;
      border: 1px solid #d3adf7;
      border-radius: 8px;
      padding: 12px;
      margin-bottom: 8px;
    }
    .line-assignment-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }
    .line-name {
      font-size: 14px;
      font-weight: 500;
      color: #333;
    }
    .line-load {
      font-size: 12px;
      padding: 2px 8px;
      border-radius: 4px;
    }
    .line-load.low { background: #f6ffed; color: #52c41a; }
    .line-load.medium { background: #fff7e6; color: #fa8c16; }
    .line-load.high { background: #fff1f0; color: #ff4d4f; }
    .line-batches {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }
    .line-batch-tag {
      background: white;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 12px;
      color: #666;
      border: 1px solid #e0e0e0;
    }

    /* 完成概率仪表盘 */
    .probability-gauge {
      text-align: center;
      padding: 20px;
      background: linear-gradient(135deg, #f9f5ff 0%, #fff 100%);
      border-radius: 12px;
      margin-bottom: 12px;
    }
    .gauge-circle {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      background: conic-gradient(#52c41a 0% 85%, #f0f0f0 85% 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 12px;
      position: relative;
    }
    .gauge-inner {
      width: 100px;
      height: 100px;
      border-radius: 50%;
      background: white;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }
    .gauge-value {
      font-size: 28px;
      font-weight: 600;
      color: #52c41a;
    }
    .gauge-label {
      font-size: 12px;
      color: #999;
    }
    .probability-desc {
      font-size: 14px;
      color: #666;
    }
    .probability-desc strong {
      color: #722ed1;
    }

    /* 工人建议 */
    .worker-suggestion {
      background: white;
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      padding: 12px;
      margin-bottom: 8px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .worker-suggestion-left {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .worker-avatar-sm {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      background: linear-gradient(135deg, #722ed1 0%, #a18cd1 100%);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
    }
    .worker-suggestion-info h4 {
      font-size: 14px;
      color: #333;
      margin: 0;
    }
    .worker-suggestion-info p {
      font-size: 12px;
      color: #999;
      margin: 2px 0 0;
    }
    .worker-suggestion-arrow {
      font-size: 16px;
      color: #722ed1;
    }
    .worker-suggestion-target {
      font-size: 14px;
      color: #333;
      font-weight: 500;
    }

    /* 操作按钮组 */
    .action-buttons {
      display: flex;
      gap: 12px;
      margin-top: 16px;
    }
    .btn-outline {
      flex: 1;
      padding: 12px;
      border: 1px solid #722ed1;
      background: white;
      color: #722ed1;
      border-radius: 8px;
      font-size: 14px;
      cursor: pointer;
    }
    .btn-solid {
      flex: 1;
      padding: 12px;
      border: none;
      background: linear-gradient(135deg, #722ed1 0%, #a18cd1 100%);
      color: white;
      border-radius: 8px;
      font-size: 14px;
      cursor: pointer;
    }

    /* Loading 状态 */
    .loading-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.5);
      z-index: 1000;
      justify-content: center;
      align-items: center;
    }
    .loading-content {
      background: white;
      border-radius: 16px;
      padding: 32px;
      text-align: center;
      max-width: 280px;
    }
    .loading-spinner {
      width: 48px;
      height: 48px;
      border: 4px solid #f0f0f0;
      border-top-color: #722ed1;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 16px;
    }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    .loading-text {
      font-size: 16px;
      color: #333;
      margin-bottom: 8px;
    }
    .loading-subtext {
      font-size: 12px;
      color: #999;
    }
  </style>
</head>
<body>
  <a href="../index.html" class="back-to-index">< 返回角色选择</a>

  <div class="mobile-container">
    <div class="status-bar">
      <span>9:41</span>
      <span></span>
    </div>

    <!-- AI Header -->
    <div class="ai-header">
      <a href="index.html" style="position: absolute; left: 16px; top: 16px; color: white; text-decoration: none; font-size: 20px;"><</a>
      <div class="ai-header-icon">&#129302;</div>
      <div class="ai-header-title">AI 智能排产</div>
      <div class="ai-header-subtitle">基于 Monte Carlo + OR-Tools + LLM</div>
    </div>

    <div class="content" style="background: #f5f5f5; padding-bottom: 100px;">

      <!-- 日期选择 -->
      <div class="ai-card">
        <div class="ai-card-header">
          <div class="ai-card-title">
            <span>&#128197;</span>
            排产日期
          </div>
        </div>
        <div class="date-picker-row">
          <div class="date-picker-item">
            <div class="date-picker-label">开始日期</div>
            <input type="date" class="date-picker-input" value="2025-12-28">
          </div>
          <div class="date-picker-item">
            <div class="date-picker-label">结束日期</div>
            <input type="date" class="date-picker-input" value="2025-12-28">
          </div>
        </div>
      </div>

      <!-- 待排产批次 -->
      <div class="ai-card">
        <div class="ai-card-header">
          <div class="ai-card-title">
            <span>&#128230;</span>
            待排产批次
            <span class="ai-badge">5 个</span>
          </div>
          <span style="color: #722ed1; font-size: 12px; cursor: pointer;">全选</span>
        </div>

        <div class="batch-item">
          <div class="batch-checkbox checked">&#10003;</div>
          <div class="batch-info">
            <div class="batch-name">带鱼片 100kg</div>
            <div class="batch-meta">订单号: ORD-2025-001 | 交期: 12-28 18:00</div>
          </div>
          <span class="batch-priority high">紧急</span>
        </div>

        <div class="batch-item">
          <div class="batch-checkbox checked">&#10003;</div>
          <div class="batch-info">
            <div class="batch-name">黄鱼片 80kg</div>
            <div class="batch-meta">订单号: ORD-2025-002 | 交期: 12-28 20:00</div>
          </div>
          <span class="batch-priority normal">普通</span>
        </div>

        <div class="batch-item">
          <div class="batch-checkbox checked">&#10003;</div>
          <div class="batch-info">
            <div class="batch-name">鱿鱼圈 60kg</div>
            <div class="batch-meta">订单号: ORD-2025-003 | 交期: 12-29 12:00</div>
          </div>
          <span class="batch-priority normal">普通</span>
        </div>

        <div class="batch-item">
          <div class="batch-checkbox checked">&#10003;</div>
          <div class="batch-info">
            <div class="batch-name">虾仁 120kg</div>
            <div class="batch-meta">订单号: ORD-2025-004 | 交期: 12-29 18:00</div>
          </div>
          <span class="batch-priority normal">普通</span>
        </div>

        <div class="batch-item">
          <div class="batch-checkbox">&#10003;</div>
          <div class="batch-info">
            <div class="batch-name">墨鱼仔 50kg</div>
            <div class="batch-meta">订单号: ORD-2025-005 | 交期: 12-30 12:00</div>
          </div>
          <span class="batch-priority normal">普通</span>
        </div>
      </div>

      <!-- AI 一键排产按钮 -->
      <button class="btn-ai" id="aiScheduleBtn" onclick="startAISchedule()">
        <span class="btn-ai-icon">&#129302;</span>
        AI 一键智能排产
      </button>

      <!-- AI 结果区域 (初始隐藏) -->
      <div id="aiResult" style="display: none;">

        <!-- 完成概率 -->
        <div class="ai-card" style="margin-top: 16px;">
          <div class="ai-card-header">
            <div class="ai-card-title">
              <span>&#128200;</span>
              完成概率预测
              <span class="ai-badge">Monte Carlo</span>
            </div>
            <a href="ai-completion-prob.html" style="color: #722ed1; font-size: 12px;">详情 ></a>
          </div>
          <div class="probability-gauge">
            <div class="gauge-circle">
              <div class="gauge-inner">
                <div class="gauge-value">85%</div>
                <div class="gauge-label">按时完成</div>
              </div>
            </div>
            <div class="probability-desc">
              基于 <strong>10,000 次模拟</strong>，预计按时完成概率 <strong>85%</strong>
            </div>
          </div>
        </div>

        <!-- 产线分配建议 -->
        <div class="ai-card">
          <div class="ai-card-header">
            <div class="ai-card-title">
              <span>&#127981;</span>
              产线分配建议
              <span class="ai-badge">OR-Tools</span>
            </div>
          </div>

          <div class="line-assignment">
            <div class="line-assignment-header">
              <span class="line-name">切片车间 - A线</span>
              <span class="line-load low">负荷 65%</span>
            </div>
            <div class="line-batches">
              <span class="line-batch-tag">带鱼片 100kg</span>
              <span class="line-batch-tag">黄鱼片 80kg</span>
            </div>
          </div>

          <div class="line-assignment">
            <div class="line-assignment-header">
              <span class="line-name">切片车间 - B线</span>
              <span class="line-load medium">负荷 78%</span>
            </div>
            <div class="line-batches">
              <span class="line-batch-tag">鱿鱼圈 60kg</span>
              <span class="line-batch-tag">墨鱼仔 50kg</span>
            </div>
          </div>

          <div class="line-assignment">
            <div class="line-assignment-header">
              <span class="line-name">包装车间 - A线</span>
              <span class="line-load low">负荷 55%</span>
            </div>
            <div class="line-batches">
              <span class="line-batch-tag">虾仁 120kg</span>
            </div>
          </div>
        </div>

        <!-- 人员优化建议 -->
        <div class="ai-card">
          <div class="ai-card-header">
            <div class="ai-card-title">
              <span>&#128101;</span>
              人员优化建议
              <span class="ai-badge">LLM</span>
            </div>
            <a href="ai-worker-optimize.html" style="color: #722ed1; font-size: 12px;">详情 ></a>
          </div>

          <div class="worker-suggestion">
            <div class="worker-suggestion-left">
              <div class="worker-avatar-sm">张</div>
              <div class="worker-suggestion-info">
                <h4>张小明</h4>
                <p>机动人员 | 切片技能 Lv.3</p>
              </div>
            </div>
            <span class="worker-suggestion-arrow">&#8594;</span>
            <div class="worker-suggestion-target">切片A线</div>
          </div>

          <div class="worker-suggestion">
            <div class="worker-suggestion-left">
              <div class="worker-avatar-sm">李</div>
              <div class="worker-suggestion-info">
                <h4>李小红</h4>
                <p>包装车间 | 可调动</p>
              </div>
            </div>
            <span class="worker-suggestion-arrow">&#8594;</span>
            <div class="worker-suggestion-target">切片B线</div>
          </div>

          <div style="background: #f6ffed; border-radius: 6px; padding: 10px; margin-top: 12px; font-size: 12px; color: #52c41a;">
            &#128161; AI 建议：调整后预计效率提升 12%，完成概率提升至 92%
          </div>
        </div>

        <!-- 操作按钮 -->
        <div class="action-buttons">
          <button class="btn-outline" onclick="location.href='plan-gantt.html'">手动调整</button>
          <button class="btn-solid" onclick="applySchedule()">应用排产方案</button>
        </div>
      </div>

    </div>

    <!-- 底部导航 -->
    <nav class="bottom-nav">
      <a href="index.html" class="nav-item"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg><span>首页</span></a>
      <a href="plan-list.html" class="nav-item"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-5 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"/></svg><span>计划</span></a>
      <a href="ai-schedule.html" class="nav-item ai-nav active"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M21 10.12h-6.78l2.74-2.82c-2.73-2.7-7.15-2.8-9.88-.1-2.73 2.71-2.73 7.08 0 9.79s7.15 2.71 9.88 0C18.32 15.65 19 14.08 19 12.1h2c0 1.98-.88 4.55-2.64 6.29-3.51 3.48-9.21 3.48-12.72 0-3.5-3.47-3.53-9.11-.02-12.58s9.14-3.47 12.65 0L21 3v7.12z"/></svg><span>AI调度</span></a>
      <a href="personnel-list.html" class="nav-item"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5z"/></svg><span>人员</span></a>
      <a href="profile.html" class="nav-item"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg><span>我的</span></a>
    </nav>
  </div>

  <!-- Loading 弹窗 -->
  <div class="loading-overlay" id="loadingOverlay">
    <div class="loading-content">
      <div class="loading-spinner"></div>
      <div class="loading-text">AI 正在分析...</div>
      <div class="loading-subtext">Monte Carlo 模拟中 (10,000次)</div>
    </div>
  </div>

  <script>
    function startAISchedule() {
      // 显示 loading
      document.getElementById('loadingOverlay').style.display = 'flex';
      document.getElementById('aiScheduleBtn').disabled = true;

      // 模拟 AI 处理时间
      setTimeout(() => {
        document.getElementById('loadingOverlay').style.display = 'none';
        document.getElementById('aiResult').style.display = 'block';
        document.getElementById('aiScheduleBtn').style.display = 'none';

        // 滚动到结果区域
        document.getElementById('aiResult').scrollIntoView({ behavior: 'smooth' });
      }, 2500);
    }

    function applySchedule() {
      alert('排产方案已应用！\n\n已创建 4 个生产计划，人员调动申请已提交审批。');
      location.href = 'plan-list.html';
    }
  </script>
</body>
</html>
