# ç™½å©çºªé£Ÿå“æº¯æºç³»ç»Ÿ - ç”Ÿäº§æ¨¡å—è§„åˆ’æ–‡æ¡£

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**åˆ›å»ºæ—¥æœŸ**: 2025-01-05
**å®æ–½å‘¨æœŸ**: 4-6å‘¨
**æ–‡æ¡£çŠ¶æ€**: å¾…å®æ–½

---

## ğŸ“‹ ç›®å½•

1. [ç”Ÿäº§æ¨¡å—æ¦‚è¿°](#ç”Ÿäº§æ¨¡å—æ¦‚è¿°)
2. [ä¸šåŠ¡æµç¨‹åˆ†æ](#ä¸šåŠ¡æµç¨‹åˆ†æ)
3. [åŠŸèƒ½æ¨¡å—è¯¦ç»†è®¾è®¡](#åŠŸèƒ½æ¨¡å—è¯¦ç»†è®¾è®¡)
4. [æ•°æ®åº“è®¾è®¡](#æ•°æ®åº“è®¾è®¡)
5. [APIæ¥å£æ¸…å•](#apiæ¥å£æ¸…å•)
6. [å‰ç«¯é¡µé¢è®¾è®¡](#å‰ç«¯é¡µé¢è®¾è®¡)
7. [é¡µé¢è·³è½¬å…³ç³»å›¾](#é¡µé¢è·³è½¬å…³ç³»å›¾)
8. [ä¸å…¶ä»–æ¨¡å—çš„åä½œ](#ä¸å…¶ä»–æ¨¡å—çš„åä½œ)
9. [ä¼˜åŒ–æ–¹å‘](#ä¼˜åŒ–æ–¹å‘)
10. [å®æ–½è®¡åˆ’](#å®æ–½è®¡åˆ’)
11. [éªŒæ”¶æ ‡å‡†](#éªŒæ”¶æ ‡å‡†)

---

## ç”Ÿäº§æ¨¡å—æ¦‚è¿°

### 1.1 ç³»ç»Ÿå®šä½

ç”Ÿäº§æ¨¡å—æ˜¯ç™½å©çºªé£Ÿå“æº¯æºç³»ç»Ÿçš„**æ ¸å¿ƒä¸šåŠ¡æ¨¡å—**,è´Ÿè´£ç®¡ç†ä»åŸææ–™æ¥æ”¶åˆ°æˆå“äº§å‡ºçš„å®Œæ•´ç”Ÿäº§æµç¨‹ã€‚

**è®¾è®¡åŸåˆ™**:
- ğŸ¯ **æµç¨‹å®Œæ•´**: è¦†ç›–ç”Ÿäº§å…¨ç”Ÿå‘½å‘¨æœŸç®¡ç†
- ğŸ“Š **æ•°æ®é©±åŠ¨**: å®æ—¶è®°å½•ç”Ÿäº§æ•°æ®,æ”¯æŒæˆæœ¬æ ¸ç®—å’Œæ™ºèƒ½åˆ†æ
- ğŸ”— **ååŒå·¥ä½œ**: ä¸å‘˜å·¥ç®¡ç†ã€è®¾å¤‡ç›‘æ§ã€ä»“å‚¨ç­‰æ¨¡å—æ·±åº¦é›†æˆ
- ğŸ’° **æˆæœ¬å¯æ§**: ç²¾ç»†åŒ–æˆæœ¬æ ¸ç®—,AIæ™ºèƒ½åˆ†æä¼˜åŒ–å»ºè®®
- ğŸ“± **ç§»åŠ¨ä¼˜å…ˆ**: ä¼˜åŒ–ç§»åŠ¨ç«¯æ“ä½œä½“éªŒ,æ”¯æŒç¦»çº¿åŠŸèƒ½

### 1.2 æ ¸å¿ƒåŠŸèƒ½æ¸…å•

**6å¤§æ ¸å¿ƒå­æ¨¡å—**:

1. **æ‰¹æ¬¡ç®¡ç†** (Batch Management)
   - âœ… æ‰¹æ¬¡åˆ›å»ºã€ç¼–è¾‘ã€åˆ é™¤
   - âœ… æ‰¹æ¬¡çŠ¶æ€æµè½¬(planning â†’ in_progress â†’ quality_check â†’ completed)
   - âœ… æ‰¹æ¬¡æ—¶é—´çº¿è¿½è¸ª
   - âœ… æ‰¹æ¬¡æ•°æ®æŸ¥è¯¢å’Œç­›é€‰

2. **è´¨é‡æ£€éªŒ** (Quality Inspection)
   - âœ… ä¸‰é˜¶æ®µè´¨æ£€(åŸæ–™è´¨æ£€ â†’ è¿‡ç¨‹è´¨æ£€ â†’ æˆå“è´¨æ£€)
   - âœ… è´¨æ£€è®°å½•åˆ›å»ºå’ŒæŸ¥è¯¢
   - âœ… è´¨æ£€ç…§ç‰‡ä¸Šä¼ 
   - âœ… è´¨æ£€ç»Ÿè®¡å’Œè¶‹åŠ¿åˆ†æ

3. **å‘˜å·¥å·¥ä½œç®¡ç†** (Employee Work Management)
   - âœ… å‘˜å·¥æ‰“å¡(ä¸Šç­/ä¸‹ç­)
   - âœ… å·¥ä½œæ—¶æ®µè®°å½•
   - âœ… å·¥æ—¶ç»Ÿè®¡(æ—¥/å‘¨/æœˆ)
   - âœ… å·¥ä½œè®°å½•å…³è”æ‰¹æ¬¡

4. **è®¾å¤‡ç›‘æ§** (Equipment Monitoring)
   - âœ… è®¾å¤‡å®æ—¶ç›‘æ§(æ¸©åº¦ã€æ¹¿åº¦ã€å‹åŠ›ã€è¿è¡Œæ—¶é•¿)
   - âœ… è®¾å¤‡ä½¿ç”¨è®°å½•
   - âœ… è®¾å¤‡å‘Šè­¦ç®¡ç†(3çº§å‘Šè­¦)
   - âœ… è®¾å¤‡ç»´æŠ¤è®°å½•

5. **æˆæœ¬æ ¸ç®—** (Cost Analysis)
   - âœ… æˆæœ¬è‡ªåŠ¨è®¡ç®—(åŸæ–™+äººå·¥+è®¾å¤‡)
   - âœ… æˆæœ¬æ„æˆåˆ†æ
   - âœ… AIæ™ºèƒ½æˆæœ¬åˆ†æ(DeepSeeké›†æˆ)
   - âœ… æˆæœ¬è¶‹åŠ¿å¯¹æ¯”

6. **ç”Ÿäº§ä»ªè¡¨æ¿** (Production Dashboard)
   - âœ… ç”Ÿäº§æ¦‚è§ˆ(ä»Šæ—¥/æœ¬å‘¨/æœ¬æœˆ)
   - âœ… å…³é”®æŒ‡æ ‡å±•ç¤º(äº§é‡ã€åˆæ ¼ç‡ã€æˆæœ¬ã€æ•ˆç‡)
   - âœ… å‘Šè­¦æ‘˜è¦
   - âœ… è¶‹åŠ¿åˆ†æ

### 1.3 æŠ€æœ¯æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   ç§»åŠ¨ç«¯ (React Native)                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                    ç”Ÿäº§ä»ªè¡¨æ¿                         â”‚  â”‚
â”‚  â”‚  ProcessingDashboardScreen (ç”Ÿäº§æ¦‚è§ˆ)                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚            â”‚                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                   â”‚         â”‚         â”‚         â”‚      â”‚â”‚
â”‚  â–¼                   â–¼         â–¼         â–¼         â–¼      â”‚â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”â”‚â”‚
â”‚ â”‚æ‰¹æ¬¡  â”‚ â”‚ è´¨æ£€    â”‚â”‚ å‘˜å·¥   â”‚â”‚ è®¾å¤‡   â”‚â”‚ æˆæœ¬   â”‚â”‚æ•°æ® â”‚â”‚â”‚
â”‚ â”‚ç®¡ç†  â”‚ â”‚ ç®¡ç†    â”‚â”‚ å·¥ä½œ   â”‚â”‚ ç›‘æ§   â”‚â”‚ åˆ†æ   â”‚â”‚å¯¼å‡º â”‚â”‚â”‚
â”‚ â”‚(5é¡µ) â”‚ â”‚ (4é¡µ)   â”‚â”‚ (3é¡µ)  â”‚â”‚ (4é¡µ)  â”‚â”‚ (3é¡µ)  â”‚â”‚(1é¡µ)â”‚â”‚â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”˜â”‚â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚ HTTPS/REST API
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 åç«¯API (Node.js + Express)                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Processing API (29ä¸ªç”Ÿäº§ç›¸å…³ç«¯ç‚¹)                    â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚  â€¢ /api/mobile/processing/* (æ‰¹æ¬¡ã€è´¨æ£€ã€è®¾å¤‡)        â”‚  â”‚
â”‚  â”‚  â€¢ /api/mobile/timeclock/* (æ‰“å¡ã€å·¥æ—¶)              â”‚  â”‚
â”‚  â”‚  â€¢ /api/mobile/time-stats/* (å·¥æ—¶ç»Ÿè®¡)               â”‚  â”‚
â”‚  â”‚  â€¢ /api/mobile/analysis/* (AIæˆæœ¬åˆ†æ)                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ•°æ®åº“ (MySQL)                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  â€¢ processing_batches (æ‰¹æ¬¡ä¸»è¡¨)                      â”‚  â”‚
â”‚  â”‚  â€¢ quality_inspections (è´¨æ£€è®°å½•)                     â”‚  â”‚
â”‚  â”‚  â€¢ employee_time_clocks (æ‰“å¡è®°å½•)                    â”‚  â”‚
â”‚  â”‚  â€¢ employee_work_sessions (å·¥ä½œæ—¶æ®µ)                  â”‚  â”‚
â”‚  â”‚  â€¢ factory_equipment (è®¾å¤‡ç®¡ç†)                       â”‚  â”‚
â”‚  â”‚  â€¢ device_monitoring_data (ç›‘æ§æ•°æ®)                  â”‚  â”‚
â”‚  â”‚  â€¢ alert_notifications (å‘Šè­¦é€šçŸ¥)                     â”‚  â”‚
â”‚  â”‚  â€¢ ai_analysis_logs (AIåˆ†ææ—¥å¿—)                      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.4 ç°æœ‰åŠŸèƒ½å®Œæˆåº¦è¯„ä¼°

| å­æ¨¡å— | åç«¯API | æ•°æ®åº“è¡¨ | å‰ç«¯UI | æ•´ä½“å®Œæˆåº¦ | çŠ¶æ€ |
|-------|---------|---------|--------|-----------|------|
| **æ‰¹æ¬¡ç®¡ç†** | 100% (8ä¸ªAPI) | 100% | 30% (1/5é¡µ) | 77% | ğŸŸ¡ éœ€è¦å¤§é‡å‰ç«¯å¼€å‘ |
| **è´¨é‡æ£€éªŒ** | 100% (6ä¸ªAPI) | 100% | 20% (0/4é¡µ) | 73% | ğŸŸ¡ éœ€è¦å…¨éƒ¨å‰ç«¯é¡µé¢ |
| **å‘˜å·¥å·¥ä½œ** | 100% (7ä¸ªAPI) | 100% | 70% (2/3é¡µ) | 90% | ğŸŸ¢ æ¥è¿‘å®Œæˆ |
| **è®¾å¤‡ç›‘æ§** | 100% (5ä¸ªAPI) | 100% | 10% (0/4é¡µ) | 70% | ğŸŸ¡ éœ€è¦å…¨éƒ¨å‰ç«¯é¡µé¢ |
| **æˆæœ¬æ ¸ç®—** | 80% (3ä¸ªAPI) | 100% | 40% (1/3é¡µ) | 73% | ğŸŸ¡ AIé›†æˆå¾…å®Œå–„ |
| **ç”Ÿäº§ä»ªè¡¨æ¿** | 100% (6ä¸ªAPI) | 100% | 50% (1/2é¡µ) | 83% | ğŸŸ¡ éœ€è¦ä¼˜åŒ– |

**æ€»ä½“å®Œæˆåº¦**: **çº¦78%**

**æ ¸å¿ƒé—®é¢˜**:
- âœ… åç«¯APIå·²å®Œæˆ95%ä»¥ä¸Š,æ•°æ®åº“è¡¨ç»“æ„å®Œå–„
- âŒ å‰ç«¯UIç¼ºå¤±ä¸¥é‡,20ä¸ªé¡µé¢ä¸­ä»…å®Œæˆ5ä¸ª(25%)
- âŒ AIåˆ†æåŠŸèƒ½ä½¿ç”¨Mockæ•°æ®,æœªé›†æˆçœŸå®DeepSeek API
- âŒ ç¼ºå°‘ç¦»çº¿åŠŸèƒ½æ”¯æŒ
- âŒ æ€§èƒ½ä¼˜åŒ–ä¸è¶³(ç¼“å­˜ã€åˆ†é¡µ)

---

## ä¸šåŠ¡æµç¨‹åˆ†æ

### 2.1 å®Œæ•´ç”Ÿäº§ä¸šåŠ¡çº¿

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ç”Ÿäº§ä¸šåŠ¡å…¨æµç¨‹                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ­¥éª¤1: åŸææ–™æ¥æ”¶ (Material Receipt)
  â†“
  æ“ä½œ: æ¥æ”¶éƒ¨é—¨å½•å…¥åŸææ–™ä¿¡æ¯
  é¡µé¢: MaterialReceiptScreen
  æ•°æ®: raw_material_category, raw_material_weight, raw_material_cost
  éªŒè¯: åŸææ–™è´¨æ£€(è´¨æ£€å‘˜)

æ­¥éª¤2: æ‰¹æ¬¡åˆ›å»º (Batch Creation)
  â†“
  æ“ä½œ: ç”Ÿäº§ä¸»ç®¡åˆ›å»ºç”Ÿäº§æ‰¹æ¬¡
  é¡µé¢: BatchCreateScreen
  æ•°æ®: äº§å“ç±»å‹ã€ç›®æ ‡äº§é‡ã€ç”Ÿäº§çº¿ã€è´Ÿè´£äºº
  æƒé™: department_adminåŠä»¥ä¸Š

æ­¥éª¤3: å‘˜å·¥æ‰“å¡ä¸Šç­ (Clock In)
  â†“
  æ“ä½œ: ç”Ÿäº§å‘˜å·¥å¼€å§‹å·¥ä½œ
  é¡µé¢: TimeClockScreen
  æ•°æ®: æ‰“å¡æ—¶é—´ã€GPSä½ç½®ã€å·¥ä½œç±»å‹
  å…³è”: åˆ›å»ºwork_sessionè®°å½•

æ­¥éª¤4: è®¾å¤‡ä½¿ç”¨å¼€å§‹ (Equipment Usage Start)
  â†“
  æ“ä½œ: è®°å½•è®¾å¤‡ä½¿ç”¨å¼€å§‹æ—¶é—´
  API: POST /processing/equipment-usage/start
  æ•°æ®: equipment_id, batch_id, start_time

æ­¥éª¤5: æ‰¹æ¬¡ç”Ÿäº§æ‰§è¡Œ (Production Execution)
  â†“
  æ“ä½œ: ç”Ÿäº§ä¸»ç®¡ç‚¹å‡»"å¼€å§‹ç”Ÿäº§"
  é¡µé¢: BatchDetailScreen
  API: POST /processing/batches/:id/start
  çŠ¶æ€å˜æ›´: planning â†’ in_progress

æ­¥éª¤6: è¿‡ç¨‹è´¨æ£€ (Process Quality Inspection)
  â†“
  æ“ä½œ: è´¨æ£€å‘˜å®šæœŸè¿›è¡Œè¿‡ç¨‹è´¨æ£€
  é¡µé¢: QualityInspectionCreateScreen
  æ•°æ®: æ¸©åº¦ã€pHã€å¾®ç”Ÿç‰©æ£€æµ‹ç»“æœ
  é¢‘ç‡: æ ¹æ®äº§å“ç±»å‹,å»ºè®®2-4å°æ—¶/æ¬¡

æ­¥éª¤7: è®¾å¤‡ç›‘æ§å’Œå‘Šè­¦ (Equipment Monitoring)
  â†“
  è‡ªåŠ¨: ç³»ç»Ÿè‡ªåŠ¨é‡‡é›†è®¾å¤‡ç›‘æ§æ•°æ®
  é¡µé¢: EquipmentMonitoringScreen
  å‘Šè­¦: å‚æ•°è¶…æ ‡æ—¶è§¦å‘å‘Šè­¦
  å¤„ç†: å‘Šè­¦ç¡®è®¤ â†’ çº æ­£æªæ–½

æ­¥éª¤8: æ‰¹æ¬¡å®Œæˆ (Batch Completion)
  â†“
  æ“ä½œ: ç”Ÿäº§ä¸»ç®¡ç‚¹å‡»"å®Œæˆç”Ÿäº§"
  é¡µé¢: BatchDetailScreen
  API: POST /processing/batches/:id/complete
  çŠ¶æ€å˜æ›´: in_progress â†’ quality_check

æ­¥éª¤9: æˆå“è´¨æ£€ (Final Quality Inspection)
  â†“
  æ“ä½œ: è´¨æ£€å‘˜è¿›è¡Œæˆå“è´¨æ£€
  é¡µé¢: QualityInspectionCreateScreen
  ç»“æœ: pass â†’ completed | fail â†’ failed
  çŠ¶æ€å˜æ›´: quality_check â†’ completed/failed

æ­¥éª¤10: è®¾å¤‡ä½¿ç”¨ç»“æŸ (Equipment Usage End)
  â†“
  æ“ä½œ: è®°å½•è®¾å¤‡ä½¿ç”¨ç»“æŸæ—¶é—´
  API: POST /processing/equipment-usage/end
  è®¡ç®—: è®¾å¤‡ä½¿ç”¨æ—¶é•¿ã€è®¾å¤‡æˆæœ¬

æ­¥éª¤11: å‘˜å·¥ä¸‹ç­æ‰“å¡ (Clock Out)
  â†“
  æ“ä½œ: ç”Ÿäº§å‘˜å·¥ä¸‹ç­æ‰“å¡
  é¡µé¢: TimeClockScreen
  è®¡ç®—: å·¥æ—¶ã€åŠ ç­æ—¶é•¿
  å…³è”: æ›´æ–°work_sessionè®°å½•

æ­¥éª¤12: æˆæœ¬æ ¸ç®— (Cost Calculation)
  â†“
  è‡ªåŠ¨: ç³»ç»Ÿè‡ªåŠ¨è®¡ç®—æ‰¹æ¬¡æ€»æˆæœ¬
  API: POST /processing/batches/:batchId/recalculate-cost
  å…¬å¼: æ€»æˆæœ¬ = åŸæ–™æˆæœ¬ + äººå·¥æˆæœ¬ + è®¾å¤‡æˆæœ¬ + å…¶ä»–æˆæœ¬
  æ•°æ®:
    - åŸæ–™æˆæœ¬: raw_material_cost (æ‰‹åŠ¨è¾“å…¥)
    - äººå·¥æˆæœ¬: Î£(å·¥æ—¶ Ã— æ—¶è–ª) (è‡ªåŠ¨è®¡ç®—)
    - è®¾å¤‡æˆæœ¬: Î£(è®¾å¤‡ä½¿ç”¨æ—¶é•¿ Ã— æŠ˜æ—§è´¹ç‡) (è‡ªåŠ¨è®¡ç®—)

æ­¥éª¤13: AIæˆæœ¬åˆ†æ (AI Cost Analysis - å¯é€‰)
  â†“
  æ“ä½œ: ç”Ÿäº§ä¸»ç®¡è¯·æ±‚AIåˆ†æ
  é¡µé¢: BatchCostDetailScreen
  API: POST /analysis/deepseek
  è¾“å‡º: æˆæœ¬åˆ†ææŠ¥å‘Š + ä¼˜åŒ–å»ºè®®

æ­¥éª¤14: æ•°æ®å½’æ¡£å’Œè¿½æº¯ (Data Archive)
  â†“
  è‡ªåŠ¨: æ‰¹æ¬¡çŠ¶æ€ä¸ºcompletedåè‡ªåŠ¨å½’æ¡£
  ç”¨é€”: è´¨é‡è¿½æº¯ã€æˆæœ¬åˆ†æã€å†å²å¯¹æ¯”

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      å…³é”®ä¸šåŠ¡èŠ‚ç‚¹æ€»ç»“                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å¿…é¡»èŠ‚ç‚¹ (M - Mandatory):
  M1. æ‰¹æ¬¡åˆ›å»º
  M2. å¼€å§‹ç”Ÿäº§
  M3. å®Œæˆç”Ÿäº§
  M4. æˆå“è´¨æ£€

å¯é€‰èŠ‚ç‚¹ (O - Optional):
  O1. åŸææ–™è´¨æ£€
  O2. è¿‡ç¨‹è´¨æ£€
  O3. AIæˆæœ¬åˆ†æ

è‡ªåŠ¨èŠ‚ç‚¹ (A - Automatic):
  A1. æˆæœ¬è‡ªåŠ¨è®¡ç®—
  A2. è®¾å¤‡ç›‘æ§æ•°æ®é‡‡é›†
  A3. å‘Šè­¦è‡ªåŠ¨è§¦å‘
```

### 2.2 æ‰¹æ¬¡çŠ¶æ€æµè½¬è§„åˆ™

```
æ‰¹æ¬¡çŠ¶æ€æœº (Batch Status State Machine):

[planning] è®¡åˆ’ä¸­
  â”‚
  â”‚ æ“ä½œ: å¼€å§‹ç”Ÿäº§ (Start Production)
  â”‚ æƒé™: department_adminåŠä»¥ä¸Š
  â”‚ å‰ç½®æ¡ä»¶:
  â”‚   - åŸæ–™å·²å‡†å¤‡
  â”‚   - ç”Ÿäº§çº¿å¯ç”¨
  â”‚   - è´Ÿè´£äººå·²åˆ†é…
  â†“
[in_progress] è¿›è¡Œä¸­
  â”‚
  â”‚ æ“ä½œ: æš‚åœç”Ÿäº§ (Pause Production)
  â”‚ æƒé™: department_adminåŠä»¥ä¸Š
  â”‚ åŸå› : è®¾å¤‡æ•…éšœã€åŸæ–™ä¸è¶³ç­‰
  â†“
[paused] å·²æš‚åœ
  â”‚
  â”‚ æ“ä½œ: æ¢å¤ç”Ÿäº§ (Resume Production)
  â”‚ æƒé™: department_adminåŠä»¥ä¸Š
  â”‚ å‰ç½®æ¡ä»¶: é—®é¢˜å·²è§£å†³
  â†“
[in_progress] è¿›è¡Œä¸­
  â”‚
  â”‚ æ“ä½œ: å®Œæˆç”Ÿäº§ (Complete Production)
  â”‚ æƒé™: department_adminåŠä»¥ä¸Š
  â”‚ å¿…å¡«æ•°æ®: actualQuantity (å®é™…äº§é‡)
  â†“
[quality_check] è´¨æ£€ä¸­
  â”‚
  â”œâ”€ æ“ä½œ: è´¨æ£€é€šè¿‡ (Quality Pass)
  â”‚  æƒé™: department_adminåŠä»¥ä¸Š
  â”‚  å‰ç½®æ¡ä»¶: è´¨æ£€è®°å½•å·²åˆ›å»º,ç»“æœä¸ºpass
  â”‚  â†“
  â”‚ [completed] å·²å®Œæˆ âœ…
  â”‚
  â””â”€ æ“ä½œ: è´¨æ£€ä¸é€šè¿‡ (Quality Fail)
     æƒé™: department_adminåŠä»¥ä¸Š
     å‰ç½®æ¡ä»¶: è´¨æ£€è®°å½•å·²åˆ›å»º,ç»“æœä¸ºfail
     â†“
    [failed] å·²å¤±è´¥ âŒ

ç‰¹æ®ŠçŠ¶æ€:
  - [cancelled] å·²å–æ¶ˆ: åªèƒ½ä»planningçŠ¶æ€å–æ¶ˆ
  - [deleted] å·²åˆ é™¤: åªèƒ½åˆ é™¤planningçŠ¶æ€çš„æ‰¹æ¬¡

çŠ¶æ€æƒé™çŸ©é˜µ:

| å½“å‰çŠ¶æ€ | operator | department_admin | factory_super_admin |
|---------|---------|-----------------|---------------------|
| planning | æŸ¥çœ‹ | ç¼–è¾‘ã€åˆ é™¤ã€å¼€å§‹ | æ‰€æœ‰æ“ä½œ |
| in_progress | æŸ¥çœ‹ã€è®°å½•å·¥æ—¶ | æš‚åœã€å®Œæˆ | æ‰€æœ‰æ“ä½œ |
| paused | æŸ¥çœ‹ | æ¢å¤ã€å–æ¶ˆ | æ‰€æœ‰æ“ä½œ |
| quality_check | æŸ¥çœ‹ | é€šè¿‡ã€ä¸é€šè¿‡ | æ‰€æœ‰æ“ä½œ |
| completed | æŸ¥çœ‹ | æŸ¥çœ‹ | æŸ¥çœ‹ã€åˆ é™¤ |
| failed | æŸ¥çœ‹ | æŸ¥çœ‹ | æŸ¥çœ‹ã€åˆ é™¤ |
```

### 2.3 è·¨æ¨¡å—åä½œå…³ç³»

#### 2.3.1 ä¸å‘˜å·¥ç®¡ç†æ¨¡å—çš„é›†æˆ

**é›†æˆç‚¹1: æ‰¹æ¬¡è´Ÿè´£äººé€‰æ‹©**
```typescript
// æ‰¹æ¬¡åˆ›å»ºæ—¶é€‰æ‹©è´Ÿè´£äºº
APIè°ƒç”¨: GET /api/mobile/users?department=processing&role=operator
è¿”å›æ•°æ®: [{ id, fullName, department, currentLoad }]
ç”¨é€”: BatchCreateScreençš„è´Ÿè´£äººé€‰æ‹©å™¨
```

**é›†æˆç‚¹2: å·¥æ—¶è®°å½•å…³è”æ‰¹æ¬¡**
```typescript
// å‘˜å·¥æ‰“å¡æ—¶å…³è”æ‰¹æ¬¡
APIè°ƒç”¨: POST /api/mobile/timeclock/clock-in
è¯·æ±‚æ•°æ®: {
  workType: 'production',
  relatedBatchId: 'batch_123'  // å…³è”æ‰¹æ¬¡ID
}
ç”¨é€”: æˆæœ¬æ ¸ç®—æ—¶è®¡ç®—äººå·¥æˆæœ¬
```

**é›†æˆç‚¹3: æˆæœ¬æ ¸ç®—è¯»å–å·¥æ—¶æ•°æ®**
```typescript
// è®¡ç®—æ‰¹æ¬¡äººå·¥æˆæœ¬
APIè°ƒç”¨: GET /api/mobile/time-stats/batch/:batchId
è¿”å›æ•°æ®: {
  totalWorkMinutes: 480,  // æ€»å·¥æ—¶(åˆ†é’Ÿ)
  employeeCount: 5,       // å‚ä¸å‘˜å·¥æ•°
  workSessions: [...]     // å·¥ä½œæ—¶æ®µæ˜ç»†
}
è®¡ç®—å…¬å¼: laborCost = totalWorkMinutes * avgHourlyRate / 60
```

#### 2.3.2 ä¸è®¾å¤‡ç›‘æ§æ¨¡å—çš„é›†æˆ

**é›†æˆç‚¹1: æ‰¹æ¬¡æ‰§è¡Œæ—¶è®°å½•è®¾å¤‡ä½¿ç”¨**
```typescript
// å¼€å§‹ç”Ÿäº§æ—¶å¯åŠ¨è®¾å¤‡ä½¿ç”¨è®°å½•
APIè°ƒç”¨: POST /api/mobile/processing/equipment-usage/start
è¯·æ±‚æ•°æ®: {
  equipmentId: 'EQ001',
  batchId: 'batch_123',
  startTime: '2025-01-05T08:00:00Z'
}
```

**é›†æˆç‚¹2: æˆæœ¬æ ¸ç®—è¯»å–è®¾å¤‡æ•°æ®**
```typescript
// è®¡ç®—è®¾å¤‡æˆæœ¬
APIè°ƒç”¨: GET /api/mobile/processing/equipment-usage?batchId=batch_123
è¿”å›æ•°æ®: {
  totalUsageMinutes: 360,  // è®¾å¤‡æ€»ä½¿ç”¨æ—¶é•¿
  equipmentList: [
    { equipmentId, usageMinutes, deprecationRate }
  ]
}
è®¡ç®—å…¬å¼: equipmentCost = Î£(usageMinutes * deprecationRate / 60)
```

**é›†æˆç‚¹3: è®¾å¤‡å¼‚å¸¸å½±å“æ‰¹æ¬¡çŠ¶æ€**
```typescript
// è®¾å¤‡å‘Šè­¦è§¦å‘æ‰¹æ¬¡æš‚åœ
äº‹ä»¶: device_critical_alert
è§¦å‘æ¡ä»¶: è®¾å¤‡æ•…éšœã€å‚æ•°è¶…æ ‡ä¸¥é‡
åŠ¨ä½œ: è‡ªåŠ¨æš‚åœå…³è”æ‰¹æ¬¡ (status â†’ paused)
é€šçŸ¥: æ¨é€é€šçŸ¥ç»™æ‰¹æ¬¡è´Ÿè´£äººå’Œç”Ÿäº§ä¸»ç®¡
```

#### 2.3.3 ä¸ä»“å‚¨æ¨¡å—çš„é›†æˆ (æœªæ¥è§„åˆ’)

**é›†æˆç‚¹1: æ‰¹æ¬¡åˆ›å»ºæ—¶åŸæ–™å‡ºåº“**
```typescript
// åŸæ–™å‡ºåº“å•
APIè°ƒç”¨: POST /api/warehouse/outbound
è¯·æ±‚æ•°æ®: {
  batchId: 'batch_123',
  materials: [
    { materialId, quantity, unit }
  ],
  purpose: 'production'
}
æ•ˆæœ:
  - ä»“åº“åº“å­˜å‡å°‘
  - æ‰¹æ¬¡å…³è”åŸæ–™æ‰¹æ¬¡å·(ç”¨äºè¿½æº¯)
```

**é›†æˆç‚¹2: æ‰¹æ¬¡å®Œæˆæ—¶æˆå“å…¥åº“**
```typescript
// æˆå“å…¥åº“å•
APIè°ƒç”¨: POST /api/warehouse/inbound
è¯·æ±‚æ•°æ®: {
  batchId: 'batch_123',
  productType: 'é€Ÿå†»é±¼æ’',
  quantity: 500,  // actualQuantity
  qualityGrade: 'A',
  expiryDate: '2025-07-05'
}
æ•ˆæœ:
  - æˆå“åº“åº“å­˜å¢åŠ 
  - ç”Ÿæˆè¿½æº¯ç (batch_123å…³è”)
```

#### 2.3.4 ä¸é”€å”®æ¨¡å—çš„é›†æˆ (æœªæ¥è§„åˆ’)

**é›†æˆç‚¹1: é”€å”®å‡ºåº“å…³è”æ‰¹æ¬¡**
```typescript
// æˆå“å‡ºåº“æ—¶ç”Ÿæˆè¿½æº¯ç 
APIè°ƒç”¨: POST /api/sales/outbound
è¯·æ±‚æ•°æ®: {
  productId: 'PROD001',
  quantity: 100,
  batchId: 'batch_123'  // æ‰¹æ¬¡è¿½æº¯
}
æ•ˆæœ:
  - ç”Ÿæˆè¿½æº¯äºŒç»´ç 
  - æ‰«ç å¯æŸ¥è¯¢æ‰¹æ¬¡ä¿¡æ¯(åŸæ–™ã€ç”Ÿäº§æ—¥æœŸã€è´¨æ£€æŠ¥å‘Š)
```

**é›†æˆç‚¹2: æˆæœ¬æ•°æ®ç”¨äºå®šä»·**
```typescript
// è¯»å–æ‰¹æ¬¡æˆæœ¬ç”¨äºäº§å“å®šä»·
APIè°ƒç”¨: GET /api/mobile/processing/batches/:id/cost-analysis
è¿”å›æ•°æ®: {
  costPerKg: 12.50,  // å•ä½æˆæœ¬
  suggestedPrice: costPerKg * (1 + profitMargin)  // å»ºè®®å”®ä»·
}
```

#### 2.3.5 ä¸è´¢åŠ¡æ¨¡å—çš„é›†æˆ (æœªæ¥è§„åˆ’)

**é›†æˆç‚¹1: æ‰¹æ¬¡æˆæœ¬æ•°æ®åŒæ­¥**
```typescript
// æ‰¹æ¬¡å®Œæˆåæˆæœ¬æ•°æ®åŒæ­¥åˆ°è´¢åŠ¡
äº‹ä»¶: batch_completed
æ•°æ®åŒæ­¥:
  - åŸæ–™æˆæœ¬ â†’ æˆæœ¬ä¼šè®¡ç§‘ç›®
  - äººå·¥æˆæœ¬ â†’ è–ªèµ„æˆæœ¬
  - è®¾å¤‡æˆæœ¬ â†’ æŠ˜æ—§æ‘Šé”€
ç”¨é€”: è´¢åŠ¡æŠ¥è¡¨ã€æˆæœ¬æ ¸ç®—
```

**é›†æˆç‚¹2: åˆ©æ¶¦åˆ†æ**
```typescript
// è´¢åŠ¡æ¨¡å—è¯»å–ç”Ÿäº§æ•°æ®è¿›è¡Œåˆ©æ¶¦åˆ†æ
APIè°ƒç”¨: GET /api/mobile/processing/batches?status=completed&startDate=2025-01-01
è¿”å›æ•°æ®: [
  { batchId, totalCost, totalRevenue, profitMargin }
]
ç”¨é€”: ç®¡ç†ä¼šè®¡æŠ¥è¡¨
```

### 2.4 å…³é”®ä¸šåŠ¡è§„åˆ™

#### è§„åˆ™1: æ‰¹æ¬¡åˆ›å»ºè§„åˆ™
- **è§„åˆ™**: åŒä¸€ç”Ÿäº§çº¿åŒä¸€æ—¶é—´åªèƒ½æœ‰ä¸€ä¸ªæ‰¹æ¬¡åœ¨è¿›è¡Œ
- **éªŒè¯**: åˆ›å»ºæ‰¹æ¬¡æ—¶æ£€æŸ¥ç”Ÿäº§çº¿æ˜¯å¦è¢«å ç”¨
- **å®ç°**:
```sql
SELECT COUNT(*) FROM processing_batches
WHERE production_line = 'ç”Ÿäº§çº¿A'
  AND status IN ('in_progress', 'paused')
  AND factory_id = 'FAC001'
```

#### è§„åˆ™2: è´¨æ£€å¿…é¡»è§„åˆ™
- **è§„åˆ™**: æˆå“è´¨æ£€å¿…é¡»é€šè¿‡æ‰èƒ½å®Œæˆæ‰¹æ¬¡
- **éªŒè¯**: æ‰¹æ¬¡çŠ¶æ€ä»quality_check â†’ completedæ—¶,å¿…é¡»æœ‰è´¨æ£€è®°å½•ä¸”ç»“æœä¸ºpass
- **å¼‚å¸¸å¤„ç†**: è´¨æ£€ä¸é€šè¿‡æ—¶æ‰¹æ¬¡çŠ¶æ€å˜æ›´ä¸ºfailed

#### è§„åˆ™3: æˆæœ¬è®¡ç®—æ—¶æœº
- **è‡ªåŠ¨è®¡ç®—æ—¶æœº**:
  1. æ‰¹æ¬¡çŠ¶æ€å˜æ›´ä¸ºcompletedæ—¶
  2. æ‰‹åŠ¨è°ƒç”¨recalculate-cost APIæ—¶
- **æˆæœ¬æ„æˆ**:
  - åŸæ–™æˆæœ¬: æ‰‹åŠ¨è¾“å…¥(æ¥è‡ªé‡‡è´­æ•°æ®)
  - äººå·¥æˆæœ¬: è‡ªåŠ¨è®¡ç®—(å·¥æ—¶ Ã— æ—¶è–ª)
  - è®¾å¤‡æˆæœ¬: è‡ªåŠ¨è®¡ç®—(ä½¿ç”¨æ—¶é•¿ Ã— æŠ˜æ—§ç‡)
- **æˆæœ¬å®¡æ ¸**:
  - factory_super_adminå¯ä»¥è°ƒæ•´æˆæœ¬æ•°æ®
  - è°ƒæ•´éœ€è¦è®°å½•å®¡è®¡æ—¥å¿—

#### è§„åˆ™4: æ•°æ®æƒé™è§„åˆ™
- **operator (æ“ä½œå‘˜)**:
  - åªèƒ½æŸ¥çœ‹è‡ªå·±å‚ä¸çš„æ‰¹æ¬¡
  - åªèƒ½å½•å…¥è‡ªå·±çš„å·¥ä½œè®°å½•
- **department_admin (éƒ¨é—¨ç®¡ç†å‘˜)**:
  - å¯ä»¥æŸ¥çœ‹æœ¬éƒ¨é—¨æ‰€æœ‰æ‰¹æ¬¡
  - å¯ä»¥åˆ›å»ºã€ç¼–è¾‘ã€åˆ é™¤æ‰¹æ¬¡
- **factory_super_admin (å·¥å‚è¶…ç®¡)**:
  - å¯ä»¥æŸ¥çœ‹æœ¬å·¥å‚æ‰€æœ‰æ‰¹æ¬¡
  - å¯ä»¥æ‰§è¡Œæ‰€æœ‰æ“ä½œ

#### è§„åˆ™5: ç¦»çº¿æ•°æ®åŒæ­¥è§„åˆ™
- **ç¦»çº¿å¯æ“ä½œ**: å‘˜å·¥æ‰“å¡ã€è´¨æ£€è®°å½•åˆ›å»º
- **ç¦»çº¿ä¸å¯æ“ä½œ**: æ‰¹æ¬¡çŠ¶æ€å˜æ›´ã€æˆæœ¬è®¡ç®—
- **åŒæ­¥ç­–ç•¥**:
  - ç½‘ç»œæ¢å¤æ—¶è‡ªåŠ¨åŒæ­¥
  - å†²çªæ£€æµ‹: æ—¶é—´æˆ³åˆ¤æ–­,åæäº¤çš„è¦†ç›–
  - å¤±è´¥é‡è¯•: æœ€å¤šé‡è¯•3æ¬¡

---

## åŠŸèƒ½æ¨¡å—è¯¦ç»†è®¾è®¡

### 3.1 æ‰¹æ¬¡ç®¡ç†æ¨¡å— (Batch Management)

#### 3.1.1 åŠŸèƒ½æ¦‚è¿°

æ‰¹æ¬¡ç®¡ç†æ˜¯ç”Ÿäº§æ¨¡å—çš„æ ¸å¿ƒ,è´Ÿè´£ç®¡ç†ç”Ÿäº§æ‰¹æ¬¡çš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸã€‚

**ç°æœ‰åŠŸèƒ½**:
- âœ… åç«¯API: 8ä¸ªAPIå…¨éƒ¨å®Œæˆ
- âœ… æ•°æ®åº“è¡¨: processing_batchesè¡¨å®Œå–„
- âŒ å‰ç«¯UI: ä»…1/5é¡µé¢å®Œæˆ(MaterialReceiptScreen)

**ç¼ºå¤±é¡µé¢**:
- âŒ BatchListScreen - æ‰¹æ¬¡åˆ—è¡¨é¡µ
- âŒ BatchDetailScreen - æ‰¹æ¬¡è¯¦æƒ…é¡µ
- âŒ BatchCreateScreen - åˆ›å»ºæ‰¹æ¬¡é¡µ
- âŒ BatchEditScreen - ç¼–è¾‘æ‰¹æ¬¡é¡µ
- âŒ BatchTimelineScreen - æ‰¹æ¬¡æ—¶é—´çº¿é¡µ

#### 3.1.2 æ•°æ®æ¨¡å‹

```typescript
interface ProcessingBatch {
  // åŸºæœ¬ä¿¡æ¯
  id: string;                    // æ‰¹æ¬¡ID (UUID)
  factoryId: string;             // å·¥å‚ID
  batchNumber: string;           // æ‰¹æ¬¡å· (è‡ªåŠ¨ç”Ÿæˆ,æ ¼å¼: FAC001-20250105-001)
  productType: string;           // äº§å“ç±»å‹ (å¦‚: é€Ÿå†»é±¼æ’ã€é±¼ä¸¸ç­‰)
  productCategory: ProductCategory; // äº§å“åˆ†ç±»

  // åŸææ–™ä¿¡æ¯
  rawMaterials: RawMaterial[];   // åŸææ–™åˆ—è¡¨ (JSON)
  rawMaterialCost: number;       // åŸæ–™æ€»æˆæœ¬
  rawMaterialWeight: number;     // åŸæ–™æ€»é‡é‡(kg)
  rawMaterialCategory: string;   // åŸæ–™åˆ†ç±»

  // ç”Ÿäº§ä¿¡æ¯
  startDate: Date;               // å¼€å§‹æ—¥æœŸ
  endDate?: Date;                // ç»“æŸæ—¥æœŸ
  status: BatchStatus;           // æ‰¹æ¬¡çŠ¶æ€
  productionLine: string;        // ç”Ÿäº§çº¿
  supervisorId: number;          // è´Ÿè´£äººID
  supervisor?: User;             // è´Ÿè´£äººä¿¡æ¯(å…³è”æŸ¥è¯¢)

  // äº§é‡ä¿¡æ¯
  targetQuantity: number;        // ç›®æ ‡äº§é‡(kg)
  actualQuantity: number;        // å®é™…äº§é‡(kg)
  qualityGrade: QualityGrade;    // è´¨é‡ç­‰çº§ (A/B/C/D)

  // æˆæœ¬ä¿¡æ¯
  laborCost: number;             // äººå·¥æˆæœ¬
  equipmentCost: number;         // è®¾å¤‡æˆæœ¬
  totalCost: number;             // æ€»æˆæœ¬
  profitMargin: number;          // åˆ©æ¶¦é¢
  profitRate: number;            // åˆ©æ¶¦ç‡(%)
  expectedPrice: number;         // é¢„æœŸå”®ä»·

  // å…¶ä»–
  notes: string;                 // å¤‡æ³¨
  createdAt: Date;               // åˆ›å»ºæ—¶é—´
  updatedAt: Date;               // æ›´æ–°æ—¶é—´

  // å…³è”æ•°æ®
  qualityInspections?: QualityInspection[];  // è´¨æ£€è®°å½•
  workSessions?: EmployeeWorkSession[];      // å·¥ä½œæ—¶æ®µ
  equipmentUsage?: EquipmentUsage[];         // è®¾å¤‡ä½¿ç”¨è®°å½•
}

type BatchStatus =
  | 'planning'       // è®¡åˆ’ä¸­
  | 'in_progress'    // è¿›è¡Œä¸­
  | 'paused'         // å·²æš‚åœ
  | 'quality_check'  // è´¨æ£€ä¸­
  | 'completed'      // å·²å®Œæˆ
  | 'failed'         // å·²å¤±è´¥
  | 'cancelled';     // å·²å–æ¶ˆ

type ProductCategory =
  | 'frozen_fish'    // é€Ÿå†»é±¼ç±»
  | 'fish_balls'     // é±¼ä¸¸ç±»
  | 'surimi'         // é±¼ç³œç±»
  | 'dried_fish'     // é±¼å¹²ç±»
  | 'other';         // å…¶ä»–

type QualityGrade = 'A' | 'B' | 'C' | 'D';

interface RawMaterial {
  materialId: string;     // åŸæ–™ID
  materialName: string;   // åŸæ–™åç§°
  quantity: number;       // æ•°é‡
  unit: string;          // å•ä½ (kg, tonç­‰)
  cost: number;          // æˆæœ¬
  supplier?: string;     // ä¾›åº”å•†
  batchNumber?: string;  // åŸæ–™æ‰¹æ¬¡å·(è¿½æº¯ç”¨)
}
```

#### 3.1.3 APIæ¥å£æ¸…å•

| APIç«¯ç‚¹ | æ–¹æ³• | åŠŸèƒ½ | æƒé™ | çŠ¶æ€ |
|--------|------|------|------|------|
| `/api/mobile/processing/batches` | POST | åˆ›å»ºæ‰¹æ¬¡ | department_admin+ | âœ… |
| `/api/mobile/processing/batches` | GET | æ‰¹æ¬¡åˆ—è¡¨(åˆ†é¡µã€ç­›é€‰) | operator+ | âœ… |
| `/api/mobile/processing/batches/:id` | GET | æ‰¹æ¬¡è¯¦æƒ… | operator+ | âœ… |
| `/api/mobile/processing/batches/:id` | PUT | æ›´æ–°æ‰¹æ¬¡ | department_admin+ | âœ… |
| `/api/mobile/processing/batches/:id` | DELETE | åˆ é™¤æ‰¹æ¬¡(ä»…planning) | department_admin+ | âœ… |
| `/api/mobile/processing/batches/:id/start` | POST | å¼€å§‹ç”Ÿäº§ | department_admin+ | âœ… |
| `/api/mobile/processing/batches/:id/complete` | POST | å®Œæˆç”Ÿäº§ | department_admin+ | âœ… |
| `/api/mobile/processing/batches/:id/pause` | POST | æš‚åœç”Ÿäº§ | department_admin+ | âœ… |
| `/api/mobile/processing/batches/:id/resume` | POST | æ¢å¤ç”Ÿäº§ | department_admin+ | âŒ å¾…å¼€å‘ |
| `/api/mobile/processing/batches/:id/timeline` | GET | æ‰¹æ¬¡æ—¶é—´çº¿ | operator+ | âœ… |

**APIä½¿ç”¨ç¤ºä¾‹**:

```typescript
// åˆ›å»ºæ‰¹æ¬¡
POST /api/mobile/processing/batches
{
  "productType": "é€Ÿå†»é±¼æ’",
  "productCategory": "frozen_fish",
  "rawMaterials": [
    {
      "materialName": "é²ˆé±¼",
      "quantity": 500,
      "unit": "kg",
      "cost": 15000,
      "supplier": "æµ·æ´‹æ¸”ä¸šå…¬å¸"
    }
  ],
  "targetQuantity": 400,
  "productionLine": "ç”Ÿäº§çº¿A",
  "supervisorId": 5,
  "startDate": "2025-01-06",
  "notes": "æ˜¥èŠ‚è®¢å•"
}

// æ‰¹æ¬¡åˆ—è¡¨æŸ¥è¯¢
GET /api/mobile/processing/batches?page=1&limit=20&status=in_progress&startDate=2025-01-01&endDate=2025-01-31

// æ‰¹æ¬¡çŠ¶æ€å˜æ›´
POST /api/mobile/processing/batches/batch_123/start
{} // æ— éœ€body
```

#### 3.1.4 æ‰¹æ¬¡ç¼–å·ç”Ÿæˆè§„åˆ™

```javascript
// æ‰¹æ¬¡å·æ ¼å¼: {å·¥å‚ä»£ç }-{æ—¥æœŸYYYYMMDD}-{å½“æ—¥åºå·}
// ç¤ºä¾‹: FAC001-20250105-001

async function generateBatchNumber(factoryId, productType) {
  const today = new Date().toISOString().slice(0, 10).replace(/-/g, '');

  // æŸ¥è¯¢ä»Šæ—¥å·²æœ‰æ‰¹æ¬¡æ•°
  const count = await prisma.processingBatch.count({
    where: {
      factoryId,
      batchNumber: {
        startsWith: `${factoryId}-${today}-`
      }
    }
  });

  const sequence = String(count + 1).padStart(3, '0');
  return `${factoryId}-${today}-${sequence}`;
}

// ç¤ºä¾‹:
// FAC001-20250105-001  (2025å¹´1æœˆ5æ—¥FAC001å·¥å‚çš„ç¬¬1ä¸ªæ‰¹æ¬¡)
// FAC001-20250105-002  (2025å¹´1æœˆ5æ—¥FAC001å·¥å‚çš„ç¬¬2ä¸ªæ‰¹æ¬¡)
```

#### 3.1.5 ä¼˜åŒ–æ–¹å‘

1. **æ‰¹æ¬¡æ¨¡æ¿åŠŸèƒ½** (ä¼˜å…ˆçº§: P1)
   - ä¿å­˜å¸¸ç”¨æ‰¹æ¬¡é…ç½®ä¸ºæ¨¡æ¿
   - å¿«é€Ÿåˆ›å»ºæ‰¹æ¬¡(é€‰æ‹©æ¨¡æ¿+è°ƒæ•´å‚æ•°)
   - å‡å°‘é‡å¤è¾“å…¥

2. **æ‰¹æ¬¡å¤åˆ¶åŠŸèƒ½** (ä¼˜å…ˆçº§: P2)
   - å¤åˆ¶ç°æœ‰æ‰¹æ¬¡åˆ›å»ºæ–°æ‰¹æ¬¡
   - è‡ªåŠ¨ç”Ÿæˆæ–°æ‰¹æ¬¡å·
   - ä¿ç•™åŸæ‰¹æ¬¡çš„é…ç½®å‚æ•°

3. **æ‰¹æ¬¡é¢„æµ‹åŠŸèƒ½** (ä¼˜å…ˆçº§: P2)
   - åŸºäºå†å²æ•°æ®é¢„æµ‹äº§é‡
   - åŸºäºå†å²æ•°æ®é¢„æµ‹æˆæœ¬
   - AIæ¨èæœ€ä¼˜ç”Ÿäº§å‚æ•°

---

### 3.2 è´¨é‡æ£€éªŒæ¨¡å— (Quality Inspection)

#### 3.2.1 åŠŸèƒ½æ¦‚è¿°

è´¨é‡æ£€éªŒæ¨¡å—è´Ÿè´£ç®¡ç†ç”Ÿäº§è¿‡ç¨‹ä¸­çš„è´¨é‡æ§åˆ¶,æ”¯æŒä¸‰é˜¶æ®µè´¨æ£€ã€‚

**ç°æœ‰åŠŸèƒ½**:
- âœ… åç«¯API: 6ä¸ªAPIå…¨éƒ¨å®Œæˆ
- âœ… æ•°æ®åº“è¡¨: quality_inspectionsè¡¨å®Œå–„
- âŒ å‰ç«¯UI: 0/4é¡µé¢å®Œæˆ

**ç¼ºå¤±é¡µé¢**:
- âŒ QualityInspectionListScreen - è´¨æ£€åˆ—è¡¨é¡µ
- âŒ QualityInspectionCreateScreen - åˆ›å»ºè´¨æ£€é¡µ
- âŒ QualityInspectionDetailScreen - è´¨æ£€è¯¦æƒ…é¡µ
- âŒ QualityStatisticsScreen - è´¨æ£€ç»Ÿè®¡é¡µ

#### 3.2.2 ä¸‰é˜¶æ®µè´¨æ£€æµç¨‹

```
é˜¶æ®µ1: åŸæ–™è´¨æ£€ (Raw Material Inspection)
  æ—¶æœº: åŸæ–™æ¥æ”¶æ—¶
  æ£€æµ‹é¡¹:
    - æ„Ÿå®˜æ£€æŸ¥(å¤–è§‚ã€æ°”å‘³ã€è‰²æ³½)
    - æ¸©åº¦æ£€æµ‹
    - å¾®ç”Ÿç‰©æ£€æµ‹(éƒ¨åˆ†æ‰¹æ¬¡æŠ½æ£€)
  åˆ¤å®šæ ‡å‡†:
    - pass: å…è®¸å…¥åº“
    - fail: æ‹’æ”¶é€€è´§
    - conditional_pass: é™çº§ä½¿ç”¨

é˜¶æ®µ2: è¿‡ç¨‹è´¨æ£€ (Process Inspection)
  æ—¶æœº: ç”Ÿäº§è¿‡ç¨‹ä¸­(å»ºè®®2-4å°æ—¶/æ¬¡)
  æ£€æµ‹é¡¹:
    - åŠ å·¥æ¸©åº¦
    - pHå€¼
    - æ°´åˆ†å«é‡
    - åŠ å·¥æ—¶é—´
  åˆ¤å®šæ ‡å‡†:
    - pass: ç»§ç»­ç”Ÿäº§
    - fail: åœæ­¢ç”Ÿäº§,æŸ¥æ‰¾åŸå› 

é˜¶æ®µ3: æˆå“è´¨æ£€ (Final Product Inspection)
  æ—¶æœº: æ‰¹æ¬¡å®Œæˆå
  æ£€æµ‹é¡¹:
    - æ„Ÿå®˜æ£€æŸ¥
    - ç†åŒ–æŒ‡æ ‡(æ°´åˆ†ã€è›‹ç™½è´¨ã€è„‚è‚ªç­‰)
    - å¾®ç”Ÿç‰©æ£€æµ‹(å¿…æ£€)
    - é‡é‡æ£€æµ‹
    - åŒ…è£…æ£€æŸ¥
  åˆ¤å®šæ ‡å‡†:
    - pass: æ‰¹æ¬¡completed,å…è®¸å‡ºåº“
    - fail: æ‰¹æ¬¡failed,æŠ¥åºŸæˆ–é™çº§å¤„ç†
    - conditional_pass: é™çº§å¤„ç†(Açº§â†’Bçº§)
```

#### 3.2.3 æ•°æ®æ¨¡å‹

```typescript
interface QualityInspection {
  // åŸºæœ¬ä¿¡æ¯
  id: string;                      // è´¨æ£€ID
  factoryId: string;               // å·¥å‚ID
  batchId: string;                 // å…³è”æ‰¹æ¬¡ID
  batch?: ProcessingBatch;         // æ‰¹æ¬¡ä¿¡æ¯(å…³è”æŸ¥è¯¢)

  // è´¨æ£€ç±»å‹
  inspectionType: InspectionType;  // è´¨æ£€ç±»å‹
  inspectionDate: Date;            // è´¨æ£€æ—¥æœŸ
  inspectorId: number;             // è´¨æ£€å‘˜ID
  inspector?: User;                // è´¨æ£€å‘˜ä¿¡æ¯

  // æ£€æµ‹é¡¹ç›®
  testItems: TestItem[];           // æ£€æµ‹é¡¹ç›®åˆ—è¡¨ (JSON)

  // æ£€æµ‹ç»“æœ
  overallResult: InspectionResult; // æ€»ä½“ç»“æœ
  qualityScore: number;            // è´¨é‡è¯„åˆ† (0-100)
  defectDetails: string;           // ç¼ºé™·è¯¦æƒ…
  defectTypes: string[];           // ç¼ºé™·ç±»å‹åˆ—è¡¨

  // çº æ­£æªæ–½
  correctiveActions: string;       // çº æ­£æªæ–½
  followUpRequired: boolean;       // æ˜¯å¦éœ€è¦è·Ÿè¿›
  followUpDate?: Date;             // è·Ÿè¿›æ—¥æœŸ

  // ç…§ç‰‡è¯æ®
  photos: string[];                // ç…§ç‰‡URLåˆ—è¡¨

  // å…¶ä»–
  notes: string;                   // å¤‡æ³¨
  createdAt: Date;                 // åˆ›å»ºæ—¶é—´
}

type InspectionType =
  | 'raw_material'    // åŸæ–™è´¨æ£€
  | 'process'         // è¿‡ç¨‹è´¨æ£€
  | 'final_product';  // æˆå“è´¨æ£€

type InspectionResult =
  | 'pass'            // åˆæ ¼
  | 'fail'            // ä¸åˆæ ¼
  | 'conditional_pass'; // æ¡ä»¶åˆæ ¼

interface TestItem {
  itemName: string;       // æ£€æµ‹é¡¹åç§°
  standard: string;       // æ ‡å‡†å€¼/èŒƒå›´
  actualValue: string;    // å®é™…å€¼
  result: 'pass' | 'fail'; // å•é¡¹ç»“æœ
  unit?: string;          // å•ä½
}

// å¸¸è§æ£€æµ‹é¡¹é…ç½®
const COMMON_TEST_ITEMS = {
  raw_material: [
    { itemName: 'å¤–è§‚', standard: 'æ–°é²œã€æ— è…è´¥', type: 'text' },
    { itemName: 'æ°”å‘³', standard: 'æ— å¼‚å‘³', type: 'text' },
    { itemName: 'æ¸©åº¦', standard: 'â‰¤4Â°C', unit: 'Â°C', type: 'number' },
  ],
  process: [
    { itemName: 'åŠ å·¥æ¸©åº¦', standard: '85-95Â°C', unit: 'Â°C', type: 'number' },
    { itemName: 'pHå€¼', standard: '6.5-7.5', unit: 'pH', type: 'number' },
    { itemName: 'æ°´åˆ†', standard: 'â‰¤75%', unit: '%', type: 'number' },
  ],
  final_product: [
    { itemName: 'æ„Ÿå®˜', standard: 'è‰²æ³½æ­£å¸¸ã€æ— å¼‚å‘³', type: 'text' },
    { itemName: 'è›‹ç™½è´¨', standard: 'â‰¥15%', unit: '%', type: 'number' },
    { itemName: 'è„‚è‚ª', standard: 'â‰¤5%', unit: '%', type: 'number' },
    { itemName: 'å¤§è‚ èŒç¾¤', standard: 'â‰¤100CFU/g', unit: 'CFU/g', type: 'number' },
  ]
};
```

#### 3.2.4 APIæ¥å£æ¸…å•

| APIç«¯ç‚¹ | æ–¹æ³• | åŠŸèƒ½ | æƒé™ | çŠ¶æ€ |
|--------|------|------|------|------|
| `/api/mobile/processing/quality/inspections` | POST | åˆ›å»ºè´¨æ£€è®°å½• | operator+ | âœ… |
| `/api/mobile/processing/quality/inspections` | GET | è´¨æ£€åˆ—è¡¨(åˆ†é¡µã€ç­›é€‰) | operator+ | âœ… |
| `/api/mobile/processing/quality/inspections/:id` | GET | è´¨æ£€è¯¦æƒ… | operator+ | âœ… |
| `/api/mobile/processing/quality/inspections/:id` | PUT | æ›´æ–°è´¨æ£€è®°å½• | department_admin+ | âœ… |
| `/api/mobile/processing/quality/statistics` | GET | è´¨æ£€ç»Ÿè®¡æ•°æ® | operator+ | âœ… |
| `/api/mobile/processing/quality/trends` | GET | è´¨é‡è¶‹åŠ¿åˆ†æ | department_admin+ | âœ… |

#### 3.2.5 è´¨æ£€åˆ¤å®šé€»è¾‘

```javascript
// è´¨æ£€ç»“æœè‡ªåŠ¨åˆ¤å®šé€»è¾‘
function determineInspectionResult(testItems) {
  const failedItems = testItems.filter(item => item.result === 'fail');

  // è§„åˆ™1: æ— ä¸åˆæ ¼é¡¹ â†’ åˆæ ¼
  if (failedItems.length === 0) {
    return {
      overallResult: 'pass',
      qualityScore: 100
    };
  }

  // è§„åˆ™2: æœ‰ä¸¥é‡ä¸åˆæ ¼é¡¹ â†’ ä¸åˆæ ¼
  const criticalItems = ['å¤§è‚ èŒç¾¤', 'æ²™é—¨æ°èŒ', 'é‡é‡‘å±'];
  const hasCriticalFailure = failedItems.some(item =>
    criticalItems.includes(item.itemName)
  );

  if (hasCriticalFailure) {
    return {
      overallResult: 'fail',
      qualityScore: calculateScore(testItems)
    };
  }

  // è§„åˆ™3: è½»å¾®ä¸åˆæ ¼é¡¹ â†’ æ¡ä»¶åˆæ ¼
  if (failedItems.length <= 2) {
    return {
      overallResult: 'conditional_pass',
      qualityScore: calculateScore(testItems)
    };
  }

  // è§„åˆ™4: å¤šé¡¹ä¸åˆæ ¼ â†’ ä¸åˆæ ¼
  return {
    overallResult: 'fail',
    qualityScore: calculateScore(testItems)
  };
}

function calculateScore(testItems) {
  const totalItems = testItems.length;
  const passedItems = testItems.filter(item => item.result === 'pass').length;
  return Math.round((passedItems / totalItems) * 100);
}
```

#### 3.2.6 ä¼˜åŒ–æ–¹å‘

1. **è´¨æ£€æ¨¡æ¿åŠŸèƒ½** (ä¼˜å…ˆçº§: P1)
   - æŒ‰äº§å“ç±»å‹é¢„è®¾æ£€æµ‹é¡¹
   - å¿«é€Ÿåˆ›å»ºè´¨æ£€è®°å½•

2. **ç…§ç‰‡AIè¯†åˆ«** (ä¼˜å…ˆçº§: P3)
   - ä¸Šä¼ ç…§ç‰‡è‡ªåŠ¨è¯†åˆ«ç¼ºé™·
   - AIè¾…åŠ©åˆ¤å®šè´¨æ£€ç»“æœ

3. **è´¨æ£€æé†’åŠŸèƒ½** (ä¼˜å…ˆçº§: P2)
   - è¿‡ç¨‹è´¨æ£€åˆ°æœŸæé†’
   - è´¨æ£€ä¸åˆæ ¼è‡ªåŠ¨é€šçŸ¥ä¸»ç®¡

---

### 3.3 å‘˜å·¥å·¥ä½œç®¡ç†æ¨¡å— (Employee Work Management)

#### 3.3.1 åŠŸèƒ½æ¦‚è¿°

å‘˜å·¥å·¥ä½œç®¡ç†æ¨¡å—è´Ÿè´£å‘˜å·¥æ‰“å¡ã€å·¥æ—¶ç»Ÿè®¡å’Œå·¥ä½œè®°å½•ç®¡ç†ã€‚

**ç°æœ‰åŠŸèƒ½**:
- âœ… åç«¯API: 7ä¸ªAPIå…¨éƒ¨å®Œæˆ
- âœ… æ•°æ®åº“è¡¨: employee_time_clocks, employee_work_sessionsè¡¨å®Œå–„
- âœ… å‰ç«¯UI: 2/3é¡µé¢å®Œæˆ (TimeClockScreen, ClockHistoryScreen)

**ç¼ºå¤±é¡µé¢**:
- âŒ WorkRecordScreen - å·¥ä½œè®°å½•é¡µ

#### 3.3.2 æ‰“å¡æµç¨‹

```
ä¸Šç­æ‰“å¡æµç¨‹:
  1. å‘˜å·¥æ‰“å¼€App â†’ TimeClockScreen
  2. ç‚¹å‡»"ä¸Šç­æ‰“å¡"æŒ‰é’®
  3. ç³»ç»Ÿè·å–GPSä½ç½®
  4. éªŒè¯ä½ç½®æ˜¯å¦åœ¨å·¥å‚èŒƒå›´å†…(geofencing)
  5. æ‹æ‘„æ‰“å¡ç…§ç‰‡(å¯é€‰)
  6. é€‰æ‹©å·¥ä½œç±»å‹(ç”Ÿäº§ã€è´¨æ£€ã€è®¾å¤‡ç»´æŠ¤ç­‰)
  7. é€‰æ‹©å…³è”æ‰¹æ¬¡(å¦‚æœå·¥ä½œç±»å‹æ˜¯ç”Ÿäº§)
  8. æäº¤æ‰“å¡
  9. åç«¯åˆ›å»ºtime_clockè®°å½•å’Œwork_sessionè®°å½•
  10. è¿”å›æ‰“å¡æˆåŠŸä¿¡æ¯

ä¸‹ç­æ‰“å¡æµç¨‹:
  1. å‘˜å·¥æ‰“å¼€App â†’ TimeClockScreen
  2. ç‚¹å‡»"ä¸‹ç­æ‰“å¡"æŒ‰é’®
  3. ç³»ç»Ÿè·å–GPSä½ç½®
  4. æ‹æ‘„æ‰“å¡ç…§ç‰‡(å¯é€‰)
  5. å¡«å†™å·¥ä½œæ€»ç»“(å¯é€‰)
  6. æäº¤æ‰“å¡
  7. åç«¯æ›´æ–°work_sessionè®°å½•(ç»“æŸæ—¶é—´ã€å·¥æ—¶)
  8. è®¡ç®—å·¥æ—¶å’ŒåŠ ç­æ—¶é—´
  9. è¿”å›æ‰“å¡æˆåŠŸä¿¡æ¯

å·¥æ—¶è®¡ç®—è§„åˆ™:
  - æ­£å¸¸å·¥æ—¶: 8å°æ—¶/å¤©
  - åŠ ç­å·¥æ—¶: è¶…è¿‡8å°æ—¶çš„éƒ¨åˆ†
  - è¿Ÿåˆ°: 9:00åæ‰“å¡
  - æ—©é€€: 17:00å‰æ‰“å¡
  - å·¥æ—¶è®¡ç®—: (ä¸‹ç­æ—¶é—´ - ä¸Šç­æ—¶é—´) / 60 åˆ†é’Ÿ
```

#### 3.3.3 æ•°æ®æ¨¡å‹

```typescript
interface EmployeeTimeClock {
  id: string;               // æ‰“å¡ID
  factoryId: string;        // å·¥å‚ID
  userId: number;           // å‘˜å·¥ID
  user?: User;              // å‘˜å·¥ä¿¡æ¯

  clockType: ClockType;     // æ‰“å¡ç±»å‹
  clockTime: Date;          // æ‰“å¡æ—¶é—´
  location: GeoLocation;    // GPSä½ç½® (JSON)
  photo?: string;           // æ‰“å¡ç…§ç‰‡URL

  workType: WorkType;       // å·¥ä½œç±»å‹
  relatedBatchId?: string;  // å…³è”æ‰¹æ¬¡ID (å·¥ä½œç±»å‹ä¸ºproductionæ—¶)

  status: ClockStatus;      // æ‰“å¡çŠ¶æ€
  notes?: string;           // å¤‡æ³¨
  createdAt: Date;          // åˆ›å»ºæ—¶é—´
}

type ClockType = 'in' | 'out';  // ä¸Šç­ | ä¸‹ç­

type WorkType =
  | 'production'           // ç”Ÿäº§
  | 'quality_inspection'   // è´¨æ£€
  | 'equipment_maintenance' // è®¾å¤‡ç»´æŠ¤
  | 'material_handling'    // ç‰©æ–™æ¬è¿
  | 'cleaning'             // æ¸…æ´å«ç”Ÿ
  | 'training'             // åŸ¹è®­
  | 'other';               // å…¶ä»–

type ClockStatus =
  | 'normal'       // æ­£å¸¸
  | 'late'         // è¿Ÿåˆ°
  | 'early_leave'  // æ—©é€€
  | 'overtime'     // åŠ ç­
  | 'forgot';      // è¡¥å¡

interface GeoLocation {
  latitude: number;   // çº¬åº¦
  longitude: number;  // ç»åº¦
  accuracy: number;   // ç²¾åº¦(ç±³)
  address?: string;   // åœ°å€
}

interface EmployeeWorkSession {
  id: string;               // å·¥ä½œæ—¶æ®µID
  factoryId: string;        // å·¥å‚ID
  userId: number;           // å‘˜å·¥ID
  user?: User;              // å‘˜å·¥ä¿¡æ¯

  clockInId: string;        // ä¸Šç­æ‰“å¡ID
  clockOutId?: string;      // ä¸‹ç­æ‰“å¡ID

  workType: WorkType;       // å·¥ä½œç±»å‹
  relatedBatchId?: string;  // å…³è”æ‰¹æ¬¡ID
  batch?: ProcessingBatch;  // æ‰¹æ¬¡ä¿¡æ¯

  startTime: Date;          // å¼€å§‹æ—¶é—´
  endTime?: Date;           // ç»“æŸæ—¶é—´
  totalMinutes?: number;    // æ€»å·¥æ—¶(åˆ†é’Ÿ)
  overtimeMinutes?: number; // åŠ ç­æ—¶é•¿(åˆ†é’Ÿ)

  efficiency?: number;      // å·¥ä½œæ•ˆç‡è¯„åˆ† (0-100)
  workSummary?: string;     // å·¥ä½œæ€»ç»“

  createdAt: Date;          // åˆ›å»ºæ—¶é—´
}
```

#### 3.3.4 APIæ¥å£æ¸…å•

| APIç«¯ç‚¹ | æ–¹æ³• | åŠŸèƒ½ | æƒé™ | çŠ¶æ€ |
|--------|------|------|------|------|
| `/api/mobile/timeclock/clock-in` | POST | ä¸Šç­æ‰“å¡ | operator+ | âœ… |
| `/api/mobile/timeclock/clock-out` | POST | ä¸‹ç­æ‰“å¡ | operator+ | âœ… |
| `/api/mobile/timeclock/status` | GET | å½“å‰æ‰“å¡çŠ¶æ€ | operator+ | âœ… |
| `/api/mobile/timeclock/history` | GET | æ‰“å¡å†å²è®°å½• | operator+ | âœ… |
| `/api/mobile/time-stats/daily` | GET | æ—¥å·¥æ—¶ç»Ÿè®¡ | operator+ | âœ… |
| `/api/mobile/time-stats/weekly` | GET | å‘¨å·¥æ—¶ç»Ÿè®¡ | operator+ | âœ… |
| `/api/mobile/time-stats/monthly` | GET | æœˆå·¥æ—¶ç»Ÿè®¡ | department_admin+ | âœ… |

#### 3.3.5 å·¥æ—¶ç»Ÿè®¡é€»è¾‘

```javascript
// æ—¥å·¥æ—¶ç»Ÿè®¡
async function getDailyStats(userId, date) {
  const workSessions = await prisma.employeeWorkSession.findMany({
    where: {
      userId,
      startTime: {
        gte: new Date(date + 'T00:00:00'),
        lt: new Date(date + 'T23:59:59')
      },
      endTime: { not: null }
    }
  });

  const totalMinutes = workSessions.reduce(
    (sum, session) => sum + session.totalMinutes,
    0
  );
  const overtimeMinutes = workSessions.reduce(
    (sum, session) => sum + (session.overtimeMinutes || 0),
    0
  );

  return {
    date,
    totalHours: (totalMinutes / 60).toFixed(2),
    overtimeHours: (overtimeMinutes / 60).toFixed(2),
    sessionCount: workSessions.length,
    workSessions
  };
}

// æœˆå·¥æ—¶ç»Ÿè®¡
async function getMonthlyStats(userId, year, month) {
  // ç»Ÿè®¡æœ¬æœˆæ‰€æœ‰å·¥ä½œæ—¥
  const dailyStats = [];
  const daysInMonth = new Date(year, month, 0).getDate();

  for (let day = 1; day <= daysInMonth; day++) {
    const date = `${year}-${String(month).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
    const stats = await getDailyStats(userId, date);
    dailyStats.push(stats);
  }

  const totalHours = dailyStats.reduce(
    (sum, day) => sum + parseFloat(day.totalHours),
    0
  );
  const overtimeHours = dailyStats.reduce(
    (sum, day) => sum + parseFloat(day.overtimeHours),
    0
  );

  return {
    year,
    month,
    totalHours: totalHours.toFixed(2),
    overtimeHours: overtimeHours.toFixed(2),
    workDays: dailyStats.filter(d => parseFloat(d.totalHours) > 0).length,
    dailyStats
  };
}
```

#### 3.3.6 ä¼˜åŒ–æ–¹å‘

1. **GPSå›´æ ä¼˜åŒ–** (ä¼˜å…ˆçº§: P1)
   - æ”¯æŒå¤šä¸ªæ‰“å¡ç‚¹(ä¸åŒè½¦é—´)
   - GPSä¿¡å·å¼±æ—¶å…è®¸æ‰‹åŠ¨æ‰“å¡+å®¡æ‰¹

2. **ç­æ¬¡ç®¡ç†** (ä¼˜å…ˆçº§: P2)
   - æ”¯æŒå¤šç­æ¬¡(æ—©ç­ã€ä¸­ç­ã€å¤œç­)
   - è‡ªåŠ¨è¯†åˆ«ç­æ¬¡å¹¶è®¡ç®—å·¥æ—¶

3. **å·¥æ—¶å¯¼å‡º** (ä¼˜å…ˆçº§: P2)
   - å¯¼å‡ºæœˆåº¦å·¥æ—¶æŠ¥è¡¨(Excel)
   - ç”¨äºè–ªèµ„è®¡ç®—

---

### 3.4 è®¾å¤‡ç›‘æ§æ¨¡å— (Equipment Monitoring)

#### 3.4.1 åŠŸèƒ½æ¦‚è¿°

è®¾å¤‡ç›‘æ§æ¨¡å—è´Ÿè´£å®æ—¶ç›‘æ§ç”Ÿäº§è®¾å¤‡çŠ¶æ€,è®°å½•è®¾å¤‡ä½¿ç”¨æƒ…å†µ,ç®¡ç†è®¾å¤‡å‘Šè­¦ã€‚

**ç°æœ‰åŠŸèƒ½**:
- âœ… åç«¯API: 5ä¸ªAPIå…¨éƒ¨å®Œæˆ
- âœ… æ•°æ®åº“è¡¨: factory_equipment, device_monitoring_data, alert_notificationsè¡¨å®Œå–„
- âŒ å‰ç«¯UI: 0/4é¡µé¢å®Œæˆ

**ç¼ºå¤±é¡µé¢**:
- âŒ EquipmentListScreen - è®¾å¤‡åˆ—è¡¨é¡µ
- âŒ EquipmentMonitoringScreen - å®æ—¶ç›‘æ§é¡µ
- âŒ EquipmentDetailScreen - è®¾å¤‡è¯¦æƒ…é¡µ
- âŒ EquipmentAlertsScreen - è®¾å¤‡å‘Šè­¦é¡µ

#### 3.4.2 æ•°æ®æ¨¡å‹

```typescript
interface FactoryEquipment {
  id: string;                  // è®¾å¤‡ID
  factoryId: string;           // å·¥å‚ID
  equipmentCode: string;       // è®¾å¤‡ç¼–å· (å¦‚: EQ001)
  equipmentName: string;       // è®¾å¤‡åç§°
  equipmentType: EquipmentType; // è®¾å¤‡ç±»å‹
  location: string;            // å®‰è£…ä½ç½®

  // è®¾å¤‡å‚æ•°
  specifications: any;         // è®¾å¤‡è§„æ ¼ (JSON)
  purchaseDate: Date;          // è´­ä¹°æ—¥æœŸ
  purchasePrice: number;       // è´­ä¹°ä»·æ ¼
  deprecationRate: number;     // æŠ˜æ—§ç‡(å…ƒ/å°æ—¶)

  // è¿è¡ŒçŠ¶æ€
  status: EquipmentStatus;     // è®¾å¤‡çŠ¶æ€
  lastMaintenanceDate?: Date;  // ä¸Šæ¬¡ç»´æŠ¤æ—¥æœŸ
  nextMaintenanceDate?: Date;  // ä¸‹æ¬¡ç»´æŠ¤æ—¥æœŸ

  // ç›‘æ§é…ç½®
  monitoringEnabled: boolean;  // æ˜¯å¦å¯ç”¨ç›‘æ§
  alertThresholds: AlertThreshold[]; // å‘Šè­¦é˜ˆå€¼é…ç½® (JSON)

  createdAt: Date;             // åˆ›å»ºæ—¶é—´
}

type EquipmentType =
  | 'freezer'          // é€Ÿå†»æœº
  | 'cooler'           // å†·å´æœº
  | 'mixer'            // æ…æ‹Œæœº
  | 'cutter'           // åˆ‡å‰²æœº
  | 'packing_machine'  // åŒ…è£…æœº
  | 'conveyor'         // ä¼ é€å¸¦
  | 'other';           // å…¶ä»–

type EquipmentStatus =
  | 'normal'       // æ­£å¸¸è¿è¡Œ
  | 'warning'      // è­¦å‘Š(å‚æ•°æ¥è¿‘é˜ˆå€¼)
  | 'error'        // æ•…éšœ
  | 'maintenance'  // ç»´æŠ¤ä¸­
  | 'offline';     // ç¦»çº¿

interface AlertThreshold {
  metric: string;       // æŒ‡æ ‡åç§° (temperature, humidity, pressureç­‰)
  minValue?: number;    // æœ€å°å€¼
  maxValue?: number;    // æœ€å¤§å€¼
  warningLevel: number; // è­¦å‘Šçº§åˆ« (1-3)
}

interface DeviceMonitoringData {
  id: string;              // ç›‘æ§æ•°æ®ID
  equipmentId: string;     // è®¾å¤‡ID
  equipment?: FactoryEquipment; // è®¾å¤‡ä¿¡æ¯

  timestamp: Date;         // é‡‡é›†æ—¶é—´

  // ç›‘æ§æŒ‡æ ‡
  temperature?: number;    // æ¸©åº¦(Â°C)
  humidity?: number;       // æ¹¿åº¦(%)
  pressure?: number;       // å‹åŠ›(Pa)
  voltage?: number;        // ç”µå‹(V)
  current?: number;        // ç”µæµ(A)
  runtime?: number;        // è¿è¡Œæ—¶é•¿(åˆ†é’Ÿ)

  // å…¶ä»–æŒ‡æ ‡(JSON)
  customMetrics?: any;     // è‡ªå®šä¹‰æŒ‡æ ‡

  // çŠ¶æ€
  isNormal: boolean;       // æ˜¯å¦æ­£å¸¸
  abnormalMetrics?: string[]; // å¼‚å¸¸æŒ‡æ ‡åˆ—è¡¨

  createdAt: Date;         // åˆ›å»ºæ—¶é—´
}

interface AlertNotification {
  id: string;              // å‘Šè­¦ID
  factoryId: string;       // å·¥å‚ID
  equipmentId?: string;    // è®¾å¤‡ID (è®¾å¤‡å‘Šè­¦)
  batchId?: string;        // æ‰¹æ¬¡ID (æ‰¹æ¬¡å‘Šè­¦)

  alertType: AlertType;    // å‘Šè­¦ç±»å‹
  severity: AlertSeverity; // ä¸¥é‡ç¨‹åº¦
  title: string;           // å‘Šè­¦æ ‡é¢˜
  message: string;         // å‘Šè­¦æ¶ˆæ¯

  // å‘Šè­¦æ•°æ®
  triggeredAt: Date;       // è§¦å‘æ—¶é—´
  acknowledgedAt?: Date;   // ç¡®è®¤æ—¶é—´
  resolvedAt?: Date;       // è§£å†³æ—¶é—´

  // å¤„ç†ä¿¡æ¯
  acknowledgedBy?: number; // ç¡®è®¤äººID
  resolvedBy?: number;     // è§£å†³äººID
  resolutionNotes?: string; // å¤„ç†è¯´æ˜

  status: AlertStatus;     // å‘Šè­¦çŠ¶æ€
  createdAt: Date;         // åˆ›å»ºæ—¶é—´
}

type AlertType =
  | 'temperature_high'     // æ¸©åº¦è¿‡é«˜
  | 'temperature_low'      // æ¸©åº¦è¿‡ä½
  | 'equipment_failure'    // è®¾å¤‡æ•…éšœ
  | 'quality_issue'        // è´¨é‡é—®é¢˜
  | 'cost_overrun'         // æˆæœ¬è¶…æ ‡
  | 'batch_delayed'        // æ‰¹æ¬¡å»¶æœŸ
  | 'maintenance_due';     // ç»´æŠ¤åˆ°æœŸ

type AlertSeverity =
  | 'critical'  // ä¸¥é‡(çº¢è‰²)
  | 'high'      // é«˜(æ©™è‰²)
  | 'medium'    // ä¸­(é»„è‰²)
  | 'low';      // ä½(è“è‰²)

type AlertStatus =
  | 'active'        // æ´»åŠ¨ä¸­
  | 'acknowledged'  // å·²ç¡®è®¤
  | 'resolved';     // å·²è§£å†³
```

#### 3.4.3 APIæ¥å£æ¸…å•

| APIç«¯ç‚¹ | æ–¹æ³• | åŠŸèƒ½ | æƒé™ | çŠ¶æ€ |
|--------|------|------|------|------|
| `/api/mobile/processing/equipment/monitoring` | GET | è®¾å¤‡å®æ—¶ç›‘æ§åˆ—è¡¨ | operator+ | âœ… |
| `/api/mobile/processing/equipment/:id/metrics` | GET | è®¾å¤‡å†å²æŒ‡æ ‡æ•°æ® | operator+ | âœ… |
| `/api/mobile/processing/equipment/:id/data` | POST | ä¸ŠæŠ¥è®¾å¤‡ç›‘æ§æ•°æ® | operator+ | âœ… |
| `/api/mobile/processing/equipment/alerts` | GET | è®¾å¤‡å‘Šè­¦åˆ—è¡¨ | operator+ | âœ… |
| `/api/mobile/processing/equipment/:id/status` | GET | å•ä¸ªè®¾å¤‡çŠ¶æ€ | operator+ | âœ… |
| `/api/mobile/alerts` | GET | æ‰€æœ‰å‘Šè­¦åˆ—è¡¨ | operator+ | âœ… |
| `/api/mobile/alerts/:id/acknowledge` | POST | ç¡®è®¤å‘Šè­¦ | department_admin+ | âœ… |
| `/api/mobile/alerts/:id/resolve` | POST | è§£å†³å‘Šè­¦ | department_admin+ | âœ… |

#### 3.4.4 å‘Šè­¦è§¦å‘é€»è¾‘

```javascript
// ç›‘æ§æ•°æ®ä¸ŠæŠ¥æ—¶æ£€æŸ¥å‘Šè­¦é˜ˆå€¼
async function checkAlertThresholds(equipmentId, monitoringData) {
  const equipment = await prisma.factoryEquipment.findUnique({
    where: { id: equipmentId }
  });

  const alerts = [];

  for (const threshold of equipment.alertThresholds) {
    const value = monitoringData[threshold.metric];
    if (!value) continue;

    let triggered = false;
    let message = '';

    // æ£€æŸ¥æ˜¯å¦è¶…è¿‡é˜ˆå€¼
    if (threshold.maxValue && value > threshold.maxValue) {
      triggered = true;
      message = `${threshold.metric}è¿‡é«˜: ${value} (é˜ˆå€¼: ${threshold.maxValue})`;
    } else if (threshold.minValue && value < threshold.minValue) {
      triggered = true;
      message = `${threshold.metric}è¿‡ä½: ${value} (é˜ˆå€¼: ${threshold.minValue})`;
    }

    if (triggered) {
      // åˆ›å»ºå‘Šè­¦
      const alert = await prisma.alertNotification.create({
        data: {
          factoryId: equipment.factoryId,
          equipmentId,
          alertType: `${threshold.metric}_${value > threshold.maxValue ? 'high' : 'low'}`,
          severity: getSeverityLevel(threshold.warningLevel),
          title: `è®¾å¤‡${equipment.equipmentName}å‘Šè­¦`,
          message,
          status: 'active',
          triggeredAt: new Date()
        }
      });

      alerts.push(alert);

      // å‘é€æ¨é€é€šçŸ¥
      await sendPushNotification(equipment.factoryId, alert);
    }
  }

  return alerts;
}

function getSeverityLevel(warningLevel) {
  if (warningLevel >= 3) return 'critical';
  if (warningLevel === 2) return 'high';
  if (warningLevel === 1) return 'medium';
  return 'low';
}
```

#### 3.4.5 ä¼˜åŒ–æ–¹å‘

1. **å®æ—¶æ•°æ®æ¨é€** (ä¼˜å…ˆçº§: P1)
   - WebSocketè¿æ¥å®æ—¶æ¨é€ç›‘æ§æ•°æ®
   - å‰ç«¯å›¾è¡¨å®æ—¶æ›´æ–°

2. **è®¾å¤‡ç»´æŠ¤æé†’** (ä¼˜å…ˆçº§: P2)
   - å®šæœŸç»´æŠ¤åˆ°æœŸæé†’
   - è¿è¡Œæ—¶é•¿è¾¾æ ‡æé†’

3. **è®¾å¤‡ä½¿ç”¨åˆ†æ** (ä¼˜å…ˆçº§: P2)
   - è®¾å¤‡åˆ©ç”¨ç‡ç»Ÿè®¡
   - è®¾å¤‡æ•…éšœç‡åˆ†æ

---

### 3.5 æˆæœ¬æ ¸ç®—æ¨¡å— (Cost Analysis)

#### 3.5.1 åŠŸèƒ½æ¦‚è¿°

æˆæœ¬æ ¸ç®—æ¨¡å—è´Ÿè´£è‡ªåŠ¨è®¡ç®—æ‰¹æ¬¡æˆæœ¬,æä¾›æˆæœ¬åˆ†æå’ŒAIä¼˜åŒ–å»ºè®®ã€‚

**ç°æœ‰åŠŸèƒ½**:
- âœ… åç«¯API: 3ä¸ªAPI,å…¶ä¸­AIåˆ†æä½¿ç”¨Mockæ•°æ®
- âœ… æ•°æ®åº“è¡¨: processing_batchesåŒ…å«æˆæœ¬å­—æ®µ
- âœ… å‰ç«¯UI: 1/3é¡µé¢å®Œæˆ (CostAnalysisDashboard)

**ç¼ºå¤±é¡µé¢**:
- âŒ BatchCostDetailScreen - æ‰¹æ¬¡æˆæœ¬è¯¦æƒ…é¡µ
- âŒ CostTrendScreen - æˆæœ¬è¶‹åŠ¿åˆ†æé¡µ

**éœ€è¦ä¼˜åŒ–**:
- âŒ DeepSeek AIçœŸå®é›†æˆ(å½“å‰ä½¿ç”¨Mockæ•°æ®)
- âŒ æˆæœ¬è®¡ç®—å…¬å¼ä¼˜åŒ–
- âŒ å†å²æˆæœ¬å¯¹æ¯”åŠŸèƒ½

#### 3.5.2 æˆæœ¬æ„æˆåˆ†æ

```
æ‰¹æ¬¡æ€»æˆæœ¬ = åŸæ–™æˆæœ¬ + äººå·¥æˆæœ¬ + è®¾å¤‡æˆæœ¬ + å…¶ä»–æˆæœ¬

1. åŸæ–™æˆæœ¬ (Raw Material Cost)
   - æ¥æº: æ‰‹åŠ¨è¾“å…¥(æ¥è‡ªé‡‡è´­æ•°æ®)
   - è®¡ç®—: rawMaterialCost = Î£(åŸæ–™æ•°é‡ Ã— åŸæ–™å•ä»·)
   - å æ¯”: é€šå¸¸40-50%

2. äººå·¥æˆæœ¬ (Labor Cost)
   - æ¥æº: è‡ªåŠ¨è®¡ç®—(å·¥æ—¶è®°å½•)
   - è®¡ç®—: laborCost = Î£(å·¥æ—¶ Ã— å‘˜å·¥æ—¶è–ª)
   - è¯¦ç»†å…¬å¼:
     laborCost = Î£(workSession.totalMinutes Ã— employee.hourlyRate / 60)
     å…¶ä¸­,hourlyRateæ ¹æ®å‘˜å·¥å·¥ç§å’Œçº§åˆ«ç¡®å®š:
       - æ™®é€šæ“ä½œå‘˜: Â¥20/å°æ—¶
       - ç†Ÿç»ƒæ“ä½œå‘˜: Â¥25/å°æ—¶
       - ç­é•¿: Â¥30/å°æ—¶
     åŠ ç­å·¥æ—¶æŒ‰1.5å€è®¡ç®—
   - å æ¯”: é€šå¸¸30-40%

3. è®¾å¤‡æˆæœ¬ (Equipment Cost)
   - æ¥æº: è‡ªåŠ¨è®¡ç®—(è®¾å¤‡ä½¿ç”¨è®°å½•)
   - è®¡ç®—: equipmentCost = Î£(è®¾å¤‡ä½¿ç”¨æ—¶é•¿ Ã— è®¾å¤‡æŠ˜æ—§ç‡)
   - è¯¦ç»†å…¬å¼:
     equipmentCost = Î£(equipmentUsage.usageMinutes Ã— equipment.deprecationRate / 60)
     å…¶ä¸­,deprecationRate = è®¾å¤‡è´­ä¹°ä»·æ ¼ / (é¢„è®¡ä½¿ç”¨å¹´é™ Ã— 365 Ã— 24)
     ä¾‹å¦‚: 100ä¸‡è®¾å¤‡,ä½¿ç”¨10å¹´
       deprecationRate = 1000000 / (10 Ã— 365 Ã— 24) = Â¥11.42/å°æ—¶
   - å æ¯”: é€šå¸¸10-20%

4. å…¶ä»–æˆæœ¬ (Other Cost)
   - èƒ½è€—æˆæœ¬: ç”µè´¹ã€æ°´è´¹
   - åŒ…è£…æˆæœ¬: åŒ…è£…ææ–™
   - ç‰©æµæˆæœ¬: åŸæ–™è¿è¾“ã€æˆå“è¿è¾“
   - å æ¯”: é€šå¸¸5-10%

å•ä½æˆæœ¬ = æ€»æˆæœ¬ / å®é™…äº§é‡
  costPerKg = totalCost / actualQuantity

åˆ©æ¶¦ç‡ = (é¢„æœŸå”®ä»· - å•ä½æˆæœ¬) / é¢„æœŸå”®ä»· Ã— 100%
  profitRate = (expectedPrice - costPerKg) / expectedPrice Ã— 100%

åˆ©æ¶¦é¢ = å®é™…äº§é‡ Ã— (é¢„æœŸå”®ä»· - å•ä½æˆæœ¬)
  profitMargin = actualQuantity Ã— (expectedPrice - costPerKg)
```

#### 3.5.3 æˆæœ¬è®¡ç®—ç¤ºä¾‹

```javascript
// æ‰¹æ¬¡æˆæœ¬è‡ªåŠ¨è®¡ç®—
async function calculateBatchCost(batchId) {
  const batch = await prisma.processingBatch.findUnique({
    where: { id: batchId }
  });

  // 1. åŸæ–™æˆæœ¬(å·²æ‰‹åŠ¨è¾“å…¥)
  const rawMaterialCost = batch.rawMaterialCost || 0;

  // 2. äººå·¥æˆæœ¬
  const workSessions = await prisma.employeeWorkSession.findMany({
    where: { relatedBatchId: batchId, endTime: { not: null } },
    include: { user: true }
  });

  let laborCost = 0;
  for (const session of workSessions) {
    const hourlyRate = session.user.hourlyRate || 20;  // é»˜è®¤Â¥20/å°æ—¶
    const hours = session.totalMinutes / 60;
    const overtimeHours = (session.overtimeMinutes || 0) / 60;

    laborCost += hours * hourlyRate;
    laborCost += overtimeHours * hourlyRate * 1.5;  // åŠ ç­1.5å€
  }

  // 3. è®¾å¤‡æˆæœ¬
  const equipmentUsage = await prisma.equipmentUsage.findMany({
    where: { batchId },
    include: { equipment: true }
  });

  let equipmentCost = 0;
  for (const usage of equipmentUsage) {
    const hours = usage.usageMinutes / 60;
    const deprecationRate = usage.equipment.deprecationRate || 10;
    equipmentCost += hours * deprecationRate;
  }

  // 4. å…¶ä»–æˆæœ¬(æš‚æ—¶å›ºå®šæ¯”ä¾‹,åç»­å¯é…ç½®)
  const otherCostRate = 0.05;  // 5%
  const otherCost = (rawMaterialCost + laborCost + equipmentCost) * otherCostRate;

  // 5. æ€»æˆæœ¬
  const totalCost = rawMaterialCost + laborCost + equipmentCost + otherCost;

  // 6. å•ä½æˆæœ¬
  const costPerKg = batch.actualQuantity > 0
    ? totalCost / batch.actualQuantity
    : 0;

  // 7. åˆ©æ¶¦è®¡ç®—
  const profitRate = batch.expectedPrice && batch.expectedPrice > 0
    ? ((batch.expectedPrice - costPerKg) / batch.expectedPrice * 100)
    : 0;

  const profitMargin = batch.actualQuantity * (batch.expectedPrice - costPerKg);

  // 8. æ›´æ–°æ‰¹æ¬¡æˆæœ¬æ•°æ®
  await prisma.processingBatch.update({
    where: { id: batchId },
    data: {
      rawMaterialCost,
      laborCost: Math.round(laborCost * 100) / 100,
      equipmentCost: Math.round(equipmentCost * 100) / 100,
      totalCost: Math.round(totalCost * 100) / 100,
      costPerKg: Math.round(costPerKg * 100) / 100,
      profitRate: Math.round(profitRate * 100) / 100,
      profitMargin: Math.round(profitMargin * 100) / 100
    }
  });

  return {
    rawMaterialCost,
    laborCost,
    equipmentCost,
    otherCost,
    totalCost,
    costPerKg,
    profitRate,
    profitMargin
  };
}
```

#### 3.5.4 AIæˆæœ¬åˆ†æ (DeepSeeké›†æˆ)

**å½“å‰çŠ¶æ€**: ä½¿ç”¨Mockæ•°æ®,æœªé›†æˆçœŸå®DeepSeek API

**ä¼˜åŒ–æ–¹æ¡ˆ**:
1. é›†æˆDeepSeek API
2. æˆæœ¬æ§åˆ¶åœ¨Â¥30/æœˆä»¥å†…
3. ä½¿ç”¨5åˆ†é’Ÿç¼“å­˜ç­–ç•¥
4. æœˆé¢„ç®—ç”¨å®Œåé™çº§åˆ°è§„åˆ™å¼•æ“

**è¯¦ç»†è®¾è®¡**: å‚è§ `PRD-è®¤è¯ä¸ç”Ÿäº§æ¨¡å—ä¼˜åŒ–æ–¹æ¡ˆ.md` çš„é˜¶æ®µ3(DeepSeek AIé›†æˆ)ç« èŠ‚

#### 3.5.5 APIæ¥å£æ¸…å•

| APIç«¯ç‚¹ | æ–¹æ³• | åŠŸèƒ½ | æƒé™ | çŠ¶æ€ |
|--------|------|------|------|------|
| `/api/mobile/processing/batches/:id/cost-analysis` | GET | æ‰¹æ¬¡æˆæœ¬åˆ†æ | operator+ | âœ… |
| `/api/mobile/processing/batches/:id/recalculate-cost` | POST | é‡æ–°è®¡ç®—æˆæœ¬ | department_admin+ | âœ… |
| `/api/mobile/analysis/deepseek` | POST | AIæˆæœ¬åˆ†æ | department_admin+ | ğŸŸ¡ Mock |

#### 3.5.6 ä¼˜åŒ–æ–¹å‘

1. **DeepSeekçœŸå®é›†æˆ** (ä¼˜å…ˆçº§: P0)
   - æ›¿æ¢Mockæ•°æ®
   - å®ç°ç¼“å­˜ç­–ç•¥
   - æœˆåº¦é¢„ç®—æ§åˆ¶

2. **æˆæœ¬å¯¹æ¯”åŠŸèƒ½** (ä¼˜å…ˆçº§: P1)
   - ä¸ç›®æ ‡æˆæœ¬å¯¹æ¯”
   - ä¸å†å²å¹³å‡å¯¹æ¯”
   - ä¸åŒç±»æ‰¹æ¬¡å¯¹æ¯”

3. **æˆæœ¬é¢„æµ‹åŠŸèƒ½** (ä¼˜å…ˆçº§: P2)
   - åŸºäºå†å²æ•°æ®é¢„æµ‹æˆæœ¬
   - æå‰å‘ç°æˆæœ¬è¶…æ ‡é£é™©

---

### 3.6 ç”Ÿäº§ä»ªè¡¨æ¿æ¨¡å— (Production Dashboard)

#### 3.6.1 åŠŸèƒ½æ¦‚è¿°

ç”Ÿäº§ä»ªè¡¨æ¿æ˜¯ç”Ÿäº§æ¨¡å—çš„ä¸»å…¥å£,æä¾›ç”Ÿäº§æ•°æ®çš„å¯è§†åŒ–å±•ç¤ºã€‚

**ç°æœ‰åŠŸèƒ½**:
- âœ… åç«¯API: 6ä¸ªAPIå…¨éƒ¨å®Œæˆ
- âœ… æ•°æ®åº“è¡¨: æ— éœ€é¢å¤–è¡¨,èšåˆæŸ¥è¯¢ç°æœ‰è¡¨
- âœ… å‰ç«¯UI: 1/2é¡µé¢å®Œæˆ (ProcessingDashboardScreen)

**ç¼ºå¤±é¡µé¢**:
- âŒ ProductionStatisticsScreen - ç”Ÿäº§ç»Ÿè®¡è¯¦æƒ…é¡µ

#### 3.6.2 ä»ªè¡¨æ¿æŒ‡æ ‡

```
æ ¸å¿ƒæŒ‡æ ‡ (KPIs):

1. ç”Ÿäº§æ¦‚è§ˆ
   - ä»Šæ—¥ç”Ÿäº§æ‰¹æ¬¡æ•°
   - ä»Šæ—¥å®Œæˆæ‰¹æ¬¡æ•°
   - ä»Šæ—¥äº§é‡(kg)
   - ä»Šæ—¥åˆæ ¼ç‡(%)

2. è´¨é‡æ¦‚è§ˆ
   - è´¨æ£€æ¬¡æ•°
   - è´¨æ£€åˆæ ¼ç‡
   - ä¸åˆæ ¼é¡¹TOP5

3. æˆæœ¬æ¦‚è§ˆ
   - ä»Šæ—¥æ€»æˆæœ¬
   - å¹³å‡å•ä½æˆæœ¬
   - æˆæœ¬è¶…æ ‡æ‰¹æ¬¡æ•°

4. äººå‘˜æ¦‚è§ˆ
   - åœ¨å²—äººæ•°
   - æ€»å·¥æ—¶
   - å¹³å‡æ•ˆç‡

5. è®¾å¤‡æ¦‚è§ˆ
   - è®¾å¤‡åœ¨çº¿æ•°
   - è®¾å¤‡æ•…éšœæ•°
   - æ´»åŠ¨å‘Šè­¦æ•°

æ—¶é—´ç»´åº¦:
   - ä»Šæ—¥ (Today)
   - æœ¬å‘¨ (This Week)
   - æœ¬æœˆ (This Month)
   - è‡ªå®šä¹‰æ—¶é—´æ®µ (Custom Range)

å›¾è¡¨ç±»å‹:
   - æŠ˜çº¿å›¾: äº§é‡è¶‹åŠ¿ã€æˆæœ¬è¶‹åŠ¿
   - æŸ±çŠ¶å›¾: æ‰¹æ¬¡æ•°å¯¹æ¯”ã€éƒ¨é—¨äº§é‡å¯¹æ¯”
   - é¥¼å›¾: æˆæœ¬æ„æˆã€äº§å“ç±»å‹åˆ†å¸ƒ
   - ä»ªè¡¨ç›˜: åˆæ ¼ç‡ã€è®¾å¤‡åˆ©ç”¨ç‡
```

#### 3.6.3 APIæ¥å£æ¸…å•

| APIç«¯ç‚¹ | æ–¹æ³• | åŠŸèƒ½ | æƒé™ | çŠ¶æ€ |
|--------|------|------|------|------|
| `/api/mobile/processing/dashboard/overview` | GET | ä»ªè¡¨æ¿æ¦‚è§ˆæ•°æ® | operator+ | âœ… |
| `/api/mobile/processing/dashboard/production` | GET | ç”Ÿäº§ç»Ÿè®¡ | operator+ | âœ… |
| `/api/mobile/processing/dashboard/quality` | GET | è´¨é‡ç»Ÿè®¡ | operator+ | âœ… |
| `/api/mobile/processing/dashboard/equipment` | GET | è®¾å¤‡çŠ¶æ€ç»Ÿè®¡ | operator+ | âœ… |
| `/api/mobile/processing/dashboard/alerts` | GET | å‘Šè­¦ç»Ÿè®¡ | operator+ | âœ… |
| `/api/mobile/processing/dashboard/trends` | GET | è¶‹åŠ¿åˆ†æ | department_admin+ | âœ… |

#### 3.6.4 ä¼˜åŒ–æ–¹å‘

1. **å®æ—¶æ•°æ®åˆ·æ–°** (ä¼˜å…ˆçº§: P1)
   - å®šæ—¶è‡ªåŠ¨åˆ·æ–°(30ç§’/æ¬¡)
   - æ”¯æŒæ‰‹åŠ¨ä¸‹æ‹‰åˆ·æ–°

2. **è‡ªå®šä¹‰ä»ªè¡¨æ¿** (ä¼˜å…ˆçº§: P2)
   - ç”¨æˆ·è‡ªå®šä¹‰æ˜¾ç¤ºæŒ‡æ ‡
   - æ‹–æ‹½è°ƒæ•´ç»„ä»¶é¡ºåº

3. **æ•°æ®å¯¼å‡º** (ä¼˜å…ˆçº§: P2)
   - å¯¼å‡ºç”Ÿäº§æŠ¥è¡¨(PDF/Excel)
   - é‚®ä»¶å®šæ—¶å‘é€æŠ¥è¡¨

---

## æ•°æ®åº“è®¾è®¡

### 4.1 æ ¸å¿ƒè¡¨ç»“æ„

ç”Ÿäº§æ¨¡å—ä½¿ç”¨8ä¸ªæ ¸å¿ƒæ•°æ®è¡¨:

```sql
-- 1. processing_batches (æ‰¹æ¬¡ä¸»è¡¨)
CREATE TABLE processing_batches (
  id VARCHAR(50) PRIMARY KEY,
  factory_id VARCHAR(50) NOT NULL,
  batch_number VARCHAR(100) UNIQUE NOT NULL,
  product_type VARCHAR(100),
  raw_materials JSON,
  start_date DATE,
  end_date DATE,
  status ENUM('planning', 'in_progress', 'paused', 'quality_check', 'completed', 'failed', 'cancelled'),
  production_line VARCHAR(100),
  supervisor_id INT,
  target_quantity DECIMAL(10,2),
  actual_quantity DECIMAL(10,2),
  quality_grade ENUM('A', 'B', 'C', 'D'),
  notes TEXT,

  -- åŸæ–™æˆæœ¬
  raw_material_cost DECIMAL(12,2),
  raw_material_weight DECIMAL(10,2),
  raw_material_category VARCHAR(100),
  product_category VARCHAR(50),
  expected_price DECIMAL(12,2),

  -- æˆæœ¬æ ¸ç®—
  labor_cost DECIMAL(12,2),
  equipment_cost DECIMAL(12,2),
  total_cost DECIMAL(12,2),
  profit_margin DECIMAL(12,2),
  profit_rate DECIMAL(5,2),

  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,

  FOREIGN KEY (factory_id) REFERENCES factories(id),
  FOREIGN KEY (supervisor_id) REFERENCES users(id),
  INDEX idx_factory_status (factory_id, status, start_date DESC),
  INDEX idx_batch_number (batch_number)
);

-- 2. quality_inspections (è´¨æ£€è®°å½•è¡¨)
CREATE TABLE quality_inspections (
  id VARCHAR(50) PRIMARY KEY,
  factory_id VARCHAR(50) NOT NULL,
  batch_id VARCHAR(50) NOT NULL,
  inspection_type ENUM('raw_material', 'process', 'final_product'),
  inspection_date DATE,
  inspector_id INT,

  -- æ£€æµ‹é¡¹ç›® (JSON)
  test_items JSON,

  -- æ£€æµ‹ç»“æœ
  overall_result ENUM('pass', 'fail', 'conditional_pass'),
  quality_score DECIMAL(5,2),
  defect_details TEXT,
  defect_types JSON,

  -- çº æ­£æªæ–½
  corrective_actions TEXT,
  follow_up_required BOOLEAN DEFAULT FALSE,
  follow_up_date DATE,

  -- ç…§ç‰‡è¯æ®
  photos JSON,
  notes TEXT,

  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

  FOREIGN KEY (batch_id) REFERENCES processing_batches(id) ON DELETE CASCADE,
  FOREIGN KEY (inspector_id) REFERENCES users(id),
  INDEX idx_batch_inspection (batch_id, inspection_date DESC),
  INDEX idx_factory_date (factory_id, inspection_date DESC)
);

-- 3. employee_time_clocks (æ‰“å¡è®°å½•è¡¨)
CREATE TABLE employee_time_clocks (
  id VARCHAR(50) PRIMARY KEY,
  factory_id VARCHAR(50) NOT NULL,
  user_id INT NOT NULL,
  clock_type ENUM('in', 'out'),
  clock_time TIMESTAMP,
  location JSON,
  photo VARCHAR(500),

  work_type VARCHAR(50),
  related_batch_id VARCHAR(50),

  status ENUM('normal', 'late', 'early_leave', 'overtime', 'forgot'),
  notes TEXT,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

  FOREIGN KEY (factory_id) REFERENCES factories(id),
  FOREIGN KEY (user_id) REFERENCES users(id),
  FOREIGN KEY (related_batch_id) REFERENCES processing_batches(id) ON DELETE SET NULL,
  INDEX idx_user_time (user_id, clock_time DESC),
  INDEX idx_factory_time (factory_id, clock_time DESC)
);

-- 4. employee_work_sessions (å·¥ä½œæ—¶æ®µè¡¨)
CREATE TABLE employee_work_sessions (
  id VARCHAR(50) PRIMARY KEY,
  factory_id VARCHAR(50) NOT NULL,
  user_id INT NOT NULL,
  clock_in_id VARCHAR(50) NOT NULL,
  clock_out_id VARCHAR(50),

  work_type VARCHAR(50),
  related_batch_id VARCHAR(50),

  start_time TIMESTAMP,
  end_time TIMESTAMP,
  total_minutes INT,
  overtime_minutes INT,

  efficiency DECIMAL(5,2),
  work_summary TEXT,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

  FOREIGN KEY (user_id) REFERENCES users(id),
  FOREIGN KEY (clock_in_id) REFERENCES employee_time_clocks(id) ON DELETE CASCADE,
  FOREIGN KEY (clock_out_id) REFERENCES employee_time_clocks(id) ON DELETE CASCADE,
  FOREIGN KEY (related_batch_id) REFERENCES processing_batches(id) ON DELETE SET NULL,
  INDEX idx_user_session (user_id, start_time DESC),
  INDEX idx_batch_session (related_batch_id, start_time DESC)
);

-- 5. factory_equipment (è®¾å¤‡ç®¡ç†è¡¨)
CREATE TABLE factory_equipment (
  id VARCHAR(50) PRIMARY KEY,
  factory_id VARCHAR(50) NOT NULL,
  equipment_code VARCHAR(50) UNIQUE NOT NULL,
  equipment_name VARCHAR(100) NOT NULL,
  equipment_type VARCHAR(50),
  location VARCHAR(100),

  specifications JSON,
  purchase_date DATE,
  purchase_price DECIMAL(12,2),
  deprecation_rate DECIMAL(10,2),

  status ENUM('normal', 'warning', 'error', 'maintenance', 'offline'),
  last_maintenance_date DATE,
  next_maintenance_date DATE,

  monitoring_enabled BOOLEAN DEFAULT TRUE,
  alert_thresholds JSON,

  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

  FOREIGN KEY (factory_id) REFERENCES factories(id),
  INDEX idx_factory_equipment (factory_id, equipment_code)
);

-- 6. device_monitoring_data (è®¾å¤‡ç›‘æ§æ•°æ®è¡¨)
CREATE TABLE device_monitoring_data (
  id VARCHAR(50) PRIMARY KEY,
  equipment_id VARCHAR(50) NOT NULL,
  timestamp TIMESTAMP,

  -- ç›‘æ§æŒ‡æ ‡
  temperature DECIMAL(5,2),
  humidity DECIMAL(5,2),
  pressure DECIMAL(8,2),
  voltage DECIMAL(8,2),
  current DECIMAL(8,2),
  runtime INT,

  custom_metrics JSON,

  is_normal BOOLEAN DEFAULT TRUE,
  abnormal_metrics JSON,

  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

  FOREIGN KEY (equipment_id) REFERENCES factory_equipment(id) ON DELETE CASCADE,
  INDEX idx_equipment_time (equipment_id, timestamp DESC)
);

-- 7. alert_notifications (å‘Šè­¦é€šçŸ¥è¡¨)
CREATE TABLE alert_notifications (
  id VARCHAR(50) PRIMARY KEY,
  factory_id VARCHAR(50) NOT NULL,
  equipment_id VARCHAR(50),
  batch_id VARCHAR(50),

  alert_type VARCHAR(50),
  severity ENUM('critical', 'high', 'medium', 'low'),
  title VARCHAR(200),
  message TEXT,

  triggered_at TIMESTAMP,
  acknowledged_at TIMESTAMP,
  resolved_at TIMESTAMP,

  acknowledged_by INT,
  resolved_by INT,
  resolution_notes TEXT,

  status ENUM('active', 'acknowledged', 'resolved'),
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

  FOREIGN KEY (factory_id) REFERENCES factories(id),
  FOREIGN KEY (equipment_id) REFERENCES factory_equipment(id) ON DELETE SET NULL,
  FOREIGN KEY (batch_id) REFERENCES processing_batches(id) ON DELETE SET NULL,
  FOREIGN KEY (acknowledged_by) REFERENCES users(id) ON DELETE SET NULL,
  FOREIGN KEY (resolved_by) REFERENCES users(id) ON DELETE SET NULL,
  INDEX idx_factory_status (factory_id, status, triggered_at DESC),
  INDEX idx_severity (severity, triggered_at DESC)
);

-- 8. ai_analysis_logs (AIåˆ†ææ—¥å¿—è¡¨) - æ–°å¢
CREATE TABLE ai_analysis_logs (
  id VARCHAR(50) PRIMARY KEY,
  batch_id VARCHAR(50),
  service VARCHAR(50) DEFAULT 'deepseek',
  cost DECIMAL(10,4),
  timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

  FOREIGN KEY (batch_id) REFERENCES processing_batches(id) ON DELETE SET NULL,
  INDEX idx_service_time (service, timestamp DESC),
  INDEX idx_batch_analysis (batch_id)
);
```

### 4.2 æ•°æ®å…³ç³»ERå›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   factories     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ 1
         â”‚
         â”‚ N
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚processing_batches   â”‚ 1..N â”‚quality_inspectionsâ”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â—„â”€â”€â”€â”€â”€â”¤â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ id (PK)             â”‚      â”‚ batch_id (FK)    â”‚
â”‚ factory_id (FK)     â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ batch_number        â”‚
â”‚ status              â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ supervisor_id (FK)  â”‚ 1..N â”‚employee_work_sessionsâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â—„â”€â”€â”€â”€â”€â”¤â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
          â”‚                  â”‚ related_batch_id (FK)â”‚
          â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”‚ N                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ users            â”‚
                        1    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
                             â”‚ id (PK)          â”‚
                             â”‚ factory_id (FK)  â”‚
                             â”‚ role_code        â”‚
                             â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚ 1
                                      â”‚
                                      â”‚ N
                             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                             â”‚employee_time_clocks â”‚
                             â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
                             â”‚ user_id (FK)        â”‚
                             â”‚ clock_type          â”‚
                             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ factory_equipment   â”‚ 1..N â”‚device_monitoring_data   â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â—„â”€â”€â”€â”€â”€â”¤â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ id (PK)             â”‚      â”‚ equipment_id (FK)       â”‚
â”‚ factory_id (FK)     â”‚      â”‚ temperature, humidity..â”‚
â”‚ equipment_code      â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ status              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚ 1..N             â”‚ alert_notifications â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
                             â”‚ equipment_id (FK)   â”‚
                             â”‚ batch_id (FK)       â”‚
                             â”‚ severity            â”‚
                             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.3 ç´¢å¼•ä¼˜åŒ–å»ºè®®

```sql
-- æ‰¹æ¬¡æŸ¥è¯¢ä¼˜åŒ–
CREATE INDEX idx_batch_composite
ON processing_batches(factory_id, status, start_date DESC, created_at DESC);

-- è´¨æ£€æŸ¥è¯¢ä¼˜åŒ–
CREATE INDEX idx_inspection_composite
ON quality_inspections(factory_id, batch_id, inspection_type, inspection_date DESC);

-- å·¥æ—¶ç»Ÿè®¡ä¼˜åŒ–
CREATE INDEX idx_worksession_stats
ON employee_work_sessions(user_id, start_time DESC, end_time DESC);

-- è®¾å¤‡ç›‘æ§æŸ¥è¯¢ä¼˜åŒ–
CREATE INDEX idx_monitoring_composite
ON device_monitoring_data(equipment_id, timestamp DESC, is_normal);

-- å‘Šè­¦æŸ¥è¯¢ä¼˜åŒ–
CREATE INDEX idx_alert_composite
ON alert_notifications(factory_id, status, severity, triggered_at DESC);
```

---

## APIæ¥å£æ¸…å•

### 5.1 APIåˆ†ç±»æ±‡æ€»

ç”Ÿäº§æ¨¡å—å…±è®¡**29ä¸ªAPIç«¯ç‚¹**:

| æ¨¡å— | APIæ•°é‡ | å®ŒæˆçŠ¶æ€ |
|-----|---------|---------|
| æ‰¹æ¬¡ç®¡ç† | 8 | âœ… 100% |
| è´¨é‡æ£€éªŒ | 6 | âœ… 100% |
| å‘˜å·¥å·¥ä½œ | 7 | âœ… 100% |
| è®¾å¤‡ç›‘æ§ | 5 | âœ… 100% |
| æˆæœ¬åˆ†æ | 3 | ğŸŸ¡ 80% (AI Mock) |
| ç”Ÿäº§ä»ªè¡¨æ¿ | 6 | âœ… 100% |
| **æ€»è®¡** | **35** | **97%** |

### 5.2 å®Œæ•´APIæ¸…å•

#### 5.2.1 æ‰¹æ¬¡ç®¡ç†API (8ä¸ª)

```
POST   /api/mobile/processing/batches                    åˆ›å»ºæ‰¹æ¬¡
GET    /api/mobile/processing/batches                    æ‰¹æ¬¡åˆ—è¡¨(åˆ†é¡µã€ç­›é€‰)
GET    /api/mobile/processing/batches/:id                æ‰¹æ¬¡è¯¦æƒ…
PUT    /api/mobile/processing/batches/:id                æ›´æ–°æ‰¹æ¬¡
DELETE /api/mobile/processing/batches/:id                åˆ é™¤æ‰¹æ¬¡
POST   /api/mobile/processing/batches/:id/start          å¼€å§‹ç”Ÿäº§
POST   /api/mobile/processing/batches/:id/complete       å®Œæˆç”Ÿäº§
POST   /api/mobile/processing/batches/:id/pause          æš‚åœç”Ÿäº§
GET    /api/mobile/processing/batches/:id/timeline       æ‰¹æ¬¡æ—¶é—´çº¿
```

#### 5.2.2 è´¨é‡æ£€éªŒAPI (6ä¸ª)

```
POST   /api/mobile/processing/quality/inspections        åˆ›å»ºè´¨æ£€è®°å½•
GET    /api/mobile/processing/quality/inspections        è´¨æ£€åˆ—è¡¨(åˆ†é¡µã€ç­›é€‰)
GET    /api/mobile/processing/quality/inspections/:id    è´¨æ£€è¯¦æƒ…
PUT    /api/mobile/processing/quality/inspections/:id    æ›´æ–°è´¨æ£€è®°å½•
GET    /api/mobile/processing/quality/statistics         è´¨æ£€ç»Ÿè®¡æ•°æ®
GET    /api/mobile/processing/quality/trends             è´¨é‡è¶‹åŠ¿åˆ†æ
```

#### 5.2.3 å‘˜å·¥å·¥ä½œAPI (7ä¸ª)

```
POST   /api/mobile/timeclock/clock-in                    ä¸Šç­æ‰“å¡
POST   /api/mobile/timeclock/clock-out                   ä¸‹ç­æ‰“å¡
GET    /api/mobile/timeclock/status                      å½“å‰æ‰“å¡çŠ¶æ€
GET    /api/mobile/timeclock/history                     æ‰“å¡å†å²è®°å½•
GET    /api/mobile/time-stats/daily                      æ—¥å·¥æ—¶ç»Ÿè®¡
GET    /api/mobile/time-stats/weekly                     å‘¨å·¥æ—¶ç»Ÿè®¡
GET    /api/mobile/time-stats/monthly                    æœˆå·¥æ—¶ç»Ÿè®¡
```

#### 5.2.4 è®¾å¤‡ç›‘æ§API (5ä¸ª)

```
GET    /api/mobile/processing/equipment/monitoring       è®¾å¤‡å®æ—¶ç›‘æ§åˆ—è¡¨
GET    /api/mobile/processing/equipment/:id/metrics      è®¾å¤‡å†å²æŒ‡æ ‡æ•°æ®
POST   /api/mobile/processing/equipment/:id/data         ä¸ŠæŠ¥è®¾å¤‡ç›‘æ§æ•°æ®
GET    /api/mobile/processing/equipment/alerts           è®¾å¤‡å‘Šè­¦åˆ—è¡¨
GET    /api/mobile/processing/equipment/:id/status       å•ä¸ªè®¾å¤‡çŠ¶æ€
```

#### 5.2.5 æˆæœ¬åˆ†æAPI (3ä¸ª)

```
GET    /api/mobile/processing/batches/:id/cost-analysis  æ‰¹æ¬¡æˆæœ¬åˆ†æ
POST   /api/mobile/processing/batches/:id/recalculate-cost é‡æ–°è®¡ç®—æˆæœ¬
POST   /api/mobile/analysis/deepseek                     AIæˆæœ¬åˆ†æ (ğŸŸ¡ Mock)
```

#### 5.2.6 ç”Ÿäº§ä»ªè¡¨æ¿API (6ä¸ª)

```
GET    /api/mobile/processing/dashboard/overview         ä»ªè¡¨æ¿æ¦‚è§ˆæ•°æ®
GET    /api/mobile/processing/dashboard/production       ç”Ÿäº§ç»Ÿè®¡
GET    /api/mobile/processing/dashboard/quality          è´¨é‡ç»Ÿè®¡
GET    /api/mobile/processing/dashboard/equipment        è®¾å¤‡çŠ¶æ€ç»Ÿè®¡
GET    /api/mobile/processing/dashboard/alerts           å‘Šè­¦ç»Ÿè®¡
GET    /api/mobile/processing/dashboard/trends           è¶‹åŠ¿åˆ†æ
```

#### 5.2.7 å‘Šè­¦ç®¡ç†API (6ä¸ª)

```
GET    /api/mobile/alerts                                æ‰€æœ‰å‘Šè­¦åˆ—è¡¨
POST   /api/mobile/alerts/:id/acknowledge                ç¡®è®¤å‘Šè­¦
POST   /api/mobile/alerts/:id/resolve                    è§£å†³å‘Šè­¦
GET    /api/mobile/alerts/statistics                     å‘Šè­¦ç»Ÿè®¡æ•°æ®
GET    /api/mobile/alerts/summary                        å‘Šè­¦æ‘˜è¦
```

### 5.3 APIè¯·æ±‚/å“åº”ç¤ºä¾‹

è¯¦è§å„å­æ¨¡å—çš„APIä½¿ç”¨ç¤ºä¾‹éƒ¨åˆ†ã€‚

---

## å‰ç«¯é¡µé¢è®¾è®¡

### 6.1 é¡µé¢æ€»è§ˆ

ç”Ÿäº§æ¨¡å—å…±éœ€å¼€å‘**20ä¸ªå‰ç«¯é¡µé¢**,å½“å‰ä»…å®Œæˆ**5ä¸ªé¡µé¢**(25%å®Œæˆåº¦)ã€‚

**é¡µé¢åˆ†ç±»**:

| æ¨¡å— | é¡µé¢æ•° | å·²å®Œæˆ | å¾…å¼€å‘ | ä¼˜å…ˆçº§ |
|-----|--------|--------|--------|--------|
| **æ‰¹æ¬¡ç®¡ç†** | 5 | 0 | 5 | P0 |
| **è´¨é‡æ£€éªŒ** | 4 | 0 | 4 | P0 |
| **å‘˜å·¥å·¥ä½œ** | 3 | 2 | 1 | P1 |
| **è®¾å¤‡ç›‘æ§** | 4 | 0 | 4 | P1 |
| **æˆæœ¬åˆ†æ** | 3 | 1 | 2 | P1 |
| **ç”Ÿäº§ä»ªè¡¨æ¿** | 2 | 1 | 1 | P0 |
| **æ•°æ®å¯¼å‡º** | 1 | 0 | 1 | P2 |
| **æ€»è®¡** | **22** | **4** | **18** | - |

### 6.2 æ‰¹æ¬¡ç®¡ç†é¡µé¢ (5é¡µ)

#### 6.2.1 BatchListScreen - æ‰¹æ¬¡åˆ—è¡¨é¡µ

**è·¯å¾„**: `/src/screens/processing/batch/BatchListScreen.tsx`

**åŠŸèƒ½æ¸…å•**:
- [ ] æ‰¹æ¬¡åˆ—è¡¨å±•ç¤º(å¡ç‰‡å¼å¸ƒå±€)
- [ ] ä¸‹æ‹‰åˆ·æ–°
- [ ] ä¸Šæ‹‰åŠ è½½æ›´å¤š(åˆ†é¡µ,æ¯é¡µ20æ¡)
- [ ] çŠ¶æ€ç­›é€‰æ ‡ç­¾é¡µ(å…¨éƒ¨/è¿›è¡Œä¸­/å·²å®Œæˆç­‰)
- [ ] æ—¥æœŸèŒƒå›´ç­›é€‰
- [ ] æœç´¢(æ‰¹æ¬¡å·ã€äº§å“ç±»å‹)
- [ ] æ’åº(æŒ‰å¼€å§‹æ—¶é—´ã€çŠ¶æ€ã€äº§é‡)
- [ ] å¿«æ·æ“ä½œæŒ‰é’®(å¼€å§‹ç”Ÿäº§ã€æŸ¥çœ‹è¯¦æƒ…)
- [ ] ç©ºçŠ¶æ€æç¤º

**UIç»„ä»¶**:
```typescript
<View style={styles.container}>
  {/* é¡¶éƒ¨æœç´¢æ  */}
  <SearchBar
    placeholder="æœç´¢æ‰¹æ¬¡å·æˆ–äº§å“ç±»å‹..."
    onSearch={handleSearch}
    onClear={clearSearch}
  />

  {/* çŠ¶æ€ç­›é€‰æ ‡ç­¾é¡µ */}
  <ScrollView horizontal showsHorizontalScrollIndicator={false}>
    <FilterTabs
      tabs={[
        { key: 'all', label: 'å…¨éƒ¨', count: totalCount },
        { key: 'planning', label: 'è®¡åˆ’ä¸­', count: planningCount },
        { key: 'in_progress', label: 'è¿›è¡Œä¸­', count: inProgressCount },
        { key: 'completed', label: 'å·²å®Œæˆ', count: completedCount }
      ]}
      activeTab={activeTab}
      onTabChange={setActiveTab}
    />
  </ScrollView>

  {/* é«˜çº§ç­›é€‰æŒ‰é’® */}
  <TouchableOpacity onPress={showFilterModal}>
    <Icon name="filter" />
    <Text>ç­›é€‰</Text>
  </TouchableOpacity>

  {/* æ‰¹æ¬¡åˆ—è¡¨ */}
  <FlatList
    data={batches}
    renderItem={({ item }) => (
      <BatchCard
        batch={item}
        onPress={() => navigation.navigate('BatchDetail', { batchId: item.id })}
        onActionPress={handleQuickAction}
      />
    )}
    keyExtractor={item => item.id}
    onRefresh={handleRefresh}
    refreshing={isRefreshing}
    onEndReached={loadMore}
    onEndReachedThreshold={0.5}
    ListEmptyComponent={<EmptyState message="æš‚æ— æ‰¹æ¬¡æ•°æ®" />}
  />

  {/* åˆ›å»ºæ‰¹æ¬¡FAB */}
  <FAB
    icon="plus"
    onPress={() => navigation.navigate('BatchCreate')}
    style={styles.fab}
  />

  {/* ç­›é€‰å¼¹çª— */}
  <FilterModal
    visible={filterModalVisible}
    onClose={hideFilterModal}
    onApply={applyFilters}
  />
</View>
```

**é¡µé¢è·³è½¬**:
- â†’ `BatchDetailScreen` (ç‚¹å‡»æ‰¹æ¬¡å¡ç‰‡)
- â†’ `BatchCreateScreen` (ç‚¹å‡»åˆ›å»ºæŒ‰é’®)
- â†’ `BatchEditScreen` (å¿«æ·æ“ä½œ-ç¼–è¾‘)

**æ•°æ®åŠ è½½**:
```typescript
// APIè°ƒç”¨
const fetchBatches = async (page = 1, status = '', search = '') => {
  const response = await apiClient.get('/api/mobile/processing/batches', {
    params: {
      page,
      limit: 20,
      status,
      search,
      orderBy: 'startDate',
      order: 'desc'
    }
  });

  return response.data.batches;
};
```

---

#### 6.2.2 BatchDetailScreen - æ‰¹æ¬¡è¯¦æƒ…é¡µ

**è·¯å¾„**: `/src/screens/processing/batch/BatchDetailScreen.tsx`

**åŠŸèƒ½æ¸…å•**:
- [ ] æ‰¹æ¬¡åŸºæœ¬ä¿¡æ¯å±•ç¤º
- [ ] æ‰¹æ¬¡çŠ¶æ€æµè½¬å¯è§†åŒ–
- [ ] äº§é‡è¿›åº¦æ¡
- [ ] æˆæœ¬æ„æˆé¥¼å›¾
- [ ] å…³è”è´¨æ£€è®°å½•åˆ—è¡¨
- [ ] å…³è”å·¥æ—¶è®°å½•åˆ—è¡¨
- [ ] å…³è”è®¾å¤‡ä½¿ç”¨è®°å½•
- [ ] æ‰¹æ¬¡æ—¶é—´çº¿(å¯å±•å¼€)
- [ ] æ“ä½œæŒ‰é’®ç»„(æ ¹æ®çŠ¶æ€å’Œæƒé™åŠ¨æ€æ˜¾ç¤º)
- [ ] ç¼–è¾‘æŒ‰é’®(ä»…planningçŠ¶æ€å¯ç¼–è¾‘)

**UIå¸ƒå±€**:
```typescript
<ScrollView style={styles.container}>
  {/* å¤´éƒ¨:æ‰¹æ¬¡å·+çŠ¶æ€ */}
  <BatchHeader batch={batch}>
    <Text style={styles.batchNumber}>{batch.batchNumber}</Text>
    <StatusBadge status={batch.status} />
    <Text style={styles.productType}>{batch.productType}</Text>
  </BatchHeader>

  {/* çŠ¶æ€æµè½¬å¯è§†åŒ– */}
  <BatchStatusFlow currentStatus={batch.status} />

  {/* åŸºæœ¬ä¿¡æ¯å¡ç‰‡ */}
  <Card title="åŸºæœ¬ä¿¡æ¯">
    <InfoRow label="è´Ÿè´£äºº" value={batch.supervisor?.fullName} />
    <InfoRow label="ç”Ÿäº§çº¿" value={batch.productionLine} />
    <InfoRow label="å¼€å§‹æ—¥æœŸ" value={formatDate(batch.startDate)} />
    <InfoRow label="ç»“æŸæ—¥æœŸ" value={formatDate(batch.endDate)} />
  </Card>

  {/* äº§é‡ä¿¡æ¯å¡ç‰‡ */}
  <Card title="äº§é‡ä¿¡æ¯">
    <ProgressBar
      label="ç”Ÿäº§è¿›åº¦"
      current={batch.actualQuantity}
      target={batch.targetQuantity}
      unit="kg"
      color={getProgressColor(batch.actualQuantity / batch.targetQuantity)}
    />
    <InfoRow label="ç›®æ ‡äº§é‡" value={`${batch.targetQuantity} kg`} />
    <InfoRow label="å®é™…äº§é‡" value={`${batch.actualQuantity || 0} kg`} />
    <InfoRow label="è´¨é‡ç­‰çº§" value={batch.qualityGrade || '-'} />
  </Card>

  {/* æˆæœ¬åˆ†æå¡ç‰‡ */}
  <Card title="æˆæœ¬åˆ†æ">
    <CostPieChart
      data={[
        { label: 'åŸæ–™', value: batch.rawMaterialCost, color: '#FF6B6B' },
        { label: 'äººå·¥', value: batch.laborCost, color: '#4ECDC4' },
        { label: 'è®¾å¤‡', value: batch.equipmentCost, color: '#45B7D1' },
      ]}
    />
    <InfoRow label="æ€»æˆæœ¬" value={`Â¥${batch.totalCost?.toFixed(2)}`} bold />
    <InfoRow label="å•ä½æˆæœ¬" value={`Â¥${batch.costPerKg?.toFixed(2)}/kg`} />
    <TouchableOpacity onPress={navigateToCostDetail}>
      <Text style={styles.link}>æŸ¥çœ‹æˆæœ¬è¯¦æƒ… â†’</Text>
    </TouchableOpacity>
  </Card>

  {/* è´¨æ£€è®°å½•å¡ç‰‡ */}
  <Card title="è´¨æ£€è®°å½•">
    {batch.qualityInspections?.length > 0 ? (
      batch.qualityInspections.map(inspection => (
        <InspectionItem
          key={inspection.id}
          inspection={inspection}
          onPress={() => navigateToInspectionDetail(inspection.id)}
        />
      ))
    ) : (
      <EmptyState message="æš‚æ— è´¨æ£€è®°å½•" />
    )}
    <TouchableOpacity onPress={createInspection}>
      <Text style={styles.link}>+ åˆ›å»ºè´¨æ£€è®°å½•</Text>
    </TouchableOpacity>
  </Card>

  {/* å·¥æ—¶è®°å½•å¡ç‰‡ */}
  <Card title="å·¥æ—¶è®°å½•">
    <InfoRow label="æ€»å·¥æ—¶" value={`${totalHours} å°æ—¶`} />
    <InfoRow label="å‚ä¸å‘˜å·¥" value={`${employeeCount} äºº`} />
    <TouchableOpacity onPress={viewWorkSessions}>
      <Text style={styles.link}>æŸ¥çœ‹è¯¦ç»†å·¥æ—¶ â†’</Text>
    </TouchableOpacity>
  </Card>

  {/* æ‰¹æ¬¡æ—¶é—´çº¿(å¯æŠ˜å ) */}
  <Card title="æ‰¹æ¬¡æ—¶é—´çº¿" collapsible>
    <Timeline events={batch.timeline} />
  </Card>

  {/* å¤‡æ³¨ */}
  {batch.notes && (
    <Card title="å¤‡æ³¨">
      <Text>{batch.notes}</Text>
    </Card>
  )}
</ScrollView>

{/* åº•éƒ¨æ“ä½œæŒ‰é’®ç»„ */}
<ActionButtonGroup>
  {canEdit && (
    <Button
      mode="outlined"
      onPress={navigateToEdit}
      icon="pencil"
    >
      ç¼–è¾‘
    </Button>
  )}
  {canStart && (
    <Button
      mode="contained"
      onPress={startProduction}
      icon="play"
    >
      å¼€å§‹ç”Ÿäº§
    </Button>
  )}
  {canPause && (
    <Button
      mode="outlined"
      onPress={pauseProduction}
      icon="pause"
    >
      æš‚åœ
    </Button>
  )}
  {canComplete && (
    <Button
      mode="contained"
      onPress={completeProduction}
      icon="check"
    >
      å®Œæˆç”Ÿäº§
    </Button>
  )}
</ActionButtonGroup>
```

**æƒé™æ§åˆ¶**:
```typescript
// æ ¹æ®æ‰¹æ¬¡çŠ¶æ€å’Œç”¨æˆ·æƒé™å†³å®šå¯è§æŒ‰é’®
const canEdit = batch.status === 'planning' && hasPermission('batch:edit');
const canStart = batch.status === 'planning' && hasPermission('batch:start');
const canPause = batch.status === 'in_progress' && hasPermission('batch:pause');
const canComplete = batch.status === 'in_progress' && hasPermission('batch:complete');
```

**é¡µé¢è·³è½¬**:
- â†’ `BatchEditScreen` (ç¼–è¾‘æŒ‰é’®)
- â†’ `BatchTimelineScreen` (æŸ¥çœ‹æ—¶é—´çº¿)
- â†’ `BatchCostDetailScreen` (æŸ¥çœ‹æˆæœ¬è¯¦æƒ…)
- â†’ `QualityInspectionDetailScreen` (æŸ¥çœ‹è´¨æ£€è¯¦æƒ…)
- â†’ `QualityInspectionCreateScreen` (åˆ›å»ºè´¨æ£€)

---

#### 6.2.3 BatchCreateScreen - åˆ›å»ºæ‰¹æ¬¡é¡µ

**è·¯å¾„**: `/src/screens/processing/batch/BatchCreateScreen.tsx`

**åŠŸèƒ½æ¸…å•**:
- [ ] è¡¨å•éªŒè¯(å¿…å¡«é¡¹æ£€æŸ¥)
- [ ] äº§å“ç±»å‹é€‰æ‹©å™¨(Picker)
- [ ] åŸææ–™å¤šé€‰
- [ ] æ•°é‡è¾“å…¥(æ•°å­—é”®ç›˜)
- [ ] ç”Ÿäº§çº¿é€‰æ‹©
- [ ] è´Ÿè´£äººé€‰æ‹©(éƒ¨é—¨ç­›é€‰)
- [ ] å¼€å§‹æ—¥æœŸé€‰æ‹©(DatePicker)
- [ ] å¤‡æ³¨è¾“å…¥(å¤šè¡Œæ–‡æœ¬)
- [ ] æäº¤å‰ç¡®è®¤å¼¹çª—
- [ ] åŠ è½½çŠ¶æ€æ˜¾ç¤º

**è¡¨å•å­—æ®µ**:
```typescript
interface BatchFormData {
  productType: string;        // äº§å“ç±»å‹ (å¿…å¡«)
  productCategory: string;    // äº§å“åˆ†ç±» (å¿…å¡«)
  rawMaterials: RawMaterial[]; // åŸææ–™åˆ—è¡¨ (å¿…å¡«)
  targetQuantity: number;     // ç›®æ ‡äº§é‡ (å¿…å¡«)
  productionLine: string;     // ç”Ÿäº§çº¿ (å¿…å¡«)
  supervisorId: number;       // è´Ÿè´£äººID (å¿…å¡«)
  startDate: Date;            // å¼€å§‹æ—¥æœŸ (å¿…å¡«)
  expectedPrice?: number;     // é¢„æœŸå”®ä»· (å¯é€‰)
  notes?: string;             // å¤‡æ³¨ (å¯é€‰)
}

// è¡¨å•éªŒè¯è§„åˆ™
const validationSchema = {
  productType: { required: true, message: 'è¯·é€‰æ‹©äº§å“ç±»å‹' },
  rawMaterials: { required: true, minLength: 1, message: 'è¯·è‡³å°‘æ·»åŠ ä¸€ç§åŸææ–™' },
  targetQuantity: { required: true, min: 1, message: 'ç›®æ ‡äº§é‡å¿…é¡»å¤§äº0' },
  productionLine: { required: true, message: 'è¯·é€‰æ‹©ç”Ÿäº§çº¿' },
  supervisorId: { required: true, message: 'è¯·é€‰æ‹©è´Ÿè´£äºº' },
  startDate: { required: true, message: 'è¯·é€‰æ‹©å¼€å§‹æ—¥æœŸ' }
};
```

**UIç»„ä»¶**:
```typescript
<KeyboardAvoidingView>
  <ScrollView>
    <Form>
      {/* äº§å“ç±»å‹ */}
      <FormField label="äº§å“ç±»å‹*" error={errors.productType}>
        <Picker
          items={PRODUCT_TYPES}
          selectedValue={formData.productType}
          onValueChange={value => setFormData({ ...formData, productType: value })}
        />
      </FormField>

      {/* åŸææ–™é€‰æ‹© */}
      <FormField label="åŸææ–™*" error={errors.rawMaterials}>
        <RawMaterialSelector
          selectedMaterials={formData.rawMaterials}
          onSelectionChange={handleMaterialsChange}
        />
        <TouchableOpacity onPress={addMaterial}>
          <Text style={styles.addButton}>+ æ·»åŠ åŸææ–™</Text>
        </TouchableOpacity>
      </FormField>

      {/* ç›®æ ‡äº§é‡ */}
      <FormField label="ç›®æ ‡äº§é‡(kg)*" error={errors.targetQuantity}>
        <TextInput
          keyboardType="numeric"
          placeholder="è¯·è¾“å…¥ç›®æ ‡äº§é‡"
          value={formData.targetQuantity?.toString()}
          onChangeText={value => setFormData({ ...formData, targetQuantity: Number(value) })}
        />
      </FormField>

      {/* ç”Ÿäº§çº¿ */}
      <FormField label="ç”Ÿäº§çº¿*" error={errors.productionLine}>
        <Picker
          items={PRODUCTION_LINES}
          selectedValue={formData.productionLine}
          onValueChange={value => setFormData({ ...formData, productionLine: value })}
        />
      </FormField>

      {/* è´Ÿè´£äºº */}
      <FormField label="è´Ÿè´£äºº*" error={errors.supervisorId}>
        <UserPicker
          department="processing"
          role={['department_admin', 'operator']}
          selectedUserId={formData.supervisorId}
          onSelect={user => setFormData({ ...formData, supervisorId: user.id })}
        />
      </FormField>

      {/* å¼€å§‹æ—¥æœŸ */}
      <FormField label="å¼€å§‹æ—¥æœŸ*" error={errors.startDate}>
        <DatePicker
          value={formData.startDate}
          onChange={date => setFormData({ ...formData, startDate: date })}
          minimumDate={new Date()}
        />
      </FormField>

      {/* é¢„æœŸå”®ä»· */}
      <FormField label="é¢„æœŸå”®ä»·(å…ƒ/kg)">
        <TextInput
          keyboardType="numeric"
          placeholder="å¯é€‰,ç”¨äºæˆæœ¬åˆ†æ"
          value={formData.expectedPrice?.toString()}
          onChangeText={value => setFormData({ ...formData, expectedPrice: Number(value) })}
        />
      </FormField>

      {/* å¤‡æ³¨ */}
      <FormField label="å¤‡æ³¨">
        <TextInput
          multiline
          numberOfLines={4}
          placeholder="è¯·è¾“å…¥å¤‡æ³¨ä¿¡æ¯"
          value={formData.notes}
          onChangeText={value => setFormData({ ...formData, notes: value })}
        />
      </FormField>
    </Form>
  </ScrollView>

  {/* åº•éƒ¨æäº¤æŒ‰é’® */}
  <View style={styles.footer}>
    <Button
      mode="outlined"
      onPress={handleCancel}
      disabled={isSubmitting}
    >
      å–æ¶ˆ
    </Button>
    <Button
      mode="contained"
      onPress={handleSubmit}
      disabled={!isFormValid || isSubmitting}
      loading={isSubmitting}
    >
      åˆ›å»ºæ‰¹æ¬¡
    </Button>
  </View>
</KeyboardAvoidingView>
```

**æäº¤é€»è¾‘**:
```typescript
const handleSubmit = async () => {
  // 1. è¡¨å•éªŒè¯
  const errors = validateForm(formData, validationSchema);
  if (Object.keys(errors).length > 0) {
    setErrors(errors);
    Alert.alert('æç¤º', 'è¯·æ£€æŸ¥è¡¨å•è¾“å…¥');
    return;
  }

  // 2. ç¡®è®¤å¼¹çª—
  Alert.alert(
    'ç¡®è®¤åˆ›å»ºæ‰¹æ¬¡?',
    `äº§å“ç±»å‹: ${formData.productType}\nç›®æ ‡äº§é‡: ${formData.targetQuantity} kg`,
    [
      { text: 'å–æ¶ˆ', style: 'cancel' },
      { text: 'ç¡®è®¤', onPress: submitForm }
    ]
  );
};

const submitForm = async () => {
  setIsSubmitting(true);
  try {
    // 3. APIè°ƒç”¨
    const response = await apiClient.post('/api/mobile/processing/batches', formData);

    // 4. æˆåŠŸæç¤º
    Alert.alert('æˆåŠŸ', 'æ‰¹æ¬¡åˆ›å»ºæˆåŠŸ', [
      { text: 'ç¡®å®š', onPress: () => navigation.goBack() }
    ]);
  } catch (error) {
    Alert.alert('é”™è¯¯', error.message || 'åˆ›å»ºå¤±è´¥,è¯·é‡è¯•');
  } finally {
    setIsSubmitting(false);
  }
};
```

**é¡µé¢è·³è½¬**:
- â†’ `BatchListScreen` (åˆ›å»ºæˆåŠŸåè¿”å›)
- â†’ `BatchDetailScreen` (åˆ›å»ºæˆåŠŸå¯é€‰è·³è½¬åˆ°è¯¦æƒ…)

---

#### 6.2.4 BatchEditScreen - ç¼–è¾‘æ‰¹æ¬¡é¡µ

**è·¯å¾„**: `/src/screens/processing/batch/BatchEditScreen.tsx`

**åŠŸèƒ½æ¸…å•**:
- [ ] åŠ è½½ç°æœ‰æ‰¹æ¬¡æ•°æ®
- [ ] è¡¨å•é¢„å¡«å……
- [ ] ä»…å…è®¸ä¿®æ”¹éƒ¨åˆ†å­—æ®µ(æ ¹æ®çŠ¶æ€)
- [ ] è¡¨å•éªŒè¯
- [ ] ä¿å­˜å˜æ›´
- [ ] å–æ¶ˆç¼–è¾‘ç¡®è®¤

**ç¼–è¾‘è§„åˆ™**:
```typescript
// planningçŠ¶æ€:æ‰€æœ‰å­—æ®µå¯ç¼–è¾‘
const editableFieldsForPlanning = [
  'productType', 'rawMaterials', 'targetQuantity',
  'productionLine', 'supervisorId', 'startDate', 'notes'
];

// in_progressçŠ¶æ€:ä»…éƒ¨åˆ†å­—æ®µå¯ç¼–è¾‘
const editableFieldsForInProgress = [
  'actualQuantity', 'notes'
];

// completed/failedçŠ¶æ€:ä¸å…è®¸ç¼–è¾‘
const editableFieldsForCompleted = [];
```

**UIä¸BatchCreateScreenç±»ä¼¼,åŒºåˆ«**:
- è¡¨å•é¢„å¡«å……ç°æœ‰æ•°æ®
- æ ¹æ®çŠ¶æ€ç¦ç”¨éƒ¨åˆ†å­—æ®µ
- ä¿å­˜æŒ‰é’®æ–‡æ¡ˆä¸º"ä¿å­˜ä¿®æ”¹"

---

#### 6.2.5 BatchTimelineScreen - æ‰¹æ¬¡æ—¶é—´çº¿é¡µ

**è·¯å¾„**: `/src/screens/processing/batch/BatchTimelineScreen.tsx`

**åŠŸèƒ½æ¸…å•**:
- [ ] æ—¶é—´çº¿å¯è§†åŒ–å±•ç¤º
- [ ] äº‹ä»¶è¯¦æƒ…æŸ¥çœ‹
- [ ] æŒ‰æ—¶é—´æ’åº(æœ€æ–°åœ¨ä¸Š)
- [ ] äº‹ä»¶ç±»å‹å›¾æ ‡åŒºåˆ†
- [ ] æ”¯æŒåˆ·æ–°åŠ è½½æœ€æ–°äº‹ä»¶

**äº‹ä»¶ç±»å‹**:
```typescript
const EVENT_TYPES = {
  CREATED: { label: 'åˆ›å»ºæ‰¹æ¬¡', icon: 'file-plus', color: '#4ECDC4' },
  STARTED: { label: 'å¼€å§‹ç”Ÿäº§', icon: 'play', color: '#45B7D1' },
  PAUSED: { label: 'æš‚åœç”Ÿäº§', icon: 'pause', color: '#FFA07A' },
  RESUMED: { label: 'æ¢å¤ç”Ÿäº§', icon: 'play', color: '#45B7D1' },
  QUALITY_CHECK: { label: 'è´¨æ£€', icon: 'check-circle', color: '#95E1D3' },
  QUALITY_PASS: { label: 'è´¨æ£€é€šè¿‡', icon: 'check-circle', color: '#50C878' },
  QUALITY_FAIL: { label: 'è´¨æ£€ä¸é€šè¿‡', icon: 'x-circle', color: '#FF6B6B' },
  COMPLETED: { label: 'å®Œæˆç”Ÿäº§', icon: 'check', color: '#50C878' },
  FAILED: { label: 'ç”Ÿäº§å¤±è´¥', icon: 'x', color: '#FF6B6B' },
  UPDATED: { label: 'æ›´æ–°ä¿¡æ¯', icon: 'edit', color: '#95A5A6' }
};
```

**UIç»„ä»¶**:
```typescript
<ScrollView style={styles.container}>
  <Timeline>
    {events.map((event, index) => (
      <TimelineItem
        key={event.id}
        isFirst={index === 0}
        isLast={index === events.length - 1}
      >
        <TimelineDot
          icon={EVENT_TYPES[event.type].icon}
          color={EVENT_TYPES[event.type].color}
        />
        <TimelineContent>
          <Text style={styles.eventType}>
            {EVENT_TYPES[event.type].label}
          </Text>
          <Text style={styles.eventTime}>
            {formatDateTime(event.timestamp)}
          </Text>
          {event.description && (
            <Text style={styles.eventDetail}>
              {event.description}
            </Text>
          )}
          {event.operator && (
            <Text style={styles.operator}>
              æ“ä½œäºº: {event.operator.fullName}
            </Text>
          )}
          {event.metadata && (
            <View style={styles.metadata}>
              {Object.entries(event.metadata).map(([key, value]) => (
                <Text key={key} style={styles.metadataItem}>
                  {key}: {value}
                </Text>
              ))}
            </View>
          )}
        </TimelineContent>
      </TimelineItem>
    ))}
  </Timeline>
</ScrollView>
```

---

### 6.3 è´¨é‡æ£€éªŒé¡µé¢ (4é¡µ)

#### 6.3.1 QualityInspectionListScreen - è´¨æ£€åˆ—è¡¨é¡µ

**è·¯å¾„**: `/src/screens/quality/QualityInspectionListScreen.tsx`

**åŠŸèƒ½æ¸…å•**:
- [ ] è´¨æ£€è®°å½•åˆ—è¡¨å±•ç¤º
- [ ] æŒ‰è´¨æ£€ç±»å‹ç­›é€‰(åŸæ–™/è¿‡ç¨‹/æˆå“)
- [ ] æŒ‰è´¨æ£€ç»“æœç­›é€‰(åˆæ ¼/ä¸åˆæ ¼/æ¡ä»¶åˆæ ¼)
- [ ] æœç´¢(æ‰¹æ¬¡å·ã€æ£€æµ‹å‘˜)
- [ ] ä¸‹æ‹‰åˆ·æ–°ã€ä¸Šæ‹‰åŠ è½½æ›´å¤š
- [ ] æŸ¥çœ‹è´¨æ£€è¯¦æƒ…
- [ ] åˆ›å»ºè´¨æ£€è®°å½•

**UIç»„ä»¶**:
```typescript
<View style={styles.container}>
  <SearchBar placeholder="æœç´¢æ‰¹æ¬¡å·æˆ–æ£€æµ‹å‘˜..." />

  <FilterTabs
    tabs={[
      { key: 'all', label: 'å…¨éƒ¨' },
      { key: 'raw_material', label: 'åŸæ–™è´¨æ£€' },
      { key: 'process', label: 'è¿‡ç¨‹è´¨æ£€' },
      { key: 'final_product', label: 'æˆå“è´¨æ£€' }
    ]}
  />

  <FlatList
    data={inspections}
    renderItem={({ item }) => (
      <InspectionCard
        inspection={item}
        onPress={() => navigateToDetail(item.id)}
      />
    )}
  />

  <FAB
    icon="clipboard-check"
    onPress={() => navigation.navigate('QualityInspectionCreate')}
  />
</View>
```

---

#### 6.3.2 QualityInspectionCreateScreen - åˆ›å»ºè´¨æ£€é¡µ

**è·¯å¾„**: `/src/screens/quality/QualityInspectionCreateScreen.tsx`

**åŠŸèƒ½æ¸…å•**:
- [ ] é€‰æ‹©æ‰¹æ¬¡(æ‰¹æ¬¡é€‰æ‹©å™¨)
- [ ] é€‰æ‹©è´¨æ£€ç±»å‹(åŸæ–™/è¿‡ç¨‹/æˆå“)
- [ ] æ ¹æ®è´¨æ£€ç±»å‹åŠ è½½æ£€æµ‹é¡¹æ¨¡æ¿
- [ ] å½•å…¥æ£€æµ‹ç»“æœ
- [ ] æ‹ç…§ä¸Šä¼ (æœ€å¤š10å¼ )
- [ ] ä¸åˆæ ¼é¡¹è®°å½•
- [ ] çº æ­£æªæ–½è®°å½•
- [ ] è´¨æ£€ç»“æœè‡ªåŠ¨åˆ¤å®š
- [ ] æäº¤è´¨æ£€

**è¡¨å•å­—æ®µ**:
```typescript
interface QualityInspectionFormData {
  batchId: string;              // æ‰¹æ¬¡ID
  inspectionType: InspectionType; // è´¨æ£€ç±»å‹
  testItems: TestItem[];        // æ£€æµ‹é¡¹åˆ—è¡¨
  overallResult: InspectionResult; // æ€»ä½“ç»“æœ(è‡ªåŠ¨åˆ¤å®š)
  qualityScore: number;         // è´¨é‡è¯„åˆ†(è‡ªåŠ¨è®¡ç®—)
  defectDetails?: string;       // ç¼ºé™·è¯¦æƒ…
  defectTypes?: string[];       // ç¼ºé™·ç±»å‹
  correctiveActions?: string;   // çº æ­£æªæ–½
  photos: string[];             // ç…§ç‰‡URLåˆ—è¡¨
  notes?: string;               // å¤‡æ³¨
}
```

**æ£€æµ‹é¡¹è¾“å…¥**:
```typescript
<View>
  <FormField label="è´¨æ£€ç±»å‹*">
    <SegmentedControl
      values={['åŸæ–™è´¨æ£€', 'è¿‡ç¨‹è´¨æ£€', 'æˆå“è´¨æ£€']}
      selectedIndex={inspectionTypeIndex}
      onChange={handleInspectionTypeChange}
    />
  </FormField>

  <FormField label="æ£€æµ‹é¡¹">
    {testItems.map((item, index) => (
      <TestItemInput
        key={index}
        item={item}
        onChange={value => updateTestItem(index, value)}
      />
    ))}
  </FormField>

  <FormField label="ç…§ç‰‡ä¸Šä¼ ">
    <PhotoUploader
      photos={formData.photos}
      onPhotosChange={setPhotos}
      maxPhotos={10}
    />
  </FormField>

  {/* ä¸åˆæ ¼æ—¶æ˜¾ç¤º */}
  {hasDefects && (
    <>
      <FormField label="ç¼ºé™·è¯¦æƒ…*">
        <TextInput
          multiline
          placeholder="è¯·æè¿°å…·ä½“ç¼ºé™·..."
        />
      </FormField>
      <FormField label="çº æ­£æªæ–½*">
        <TextInput
          multiline
          placeholder="è¯·è¯´æ˜çº æ­£æªæ–½..."
        />
      </FormField>
    </>
  )}
</View>
```

---

#### 6.3.3 QualityInspectionDetailScreen - è´¨æ£€è¯¦æƒ…é¡µ

**åŠŸèƒ½æ¸…å•**:
- [ ] è´¨æ£€åŸºæœ¬ä¿¡æ¯å±•ç¤º
- [ ] æ£€æµ‹é¡¹ç»“æœå±•ç¤º
- [ ] ç…§ç‰‡æŸ¥çœ‹(æ”¯æŒæ”¾å¤§)
- [ ] è´¨æ£€è¯„åˆ†å¯è§†åŒ–
- [ ] ä¸åˆæ ¼é¡¹å±•ç¤º(å¦‚æœæœ‰)
- [ ] çº æ­£æªæ–½å±•ç¤º
- [ ] å…³è”æ‰¹æ¬¡ä¿¡æ¯

---

#### 6.3.4 QualityStatisticsScreen - è´¨æ£€ç»Ÿè®¡é¡µ

**åŠŸèƒ½æ¸…å•**:
- [ ] è´¨æ£€åˆæ ¼ç‡è¶‹åŠ¿å›¾(æŠ˜çº¿å›¾)
- [ ] ä¸åˆæ ¼é¡¹TOP10(æŸ±çŠ¶å›¾)
- [ ] è´¨æ£€å‘˜ç»©æ•ˆæ’å
- [ ] æŒ‰äº§å“ç±»å‹ç»Ÿè®¡
- [ ] æŒ‰æ—¶é—´æ®µç»Ÿè®¡(æ—¥/å‘¨/æœˆ)
- [ ] æ•°æ®å¯¼å‡º

**å›¾è¡¨ç»„ä»¶**:
```typescript
<ScrollView>
  <StatCard title="ä»Šæ—¥åˆæ ¼ç‡" value="98.5%" trend="+2.3%" />
  <StatCard title="æœ¬å‘¨è´¨æ£€æ¬¡æ•°" value="156" trend="+12" />

  <LineChart
    title="è´¨æ£€åˆæ ¼ç‡è¶‹åŠ¿(è¿‘7å¤©)"
    data={qualityTrends}
    yAxisSuffix="%"
  />

  <BarChart
    title="ä¸åˆæ ¼é¡¹TOP10"
    data={defectTypes}
    horizontal
  />

  <RankingList
    title="è´¨æ£€å‘˜ç»©æ•ˆæ’å"
    data={inspectorPerformance}
    renderItem={item => (
      <View>
        <Text>{item.name}</Text>
        <Text>åˆæ ¼ç‡: {item.passRate}%</Text>
        <Text>è´¨æ£€æ¬¡æ•°: {item.count}</Text>
      </View>
    )}
  />
</ScrollView>
```

---

### 6.4 å‘˜å·¥å·¥ä½œé¡µé¢ (3é¡µ)

#### 6.4.1 TimeClockScreen - æ‰“å¡ä¸»é¡µ (âœ… å·²å®Œæˆ)

**è·¯å¾„**: `/src/screens/timeclock/TimeClockScreen.tsx`

**ç°æœ‰åŠŸèƒ½**: ä¸Šç­/ä¸‹ç­æ‰“å¡ã€GPSä½ç½®è®°å½•ã€æ‰“å¡ç…§ç‰‡

---

#### 6.4.2 ClockHistoryScreen - æ‰“å¡å†å² (âœ… å·²å®Œæˆ)

**è·¯å¾„**: `/src/screens/timeclock/ClockHistoryScreen.tsx`

**ç°æœ‰åŠŸèƒ½**: å†å²æ‰“å¡è®°å½•æŸ¥è¯¢ã€æ—¥å†è§†å›¾

---

#### 6.4.3 WorkRecordScreen - å·¥ä½œè®°å½•é¡µ (âŒ å¾…å¼€å‘)

**è·¯å¾„**: `/src/screens/processing/WorkRecordScreen.tsx`

**åŠŸèƒ½æ¸…å•**:
- [ ] ä¸ªäººå·¥ä½œè®°å½•åˆ—è¡¨
- [ ] æŒ‰æ‰¹æ¬¡ç­›é€‰
- [ ] æŒ‰å·¥ä½œç±»å‹ç­›é€‰
- [ ] å·¥ä½œæ•ˆç‡ç»Ÿè®¡
- [ ] å·¥æ—¶æ˜ç»†
- [ ] å¯¼å‡ºå·¥ä½œæŠ¥è¡¨

---

### 6.5 è®¾å¤‡ç›‘æ§é¡µé¢ (4é¡µ)

#### 6.5.1 EquipmentListScreen - è®¾å¤‡åˆ—è¡¨é¡µ

**è·¯å¾„**: `/src/screens/equipment/EquipmentListScreen.tsx`

**åŠŸèƒ½æ¸…å•**:
- [ ] è®¾å¤‡åˆ—è¡¨å±•ç¤º
- [ ] è®¾å¤‡çŠ¶æ€ç­›é€‰(æ­£å¸¸/è­¦å‘Š/æ•…éšœ/ç»´æŠ¤ä¸­)
- [ ] è®¾å¤‡ç±»å‹ç­›é€‰
- [ ] è®¾å¤‡å®æ—¶çŠ¶æ€æŒ‡ç¤ºç¯
- [ ] å¿«é€ŸæŸ¥çœ‹è®¾å¤‡è¯¦æƒ…
- [ ] è·³è½¬åˆ°å®æ—¶ç›‘æ§

---

#### 6.5.2 EquipmentMonitoringScreen - å®æ—¶ç›‘æ§é¡µ

**è·¯å¾„**: `/src/screens/equipment/EquipmentMonitoringScreen.tsx`

**åŠŸèƒ½æ¸…å•**:
- [ ] å¤šè®¾å¤‡ç›‘æ§é¢æ¿
- [ ] å®æ—¶å‚æ•°å±•ç¤º(æ¸©åº¦/æ¹¿åº¦/å‹åŠ›/è¿è¡Œæ—¶é•¿)
- [ ] å®æ—¶æ›²çº¿å›¾
- [ ] çŠ¶æ€æŒ‡ç¤ºç¯(æ­£å¸¸/è­¦å‘Š/æ•…éšœ)
- [ ] å¼‚å¸¸å‘Šè­¦æç¤º
- [ ] è‡ªåŠ¨åˆ·æ–°(æ¯30ç§’)
- [ ] æ‰‹åŠ¨åˆ·æ–°

**UIç»„ä»¶**:
```typescript
<ScrollView>
  <RefreshControl onRefresh={fetchData} />

  {equipmentList.map(equipment => (
    <MonitoringCard key={equipment.id}>
      <EquipmentHeader>
        <Text>{equipment.equipmentName}</Text>
        <StatusIndicator status={equipment.status} />
      </EquipmentHeader>

      <MetricsGrid>
        <MetricItem
          label="æ¸©åº¦"
          value={equipment.metrics.temperature}
          unit="Â°C"
          isNormal={checkRange(equipment.metrics.temperature, equipment.tempRange)}
        />
        <MetricItem label="æ¹¿åº¦" value={equipment.metrics.humidity} unit="%" />
        <MetricItem label="å‹åŠ›" value={equipment.metrics.pressure} unit="Pa" />
        <MetricItem label="è¿è¡Œæ—¶é•¿" value={equipment.metrics.runtime} unit="h" />
      </MetricsGrid>

      <RealtimeChart
        data={equipment.historyData}
        interval={30000}
      />
    </MonitoringCard>
  ))}
</ScrollView>
```

---

#### 6.5.3 EquipmentDetailScreen - è®¾å¤‡è¯¦æƒ…é¡µ

**åŠŸèƒ½æ¸…å•**:
- [ ] è®¾å¤‡åŸºæœ¬ä¿¡æ¯
- [ ] è®¾å¤‡è§„æ ¼å‚æ•°
- [ ] è¿è¡ŒçŠ¶æ€å†å²
- [ ] ç»´æŠ¤è®°å½•
- [ ] ä½¿ç”¨è®°å½•
- [ ] å‘Šè­¦å†å²
- [ ] æŠ¥ä¿®åŠŸèƒ½

---

#### 6.5.4 EquipmentAlertsScreen - è®¾å¤‡å‘Šè­¦é¡µ

**åŠŸèƒ½æ¸…å•**:
- [ ] å‘Šè­¦åˆ—è¡¨
- [ ] æŒ‰ä¸¥é‡ç¨‹åº¦ç­›é€‰(critical/high/medium/low)
- [ ] æŒ‰çŠ¶æ€ç­›é€‰(active/acknowledged/resolved)
- [ ] å‘Šè­¦è¯¦æƒ…æŸ¥çœ‹
- [ ] å‘Šè­¦ç¡®è®¤
- [ ] å‘Šè­¦å¤„ç†è®°å½•

**å‘Šè­¦å¡ç‰‡**:
```typescript
<AlertCard alert={alert}>
  <SeverityBadge severity={alert.severity} />
  <Text style={styles.title}>{alert.title}</Text>
  <Text>{alert.message}</Text>
  <Text>è®¾å¤‡: {alert.equipment?.name}</Text>
  <Text>æ—¶é—´: {formatDateTime(alert.triggeredAt)}</Text>

  {alert.status === 'active' && (
    <Button onPress={() => acknowledgeAlert(alert.id)}>
      ç¡®è®¤å‘Šè­¦
    </Button>
  )}
  {alert.status === 'acknowledged' && (
    <Button onPress={() => resolveAlert(alert.id)}>
      æ ‡è®°å·²è§£å†³
    </Button>
  )}
</AlertCard>
```

---

### 6.6 æˆæœ¬åˆ†æé¡µé¢ (3é¡µ)

#### 6.6.1 CostAnalysisDashboard - æˆæœ¬ä»ªè¡¨æ¿ (âœ… å·²å®Œæˆ)

**è·¯å¾„**: `/src/screens/analysis/CostAnalysisDashboard.tsx`

**ç°æœ‰åŠŸèƒ½**: æˆæœ¬æ¦‚è§ˆã€æˆæœ¬è¶‹åŠ¿å›¾

---

#### 6.6.2 BatchCostDetailScreen - æ‰¹æ¬¡æˆæœ¬è¯¦æƒ…é¡µ (âŒ å¾…å¼€å‘)

**è·¯å¾„**: `/src/screens/analysis/BatchCostDetailScreen.tsx`

**åŠŸèƒ½æ¸…å•**:
- [ ] æˆæœ¬æ„æˆé¥¼å›¾
- [ ] æˆæœ¬æ˜ç»†è¡¨
- [ ] å•ä½æˆæœ¬è®¡ç®—
- [ ] åˆ©æ¶¦ç‡è®¡ç®—
- [ ] æˆæœ¬å¯¹æ¯”(ç›®æ ‡æˆæœ¬ã€å†å²å¹³å‡)
- [ ] AIä¼˜åŒ–å»ºè®®
- [ ] æˆæœ¬åˆ†ææŠ¥å‘Šå¯¼å‡º

**UIç»„ä»¶**:
```typescript
<ScrollView>
  <CostSummary>
    <SummaryCard label="æ€»æˆæœ¬" value={batch.totalCost} unit="å…ƒ" />
    <SummaryCard label="å•ä½æˆæœ¬" value={batch.costPerKg} unit="å…ƒ/kg" />
    <SummaryCard label="åˆ©æ¶¦ç‡" value={batch.profitRate} unit="%" />
  </CostSummary>

  <CostPieChart
    data={[
      { label: 'åŸæ–™', value: batch.rawMaterialCost },
      { label: 'äººå·¥', value: batch.laborCost },
      { label: 'è®¾å¤‡', value: batch.equipmentCost }
    ]}
  />

  <CostBreakdown>
    <BreakdownItem
      label="åŸæ–™æˆæœ¬"
      value={batch.rawMaterialCost}
      percentage={calculatePercentage(batch.rawMaterialCost, batch.totalCost)}
    />
    <BreakdownItem
      label="äººå·¥æˆæœ¬"
      value={batch.laborCost}
      details={`${batch.totalWorkMinutes}åˆ†é’Ÿ Ã— Â¥${batch.avgHourlyRate}/å°æ—¶`}
    />
    <BreakdownItem
      label="è®¾å¤‡æˆæœ¬"
      value={batch.equipmentCost}
      details={`${batch.totalEquipmentMinutes}åˆ†é’Ÿ Ã— Â¥${batch.avgEquipmentCost}/å°æ—¶`}
    />
  </CostBreakdown>

  <OptimizationSuggestions batchId={batch.id} />
</ScrollView>
```

---

#### 6.6.3 CostTrendScreen - æˆæœ¬è¶‹åŠ¿åˆ†æé¡µ (âŒ å¾…å¼€å‘)

**åŠŸèƒ½æ¸…å•**:
- [ ] æˆæœ¬è¶‹åŠ¿æŠ˜çº¿å›¾(è¿‘30å¤©)
- [ ] æˆæœ¬å¯¹æ¯”æŸ±çŠ¶å›¾(æŒ‰äº§å“ç±»å‹)
- [ ] æˆæœ¬è¶…æ ‡é¢„è­¦
- [ ] æˆæœ¬ä¼˜åŒ–ç›®æ ‡è®¾ç½®
- [ ] æˆæœ¬åˆ†ææŠ¥å‘Šç”Ÿæˆ

---

### 6.7 ç”Ÿäº§ä»ªè¡¨æ¿é¡µé¢ (2é¡µ)

#### 6.7.1 ProcessingDashboardScreen - ç”Ÿäº§ä»ªè¡¨æ¿ (âœ… å·²å®Œæˆ)

**è·¯å¾„**: `/src/screens/processing/ProcessingDashboardScreen.tsx`

**ç°æœ‰åŠŸèƒ½**: ç”Ÿäº§æ¦‚è§ˆã€å…³é”®æŒ‡æ ‡å±•ç¤º

---

#### 6.7.2 ProductionStatisticsScreen - ç”Ÿäº§ç»Ÿè®¡è¯¦æƒ…é¡µ (âŒ å¾…å¼€å‘)

**è·¯å¾„**: `/src/screens/processing/ProductionStatisticsScreen.tsx`

**åŠŸèƒ½æ¸…å•**:
- [ ] ç”Ÿäº§æ•°æ®è¯¦ç»†ç»Ÿè®¡
- [ ] æŒ‰æ—¶é—´æ®µç»Ÿè®¡(æ—¥/å‘¨/æœˆ)
- [ ] æŒ‰äº§å“ç±»å‹ç»Ÿè®¡
- [ ] æŒ‰ç”Ÿäº§çº¿ç»Ÿè®¡
- [ ] äº§é‡è¶‹åŠ¿å›¾
- [ ] æ•ˆç‡åˆ†æ
- [ ] æ•°æ®å¯¼å‡º

---

### 6.8 æ•°æ®å¯¼å‡ºé¡µé¢ (1é¡µ)

#### 6.8.1 DataExportScreen - æ•°æ®å¯¼å‡ºé¡µ (âŒ å¾…å¼€å‘)

**è·¯å¾„**: `/src/screens/processing/DataExportScreen.tsx`

**åŠŸèƒ½æ¸…å•**:
- [ ] é€‰æ‹©å¯¼å‡ºç±»å‹(æ‰¹æ¬¡æŠ¥è¡¨/è´¨æ£€æŠ¥è¡¨/å·¥æ—¶æŠ¥è¡¨/æˆæœ¬æŠ¥è¡¨)
- [ ] é€‰æ‹©æ—¶é—´èŒƒå›´
- [ ] é€‰æ‹©å¯¼å‡ºæ ¼å¼(PDF/Excel/CSV)
- [ ] é¢„è§ˆæŠ¥è¡¨
- [ ] å¯¼å‡ºåˆ°æœ¬åœ°
- [ ] åˆ†äº«æŠ¥è¡¨(é‚®ä»¶/å¾®ä¿¡/å…¶ä»–)

---

## é¡µé¢è·³è½¬å…³ç³»å›¾

### 7.1 æ•´ä½“å¯¼èˆªæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ç”Ÿäº§ä»ªè¡¨æ¿ (å…¥å£)                          â”‚
â”‚               ProcessingDashboardScreen                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚          â”‚          â”‚          â”‚          â”‚          â”‚
    â–¼          â–¼          â–¼          â–¼          â–¼          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚æ‰¹æ¬¡ç®¡ç†â”‚â”‚è´¨æ£€ç®¡ç†â”‚â”‚å‘˜å·¥å·¥ä½œâ”‚â”‚è®¾å¤‡ç›‘æ§â”‚â”‚æˆæœ¬åˆ†æâ”‚â”‚æ•°æ®å¯¼å‡ºâ”‚
â”‚5ä¸ªé¡µé¢ â”‚â”‚4ä¸ªé¡µé¢ â”‚â”‚3ä¸ªé¡µé¢ â”‚â”‚4ä¸ªé¡µé¢ â”‚â”‚3ä¸ªé¡µé¢ â”‚â”‚1ä¸ªé¡µé¢ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.2 æ‰¹æ¬¡ç®¡ç†æ¨¡å—å¯¼èˆªæµç¨‹

```
BatchListScreen (æ‰¹æ¬¡åˆ—è¡¨)
  â”‚
  â”œâ”€ [ç‚¹å‡»æ‰¹æ¬¡] â†’ BatchDetailScreen (æ‰¹æ¬¡è¯¦æƒ…)
  â”‚                    â”‚
  â”‚                    â”œâ”€ [ç¼–è¾‘] â†’ BatchEditScreen
  â”‚                    â”‚                â”‚
  â”‚                    â”‚                â””â”€ [ä¿å­˜] â†’ BatchDetailScreen
  â”‚                    â”‚
  â”‚                    â”œâ”€ [æŸ¥çœ‹æ—¶é—´çº¿] â†’ BatchTimelineScreen
  â”‚                    â”‚
  â”‚                    â”œâ”€ [æŸ¥çœ‹æˆæœ¬è¯¦æƒ…] â†’ BatchCostDetailScreen
  â”‚                    â”‚                         â”‚
  â”‚                    â”‚                         â””â”€ [AIåˆ†æ] â†’ (æ˜¾ç¤ºAIåˆ†æç»“æœ)
  â”‚                    â”‚
  â”‚                    â”œâ”€ [åˆ›å»ºè´¨æ£€] â†’ QualityInspectionCreateScreen
  â”‚                    â”‚                    â”‚
  â”‚                    â”‚                    â””â”€ [æäº¤] â†’ BatchDetailScreen
  â”‚                    â”‚
  â”‚                    â”œâ”€ [å¼€å§‹ç”Ÿäº§] â†’ (APIè°ƒç”¨,çŠ¶æ€å˜æ›´)
  â”‚                    â”œâ”€ [æš‚åœç”Ÿäº§] â†’ (APIè°ƒç”¨,çŠ¶æ€å˜æ›´)
  â”‚                    â””â”€ [å®Œæˆç”Ÿäº§] â†’ (APIè°ƒç”¨,çŠ¶æ€å˜æ›´)
  â”‚
  â””â”€ [åˆ›å»ºæ‰¹æ¬¡] â†’ BatchCreateScreen
                       â”‚
                       â””â”€ [æäº¤] â†’ BatchListScreen (æˆ– BatchDetailScreen)
```

### 7.3 è´¨æ£€ç®¡ç†æ¨¡å—å¯¼èˆªæµç¨‹

```
QualityInspectionListScreen (è´¨æ£€åˆ—è¡¨)
  â”‚
  â”œâ”€ [ç‚¹å‡»è´¨æ£€è®°å½•] â†’ QualityInspectionDetailScreen (è´¨æ£€è¯¦æƒ…)
  â”‚                          â”‚
  â”‚                          â””â”€ [å…³è”æ‰¹æ¬¡] â†’ BatchDetailScreen
  â”‚
  â”œâ”€ [åˆ›å»ºè´¨æ£€] â†’ QualityInspectionCreateScreen
  â”‚                    â”‚
  â”‚                    â”œâ”€ [é€‰æ‹©æ‰¹æ¬¡] â†’ æ‰¹æ¬¡é€‰æ‹©å™¨
  â”‚                    â”œâ”€ [ä¸Šä¼ ç…§ç‰‡] â†’ ç›¸æœº/ç›¸å†Œ
  â”‚                    â””â”€ [æäº¤] â†’ QualityInspectionListScreen
  â”‚
  â””â”€ [ç»Ÿè®¡åˆ†æ] â†’ QualityStatisticsScreen
```

### 7.4 è®¾å¤‡ç›‘æ§æ¨¡å—å¯¼èˆªæµç¨‹

```
EquipmentListScreen (è®¾å¤‡åˆ—è¡¨)
  â”‚
  â”œâ”€ [ç‚¹å‡»è®¾å¤‡] â†’ EquipmentDetailScreen (è®¾å¤‡è¯¦æƒ…)
  â”‚                    â”‚
  â”‚                    â”œâ”€ [æŸ¥çœ‹ç›‘æ§æ•°æ®] â†’ (æ˜¾ç¤ºå†å²æ›²çº¿å›¾)
  â”‚                    â”œâ”€ [ç»´æŠ¤è®°å½•] â†’ (æ˜¾ç¤ºç»´æŠ¤å†å²)
  â”‚                    â””â”€ [å‘Šè­¦å†å²] â†’ EquipmentAlertsScreen
  â”‚
  â”œâ”€ [å®æ—¶ç›‘æ§] â†’ EquipmentMonitoringScreen
  â”‚                    â”‚
  â”‚                    â””â”€ [ç‚¹å‡»è®¾å¤‡] â†’ EquipmentDetailScreen
  â”‚
  â””â”€ [å‘Šè­¦ç®¡ç†] â†’ EquipmentAlertsScreen
                       â”‚
                       â”œâ”€ [ç¡®è®¤å‘Šè­¦] â†’ (APIè°ƒç”¨,çŠ¶æ€å˜æ›´)
                       â””â”€ [è§£å†³å‘Šè­¦] â†’ (APIè°ƒç”¨,çŠ¶æ€å˜æ›´)
```

### 7.5 æˆæœ¬åˆ†ææ¨¡å—å¯¼èˆªæµç¨‹

```
CostAnalysisDashboard (æˆæœ¬ä»ªè¡¨æ¿)
  â”‚
  â”œâ”€ [ç‚¹å‡»æ‰¹æ¬¡] â†’ BatchCostDetailScreen (æ‰¹æ¬¡æˆæœ¬è¯¦æƒ…)
  â”‚                    â”‚
  â”‚                    â”œâ”€ [AIæ™ºèƒ½åˆ†æ] â†’ (è°ƒç”¨DeepSeek API,æ˜¾ç¤ºåˆ†æç»“æœ)
  â”‚                    â”œâ”€ [æˆæœ¬å¯¹æ¯”] â†’ (æ˜¾ç¤ºä¸ç›®æ ‡æˆæœ¬ã€å†å²å¯¹æ¯”)
  â”‚                    â””â”€ [å¯¼å‡ºæŠ¥è¡¨] â†’ DataExportScreen
  â”‚
  â””â”€ [æˆæœ¬è¶‹åŠ¿] â†’ CostTrendScreen
                       â”‚
                       â””â”€ [é€‰æ‹©æ—¶é—´èŒƒå›´] â†’ (æ›´æ–°è¶‹åŠ¿å›¾)
```

### 7.6 è·¨æ¨¡å—è·³è½¬å…³ç³»

```
æ‰¹æ¬¡è¯¦æƒ…é¡µ (BatchDetailScreen)
  â”‚
  â”œâ†’ è´¨æ£€æ¨¡å—: QualityInspectionCreateScreen
  â”œâ†’ æˆæœ¬æ¨¡å—: BatchCostDetailScreen
  â”œâ†’ å‘˜å·¥æ¨¡å—: WorkRecordScreen (æŸ¥çœ‹å·¥æ—¶)
  â””â†’ è®¾å¤‡æ¨¡å—: EquipmentDetailScreen (æŸ¥çœ‹è®¾å¤‡ä½¿ç”¨)

è´¨æ£€è¯¦æƒ…é¡µ (QualityInspectionDetailScreen)
  â”‚
  â””â†’ æ‰¹æ¬¡æ¨¡å—: BatchDetailScreen (å…³è”æ‰¹æ¬¡)

æˆæœ¬è¯¦æƒ…é¡µ (BatchCostDetailScreen)
  â”‚
  â”œâ†’ æ‰¹æ¬¡æ¨¡å—: BatchDetailScreen (è¿”å›æ‰¹æ¬¡)
  â””â†’ è´¨æ£€æ¨¡å—: QualityInspectionListScreen (æŸ¥çœ‹è´¨æ£€å½±å“)

è®¾å¤‡è¯¦æƒ…é¡µ (EquipmentDetailScreen)
  â”‚
  â””â†’ æ‰¹æ¬¡æ¨¡å—: BatchListScreen (æŸ¥çœ‹ç›¸å…³æ‰¹æ¬¡)
```

### 7.7 é¡µé¢æ ˆç®¡ç†

**ä¸»å¯¼èˆªæ ˆ** (Main Stack):
```
Stack.Navigator initialRouteName="ProcessingDashboard">
  <Stack.Screen name="ProcessingDashboard" component={ProcessingDashboardScreen} />
  <Stack.Screen name="BatchList" component={BatchListScreen} />
  <Stack.Screen name="QualityInspectionList" component={QualityInspectionListScreen} />
  <Stack.Screen name="EquipmentList" component={EquipmentListScreen} />
  <Stack.Screen name="CostAnalysisDashboard" component={CostAnalysisDashboardScreen} />
</Stack.Navigator>
```

**æ‰¹æ¬¡æ ˆ** (Batch Stack):
```
Stack.Navigator>
  <Stack.Screen name="BatchDetail" component={BatchDetailScreen} />
  <Stack.Screen name="BatchCreate" component={BatchCreateScreen} />
  <Stack.Screen name="BatchEdit" component={BatchEditScreen} />
  <Stack.Screen name="BatchTimeline" component={BatchTimelineScreen} />
</Stack.Navigator>
```

**è´¨æ£€æ ˆ** (Quality Stack):
```
Stack.Navigator>
  <Stack.Screen name="QualityInspectionCreate" component={QualityInspectionCreateScreen} />
  <Stack.Screen name="QualityInspectionDetail" component={QualityInspectionDetailScreen} />
  <Stack.Screen name="QualityStatistics" component={QualityStatisticsScreen} />
</Stack.Navigator>
```

---

## ä¸å…¶ä»–æ¨¡å—çš„åä½œ

### 8.1 ç”Ÿäº§æ¨¡å—åœ¨ç³»ç»Ÿä¸­çš„ä½ç½®

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   ç™½å©çºªé£Ÿå“æº¯æºç³»ç»Ÿ                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”
    â”‚       â”‚       â”‚       â”‚       â”‚       â”‚       â”‚
    â–¼       â–¼       â–¼       â–¼       â–¼       â–¼       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”
â”‚è®¤è¯  â”‚â”‚ç”Ÿäº§  â”‚â”‚ä»“å‚¨  â”‚â”‚é”€å”®  â”‚â”‚è´¢åŠ¡  â”‚â”‚ç»Ÿè®¡  â”‚â”‚å¹³å°  â”‚
â”‚æ¨¡å—  â”‚â”‚æ¨¡å—  â”‚â”‚æ¨¡å—  â”‚â”‚æ¨¡å—  â”‚â”‚æ¨¡å—  â”‚â”‚æ¨¡å—  â”‚â”‚ç®¡ç†  â”‚
â”‚      â”‚â”‚(æ ¸å¿ƒ)â”‚â”‚(æœªæ¥)â”‚â”‚(æœªæ¥)â”‚â”‚(æœªæ¥)â”‚â”‚      â”‚â”‚      â”‚
â””â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”¬â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”˜
           â”‚
      â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”
      â”‚         â”‚    â”‚    â”‚    â”‚    â”‚
   æ‰¹æ¬¡ç®¡ç†  è´¨æ£€  å‘˜å·¥  è®¾å¤‡  æˆæœ¬  ä»ªè¡¨æ¿
```

### 8.2 è®¤è¯æ¨¡å—é›†æˆ

**ç”¨æˆ·æƒé™æ§åˆ¶**:
```typescript
// ç”Ÿäº§æ¨¡å—æƒé™å®šä¹‰
const PROCESSING_PERMISSIONS = {
  // æ‰¹æ¬¡ç®¡ç†
  'batch:view': ['operator', 'department_admin', 'factory_super_admin', 'platform_admin'],
  'batch:create': ['department_admin', 'factory_super_admin', 'platform_admin'],
  'batch:edit': ['department_admin', 'factory_super_admin', 'platform_admin'],
  'batch:delete': ['factory_super_admin', 'platform_admin'],
  'batch:start': ['department_admin', 'factory_super_admin', 'platform_admin'],
  'batch:complete': ['department_admin', 'factory_super_admin', 'platform_admin'],

  // è´¨æ£€ç®¡ç†
  'quality:view': ['operator', 'department_admin', 'factory_super_admin', 'platform_admin'],
  'quality:create': ['operator', 'department_admin', 'factory_super_admin'],
  'quality:edit': ['department_admin', 'factory_super_admin'],

  // è®¾å¤‡ç›‘æ§
  'equipment:view': ['operator', 'department_admin', 'factory_super_admin'],
  'equipment:control': ['department_admin', 'factory_super_admin'],

  // æˆæœ¬åˆ†æ
  'cost:view': ['department_admin', 'factory_super_admin', 'platform_admin'],
  'cost:ai_analysis': ['factory_super_admin', 'platform_admin']
};

// æƒé™æ£€æŸ¥å‡½æ•°
const hasPermission = (permission) => {
  const userRole = authStore.user?.roleCode;
  return PROCESSING_PERMISSIONS[permission]?.includes(userRole) || false;
};
```

**é¡µé¢æƒé™å®ˆå«**:
```typescript
// æ‰¹æ¬¡åˆ›å»ºé¡µé¢æƒé™å®ˆå«
const BatchCreateScreen = () => {
  const user = useAuthStore(state => state.user);

  // æ£€æŸ¥æƒé™
  if (!hasPermission('batch:create')) {
    return (
      <PermissionDenied
        message="æ‚¨æ²¡æœ‰æƒé™åˆ›å»ºæ‰¹æ¬¡"
        requiredRoles={['department_admin', 'factory_super_admin']}
      />
    );
  }

  // æ­£å¸¸æ¸²æŸ“
  return <BatchCreateForm />;
};
```

### 8.3 å‘˜å·¥ç®¡ç†æ¨¡å—é›†æˆ

#### 8.3.1 é›†æˆç‚¹1: æ‰¹æ¬¡è´Ÿè´£äººé€‰æ‹©

**å‰ç«¯è°ƒç”¨**:
```typescript
// BatchCreateScreenä¸­é€‰æ‹©è´Ÿè´£äºº
const SupervisorSelector = () => {
  const [supervisors, setSupervisors] = useState([]);

  useEffect(() => {
    // è°ƒç”¨å‘˜å·¥ç®¡ç†æ¨¡å—APIè·å–å¯ç”¨è´Ÿè´£äºº
    const fetchSupervisors = async () => {
      const response = await apiClient.get('/api/mobile/users', {
        params: {
          department: 'processing',
          role: ['department_admin', 'operator'],
          isActive: true
        }
      });
      setSupervisors(response.data.users);
    };

    fetchSupervisors();
  }, []);

  return (
    <Picker
      items={supervisors.map(user => ({
        label: `${user.fullName} (${user.department})`,
        value: user.id
      }))}
    />
  );
};
```

#### 8.3.2 é›†æˆç‚¹2: å·¥æ—¶è®°å½•å…³è”æ‰¹æ¬¡

**å‘˜å·¥æ‰“å¡æ—¶å…³è”æ‰¹æ¬¡**:
```typescript
// TimeClockScreenä¸­æ‰“å¡æ—¶é€‰æ‹©å…³è”æ‰¹æ¬¡
const ClockInForm = () => {
  const [workType, setWorkType] = useState('production');
  const [relatedBatchId, setRelatedBatchId] = useState(null);

  const handleClockIn = async () => {
    const clockData = {
      workType,
      relatedBatchId: workType === 'production' ? relatedBatchId : null,
      location: await getCurrentLocation(),
      photo: await capturePhoto()
    };

    await apiClient.post('/api/mobile/timeclock/clock-in', clockData);
  };

  return (
    <Form>
      <FormField label="å·¥ä½œç±»å‹">
        <Picker
          items={WORK_TYPES}
          selectedValue={workType}
          onValueChange={setWorkType}
        />
      </FormField>

      {workType === 'production' && (
        <FormField label="å…³è”æ‰¹æ¬¡">
          <BatchPicker
            onSelect={setRelatedBatchId}
            filter={{ status: 'in_progress' }}
          />
        </FormField>
      )}

      <Button onPress={handleClockIn}>ä¸Šç­æ‰“å¡</Button>
    </Form>
  );
};
```

#### 8.3.3 é›†æˆç‚¹3: æˆæœ¬æ ¸ç®—è¯»å–å·¥æ—¶

**åç«¯æˆæœ¬è®¡ç®—æ—¶è¯»å–å·¥æ—¶æ•°æ®**:
```javascript
// è®¡ç®—æ‰¹æ¬¡äººå·¥æˆæœ¬
const calculateLaborCost = async (batchId) => {
  // è°ƒç”¨å‘˜å·¥ç®¡ç†æ¨¡å—API
  const workSessions = await prisma.employeeWorkSession.findMany({
    where: {
      relatedBatchId: batchId,
      endTime: { not: null }
    },
    include: {
      user: {
        select: {
          id: true,
          fullName: true,
          hourlyRate: true  // å‘˜å·¥æ—¶è–ª
        }
      }
    }
  });

  let totalLaborCost = 0;
  for (const session of workSessions) {
    const hours = session.totalMinutes / 60;
    const overtimeHours = (session.overtimeMinutes || 0) / 60;
    const hourlyRate = session.user.hourlyRate || 20;

    totalLaborCost += hours * hourlyRate;
    totalLaborCost += overtimeHours * hourlyRate * 1.5; // åŠ ç­1.5å€
  }

  return totalLaborCost;
};
```

**æ•°æ®æµå‘**:
```
å‘˜å·¥æ‰“å¡ â†’ employee_time_clocksè¡¨
          â†“
    åˆ›å»ºå·¥ä½œæ—¶æ®µ â†’ employee_work_sessionsè¡¨ (relatedBatchId)
          â†“
    æ‰¹æ¬¡å®Œæˆæ—¶è¯»å–å·¥æ—¶ â†’ è®¡ç®—äººå·¥æˆæœ¬
          â†“
    æ›´æ–°æ‰¹æ¬¡æˆæœ¬ â†’ processing_batches.labor_cost
```

### 8.4 è®¾å¤‡ç›‘æ§æ¨¡å—é›†æˆ

#### 8.4.1 é›†æˆç‚¹1: æ‰¹æ¬¡æ‰§è¡Œæ—¶å¯åŠ¨è®¾å¤‡ä½¿ç”¨

**æ‰¹æ¬¡å¼€å§‹ç”Ÿäº§æ—¶è‡ªåŠ¨è®°å½•è®¾å¤‡ä½¿ç”¨**:
```javascript
// æ‰¹æ¬¡å¼€å§‹ç”Ÿäº§
export const startProduction = async (req, res, next) => {
  try {
    const { id } = req.params;
    const { equipmentIds } = req.body;  // ä½¿ç”¨çš„è®¾å¤‡åˆ—è¡¨

    // 1. æ›´æ–°æ‰¹æ¬¡çŠ¶æ€
    const batch = await prisma.processingBatch.update({
      where: { id },
      data: { status: 'in_progress' }
    });

    // 2. å¯åŠ¨è®¾å¤‡ä½¿ç”¨è®°å½•
    for (const equipmentId of equipmentIds) {
      await prisma.equipmentUsage.create({
        data: {
          equipmentId,
          batchId: id,
          startTime: new Date(),
          usageType: 'production'
        }
      });
    }

    res.json(createSuccessResponse(batch, 'ç”Ÿäº§å·²å¼€å§‹'));
  } catch (error) {
    next(error);
  }
};
```

#### 8.4.2 é›†æˆç‚¹2: è®¾å¤‡å‘Šè­¦å½±å“æ‰¹æ¬¡

**è®¾å¤‡ä¸¥é‡æ•…éšœæ—¶è‡ªåŠ¨æš‚åœå…³è”æ‰¹æ¬¡**:
```javascript
// è®¾å¤‡å‘Šè­¦å¤„ç†é€»è¾‘
export const handleEquipmentAlert = async (equipmentId, alertData) => {
  // 1. åˆ›å»ºå‘Šè­¦è®°å½•
  const alert = await prisma.alertNotification.create({
    data: {
      equipmentId,
      severity: alertData.severity,
      title: alertData.title,
      message: alertData.message,
      status: 'active'
    }
  });

  // 2. å¦‚æœæ˜¯ä¸¥é‡å‘Šè­¦,æš‚åœç›¸å…³æ‰¹æ¬¡
  if (alertData.severity === 'critical') {
    // æŸ¥æ‰¾æ­£åœ¨ä½¿ç”¨è¯¥è®¾å¤‡çš„æ‰¹æ¬¡
    const activeBatches = await prisma.processingBatch.findMany({
      where: {
        status: 'in_progress',
        equipmentUsage: {
          some: {
            equipmentId,
            endTime: null  // æ­£åœ¨ä½¿ç”¨
          }
        }
      }
    });

    // è‡ªåŠ¨æš‚åœæ‰¹æ¬¡
    for (const batch of activeBatches) {
      await prisma.processingBatch.update({
        where: { id: batch.id },
        data: { status: 'paused' }
      });

      // é€šçŸ¥æ‰¹æ¬¡è´Ÿè´£äºº
      await sendPushNotification(batch.supervisorId, {
        title: 'æ‰¹æ¬¡å·²è‡ªåŠ¨æš‚åœ',
        message: `è®¾å¤‡${equipmentId}æ•…éšœ,æ‰¹æ¬¡${batch.batchNumber}å·²æš‚åœ`
      });
    }
  }

  return alert;
};
```

#### 8.4.3 é›†æˆç‚¹3: æˆæœ¬æ ¸ç®—è¯»å–è®¾å¤‡æ•°æ®

**è®¡ç®—è®¾å¤‡æˆæœ¬**:
```javascript
const calculateEquipmentCost = async (batchId) => {
  // è¯»å–è®¾å¤‡ä½¿ç”¨è®°å½•
  const equipmentUsage = await prisma.equipmentUsage.findMany({
    where: { batchId, endTime: { not: null } },
    include: {
      equipment: {
        select: {
          id: true,
          equipmentName: true,
          deprecationRate: true  // æŠ˜æ—§ç‡(å…ƒ/å°æ—¶)
        }
      }
    }
  });

  let totalEquipmentCost = 0;
  for (const usage of equipmentUsage) {
    const hours = usage.usageMinutes / 60;
    const deprecationRate = usage.equipment.deprecationRate || 10;
    totalEquipmentCost += hours * deprecationRate;
  }

  return totalEquipmentCost;
};
```

### 8.5 ä»“å‚¨æ¨¡å—é›†æˆ (æœªæ¥è§„åˆ’ - Phase 4+)

#### 8.5.1 é›†æˆç‚¹1: æ‰¹æ¬¡åˆ›å»ºæ—¶åŸæ–™å‡ºåº“

**ä¸šåŠ¡æµç¨‹**:
```
1. ç”¨æˆ·åˆ›å»ºæ‰¹æ¬¡
   â†“
2. é€‰æ‹©åŸææ–™(ä»ä»“å‚¨åº“å­˜ä¸­é€‰æ‹©)
   â†“
3. æ‰¹æ¬¡åˆ›å»ºæˆåŠŸ â†’ è§¦å‘åŸæ–™å‡ºåº“
   â†“
4. è°ƒç”¨ä»“å‚¨æ¨¡å—API: POST /api/warehouse/outbound
   è¯·æ±‚æ•°æ®:
   {
     batchId: 'batch_123',
     materials: [
       { materialId: 'MAT001', quantity: 500, unit: 'kg' }
     ],
     purpose: 'production',
     warehouseId: 'WH001'
   }
   â†“
5. ä»“å‚¨æ¨¡å—:
   - æ£€æŸ¥åº“å­˜æ˜¯å¦å……è¶³
   - åˆ›å»ºå‡ºåº“å•
   - å‡å°‘åº“å­˜
   - è¿”å›å‡ºåº“å•å·
   â†“
6. ç”Ÿäº§æ¨¡å—ä¿å­˜å‡ºåº“å•å·åˆ°æ‰¹æ¬¡
```

**æ•°æ®åŒæ­¥**:
```typescript
// æ‰¹æ¬¡åˆ›å»ºæ—¶è§¦å‘åŸæ–™å‡ºåº“
const createBatchWithMaterialOutbound = async (batchData) => {
  // 1. åˆ›å»ºæ‰¹æ¬¡
  const batch = await apiClient.post('/api/mobile/processing/batches', batchData);

  // 2. è§¦å‘åŸæ–™å‡ºåº“
  try {
    const outbound = await apiClient.post('/api/warehouse/outbound', {
      batchId: batch.id,
      materials: batchData.rawMaterials,
      purpose: 'production'
    });

    // 3. æ›´æ–°æ‰¹æ¬¡å…³è”å‡ºåº“å•
    await apiClient.put(`/api/mobile/processing/batches/${batch.id}`, {
      outboundOrderId: outbound.id
    });
  } catch (error) {
    // å‡ºåº“å¤±è´¥,æç¤ºç”¨æˆ·
    Alert.alert('è­¦å‘Š', 'åŸæ–™å‡ºåº“å¤±è´¥,è¯·æ‰‹åŠ¨å¤„ç†');
  }

  return batch;
};
```

#### 8.5.2 é›†æˆç‚¹2: æ‰¹æ¬¡å®Œæˆæ—¶æˆå“å…¥åº“

**ä¸šåŠ¡æµç¨‹**:
```
1. æ‰¹æ¬¡è´¨æ£€é€šè¿‡,çŠ¶æ€å˜æ›´ä¸ºcompleted
   â†“
2. è‡ªåŠ¨è§¦å‘æˆå“å…¥åº“
   â†“
3. è°ƒç”¨ä»“å‚¨æ¨¡å—API: POST /api/warehouse/inbound
   è¯·æ±‚æ•°æ®:
   {
     batchId: 'batch_123',
     productId: 'PROD001',
     productType: 'é€Ÿå†»é±¼æ’',
     quantity: 400,  // actualQuantity
     qualityGrade: 'A',
     productionDate: '2025-01-05',
     expiryDate: '2025-07-05',  // ç”Ÿäº§æ—¥æœŸ+6ä¸ªæœˆ
     warehouseId: 'WH002'
   }
   â†“
4. ä»“å‚¨æ¨¡å—:
   - åˆ›å»ºå…¥åº“å•
   - å¢åŠ åº“å­˜
   - ç”Ÿæˆè¿½æº¯ç (ç»‘å®šbatchId)
   - è¿”å›å…¥åº“å•å·
   â†“
5. ç”Ÿäº§æ¨¡å—ä¿å­˜å…¥åº“å•å·åˆ°æ‰¹æ¬¡
```

**è¿½æº¯ç ç”Ÿæˆ**:
```
è¿½æº¯ç æ ¼å¼: {batchNumber}-{QRCode}
ç¤ºä¾‹: FAC001-20250105-001-QR123456

æ‰«æè¿½æº¯ç å¯æŸ¥è¯¢:
  - æ‰¹æ¬¡ä¿¡æ¯(äº§å“ç±»å‹ã€äº§é‡ã€æ—¥æœŸ)
  - åŸæ–™ä¿¡æ¯(ä¾›åº”å•†ã€æ‰¹æ¬¡å·)
  - è´¨æ£€ä¿¡æ¯(è´¨æ£€ç»“æœã€ç…§ç‰‡)
  - ç”Ÿäº§ä¿¡æ¯(è´Ÿè´£äººã€å·¥æ—¶)
  - æˆæœ¬ä¿¡æ¯(å•ä½æˆæœ¬ã€æˆæœ¬æ„æˆ)
```

### 8.6 é”€å”®æ¨¡å—é›†æˆ (æœªæ¥è§„åˆ’ - Phase 5+)

#### 8.6.1 é›†æˆç‚¹1: é”€å”®è®¢å•å…³è”æ‰¹æ¬¡

**ä¸šåŠ¡æµç¨‹**:
```
1. é”€å”®äººå‘˜åˆ›å»ºè®¢å•
   â†“
2. é€‰æ‹©äº§å“(ä»ä»“å‚¨åº“å­˜é€‰æ‹©)
   â†“
3. ç³»ç»Ÿæ˜¾ç¤ºäº§å“çš„æ‰¹æ¬¡è¿½æº¯ä¿¡æ¯
   - æ‰¹æ¬¡å·
   - ç”Ÿäº§æ—¥æœŸ
   - è´¨é‡ç­‰çº§
   - å‰©ä½™ä¿è´¨æœŸ
   â†“
4. è®¢å•å‘è´§æ—¶è®°å½•æ‰¹æ¬¡å·
   â†“
5. å®¢æˆ·æ”¶åˆ°äº§å“,æ‰«ç æŸ¥è¯¢æ‰¹æ¬¡ä¿¡æ¯
```

#### 8.6.2 é›†æˆç‚¹2: æˆæœ¬æ•°æ®ç”¨äºå®šä»·

**è¯»å–æ‰¹æ¬¡æˆæœ¬ç”¨äºäº§å“å®šä»·**:
```typescript
// é”€å”®æ¨¡å—è°ƒç”¨ç”Ÿäº§æ¨¡å—APIè·å–æˆæœ¬æ•°æ®
const getSuggestedPrice = async (productType) => {
  // 1. æŸ¥è¯¢è¿‘30å¤©è¯¥äº§å“çš„å¹³å‡æˆæœ¬
  const response = await apiClient.get('/api/mobile/processing/batches/cost-average', {
    params: {
      productType,
      startDate: getDateBefore(30),
      endDate: new Date()
    }
  });

  const avgCostPerKg = response.data.avgCostPerKg;

  // 2. è®¡ç®—å»ºè®®å”®ä»·(æˆæœ¬+30%åˆ©æ¶¦)
  const suggestedPrice = avgCostPerKg * 1.3;

  return {
    avgCost: avgCostPerKg,
    suggestedPrice,
    profitMargin: 0.3
  };
};
```

### 8.7 è´¢åŠ¡æ¨¡å—é›†æˆ (æœªæ¥è§„åˆ’ - Phase 6+)

#### 8.7.1 é›†æˆç‚¹1: æ‰¹æ¬¡æˆæœ¬æ•°æ®åŒæ­¥

**æ•°æ®åŒæ­¥æµç¨‹**:
```
æ‰¹æ¬¡çŠ¶æ€å˜æ›´ä¸ºcompleted
  â†“
è§¦å‘æˆæœ¬æ•°æ®åŒæ­¥åˆ°è´¢åŠ¡æ¨¡å—
  â†“
è°ƒç”¨è´¢åŠ¡æ¨¡å—API: POST /api/finance/cost-sync
è¯·æ±‚æ•°æ®:
{
  batchId: 'batch_123',
  batchNumber: 'FAC001-20250105-001',
  productType: 'é€Ÿå†»é±¼æ’',
  productionDate: '2025-01-05',
  costs: {
    rawMaterial: 15000,  // åŸæ–™æˆæœ¬
    labor: 4800,         // äººå·¥æˆæœ¬
    equipment: 1200,     // è®¾å¤‡æˆæœ¬
    other: 1000,         // å…¶ä»–æˆæœ¬
    total: 22000         // æ€»æˆæœ¬
  },
  quantity: 400,  // äº§é‡(kg)
  costPerUnit: 55  // å•ä½æˆæœ¬(å…ƒ/kg)
}
  â†“
è´¢åŠ¡æ¨¡å—:
  - åˆ›å»ºæˆæœ¬è®°å½•
  - åˆ†é…åˆ°æˆæœ¬ä¼šè®¡ç§‘ç›®
  - ç”¨äºè´¢åŠ¡æŠ¥è¡¨ç”Ÿæˆ
```

#### 8.7.2 é›†æˆç‚¹2: åˆ©æ¶¦åˆ†æ

**è´¢åŠ¡æ¨¡å—è¯»å–ç”Ÿäº§æ•°æ®è¿›è¡Œåˆ©æ¶¦åˆ†æ**:
```typescript
// è´¢åŠ¡æ¨¡å—è°ƒç”¨ç”Ÿäº§æ¨¡å—API
const getProfitAnalysis = async (year, month) => {
  // 1. è·å–æŒ‡å®šæœˆä»½æ‰€æœ‰å®Œæˆæ‰¹æ¬¡
  const batches = await apiClient.get('/api/mobile/processing/batches', {
    params: {
      status: 'completed',
      startDate: `${year}-${month}-01`,
      endDate: `${year}-${month}-31`
    }
  });

  // 2. æ±‡æ€»æˆæœ¬å’Œæ”¶å…¥
  let totalCost = 0;
  let totalRevenue = 0;

  for (const batch of batches) {
    totalCost += batch.totalCost;
    totalRevenue += batch.actualQuantity * batch.expectedPrice;
  }

  // 3. è®¡ç®—åˆ©æ¶¦
  const profit = totalRevenue - totalCost;
  const profitMargin = (profit / totalRevenue) * 100;

  return {
    totalCost,
    totalRevenue,
    profit,
    profitMargin,
    batchCount: batches.length
  };
};
```

### 8.8 æ•°æ®æµå‘æ€»è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     å®Œæ•´æ•°æ®æµå‘å›¾                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. è®¤è¯æ¨¡å— â†’ ç”Ÿäº§æ¨¡å—
   - ç”¨æˆ·ç™»å½• â†’ æƒé™æ•°æ® â†’ é¡µé¢æƒé™æ§åˆ¶
   - ç”¨æˆ·ä¿¡æ¯ â†’ æ‰¹æ¬¡è´Ÿè´£äººã€è´¨æ£€å‘˜ã€æ“ä½œäºº

2. å‘˜å·¥ç®¡ç†æ¨¡å— â†” ç”Ÿäº§æ¨¡å—
   - å‘˜å·¥åˆ—è¡¨ â†’ æ‰¹æ¬¡è´Ÿè´£äººé€‰æ‹©
   - æ‰“å¡è®°å½• â†’ å·¥æ—¶æ•°æ® â†’ äººå·¥æˆæœ¬è®¡ç®—
   - æ‰¹æ¬¡ID â†’ å·¥ä½œè®°å½•å…³è”

3. è®¾å¤‡ç›‘æ§æ¨¡å— â†” ç”Ÿäº§æ¨¡å—
   - è®¾å¤‡åˆ—è¡¨ â†’ æ‰¹æ¬¡ä½¿ç”¨è®¾å¤‡é€‰æ‹©
   - è®¾å¤‡ä½¿ç”¨è®°å½• â†’ è®¾å¤‡æˆæœ¬è®¡ç®—
   - è®¾å¤‡å‘Šè­¦ â†’ æ‰¹æ¬¡çŠ¶æ€å˜æ›´(æš‚åœ)

4. ç”Ÿäº§æ¨¡å— â†’ ä»“å‚¨æ¨¡å— (æœªæ¥)
   - æ‰¹æ¬¡åˆ›å»º â†’ åŸæ–™å‡ºåº“
   - æ‰¹æ¬¡å®Œæˆ â†’ æˆå“å…¥åº“
   - æ‰¹æ¬¡ID â†’ è¿½æº¯ç ç»‘å®š

5. ç”Ÿäº§æ¨¡å— â†’ é”€å”®æ¨¡å— (æœªæ¥)
   - æ‰¹æ¬¡æˆæœ¬ â†’ äº§å“å®šä»·å»ºè®®
   - æ‰¹æ¬¡ä¿¡æ¯ â†’ äº§å“è¿½æº¯ä¿¡æ¯

6. ç”Ÿäº§æ¨¡å— â†’ è´¢åŠ¡æ¨¡å— (æœªæ¥)
   - æ‰¹æ¬¡æˆæœ¬æ•°æ® â†’ è´¢åŠ¡æˆæœ¬æ ¸ç®—
   - æ‰¹æ¬¡åˆ©æ¶¦æ•°æ® â†’ åˆ©æ¶¦åˆ†ææŠ¥è¡¨
```

---

## ä¼˜åŒ–æ–¹å‘

### 9.1 å‰ç«¯UIå¼€å‘ (ä¼˜å…ˆçº§: P0)

**ç›®æ ‡**: å®Œæˆ15-20ä¸ªç¼ºå¤±é¡µé¢çš„å¼€å‘

**å·¥ä½œé‡ä¼°ç®—**:
- æ‰¹æ¬¡ç®¡ç†é¡µé¢: 5ä¸ª Ã— 4å¤© = 20å¤©
- è´¨æ£€ç®¡ç†é¡µé¢: 4ä¸ª Ã— 3å¤© = 12å¤©
- è®¾å¤‡ç›‘æ§é¡µé¢: 4ä¸ª Ã— 3å¤© = 12å¤©
- æˆï¿½ï¿½ï¿½åˆ†æé¡µé¢: 2ä¸ª Ã— 3å¤© = 6å¤©
- å…¶ä»–é¡µé¢: 2ä¸ª Ã— 2å¤© = 4å¤©
- **æ€»è®¡**: 54å¤© (çº¦11å‘¨,2äººå¹¶è¡Œå¼€å‘å¯ç¼©çŸ­åˆ°6å‘¨)

**æŠ€æœ¯è¦æ±‚**:
- éµå¾ªMaterial Design 3è®¾è®¡è§„èŒƒ
- å“åº”å¼å¸ƒå±€(é€‚é…ä¸åŒå±å¹•å°ºå¯¸)
- ç»„ä»¶å¤ç”¨(æŠ½å–é€šç”¨ç»„ä»¶)
- æ€§èƒ½ä¼˜åŒ–(åˆ—è¡¨è™šæ‹ŸåŒ–ã€å›¾ç‰‡æ‡’åŠ è½½)

### 9.2 DeepSeek AIé›†æˆ (ä¼˜å…ˆçº§: P0)

**å½“å‰é—®é¢˜**: AIåˆ†æä½¿ç”¨Mockæ•°æ®,æ— æ³•æä¾›çœŸå®çš„æˆæœ¬ä¼˜åŒ–å»ºè®®

**ä¼˜åŒ–æ–¹æ¡ˆ**:
1. é›†æˆçœŸå®DeepSeek API
2. å®ç°5åˆ†é’Ÿç¼“å­˜ç­–ç•¥(ç›¸åŒæŸ¥è¯¢ä¸é‡å¤è°ƒç”¨)
3. æœˆåº¦é¢„ç®—æ§åˆ¶(Â¥30/æœˆ)
4. é¢„ç®—ç”¨å®Œåé™çº§åˆ°è§„åˆ™å¼•æ“

**è¯¦ç»†è®¾è®¡**: å‚è§ `PRD-è®¤è¯ä¸ç”Ÿäº§æ¨¡å—ä¼˜åŒ–æ–¹æ¡ˆ.md` çš„é˜¶æ®µ3

**å®æ–½æ­¥éª¤**:
- Week 1: DeepSeek APIé›†æˆ
- Week 2: ç¼“å­˜ç­–ç•¥å®ç°
- Week 3: é¢„ç®—æ§åˆ¶å’Œé™çº§é€»è¾‘
- Week 4: æµ‹è¯•å’Œä¼˜åŒ–

### 9.3 ç¦»çº¿åŠŸèƒ½æ”¯æŒ (ä¼˜å…ˆçº§: P1)

**ç›®æ ‡**: æ ¸å¿ƒåŠŸèƒ½æ”¯æŒç¦»çº¿æ“ä½œ

**ç¦»çº¿å¯æ“ä½œ**:
- âœ… å‘˜å·¥æ‰“å¡(ç¦»çº¿ç¼“å­˜,è”ç½‘ååŒæ­¥)
- âœ… è´¨æ£€è®°å½•åˆ›å»º(ç¦»çº¿ä¿å­˜,è”ç½‘åæäº¤)
- âœ… æ‰¹æ¬¡åˆ—è¡¨æŸ¥çœ‹(æœ¬åœ°ç¼“å­˜)

**ç¦»çº¿ä¸å¯æ“ä½œ**:
- âŒ æ‰¹æ¬¡çŠ¶æ€å˜æ›´(éœ€å®æ—¶æ€§)
- âŒ æˆæœ¬è®¡ç®—(éœ€æœåŠ¡å™¨è®¡ç®—)
- âŒ AIåˆ†æ(éœ€è°ƒç”¨API)

**å®ç°æ–¹æ¡ˆ**:
```typescript
// ç¦»çº¿æ•°æ®ç®¡ç†
class OfflineDataManager {
  // ä¿å­˜ç¦»çº¿æ‰“å¡è®°å½•
  async saveOfflineClockRecord(record) {
    const key = `offline_clock_${Date.now()}`;
    await AsyncStorage.setItem(key, JSON.stringify(record));
  }

  // åŒæ­¥ç¦»çº¿æ•°æ®
  async syncOfflineData() {
    const keys = await AsyncStorage.getAllKeys();
    const offlineKeys = keys.filter(k => k.startsWith('offline_'));

    for (const key of offlineKeys) {
      const data = await AsyncStorage.getItem(key);
      try {
        await this.uploadToServer(JSON.parse(data));
        await AsyncStorage.removeItem(key);  // åŒæ­¥æˆåŠŸ,åˆ é™¤æœ¬åœ°æ•°æ®
      } catch (error) {
        console.log('åŒæ­¥å¤±è´¥,ä¿ç•™ç¦»çº¿æ•°æ®');
      }
    }
  }
}
```

### 9.4 æ€§èƒ½ä¼˜åŒ– (ä¼˜å…ˆçº§: P1)

#### 9.4.1 APIæ€§èƒ½ä¼˜åŒ–

**é—®é¢˜**: æ‰¹æ¬¡åˆ—è¡¨æŸ¥è¯¢æ…¢,è´¨æ£€è®°å½•å¤šæ—¶å“åº”æ…¢

**ä¼˜åŒ–æ–¹æ¡ˆ**:
1. **æ•°æ®åº“ç´¢å¼•ä¼˜åŒ–**
   ```sql
   -- å¤åˆç´¢å¼•
   CREATE INDEX idx_batch_composite
   ON processing_batches(factory_id, status, start_date DESC);

   CREATE INDEX idx_inspection_batch_date
   ON quality_inspections(batch_id, inspection_date DESC);
   ```

2. **æŸ¥è¯¢ä¼˜åŒ–**
   ```javascript
   // ä½¿ç”¨selectå‡å°‘æ•°æ®ä¼ è¾“
   const batches = await prisma.processingBatch.findMany({
     where: { factoryId, status },
     select: {
       id: true,
       batchNumber: true,
       productType: true,
       status: true,
       startDate: true,
       targetQuantity: true,
       actualQuantity: true,
       supervisor: {
         select: { id: true, fullName: true }
       }
     },
     take: 20
   });
   ```

3. **Redisç¼“å­˜**
   ```javascript
   // ä»ªè¡¨æ¿æ•°æ®ç¼“å­˜5åˆ†é’Ÿ
   const cacheKey = `dashboard_${factoryId}`;
   let data = await redisClient.get(cacheKey);

   if (!data) {
     data = await calculateDashboardData(factoryId);
     await redisClient.setex(cacheKey, 300, JSON.stringify(data));
   }

   return JSON.parse(data);
   ```

#### 9.4.2 å‰ç«¯æ€§èƒ½ä¼˜åŒ–

**ä¼˜åŒ–é¡¹**:
1. **åˆ—è¡¨è™šæ‹ŸåŒ–**
   ```typescript
   import { FlashList } from "@shopify/flash-list";

   <FlashList
     data={batches}
     renderItem={renderBatchCard}
     estimatedItemSize={120}
     onEndReached={loadMore}
   />
   ```

2. **å›¾ç‰‡æ‡’åŠ è½½å’Œå‹ç¼©**
   ```typescript
   import FastImage from 'react-native-fast-image';

   <FastImage
     source={{ uri: imageUrl, priority: FastImage.priority.normal }}
     resizeMode={FastImage.resizeMode.cover}
   />
   ```

3. **æ•°æ®ç¼“å­˜**
   ```typescript
   import { useQuery } from '@tanstack/react-query';

   const { data, isLoading } = useQuery(
     ['batches', status, page],
     () => fetchBatches(status, page),
     { staleTime: 5 * 60 * 1000 }  // 5åˆ†é’Ÿç¼“å­˜
   );
   ```

### 9.5 ç”¨æˆ·ä½“éªŒä¼˜åŒ– (ä¼˜å…ˆçº§: P2)

#### 9.5.1 æ“ä½œåé¦ˆä¼˜åŒ–

**ä¼˜åŒ–é¡¹**:
1. åŠ è½½çŠ¶æ€æ˜¾ç¤º
   - éª¨æ¶å±(Skeleton Screen)
   - åŠ è½½åŠ¨ç”»(Spinner)
   - è¿›åº¦æ¡(Progress Bar)

2. æˆåŠŸ/å¤±è´¥æç¤º
   - Toastæ¶ˆæ¯(è½»é‡æç¤º)
   - Alertå¼¹çª—(é‡è¦æ“ä½œ)
   - éœ‡åŠ¨åé¦ˆ(Haptic Feedback)

3. è¡¨å•éªŒè¯æç¤º
   - å®æ—¶éªŒè¯
   - å­—æ®µçº§é”™è¯¯æç¤º
   - å‹å¥½çš„é”™è¯¯æ¶ˆæ¯

#### 9.5.2 æ™ºèƒ½åŠŸèƒ½

**ä¼˜åŒ–é¡¹**:
1. **æ‰¹æ¬¡å·æ™ºèƒ½ç”Ÿæˆé¢„è§ˆ**
   - åˆ›å»ºæ‰¹æ¬¡æ—¶é¢„è§ˆæ‰¹æ¬¡å·
   - è‡ªåŠ¨æ£€æµ‹å†²çª

2. **è¡¨å•è‡ªåŠ¨å¡«å……**
   - åŸºäºå†å²è®°å½•è‡ªåŠ¨å¡«å……
   - æ™ºèƒ½æ¨èåŸææ–™

3. **å¼‚å¸¸é¢„è­¦**
   - æˆæœ¬è¶…æ ‡é¢„è­¦
   - äº§é‡ä¸è¶³é¢„è­¦
   - è´¨æ£€å¼‚å¸¸é¢„è­¦

---

## å®æ–½è®¡åˆ’

### 10.1 æ€»ä½“æ—¶é—´è§„åˆ’

**å®æ–½å‘¨æœŸ**: 4-6å‘¨
**å¼€å‘äººå‘˜**: 2åå‰ç«¯å¼€å‘ + 1ååç«¯å¼€å‘

| å‘¨æ¬¡ | ä¸»è¦ä»»åŠ¡ | äº§å‡ºç‰© | è´£ä»»äºº |
|-----|---------|--------|--------|
| **Week 1** | æ‰¹æ¬¡ç®¡ç†UIå¼€å‘(åˆ—è¡¨ã€è¯¦æƒ…) | 2ä¸ªé¡µé¢ | å‰ç«¯1+2 |
| **Week 2** | æ‰¹æ¬¡ç®¡ç†UIå¼€å‘(åˆ›å»ºã€ç¼–è¾‘ã€æ—¶é—´çº¿) | 3ä¸ªé¡µé¢ | å‰ç«¯1+2 |
| **Week 3** | è´¨æ£€ç®¡ç†UIå¼€å‘ | 4ä¸ªé¡µé¢ | å‰ç«¯1+2 |
| **Week 4** | è®¾å¤‡ç›‘æ§UIå¼€å‘ | 4ä¸ªé¡µé¢ | å‰ç«¯1+2 |
| **Week 5** | æˆæœ¬åˆ†æé¡µé¢+DeepSeeké›†æˆ | 2ä¸ªé¡µé¢+AIé›†æˆ | å‰ç«¯1+åç«¯1 |
| **Week 6** | æ€§èƒ½ä¼˜åŒ–ã€æµ‹è¯•ã€Bugä¿®å¤ | å¯å‘å¸ƒç‰ˆæœ¬ | å…¨å‘˜ |

### 10.2 è¯¦ç»†ä»»åŠ¡åˆ†è§£

#### Week 1: æ‰¹æ¬¡ç®¡ç†UIå¼€å‘(1)

**å‰ç«¯å¼€å‘1** (5å¤©):
- Day 1-2: BatchListScreen (æ‰¹æ¬¡åˆ—è¡¨é¡µ)
  - åˆ—è¡¨ç»„ä»¶
  - ç­›é€‰åŠŸèƒ½
  - æœç´¢åŠŸèƒ½
  - åˆ†é¡µåŠ è½½
- Day 3-5: BatchDetailScreen (æ‰¹æ¬¡è¯¦æƒ…é¡µ)
  - åŸºæœ¬ä¿¡æ¯å±•ç¤º
  - çŠ¶æ€æµè½¬å¯è§†åŒ–
  - æˆæœ¬é¥¼å›¾
  - æ“ä½œæŒ‰é’®ç»„

**å‰ç«¯å¼€å‘2** (5å¤©):
- Day 1-3: é€šç”¨ç»„ä»¶å¼€å‘
  - BatchCard (æ‰¹æ¬¡å¡ç‰‡)
  - StatusBadge (çŠ¶æ€å¾½ç« )
  - ProgressBar (è¿›åº¦æ¡)
  - CostPieChart (æˆæœ¬é¥¼å›¾)
- Day 4-5: BatchDetailScreenè¾…åŠ©åŠŸèƒ½
  - è´¨æ£€è®°å½•åˆ—è¡¨
  - å·¥æ—¶è®°å½•å±•ç¤º
  - æ—¶é—´çº¿ç»„ä»¶

**åç«¯å¼€å‘** (5å¤©):
- Day 1-2: ä¼˜åŒ–æ‰¹æ¬¡æŸ¥è¯¢APIæ€§èƒ½
- Day 3-4: æ·»åŠ ç¼ºå¤±çš„æ‰¹æ¬¡API(resumeç­‰)
- Day 5: APIæ–‡æ¡£æ›´æ–°

---

#### Week 2: æ‰¹æ¬¡ç®¡ç†UIå¼€å‘(2)

**å‰ç«¯å¼€å‘1** (5å¤©):
- Day 1-3: BatchCreateScreen (åˆ›å»ºæ‰¹æ¬¡é¡µ)
  - è¡¨å•è®¾è®¡
  - åŸææ–™é€‰æ‹©å™¨
  - è´Ÿè´£äººé€‰æ‹©å™¨
  - è¡¨å•éªŒè¯
- Day 4-5: BatchEditScreen (ç¼–è¾‘æ‰¹æ¬¡é¡µ)
  - å¤ç”¨åˆ›å»ºé¡µé¢ç»„ä»¶
  - ç¼–è¾‘æƒé™æ§åˆ¶
  - æ•°æ®é¢„å¡«å……

**å‰ç«¯å¼€å‘2** (5å¤©):
- Day 1-3: BatchTimelineScreen (æ‰¹æ¬¡æ—¶é—´çº¿é¡µ)
  - æ—¶é—´çº¿ç»„ä»¶
  - äº‹ä»¶ç±»å‹é…ç½®
  - æ“ä½œäººä¿¡æ¯å±•ç¤º
- Day 4-5: æ‰¹æ¬¡ç›¸å…³APIé›†æˆ
  - åˆ›å»ºæ‰¹æ¬¡APIè°ƒç”¨
  - çŠ¶æ€å˜æ›´APIè°ƒç”¨
  - é”™è¯¯å¤„ç†

---

#### Week 3: è´¨æ£€ç®¡ç†UIå¼€å‘

**å‰ç«¯å¼€å‘1** (5å¤©):
- Day 1-2: QualityInspectionListScreen (è´¨æ£€åˆ—è¡¨)
  - åˆ—è¡¨ç»„ä»¶
  - ç±»å‹ç­›é€‰
  - ç»“æœç­›é€‰
- Day 3-5: QualityInspectionCreateScreen (åˆ›å»ºè´¨æ£€)
  - æ‰¹æ¬¡é€‰æ‹©å™¨
  - æ£€æµ‹é¡¹è¾“å…¥
  - ç…§ç‰‡ä¸Šä¼ 
  - çº æ­£æªæ–½è¾“å…¥

**å‰ç«¯å¼€å‘2** (5å¤©):
- Day 1-2: QualityInspectionDetailScreen (è´¨æ£€è¯¦æƒ…)
  - åŸºæœ¬ä¿¡æ¯å±•ç¤º
  - æ£€æµ‹é¡¹ç»“æœå±•ç¤º
  - ç…§ç‰‡æŸ¥çœ‹å™¨
- Day 3-5: QualityStatisticsScreen (è´¨æ£€ç»Ÿè®¡)
  - åˆæ ¼ç‡è¶‹åŠ¿å›¾
  - ä¸åˆæ ¼é¡¹TOP10
  - è´¨æ£€å‘˜æ’å

**åç«¯å¼€å‘** (5å¤©):
- Day 1-3: è´¨æ£€APIä¼˜åŒ–å’Œè¡¥å……
- Day 4-5: è´¨æ£€ç»Ÿè®¡APIå¼€å‘

---

#### Week 4: è®¾å¤‡ç›‘æ§UIå¼€å‘

**å‰ç«¯å¼€å‘1** (5å¤©):
- Day 1-2: EquipmentListScreen (è®¾å¤‡åˆ—è¡¨)
- Day 3-5: EquipmentMonitoringScreen (å®æ—¶ç›‘æ§)
  - ç›‘æ§é¢æ¿
  - å®æ—¶æ›²çº¿å›¾
  - è‡ªåŠ¨åˆ·æ–°æœºåˆ¶

**å‰ç«¯å¼€å‘2** (5å¤©):
- Day 1-2: EquipmentDetailScreen (è®¾å¤‡è¯¦æƒ…)
- Day 3-5: EquipmentAlertsScreen (è®¾å¤‡å‘Šè­¦)
  - å‘Šè­¦åˆ—è¡¨
  - å‘Šè­¦ç¡®è®¤
  - å‘Šè­¦å¤„ç†

**åç«¯å¼€å‘** (5å¤©):
- Day 1-3: è®¾å¤‡ç›‘æ§APIä¼˜åŒ–
- Day 4-5: å‘Šè­¦æ¨é€æœºåˆ¶ä¼˜åŒ–

---

#### Week 5: æˆæœ¬åˆ†æ+AIé›†æˆ

**å‰ç«¯å¼€å‘1** (5å¤©):
- Day 1-3: BatchCostDetailScreen (æ‰¹æ¬¡æˆæœ¬è¯¦æƒ…)
  - æˆæœ¬æ„æˆå¯è§†åŒ–
  - AIåˆ†æç»“æœå±•ç¤º
  - æˆæœ¬å¯¹æ¯”
- Day 4-5: CostTrendScreen (æˆæœ¬è¶‹åŠ¿)

**å‰ç«¯å¼€å‘2** (5å¤©):
- Day 1-3: DeepSeek AIå‰ç«¯é›†æˆ
  - AIåˆ†æè¯·æ±‚
  - ç»“æœå±•ç¤ºç»„ä»¶
  - LoadingçŠ¶æ€
- Day 4-5: æˆæœ¬ç›¸å…³ç»„ä»¶ä¼˜åŒ–

**åç«¯å¼€å‘** (5å¤©):
- Day 1-4: DeepSeek APIé›†æˆ
  - APIè°ƒç”¨å°è£…
  - ç¼“å­˜ç­–ç•¥
  - é¢„ç®—æ§åˆ¶
  - é™çº§é€»è¾‘
- Day 5: æˆæœ¬è®¡ç®—ä¼˜åŒ–

---

#### Week 6: æ€§èƒ½ä¼˜åŒ–+æµ‹è¯•

**å‰ç«¯å¼€å‘1** (5å¤©):
- Day 1-2: æ€§èƒ½ä¼˜åŒ–
  - åˆ—è¡¨è™šæ‹ŸåŒ–
  - å›¾ç‰‡æ‡’åŠ è½½
  - ç¼“å­˜ä¼˜åŒ–
- Day 3-5: åŠŸèƒ½æµ‹è¯•å’ŒBugä¿®å¤

**å‰ç«¯å¼€å‘2** (5å¤©):
- Day 1-2: ç”¨æˆ·ä½“éªŒä¼˜åŒ–
  - åŠ è½½çŠ¶æ€
  - é”™è¯¯æç¤º
  - äº¤äº’åé¦ˆ
- Day 3-5: åŠŸèƒ½æµ‹è¯•å’ŒBugä¿®å¤

**åç«¯å¼€å‘** (5å¤©):
- Day 1-2: æ€§èƒ½ä¼˜åŒ–
  - æ•°æ®åº“ç´¢å¼•
  - Redisç¼“å­˜
  - APIå“åº”ä¼˜åŒ–
- Day 3-5: é›†æˆæµ‹è¯•å’ŒBugä¿®å¤

---

### 10.3 é‡Œç¨‹ç¢‘

| é‡Œç¨‹ç¢‘ | æ—¶é—´ | æ ‡å¿— | éªŒæ”¶æ ‡å‡† |
|-------|------|------|---------|
| **M1: æ‰¹æ¬¡ç®¡ç†å®Œæˆ** | Week 2 ç»“æŸ | æ‰¹æ¬¡CRUDå…¨éƒ¨å¯ç”¨ | 5ä¸ªé¡µé¢å®Œæˆ,APIé›†æˆ |
| **M2: è´¨æ£€ç®¡ç†å®Œæˆ** | Week 3 ç»“æŸ | è´¨æ£€æµç¨‹å¯ç”¨ | 4ä¸ªé¡µé¢å®Œæˆ,APIé›†æˆ |
| **M3: è®¾å¤‡ç›‘æ§å®Œæˆ** | Week 4 ç»“æŸ | è®¾å¤‡ç›‘æ§å¯ç”¨ | 4ä¸ªé¡µé¢å®Œæˆ,APIé›†æˆ |
| **M4: AIé›†æˆå®Œæˆ** | Week 5 ç»“æŸ | AIåˆ†æå¯ç”¨ | DeepSeekçœŸå®é›†æˆ |
| **M5: ç³»ç»Ÿä¼˜åŒ–å®Œæˆ** | Week 6 ç»“æŸ | å¯å‘å¸ƒç‰ˆæœ¬ | æ€§èƒ½è¾¾æ ‡,Bug<10ä¸ª |

### 10.4 é£é™©ç®¡ç†

**é£é™©æ¸…å•**:

| é£é™© | æ¦‚ç‡ | å½±å“ | åº”å¯¹æªæ–½ |
|-----|------|------|---------|
| **å‰ç«¯äººæ‰‹ä¸è¶³** | ä¸­ | é«˜ | æå‰1å‘¨æ‹›è˜,æˆ–å»¶é•¿å‘¨æœŸ |
| **DeepSeek APIé™åˆ¶** | ä½ | ä¸­ | å‡†å¤‡å¤‡ç”¨AIæœåŠ¡(å¦‚é€šä¹‰åƒé—®) |
| **æ€§èƒ½ä¸è¾¾æ ‡** | ä¸­ | ä¸­ | æå‰è¿›è¡Œæ€§èƒ½æµ‹è¯•,é¢„ç•™ä¼˜åŒ–æ—¶é—´ |
| **éœ€æ±‚å˜æ›´** | é«˜ | ä¸­ | æ¯å‘¨review,æ§åˆ¶èŒƒå›´è”“å»¶ |
| **æ•°æ®åº“è¿ç§»** | ä½ | é«˜ | æå‰å¤‡ä»½,ç°åº¦å‘å¸ƒ |

---

## éªŒæ”¶æ ‡å‡†

### 11.1 åŠŸèƒ½å®Œæ•´æ€§

| éªŒæ”¶é¡¹ | æ ‡å‡† | éªŒæ”¶æ–¹å¼ |
|-------|------|---------|
| **é¡µé¢å®Œæˆåº¦** | 18/18é¡µé¢å®Œæˆ(100%) | é¡µé¢æ¸…å•é€ä¸€æ£€æŸ¥ |
| **APIé›†æˆ** | æ‰€æœ‰é¡µé¢ä¸åç«¯APIæ­£å¸¸äº¤äº’ | åŠŸèƒ½æµ‹è¯• |
| **ä¸šåŠ¡æµç¨‹** | å®Œæ•´ç”Ÿäº§æµç¨‹å¯èµ°é€š | ç«¯åˆ°ç«¯æµ‹è¯• |
| **æƒé™æ§åˆ¶** | 7ç§è§’è‰²æƒé™æ­£ç¡® | æƒé™æµ‹è¯• |
| **ç¦»çº¿åŠŸèƒ½** | æ‰“å¡ã€è´¨æ£€æ”¯æŒç¦»çº¿ | ç¦»çº¿æµ‹è¯• |
| **AIåˆ†æ** | DeepSeekçœŸå®é›†æˆ,æˆæœ¬<Â¥30/æœˆ | æˆæœ¬ç›‘æ§ |

### 11.2 æ€§èƒ½æŒ‡æ ‡

| æŒ‡æ ‡ | ç›®æ ‡å€¼ | å½“å‰å€¼ | æµ‹è¯•æ–¹æ³• |
|-----|-------|--------|---------|
| **Appå¯åŠ¨æ—¶é—´** | <3ç§’ | - | å†·å¯åŠ¨æµ‹è¯• |
| **APIå“åº”æ—¶é—´** | <500ms | - | APIæ€§èƒ½æµ‹è¯• |
| **åˆ—è¡¨åŠ è½½æ—¶é—´** | <2ç§’ | - | é¡µé¢åŠ è½½æµ‹è¯• |
| **åˆ—è¡¨æ»šåŠ¨å¸§ç‡** | â‰¥60fps | - | æ€§èƒ½ç›‘æ§å·¥å…· |
| **å†…å­˜å ç”¨** | <200MB | - | å†…å­˜ç›‘æ§ |
| **å´©æºƒç‡** | <1% | - | Crashlyticsç›‘æ§ |

### 11.3 ç”¨æˆ·ä½“éªŒ

| éªŒæ”¶é¡¹ | æ ‡å‡† | éªŒæ”¶æ–¹å¼ |
|-------|------|---------|
| **æ“ä½œæµç•…åº¦** | æ— æ˜æ˜¾å¡é¡¿,åŠ¨ç”»æµç•… | ç”¨æˆ·æµ‹è¯• |
| **é”™è¯¯æç¤º** | æ‰€æœ‰é”™è¯¯æœ‰å‹å¥½æç¤º | å¼‚å¸¸åœºæ™¯æµ‹è¯• |
| **åŠ è½½çŠ¶æ€** | æ‰€æœ‰å¼‚æ­¥æ“ä½œæœ‰Loading | UIæ£€æŸ¥ |
| **è¡¨å•éªŒè¯** | æ‰€æœ‰å¿…å¡«é¡¹æœ‰éªŒè¯,æç¤ºæ¸…æ™° | è¡¨å•æµ‹è¯• |
| **ç©ºçŠ¶æ€** | æ‰€æœ‰åˆ—è¡¨æœ‰ç©ºçŠ¶æ€æç¤º | UIæ£€æŸ¥ |
| **ç½‘ç»œå¼‚å¸¸å¤„ç†** | æ–­ç½‘/è¶…æ—¶æœ‰æç¤ºå’Œé‡è¯• | ç½‘ç»œå¼‚å¸¸æµ‹è¯• |

### 11.4 ä»£ç è´¨é‡

| éªŒæ”¶é¡¹ | æ ‡å‡† | éªŒæ”¶æ–¹å¼ |
|-------|------|---------|
| **ä»£ç è§„èŒƒ** | ESLintæ— é”™è¯¯,è­¦å‘Š<10ä¸ª | ä»£ç æ£€æŸ¥ |
| **ç»„ä»¶å¤ç”¨** | é€šç”¨ç»„ä»¶æå–åˆ°componentsç›®å½• | ä»£ç Review |
| **APIå°è£…** | æ‰€æœ‰APIè°ƒç”¨ç»Ÿä¸€å°è£… | ä»£ç Review |
| **é”™è¯¯å¤„ç†** | æ‰€æœ‰APIè°ƒç”¨æœ‰try-catch | ä»£ç Review |
| **ç±»å‹å®‰å…¨** | TypeScript strictæ¨¡å¼,æ— any | ç±»å‹æ£€æŸ¥ |
| **æ³¨é‡Šå®Œæ•´** | å¤æ‚é€»è¾‘æœ‰æ³¨é‡Šè¯´æ˜ | ä»£ç Review |

### 11.5 æµ‹è¯•è¦†ç›–

| æµ‹è¯•ç±»å‹ | è¦†ç›–ç‡ç›®æ ‡ | å½“å‰å€¼ | æµ‹è¯•å·¥å…· |
|---------|----------|--------|---------|
| **å•å…ƒæµ‹è¯•** | æ ¸å¿ƒä¸šåŠ¡é€»è¾‘>80% | - | Jest |
| **é›†æˆæµ‹è¯•** | å…³é”®API>90% | - | Supertest |
| **UIæµ‹è¯•** | æ ¸å¿ƒé¡µé¢>70% | - | React Native Testing Library |
| **E2Eæµ‹è¯•** | ä¸»æµç¨‹100% | - | Detox |

### 11.6 å‘å¸ƒæ£€æŸ¥æ¸…å•

**æ­£å¼å‘å¸ƒå‰æ£€æŸ¥**:
- [ ] æ‰€æœ‰Mockä»£ç å·²ç§»é™¤
- [ ] æ‰€æœ‰console.logå·²ç§»é™¤æˆ–æ”¹ä¸ºç”Ÿäº§ç¯å¢ƒä¸è¾“å‡º
- [ ] æ‰€æœ‰ç¡¬ç¼–ç çš„æµ‹è¯•æ•°æ®å·²ç§»é™¤
- [ ] APIåœ°å€å·²åˆ‡æ¢åˆ°ç”Ÿäº§ç¯å¢ƒ
- [ ] æ•æ„Ÿä¿¡æ¯(å¯†é’¥ã€Token)å·²ç¯å¢ƒå˜é‡åŒ–
- [ ] åº”ç”¨å›¾æ ‡å’Œå¯åŠ¨ç”»é¢å·²æ›¿æ¢ä¸ºæ­£å¼ç‰ˆ
- [ ] åº”ç”¨ç‰ˆæœ¬å·å·²æ›´æ–°
- [ ] åº”ç”¨æƒé™ç”³è¯·å·²å®Œå–„
- [ ] Crashlyticsç›‘æ§å·²é…ç½®
- [ ] æ€§èƒ½ç›‘æ§å·²é…ç½®
- [ ] ç”¨æˆ·åé¦ˆæ¸ é“å·²é…ç½®

---

## é™„å½•

### A. ç›¸å…³æ–‡æ¡£

- **PRD-ç³»ç»Ÿäº§å“éœ€æ±‚æ–‡æ¡£.md** - ç³»ç»Ÿæ•´ä½“éœ€æ±‚
- **PRD-è®¤è¯è§„åˆ’.md** - è®¤è¯ç³»ç»Ÿè¯¦ç»†è®¾è®¡
- **PRD-è®¤è¯ä¸ç”Ÿäº§æ¨¡å—ä¼˜åŒ–æ–¹æ¡ˆ.md** - ä¼˜åŒ–æ–¹æ¡ˆ(åŒ…å«DeepSeeké›†æˆ)
- **API_DOCUMENTATION.md** - åç«¯APIæ–‡æ¡£
- **backend/prisma/schema.prisma** - æ•°æ®åº“Schema

### B. æœ¯è¯­è¡¨

| æœ¯è¯­ | è‹±æ–‡ | è¯´æ˜ |
|-----|------|------|
| **æ‰¹æ¬¡** | Batch | ä¸€æ¬¡å®Œæ•´çš„ç”Ÿäº§è¿‡ç¨‹ |
| **æ‰¹æ¬¡å·** | Batch Number | å”¯ä¸€æ ‡è¯†ä¸€ä¸ªæ‰¹æ¬¡,æ ¼å¼: FAC001-20250105-001 |
| **å·¥æ—¶** | Work Hours | å‘˜å·¥å·¥ä½œæ—¶é•¿,ä»¥å°æ—¶æˆ–åˆ†é’Ÿè®¡ |
| **å·¥ç§** | Work Type | å‘˜å·¥å·¥ä½œç±»å‹,å¦‚ç”Ÿäº§ã€è´¨æ£€ç­‰ |
| **è´¨æ£€** | Quality Inspection | è´¨é‡æ£€éªŒ,åŒ…æ‹¬åŸæ–™ã€è¿‡ç¨‹ã€æˆå“ä¸‰é˜¶æ®µ |
| **åˆæ ¼ç‡** | Pass Rate | è´¨æ£€åˆæ ¼æ•°/æ€»è´¨æ£€æ•° |
| **å•ä½æˆæœ¬** | Cost Per Unit | æ€»æˆæœ¬/äº§é‡ |
| **åˆ©æ¶¦ç‡** | Profit Rate | (å”®ä»·-æˆæœ¬)/å”®ä»· |
| **æŠ˜æ—§ç‡** | Deprecation Rate | è®¾å¤‡æŠ˜æ—§è´¹ç”¨/å°æ—¶ |
| **è¿½æº¯ç ** | Traceability Code | äº§å“è¿½æº¯äºŒç»´ç ,ç»‘å®šæ‰¹æ¬¡ID |

### C. æŠ€æœ¯æ ˆ

**å‰ç«¯**:
- React Native 0.76+
- Expo 53+
- React Navigation 7+
- Zustand (çŠ¶æ€ç®¡ç†)
- React Query (æ•°æ®ç¼“å­˜)
- Zod (æ•°æ®éªŒè¯)
- React Native Chart Kit (å›¾è¡¨)
- React Native Fast Image (å›¾ç‰‡ä¼˜åŒ–)
- @shopify/flash-list (åˆ—è¡¨è™šæ‹ŸåŒ–)

**åç«¯**:
- Node.js 18+
- Express.js 4.18+
- Prisma 5.22+ (ORM)
- MySQL 8.0+
- Redis (å¯é€‰,ç”¨äºç¼“å­˜)
- DeepSeek API (AIåˆ†æ)

**å¼€å‘å·¥å…·**:
- TypeScript 5.0+
- ESLint + Prettier
- Jest (å•å…ƒæµ‹è¯•)
- React Native Testing Library
- Detox (E2Eæµ‹è¯•)

---

**æ–‡æ¡£ç»“æŸ**

*æœ€åæ›´æ–°: 2025-01-05*
*æ–‡æ¡£ç‰ˆæœ¬: v1.0*
*ä½œè€…: ç™½å©çºªé£Ÿå“æº¯æºç³»ç»Ÿå¼€å‘å›¢é˜Ÿ*
