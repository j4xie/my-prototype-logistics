# ç™½å©çºªé£Ÿå“æº¯æºç³»ç»Ÿ - äº§å“éœ€æ±‚æ–‡æ¡£ (PRD)

**æ–‡æ¡£ç‰ˆæœ¬**: v2.0
**åˆ›å»ºæ—¥æœŸ**: 2025-01-05
**æœ€åæ›´æ–°**: 2025-01-05
**é¡¹ç›®çŠ¶æ€**: å¼€å‘ä¸­ (Phase 1 - è®¤è¯ç³»ç»Ÿ)

---

## ğŸ“‹ ç›®å½•

1. [äº§å“æ¦‚è¿°](#äº§å“æ¦‚è¿°)
2. [ç”¨æˆ·è§’è‰²ä½“ç³»](#ç”¨æˆ·è§’è‰²ä½“ç³»)
3. [æ ¸å¿ƒåŠŸèƒ½æ¨¡å—](#æ ¸å¿ƒåŠŸèƒ½æ¨¡å—)
4. [æƒé™çŸ©é˜µ](#æƒé™çŸ©é˜µ)
5. [ä¸šåŠ¡æµç¨‹](#ä¸šåŠ¡æµç¨‹)
6. [æŠ€æœ¯æ¶æ„](#æŠ€æœ¯æ¶æ„)
7. [æ•°æ®æ¨¡å‹](#æ•°æ®æ¨¡å‹)
8. [API è®¾è®¡](#api-è®¾è®¡)
9. [éåŠŸèƒ½éœ€æ±‚](#éåŠŸèƒ½éœ€æ±‚)

---

## äº§å“æ¦‚è¿°

### 1.1 äº§å“å®šä½

ç™½å©çºªé£Ÿå“æº¯æºç³»ç»Ÿæ˜¯ä¸€ä¸ªé¢å‘é£Ÿå“åŠ å·¥è¡Œä¸šçš„**å¤šç§Ÿæˆ·**ã€**ç§»åŠ¨ä¼˜å…ˆ**çš„å…¨æµç¨‹æº¯æºç®¡ç†å¹³å°ã€‚

**æ ¸å¿ƒä»·å€¼**ï¼š
- ğŸ“± **ç§»åŠ¨ä¼˜å…ˆ**: React Native è·¨å¹³å°ç§»åŠ¨åº”ç”¨
- ğŸ­ **å¤šç§Ÿæˆ·æ¶æ„**: æ”¯æŒå¤šå·¥å‚ç‹¬ç«‹è¿è¥
- ğŸ” **ç²¾ç»†æƒé™**: 7çº§è§’è‰²æƒé™ä½“ç³»
- ğŸ“Š **æ™ºèƒ½åˆ†æ**: DeepSeek LLM æˆæœ¬åˆ†æ
- ğŸ”„ **å…¨ç¨‹æº¯æº**: ä»åŸæ–™åˆ°æˆå“çš„å®Œæ•´è¿½è¸ª

### 1.2 ç›®æ ‡ç”¨æˆ·

| ç”¨æˆ·ç±»å‹ | äººæ•°å æ¯” | ä¸»è¦åœºæ™¯ | ä½¿ç”¨é¢‘ç‡ |
|---------|---------|---------|---------|
| **å¹³å°ç®¡ç†å‘˜** | 2-5äºº | ç®¡ç†æ‰€æœ‰å·¥å‚ã€å¹³å°é…ç½® | æ¯å‘¨ |
| **å·¥å‚è¶…ç®¡** | æ¯å‚1-2äºº | å·¥å‚å…¨å±€ç®¡ç† | æ¯å¤© |
| **éƒ¨é—¨ç®¡ç†å‘˜** | æ¯å‚3-5äºº | éƒ¨é—¨ä¸šåŠ¡ç®¡ç† | æ¯å¤© |
| **æ“ä½œå‘˜** | æ¯å‚10-50äºº | æ—¥å¸¸æ•°æ®å½•å…¥ | æ¯å°æ—¶ |

### 1.3 äº§å“èŒƒå›´

**æœ¬æœŸèŒƒå›´ (Phase 1-3)**:
- âœ… å®Œæ•´çš„è®¤è¯æˆæƒç³»ç»Ÿ
- âœ… åŠ å·¥æ¨¡å— (æ‰¹æ¬¡ã€è´¨æ£€ã€æˆæœ¬æ ¸ç®—)
- âœ… å‘˜å·¥æ‰“å¡å’Œå·¥æ—¶ç»Ÿè®¡
- âœ… è®¾å¤‡ç›‘æ§å’Œå‘Šè­¦
- âœ… æ™ºèƒ½æˆæœ¬åˆ†æ (DeepSeek LLM)
- âœ… ç§»åŠ¨ç«¯åº”ç”¨ (iOS + Android)

**æœªæ¥è§„åˆ’ (Phase 4+)**:
- ğŸ”² å…»æ®–æ¨¡å—
- ğŸ”² ç‰©æµæ¨¡å—
- ğŸ”² é”€å”®æ¨¡å—
- ğŸ”² Web ç®¡ç†åå°

---

## ç”¨æˆ·è§’è‰²ä½“ç³»

### 2.1 è§’è‰²å±‚çº§æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          å¹³å°å±‚ (Platform Layer)          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚     platform_admin (å¹³å°ç®¡ç†å‘˜)    â”‚    â”‚
â”‚  â”‚   - ç®¡ç†æ‰€æœ‰å·¥å‚                   â”‚    â”‚
â”‚  â”‚   - ç®¡ç†æ‰€æœ‰ç”¨æˆ·                   â”‚    â”‚
â”‚  â”‚   - å¹³å°çº§é…ç½®                    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          å·¥å‚å±‚ (Factory Layer)           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  factory_super_admin (å·¥å‚è¶…ç®¡)   â”‚    â”‚
â”‚  â”‚   - å·¥å‚æ‰€æœ‰æƒé™                   â”‚    â”‚
â”‚  â”‚   - ç”¨æˆ·ç®¡ç†                      â”‚    â”‚
â”‚  â”‚   - æ‰€æœ‰éƒ¨é—¨æ•°æ®                   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                    â”‚                     â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚         â†“          â†“          â†“          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚permissionâ”‚ â”‚departmentâ”‚ â”‚ operator â”‚ â”‚
â”‚  â”‚  _admin  â”‚ â”‚  _admin  â”‚ â”‚          â”‚ â”‚
â”‚  â”‚æƒé™ç®¡ç†å‘˜ â”‚ â”‚éƒ¨é—¨ç®¡ç†å‘˜ â”‚ â”‚  æ“ä½œå‘˜  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚         â”‚                                â”‚
â”‚         â†“                                â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”                              â”‚
â”‚    â”‚viewerâ”‚                              â”‚
â”‚    â”‚æŸ¥çœ‹è€…â”‚                              â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”˜                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 è§’è‰²è¯¦ç»†è¯´æ˜

#### 2.2.1 å¹³å°è§’è‰²

**platform_admin (å¹³å°ç®¡ç†å‘˜)**

| å±æ€§ | è¯´æ˜ |
|-----|------|
| **æƒé™çº§åˆ«** | 0 (æœ€é«˜) |
| **ç”¨æˆ·ç±»å‹** | platform |
| **æ•°æ®è®¿é—®** | æ‰€æœ‰å·¥å‚æ‰€æœ‰æ•°æ® |
| **æ ¸å¿ƒèŒè´£** | å¹³å°è¿è¥ã€å·¥å‚ç®¡ç†ã€ç”¨æˆ·ç®¡ç† |
| **å…¸å‹åœºæ™¯** | åˆ›å»ºæ–°å·¥å‚ã€æ¿€æ´»ç”¨æˆ·ã€æŸ¥çœ‹è·¨å·¥å‚æŠ¥è¡¨ |

**æƒé™æ¸…å•**:
- âœ… åˆ›å»º/åˆ é™¤å·¥å‚
- âœ… ç®¡ç†æ‰€æœ‰å·¥å‚ç”¨æˆ·
- âœ… æŸ¥çœ‹æ‰€æœ‰å·¥å‚æ•°æ®
- âœ… å¹³å°çº§ç³»ç»Ÿé…ç½®
- âœ… è·¨å·¥å‚æ•°æ®åˆ†æ
- âœ… ç™½åå•ç®¡ç†
- âœ… ç³»ç»Ÿç›‘æ§å’Œæ—¥å¿—å®¡è®¡

#### 2.2.2 å·¥å‚è§’è‰²

**factory_super_admin (å·¥å‚è¶…çº§ç®¡ç†å‘˜)**

| å±æ€§ | è¯´æ˜ |
|-----|------|
| **æƒé™çº§åˆ«** | 0 (å·¥å‚å†…æœ€é«˜) |
| **ç”¨æˆ·ç±»å‹** | factory |
| **æ•°æ®è®¿é—®** | æœ¬å·¥å‚æ‰€æœ‰æ•°æ® |
| **éƒ¨é—¨è®¿é—®** | æ‰€æœ‰éƒ¨é—¨ |
| **æ ¸å¿ƒèŒè´£** | å·¥å‚è¿è¥ç®¡ç†ã€ç”¨æˆ·ç®¡ç†ã€å…¨å±€é…ç½® |

**æƒé™æ¸…å•**:
- âœ… å·¥å‚ç”¨æˆ·ç®¡ç†ï¼ˆåˆ›å»ºã€åˆ é™¤ã€è§’è‰²åˆ†é…ï¼‰
- âœ… æ‰€æœ‰éƒ¨é—¨æ•°æ®è¯»å†™
- âœ… å·¥å‚é…ç½®å’Œè®¾ç½®
- âœ… æŸ¥çœ‹æ‰€æœ‰ä¸šåŠ¡æ¨¡å—
- âœ… å¯¼å‡ºæ‰€æœ‰æ•°æ®
- âœ… å®¡æ‰¹å…³é”®æ“ä½œ

**permission_admin (æƒé™ç®¡ç†å‘˜)**

| å±æ€§ | è¯´æ˜ |
|-----|------|
| **æƒé™çº§åˆ«** | 5 |
| **æ•°æ®è®¿é—®** | æœ¬å·¥å‚æ‰€æœ‰æ•°æ® (åªè¯»+æƒé™ç®¡ç†) |
| **æ ¸å¿ƒèŒè´£** | ç”¨æˆ·æƒé™ç®¡ç†ã€è§’è‰²åˆ†é… |

**æƒé™æ¸…å•**:
- âœ… åˆ†é…å’Œè°ƒæ•´ç”¨æˆ·è§’è‰²
- âœ… æŸ¥çœ‹æ‰€æœ‰ç”¨æˆ·æƒé™
- âœ… æŸ¥çœ‹æ‰€æœ‰ä¸šåŠ¡æ•°æ®ï¼ˆåªè¯»ï¼‰
- âŒ ä¸èƒ½åˆ›å»º/åˆ é™¤ç”¨æˆ·
- âŒ ä¸èƒ½ä¿®æ”¹ä¸šåŠ¡æ•°æ®

**department_admin (éƒ¨é—¨ç®¡ç†å‘˜)**

| å±æ€§ | è¯´æ˜ |
|-----|------|
| **æƒé™çº§åˆ«** | 10 |
| **æ•°æ®è®¿é—®** | æœ¬éƒ¨é—¨æ•°æ® |
| **éƒ¨é—¨è®¿é—®** | å•ä¸ªéƒ¨é—¨ (farming/processing/logistics/quality) |
| **æ ¸å¿ƒèŒè´£** | éƒ¨é—¨ä¸šåŠ¡ç®¡ç†ã€éƒ¨é—¨å‘˜å·¥ç®¡ç† |

**æƒé™æ¸…å•**:
- âœ… ç®¡ç†æœ¬éƒ¨é—¨ç”¨æˆ·
- âœ… æœ¬éƒ¨é—¨æ‰€æœ‰ä¸šåŠ¡æ“ä½œ
- âœ… æŸ¥çœ‹æœ¬éƒ¨é—¨æ•°æ®
- âœ… å¯¼å‡ºæœ¬éƒ¨é—¨æ•°æ®
- âŒ ä¸èƒ½è®¿é—®å…¶ä»–éƒ¨é—¨æ•°æ®
- âŒ ä¸èƒ½ä¿®æ”¹å·¥å‚é…ç½®

**operator (æ“ä½œå‘˜)**

| å±æ€§ | è¯´æ˜ |
|-----|------|
| **æƒé™çº§åˆ«** | 30 |
| **æ•°æ®è®¿é—®** | æœ¬äººåˆ›å»ºçš„æ•°æ® |
| **æ ¸å¿ƒèŒè´£** | æ—¥å¸¸ä¸šåŠ¡æ“ä½œã€æ•°æ®å½•å…¥ |

**æƒé™æ¸…å•**:
- âœ… åˆ›å»ºä¸šåŠ¡è®°å½•ï¼ˆæ‰¹æ¬¡ã€æ‰“å¡ç­‰ï¼‰
- âœ… æŸ¥çœ‹æœ¬äººæ•°æ®
- âœ… ä¿®æ”¹æœ¬äººæœªæäº¤çš„æ•°æ®
- âŒ ä¸èƒ½åˆ é™¤å·²æäº¤æ•°æ®
- âŒ ä¸èƒ½æŸ¥çœ‹ä»–äººæ•°æ®

**viewer (æŸ¥çœ‹è€…)**

| å±æ€§ | è¯´æ˜ |
|-----|------|
| **æƒé™çº§åˆ«** | 50 |
| **æ•°æ®è®¿é—®** | æˆæƒæ•°æ®ï¼ˆåªè¯»ï¼‰ |
| **æ ¸å¿ƒèŒè´£** | æ•°æ®æŸ¥çœ‹ã€æŠ¥è¡¨æŸ¥çœ‹ |

**æƒé™æ¸…å•**:
- âœ… æŸ¥çœ‹æˆæƒèŒƒå›´å†…çš„æ•°æ®
- âŒ ä¸èƒ½è¿›è¡Œä»»ä½•å†™æ“ä½œ
- âŒ ä¸èƒ½å¯¼å‡ºæ•°æ®

**unactivated (æœªæ¿€æ´»)**

| å±æ€§ | è¯´æ˜ |
|-----|------|
| **æƒé™çº§åˆ«** | 99 (æœ€ä½) |
| **æ•°æ®è®¿é—®** | æ—  |
| **æ ¸å¿ƒèŒè´£** | å¾…æ¿€æ´»çŠ¶æ€ |

---

## æ ¸å¿ƒåŠŸèƒ½æ¨¡å—

### 3.1 è®¤è¯æˆæƒæ¨¡å— (Phase 1 - å·²å®Œæˆ)

#### 3.1.1 ç»Ÿä¸€ç™»å½•

**åŠŸèƒ½æè¿°**:
- æ™ºèƒ½è¯†åˆ«ç”¨æˆ·ç±»å‹ï¼ˆå¹³å°ç”¨æˆ· vs å·¥å‚ç”¨æˆ·ï¼‰
- æ”¯æŒç”¨æˆ·å/å¯†ç ç™»å½•
- æ”¯æŒç”Ÿç‰©è¯†åˆ«ç™»å½•ï¼ˆæŒ‡çº¹/Face IDï¼‰
- æ”¯æŒè‡ªåŠ¨ç™»å½•ï¼ˆToken æœªè¿‡æœŸï¼‰

**äº¤äº’æµç¨‹**:
```
ç”¨æˆ·è¾“å…¥ç”¨æˆ·åå¯†ç 
    â†“
ç³»ç»Ÿæ£€æŸ¥ PlatformAdmin è¡¨
    â”œâ”€ æ‰¾åˆ° â†’ å¹³å°ç”¨æˆ·ç™»å½•
    â””â”€ æœªæ‰¾åˆ° â†’ æ£€æŸ¥ User è¡¨
            â”œâ”€ æ‰¾åˆ° â†’ å·¥å‚ç”¨æˆ·ç™»å½•
            â””â”€ æœªæ‰¾åˆ° â†’ æç¤ºç”¨æˆ·ä¸å­˜åœ¨
    â†“
éªŒè¯å¯†ç 
    â”œâ”€ æˆåŠŸ â†’ ç”Ÿæˆ JWT Token
    â”‚         â”œâ”€ accessToken (24å°æ—¶)
    â”‚         â””â”€ refreshToken (7å¤©)
    â”œâ”€ å¤±è´¥ â†’ æç¤ºå¯†ç é”™è¯¯
    â†“
ä¿å­˜ Token åˆ° SecureStore
    â†“
æ ¹æ®è§’è‰²è·³è½¬åˆ°å¯¹åº”é¡µé¢
```

**API ç«¯ç‚¹**:
- `POST /api/mobile/auth/unified-login` - ç»Ÿä¸€ç™»å½•
- `POST /api/mobile/auth/refresh-token` - åˆ·æ–° Token
- `POST /api/mobile/auth/logout` - ç™»å‡º

#### 3.1.2 ä¸¤é˜¶æ®µæ³¨å†Œ

**Phase 1: æ‰‹æœºéªŒè¯**
- è¾“å…¥æ‰‹æœºå·
- å‘é€éªŒè¯ç 
- éªŒè¯ç æ ¡éªŒ
- ç™½åå•æ£€æŸ¥

**Phase 2: å®Œå–„ä¿¡æ¯**
- ä½¿ç”¨ tempToken
- å¡«å†™ç”¨æˆ·åã€å¯†ç 
- å¡«å†™å§“åã€éƒ¨é—¨
- å®Œæˆæ³¨å†Œ

**API ç«¯ç‚¹**:
- `POST /api/mobile/auth/register-phase-one` - æ‰‹æœºéªŒè¯
- `POST /api/mobile/auth/register-phase-two` - å®Œæˆæ³¨å†Œ

#### 3.1.3 è®¾å¤‡ç»‘å®š

**åŠŸèƒ½æè¿°**:
- è®°å½•è®¾å¤‡å”¯ä¸€æ ‡è¯†
- æ”¯æŒå¤šè®¾å¤‡ç™»å½•
- è®¾å¤‡ç®¡ç†ï¼ˆæŸ¥çœ‹/è§£ç»‘ï¼‰

**API ç«¯ç‚¹**:
- `POST /api/mobile/auth/bind-device` - ç»‘å®šè®¾å¤‡
- `GET /api/mobile/auth/devices` - æŸ¥çœ‹è®¾å¤‡åˆ—è¡¨

### 3.2 åŠ å·¥æ¨¡å— (Phase 2 - å·²å®Œæˆ)

#### 3.2.1 ç”Ÿäº§æ‰¹æ¬¡ç®¡ç†

**åŠŸèƒ½æè¿°**:
- åˆ›å»ºåŠ å·¥æ‰¹æ¬¡
- è®°å½•åŸæ–™ä¿¡æ¯ï¼ˆé±¼ç±»å‹ã€æ•°é‡ï¼‰
- è®°å½•åŠ å·¥å‚æ•°ï¼ˆæ¸©åº¦ã€æ—¶é—´ï¼‰
- æ‰¹æ¬¡çŠ¶æ€æµè½¬

**æ‰¹æ¬¡çŠ¶æ€**:
```
planning â†’ in_progress â†’ quality_check â†’ completed
                              â†“
                           failed
```

**æ•°æ®æ¨¡å‹**:
```typescript
interface ProcessingBatch {
  id: string;
  batchNumber: string;  // æ‰¹æ¬¡å·ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰
  factoryId: string;
  productType: string;  // äº§å“ç±»å‹
  fishType: string;     // é±¼ç±»å‹
  rawQuantity: number;  // åŸæ–™æ•°é‡ (kg)
  targetQuantity: number; // ç›®æ ‡äº§é‡
  actualQuantity: number; // å®é™…äº§é‡
  status: BatchStatus;
  startDate: DateTime;
  endDate?: DateTime;
  costPerKg?: number;   // å•ä½æˆæœ¬
  totalCost?: number;   // æ€»æˆæœ¬
}
```

**API ç«¯ç‚¹**:
- `POST /api/mobile/processing/batches` - åˆ›å»ºæ‰¹æ¬¡
- `GET /api/mobile/processing/batches` - æŸ¥è¯¢æ‰¹æ¬¡åˆ—è¡¨
- `GET /api/mobile/processing/batches/:id` - æŸ¥è¯¢æ‰¹æ¬¡è¯¦æƒ…
- `PUT /api/mobile/processing/batches/:id` - æ›´æ–°æ‰¹æ¬¡
- `POST /api/mobile/processing/batches/:id/complete` - å®Œæˆæ‰¹æ¬¡

#### 3.2.2 è´¨é‡æ£€éªŒ

**åŠŸèƒ½æè¿°**:
- åˆ›å»ºè´¨æ£€è®°å½•
- ä¸Šä¼ è´¨æ£€ç…§ç‰‡
- è®°å½•ä¸åˆæ ¼é¡¹
- è´¨æ£€ç»“æœï¼ˆåˆæ ¼/ä¸åˆæ ¼/æ¡ä»¶åˆæ ¼ï¼‰

**è´¨æ£€ç±»å‹**:
- `raw_material` - åŸæ–™è´¨æ£€
- `process` - è¿‡ç¨‹è´¨æ£€
- `final_product` - æˆå“è´¨æ£€

**API ç«¯ç‚¹**:
- `POST /api/mobile/processing/quality-inspections` - åˆ›å»ºè´¨æ£€
- `GET /api/mobile/processing/quality-inspections` - è´¨æ£€åˆ—è¡¨

#### 3.2.3 æˆæœ¬æ ¸ç®—

**åŠŸèƒ½æè¿°**:
- åŸæ–™æˆæœ¬
- äººå·¥æˆæœ¬ï¼ˆåŸºäºå·¥æ—¶ï¼‰
- è®¾å¤‡æˆæœ¬ï¼ˆæŠ˜æ—§ï¼‰
- èƒ½è€—æˆæœ¬
- ç»¼åˆæˆæœ¬åˆ†æ

**æˆæœ¬è®¡ç®—å…¬å¼**:
```
æ€»æˆæœ¬ = åŸæ–™æˆæœ¬ + äººå·¥æˆæœ¬ + è®¾å¤‡æˆæœ¬ + èƒ½è€—æˆæœ¬ + å…¶ä»–æˆæœ¬

å•ä½æˆæœ¬ = æ€»æˆæœ¬ / å®é™…äº§é‡

äººå·¥æˆæœ¬ = Î£(å‘˜å·¥å·¥æ—¶ Ã— æ—¶è–ª)
```

#### 3.2.4 æ™ºèƒ½æˆæœ¬åˆ†æ (DeepSeek LLM)

**åŠŸèƒ½æè¿°**:
- åˆ†ææˆæœ¬å¼‚å¸¸
- æä¾›ä¼˜åŒ–å»ºè®®
- æˆæœ¬è¶‹åŠ¿é¢„æµ‹
- å¯¹æ ‡åˆ†æ

**API ç«¯ç‚¹**:
- `POST /api/mobile/analysis/deepseek` - DeepSeek åˆ†æ

**ç¤ºä¾‹è¯·æ±‚**:
```json
{
  "batchId": "batch_123",
  "analysisType": "cost_optimization",
  "data": {
    "actualCost": 12.5,
    "targetCost": 10.0,
    "breakdown": {...}
  }
}
```

### 3.3 å‘˜å·¥ç®¡ç†æ¨¡å— (Phase 2 - å·²å®Œæˆ)

#### 3.3.1 å‘˜å·¥æ‰“å¡

**åŠŸèƒ½æè¿°**:
- ä¸Šç­æ‰“å¡ï¼ˆClock Inï¼‰
- ä¸‹ç­æ‰“å¡ï¼ˆClock Outï¼‰
- GPS ä½ç½®è®°å½•
- æ‰“å¡ç…§ç‰‡ï¼ˆå¯é€‰ï¼‰
- å¼‚å¸¸æ‰“å¡å¤„ç†

**æ‰“å¡ç±»å‹**:
- `normal` - æ­£å¸¸æ‰“å¡
- `late` - è¿Ÿåˆ°
- `early_leave` - æ—©é€€
- `overtime` - åŠ ç­
- `forgot` - è¡¥å¡

**API ç«¯ç‚¹**:
- `POST /api/mobile/timeclock/clock-in` - ä¸Šç­æ‰“å¡
- `POST /api/mobile/timeclock/clock-out` - ä¸‹ç­æ‰“å¡
- `GET /api/mobile/timeclock/records` - æ‰“å¡è®°å½•
- `GET /api/mobile/timeclock/current-session` - å½“å‰æ‰“å¡çŠ¶æ€

#### 3.3.2 å·¥æ—¶ç»Ÿè®¡

**åŠŸèƒ½æè¿°**:
- æ—¥å·¥æ—¶ç»Ÿè®¡
- å‘¨å·¥æ—¶ç»Ÿè®¡
- æœˆå·¥æ—¶ç»Ÿè®¡
- åŠ ç­å·¥æ—¶ç»Ÿè®¡
- å·¥æ—¶æŠ¥è¡¨å¯¼å‡º

**ç»Ÿè®¡ç»´åº¦**:
- æŒ‰å‘˜å·¥ç»Ÿè®¡
- æŒ‰éƒ¨é—¨ç»Ÿè®¡
- æŒ‰å·¥ç§ç»Ÿè®¡
- æŒ‰æ—¶é—´æ®µç»Ÿè®¡

**API ç«¯ç‚¹**:
- `GET /api/mobile/time-stats/daily` - æ—¥ç»Ÿè®¡
- `GET /api/mobile/time-stats/weekly` - å‘¨ç»Ÿè®¡
- `GET /api/mobile/time-stats/monthly` - æœˆç»Ÿè®¡
- `GET /api/mobile/time-stats/employee/:id` - å‘˜å·¥ç»Ÿè®¡

#### 3.3.3 å·¥ä½œè®°å½•

**åŠŸèƒ½æè¿°**:
- è®°å½•å·¥ä½œå†…å®¹
- è®°å½•å·¥ä½œæ‰¹æ¬¡
- è®°å½•å·¥ä½œå·¥ç§
- å·¥ä½œæ•ˆç‡åˆ†æ

**æ•°æ®æ¨¡å‹**:
```typescript
interface EmployeeWorkRecord {
  id: string;
  employeeId: number;
  factoryId: string;
  workType: string;      // å·¥ç§
  batchId?: string;      // å…³è”æ‰¹æ¬¡
  startTime: DateTime;
  endTime: DateTime;
  duration: number;      // å·¥æ—¶ï¼ˆå°æ—¶ï¼‰
  efficiency?: number;   // æ•ˆç‡åˆ†æ•°
  notes?: string;
}
```

### 3.4 è®¾å¤‡ç›‘æ§æ¨¡å— (Phase 2 - å·²å®Œæˆ)

#### 3.4.1 è®¾å¤‡å®æ—¶ç›‘æ§

**åŠŸèƒ½æè¿°**:
- è®¾å¤‡çŠ¶æ€ç›‘æ§ï¼ˆè¿è¡Œ/åœæœº/ç»´æŠ¤ï¼‰
- è®¾å¤‡å‚æ•°ç›‘æ§ï¼ˆæ¸©åº¦ã€æ¹¿åº¦ã€å‹åŠ›ï¼‰
- è®¾å¤‡æŠ¥è­¦
- è®¾å¤‡ç»´æŠ¤è®°å½•

**è®¾å¤‡çŠ¶æ€**:
- `normal` - æ­£å¸¸
- `warning` - è­¦å‘Š
- `error` - æ•…éšœ
- `maintenance` - ç»´æŠ¤ä¸­

**API ç«¯ç‚¹**:
- `GET /api/mobile/processing/equipment/monitoring` - è®¾å¤‡ç›‘æ§
- `POST /api/mobile/processing/equipment/:id/status` - æ›´æ–°çŠ¶æ€
- `GET /api/mobile/processing/equipment/:id/history` - å†å²æ•°æ®

#### 3.4.2 å‘Šè­¦ç³»ç»Ÿ

**åŠŸèƒ½æè¿°**:
- å®æ—¶å‘Šè­¦æ¨é€
- å‘Šè­¦çº§åˆ«åˆ†ç±»
- å‘Šè­¦å¤„ç†æµç¨‹
- å‘Šè­¦ç»Ÿè®¡åˆ†æ

**å‘Šè­¦çº§åˆ«**:
- `critical` - ä¸¥é‡ï¼ˆçº¢è‰²ï¼‰
- `warning` - è­¦å‘Šï¼ˆé»„è‰²ï¼‰
- `info` - æç¤ºï¼ˆè“è‰²ï¼‰

**å‘Šè­¦ç±»å‹**:
- `temperature_high` - æ¸©åº¦è¿‡é«˜
- `temperature_low` - æ¸©åº¦è¿‡ä½
- `equipment_failure` - è®¾å¤‡æ•…éšœ
- `quality_issue` - è´¨é‡é—®é¢˜
- `cost_overrun` - æˆæœ¬è¶…æ ‡

### 3.5 æ•°æ®åˆ†ææ¨¡å— (Phase 2 - å·²å®Œæˆ)

#### 3.5.1 ä»ªè¡¨æ¿

**å¹³å°ç®¡ç†å‘˜ä»ªè¡¨æ¿**:
- æ‰€æœ‰å·¥å‚æ¦‚è§ˆ
- è·¨å·¥å‚æ•°æ®å¯¹æ¯”
- å¹³å°çº§ KPI

**å·¥å‚ç®¡ç†å‘˜ä»ªè¡¨æ¿**:
- ç”Ÿäº§æ¦‚è§ˆï¼ˆä»Šæ—¥/æœ¬å‘¨/æœ¬æœˆï¼‰
- è´¨é‡æ¦‚è§ˆ
- æˆæœ¬æ¦‚è§ˆ
- äººå‘˜æ¦‚è§ˆ
- è®¾å¤‡æ¦‚è§ˆ

**éƒ¨é—¨ç®¡ç†å‘˜ä»ªè¡¨æ¿**:
- éƒ¨é—¨ç”Ÿäº§æ•°æ®
- éƒ¨é—¨å‘˜å·¥æ•°æ®
- éƒ¨é—¨æˆæœ¬æ•°æ®

**API ç«¯ç‚¹**:
- `GET /api/mobile/processing/dashboard/overview` - ä»ªè¡¨æ¿æ¦‚è§ˆ
- `GET /api/mobile/processing/dashboard/production` - ç”Ÿäº§ä»ªè¡¨æ¿
- `GET /api/mobile/processing/dashboard/quality` - è´¨é‡ä»ªè¡¨æ¿
- `GET /api/mobile/processing/dashboard/cost` - æˆæœ¬ä»ªè¡¨æ¿

#### 3.5.2 æŠ¥è¡¨ç”Ÿæˆ

**æŠ¥è¡¨ç±»å‹**:
- ç”Ÿäº§æŠ¥è¡¨ï¼ˆæ‰¹æ¬¡æ±‡æ€»ï¼‰
- è´¨æ£€æŠ¥è¡¨
- å·¥æ—¶æŠ¥è¡¨
- æˆæœ¬æŠ¥è¡¨
- è®¾å¤‡è¿è¡ŒæŠ¥è¡¨

**å¯¼å‡ºæ ¼å¼**:
- PDF
- Excel
- CSV

**API ç«¯ç‚¹**:
- `GET /api/mobile/reports/production` - ç”Ÿäº§æŠ¥è¡¨
- `GET /api/mobile/reports/quality` - è´¨æ£€æŠ¥è¡¨
- `GET /api/mobile/reports/timeclock` - å·¥æ—¶æŠ¥è¡¨
- `POST /api/mobile/reports/export` - å¯¼å‡ºæŠ¥è¡¨

---

## æƒé™çŸ©é˜µ

### 4.1 æ¨¡å—è®¿é—®æƒé™

| æ¨¡å— | platform_admin | factory_super_admin | permission_admin | department_admin | operator | viewer |
|-----|----------------|---------------------|------------------|------------------|----------|--------|
| **å¹³å°ç®¡ç†** | âœ… | âŒ | âŒ | âŒ | âŒ | âŒ |
| **å·¥å‚ç®¡ç†** | âœ… | âœ… | âŒ | âŒ | âŒ | âŒ |
| **ç”¨æˆ·ç®¡ç†** | âœ… | âœ… | âœ… (åªè¯»+è§’è‰²åˆ†é…) | âœ… (æœ¬éƒ¨é—¨) | âŒ | âŒ |
| **åŠ å·¥ç®¡ç†** | âœ… (æ‰€æœ‰å·¥å‚) | âœ… (æœ¬å·¥å‚) | ğŸ‘ï¸ (åªè¯») | âœ… (æœ¬éƒ¨é—¨) | âœ… (åˆ›å»ºè®°å½•) | ğŸ‘ï¸ (åªè¯») |
| **è´¨æ£€ç®¡ç†** | âœ… | âœ… | ğŸ‘ï¸ | âœ… (æœ¬éƒ¨é—¨) | âœ… (æäº¤è´¨æ£€) | ğŸ‘ï¸ |
| **å‘˜å·¥ç®¡ç†** | âœ… | âœ… | ğŸ‘ï¸ | âœ… (æœ¬éƒ¨é—¨) | âœ… (æ‰“å¡) | ğŸ‘ï¸ |
| **è®¾å¤‡ç›‘æ§** | âœ… | âœ… | ğŸ‘ï¸ | âœ… (æœ¬éƒ¨é—¨è®¾å¤‡) | ğŸ‘ï¸ | ğŸ‘ï¸ |
| **æ•°æ®åˆ†æ** | âœ… (å…¨å¹³å°) | âœ… (æœ¬å·¥å‚) | ğŸ‘ï¸ | âœ… (æœ¬éƒ¨é—¨) | ğŸ‘ï¸ (ä¸ªäººæ•°æ®) | ğŸ‘ï¸ (æˆæƒæ•°æ®) |
| **ç³»ç»Ÿé…ç½®** | âœ… | âœ… (å·¥å‚é…ç½®) | âŒ | âŒ | âŒ | âŒ |

**å›¾ä¾‹**: âœ… å®Œå…¨è®¿é—® | ğŸ‘ï¸ åªè¯»è®¿é—® | âŒ æ— æƒè®¿é—®

### 4.2 æ•°æ®è®¿é—®æƒé™

| è§’è‰² | æ•°æ®èŒƒå›´ | å¯è§å·¥å‚ | å¯è§éƒ¨é—¨ | å¯è§ç”¨æˆ· |
|-----|----------|----------|----------|----------|
| **platform_admin** | æ‰€æœ‰æ•°æ® | æ‰€æœ‰ | æ‰€æœ‰ | æ‰€æœ‰ |
| **factory_super_admin** | æœ¬å·¥å‚æ‰€æœ‰æ•°æ® | æœ¬å·¥å‚ | æ‰€æœ‰ | æœ¬å·¥å‚æ‰€æœ‰ |
| **permission_admin** | æœ¬å·¥å‚æ‰€æœ‰æ•°æ®ï¼ˆåªè¯»ï¼‰ | æœ¬å·¥å‚ | æ‰€æœ‰ | æœ¬å·¥å‚æ‰€æœ‰ |
| **department_admin** | æœ¬éƒ¨é—¨æ•°æ® | æœ¬å·¥å‚ | æœ¬éƒ¨é—¨ | æœ¬éƒ¨é—¨ |
| **operator** | æœ¬äººåˆ›å»ºçš„æ•°æ® | æœ¬å·¥å‚ | æœ¬éƒ¨é—¨ | æœ¬äºº |
| **viewer** | æˆæƒæ•°æ®ï¼ˆåªè¯»ï¼‰ | æˆæƒå·¥å‚ | æˆæƒéƒ¨é—¨ | æˆæƒç”¨æˆ· |

---

## ä¸šåŠ¡æµç¨‹

### 5.1 ç”¨æˆ·æ³¨å†Œæµç¨‹

```mermaid
sequenceDiagram
    participant ç”¨æˆ·
    participant å‰ç«¯
    participant åç«¯
    participant æ•°æ®åº“

    ç”¨æˆ·->>å‰ç«¯: è¾“å…¥æ‰‹æœºå·
    å‰ç«¯->>åç«¯: POST /api/mobile/auth/register-phase-one
    åç«¯->>æ•°æ®åº“: æ£€æŸ¥ç™½åå•
    alt æ‰‹æœºå·åœ¨ç™½åå•ä¸­
        æ•°æ®åº“-->>åç«¯: è¿”å›ç™½åå•è®°å½•
        åç«¯->>åç«¯: ç”ŸæˆéªŒè¯ç 
        åç«¯->>ç”¨æˆ·: å‘é€çŸ­ä¿¡éªŒè¯ç 
        åç«¯-->>å‰ç«¯: tempToken
        ç”¨æˆ·->>å‰ç«¯: è¾“å…¥éªŒè¯ç +ç”¨æˆ·ä¿¡æ¯
        å‰ç«¯->>åç«¯: POST /api/mobile/auth/register-phase-two
        åç«¯->>æ•°æ®åº“: åˆ›å»ºç”¨æˆ·è®°å½•
        åç«¯->>æ•°æ®åº“: æ›´æ–°ç™½åå•çŠ¶æ€
        åç«¯-->>å‰ç«¯: æ³¨å†ŒæˆåŠŸ+ç™»å½•Token
        å‰ç«¯->>å‰ç«¯: ä¿å­˜Token
        å‰ç«¯->>å‰ç«¯: è·³è½¬åˆ°ä¸»é¡µé¢
    else æ‰‹æœºå·ä¸åœ¨ç™½åå•
        åç«¯-->>å‰ç«¯: æç¤º"æ— æ³¨å†Œæƒé™"
    end
```

### 5.2 åŠ å·¥æ‰¹æ¬¡æµç¨‹

```mermaid
stateDiagram-v2
    [*] --> planning: åˆ›å»ºæ‰¹æ¬¡
    planning --> in_progress: å¼€å§‹åŠ å·¥
    in_progress --> quality_check: å®ŒæˆåŠ å·¥
    quality_check --> completed: è´¨æ£€åˆæ ¼
    quality_check --> failed: è´¨æ£€ä¸åˆæ ¼
    completed --> [*]
    failed --> [*]

    note right of planning
        è®°å½•ï¼šåŸæ–™ã€ç›®æ ‡äº§é‡
        æ“ä½œæƒé™ï¼šdepartment_admin+
    end note

    note right of in_progress
        è®°å½•ï¼šå®é™…äº§é‡ã€å·¥æ—¶ã€æˆæœ¬
        æ“ä½œæƒé™ï¼šoperator+
    end note

    note right of quality_check
        è®°å½•ï¼šè´¨æ£€ç»“æœã€ç…§ç‰‡
        æ“ä½œæƒé™ï¼šdepartment_admin+
    end note
```

### 5.3 å‘˜å·¥æ‰“å¡æµç¨‹

```
å‘˜å·¥åˆ°è¾¾å·¥å‚
    â†“
æ‰“å¼€App â†’ ç‚¹å‡»"ä¸Šç­æ‰“å¡"
    â†“
ç³»ç»Ÿè·å–GPSä½ç½®
    â†“
ä½ç½®éªŒè¯
    â”œâ”€ åœ¨å·¥å‚èŒƒå›´å†… â†’ å…è®¸æ‰“å¡
    â””â”€ ä¸åœ¨èŒƒå›´å†… â†’ æç¤º"ä¸åœ¨æ‰“å¡èŒƒå›´"
    â†“
æ‹æ‘„æ‰“å¡ç…§ç‰‡ï¼ˆå¯é€‰ï¼‰
    â†“
æäº¤æ‰“å¡
    â†“
ç³»ç»Ÿè®°å½•ï¼š
    - æ‰“å¡æ—¶é—´
    - GPSä½ç½®
    - æ‰“å¡ç…§ç‰‡
    - å·¥ä½œç±»å‹
    â†“
æ˜¾ç¤ºæ‰“å¡æˆåŠŸ
    â†“
å·¥ä½œä¸­...
    â†“
ç‚¹å‡»"ä¸‹ç­æ‰“å¡"
    â†“
è®¡ç®—å·¥æ—¶
    â†“
è®°å½•å·¥ä½œè®°å½•
    â†“
æ›´æ–°å·¥æ—¶ç»Ÿè®¡
```

---

## æŠ€æœ¯æ¶æ„

### 6.1 ç³»ç»Ÿæ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           ç§»åŠ¨ç«¯ (React Native)                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚   iOS    â”‚  â”‚ Android  â”‚  â”‚   Web    â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚ HTTPS/REST API
                      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              åç«¯æœåŠ¡ (Node.js + Express)         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ Auth API â”‚  â”‚Mobile APIâ”‚  â”‚ Admin APIâ”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚      ä¸šåŠ¡é€»è¾‘å±‚ (Controllers)         â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚      æ•°æ®è®¿é—®å±‚ (Prisma ORM)          â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              æ•°æ®åº“ (MySQL 8.0+)                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ ç”¨æˆ·æ•°æ®  â”‚  â”‚ ä¸šåŠ¡æ•°æ®  â”‚  â”‚ ç³»ç»Ÿæ•°æ®  â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  å¤–éƒ¨æœåŠ¡                        â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
        â”‚  â€¢ DeepSeek LLM (AIåˆ†æ)         â”‚
        â”‚  â€¢ çŸ­ä¿¡æœåŠ¡ (éªŒè¯ç )              â”‚
        â”‚  â€¢ å¯¹è±¡å­˜å‚¨ (å›¾ç‰‡/æ–‡ä»¶)           â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.2 æŠ€æœ¯æ ˆ

**å‰ç«¯ (React Native)**:
- React Native 0.76+
- Expo 53+
- React Navigation 7+
- Zustand (çŠ¶æ€ç®¡ç†)
- Axios (HTTP å®¢æˆ·ç«¯)
- Expo SecureStore (å®‰å…¨å­˜å‚¨)
- Expo LocalAuthentication (ç”Ÿç‰©è¯†åˆ«)

**åç«¯ (Node.js)**:
- Node.js 18+
- Express.js 4.18+
- Prisma 5.22+ (ORM)
- JWT (è®¤è¯)
- bcrypt (å¯†ç åŠ å¯†)
- Zod (æ•°æ®éªŒè¯)
- Winston (æ—¥å¿—)
- node-cron (å®šæ—¶ä»»åŠ¡)

**æ•°æ®åº“**:
- MySQL 8.0+ (å¼€å‘/ç”Ÿäº§)
- å¯è¿ç§»åˆ° PostgreSQL

**DevOps**:
- Docker (å®¹å™¨åŒ–)
- Nginx (åå‘ä»£ç†)

---

## æ•°æ®æ¨¡å‹

### 7.1 æ ¸å¿ƒæ•°æ®æ¨¡å‹ ER å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Factory       â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ id (PK)         â”‚
â”‚ name            â”‚
â”‚ industry        â”‚
â”‚ regionCode      â”‚
â”‚ isActive        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ 1
         â”‚
         â”‚ N
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     User        â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ id (PK)         â”‚
â”‚ username        â”‚
â”‚ factoryId (FK)  â”‚
â”‚ roleCode        â”‚â—„â”€â”€â”€â”€â”€â”
â”‚ department      â”‚      â”‚
â”‚ isActive        â”‚      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
         â”‚ 1             â”‚
         â”‚               â”‚ N
         â”‚ N      â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â” â”‚ UserRole     â”‚
â”‚ProcessingBatchâ”‚ â”‚  History     â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ id (PK)       â”‚
â”‚ batchNumber   â”‚
â”‚ factoryId(FK) â”‚
â”‚ supervisorId  â”‚
â”‚ status        â”‚
â”‚ fishType      â”‚
â”‚ rawQuantity   â”‚
â”‚ totalCost     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.2 å…³é”®æ•°æ®è¡¨

#### Factory (å·¥å‚)
```sql
CREATE TABLE factories (
  id VARCHAR(50) PRIMARY KEY,
  name VARCHAR(255) NOT NULL,
  industry VARCHAR(100),
  region_code VARCHAR(50),
  address TEXT,
  contact_name VARCHAR(100),
  contact_phone VARCHAR(20),
  is_active BOOLEAN DEFAULT true,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);
```

#### User (å·¥å‚ç”¨æˆ·)
```sql
CREATE TABLE users (
  id INT AUTO_INCREMENT PRIMARY KEY,
  username VARCHAR(50) UNIQUE NOT NULL,
  password_hash VARCHAR(255) NOT NULL,
  email VARCHAR(255),
  full_name VARCHAR(100),
  factory_id VARCHAR(50) NOT NULL,
  role_code ENUM('factory_super_admin', 'permission_admin',
                 'department_admin', 'operator', 'viewer', 'unactivated'),
  department ENUM('farming', 'processing', 'logistics',
                  'quality', 'management'),
  is_active BOOLEAN DEFAULT true,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (factory_id) REFERENCES factories(id)
);
```

#### PlatformAdmin (å¹³å°ç®¡ç†å‘˜)
```sql
CREATE TABLE platform_admins (
  id INT AUTO_INCREMENT PRIMARY KEY,
  username VARCHAR(50) UNIQUE NOT NULL,
  password_hash VARCHAR(255) NOT NULL,
  email VARCHAR(255) UNIQUE NOT NULL,
  full_name VARCHAR(100),
  role ENUM('platform_admin'),
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

#### ProcessingBatch (åŠ å·¥æ‰¹æ¬¡)
```sql
CREATE TABLE processing_batches (
  id VARCHAR(50) PRIMARY KEY,
  batch_number VARCHAR(100) UNIQUE NOT NULL,
  factory_id VARCHAR(50) NOT NULL,
  product_type VARCHAR(100),
  fish_type VARCHAR(100),
  raw_quantity DECIMAL(10,2),
  target_quantity DECIMAL(10,2),
  actual_quantity DECIMAL(10,2),
  status ENUM('planning', 'in_progress', 'quality_check',
              'completed', 'failed'),
  start_date TIMESTAMP,
  end_date TIMESTAMP,
  total_cost DECIMAL(12,2),
  cost_per_kg DECIMAL(10,2),
  supervisor_id INT,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (factory_id) REFERENCES factories(id),
  FOREIGN KEY (supervisor_id) REFERENCES users(id)
);
```

---

## API è®¾è®¡

### 8.1 API è§„èŒƒ

**Base URL**:
- å¼€å‘: `http://localhost:3001/api`
- ç”Ÿäº§: `https://api.cretas.com/api`

**è¯·æ±‚æ ¼å¼**: JSON
**å“åº”æ ¼å¼**: JSON
**è®¤è¯æ–¹å¼**: JWT Bearer Token

**æ ‡å‡†å“åº”ç»“æ„**:
```json
{
  "success": true,
  "data": {...},
  "message": "æ“ä½œæˆåŠŸ",
  "timestamp": "2025-01-05T10:00:00Z"
}
```

**é”™è¯¯å“åº”ç»“æ„**:
```json
{
  "success": false,
  "error": {
    "code": "UNAUTHORIZED",
    "message": "æœªæˆæƒè®¿é—®",
    "details": {...}
  },
  "timestamp": "2025-01-05T10:00:00Z"
}
```

### 8.2 æ ¸å¿ƒ API ç«¯ç‚¹

è¯¦è§ [APIæ–‡æ¡£](./API-Reference.md)

**è®¤è¯ç›¸å…³**:
- `POST /mobile/auth/unified-login` - ç»Ÿä¸€ç™»å½•
- `POST /mobile/auth/register-phase-one` - æ³¨å†Œç¬¬ä¸€æ­¥
- `POST /mobile/auth/register-phase-two` - æ³¨å†Œç¬¬äºŒæ­¥
- `POST /mobile/auth/logout` - ç™»å‡º
- `POST /mobile/auth/refresh-token` - åˆ·æ–°Token

**åŠ å·¥ç›¸å…³**:
- `POST /mobile/processing/batches` - åˆ›å»ºæ‰¹æ¬¡
- `GET /mobile/processing/batches` - æ‰¹æ¬¡åˆ—è¡¨
- `GET /mobile/processing/batches/:id` - æ‰¹æ¬¡è¯¦æƒ…
- `PUT /mobile/processing/batches/:id` - æ›´æ–°æ‰¹æ¬¡

**å‘˜å·¥ç›¸å…³**:
- `POST /mobile/timeclock/clock-in` - ä¸Šç­æ‰“å¡
- `POST /mobile/timeclock/clock-out` - ä¸‹ç­æ‰“å¡
- `GET /mobile/time-stats/daily` - æ—¥å·¥æ—¶ç»Ÿè®¡

---

## éåŠŸèƒ½éœ€æ±‚

### 9.1 æ€§èƒ½è¦æ±‚

| æŒ‡æ ‡ | ç›®æ ‡å€¼ | è¯´æ˜ |
|-----|-------|------|
| **Appå¯åŠ¨æ—¶é—´** | <3ç§’ | å†·å¯åŠ¨åˆ°å¯äº¤äº’ |
| **APIå“åº”æ—¶é—´** | <500ms | P95 å“åº”æ—¶é—´ |
| **é¡µé¢åˆ‡æ¢** | <300ms | é¡µé¢è¿‡æ¸¡åŠ¨ç”» |
| **ç¦»çº¿æ”¯æŒ** | æ ¸å¿ƒåŠŸèƒ½ | æ‰“å¡ã€æ•°æ®å½•å…¥ |
| **å¹¶å‘ç”¨æˆ·** | 1000+ | å•å·¥å‚å³°å€¼ |
| **æ•°æ®åº“æ€§èƒ½** | <100ms | å•è¡¨æŸ¥è¯¢ |

### 9.2 å®‰å…¨è¦æ±‚

| éœ€æ±‚ | å®ç°æ–¹å¼ |
|-----|---------|
| **å¯†ç å®‰å…¨** | bcrypt åŠ å¯†ï¼Œè‡³å°‘12è½® |
| **Tokenå®‰å…¨** | JWTï¼Œ24å°æ—¶è¿‡æœŸ |
| **HTTPS** | ç”Ÿäº§ç¯å¢ƒå¼ºåˆ¶HTTPS |
| **SQLæ³¨å…¥é˜²æŠ¤** | Prisma ORM å‚æ•°åŒ–æŸ¥è¯¢ |
| **XSSé˜²æŠ¤** | è¾“å…¥éªŒè¯ + è¾“å‡ºè½¬ä¹‰ |
| **æƒé™éªŒè¯** | æ¯ä¸ªAPIè¯·æ±‚éªŒè¯æƒé™ |
| **å®¡è®¡æ—¥å¿—** | è®°å½•æ‰€æœ‰å…³é”®æ“ä½œ |

### 9.3 å¯ç”¨æ€§è¦æ±‚

| æŒ‡æ ‡ | ç›®æ ‡å€¼ |
|-----|-------|
| **ç³»ç»Ÿå¯ç”¨æ€§** | 99.5% |
| **æ•°æ®å¤‡ä»½** | æ¯æ—¥è‡ªåŠ¨å¤‡ä»½ |
| **æ•…éšœæ¢å¤** | <2å°æ—¶ RTO |
| **æ•°æ®ä¸¢å¤±** | <15åˆ†é’Ÿ RPO |

### 9.4 å…¼å®¹æ€§è¦æ±‚

| å¹³å° | ç‰ˆæœ¬è¦æ±‚ |
|-----|---------|
| **iOS** | iOS 13.0+ |
| **Android** | Android 8.0+ (API 26+) |
| **åç«¯** | Node.js 18+ |
| **æ•°æ®åº“** | MySQL 8.0+ / PostgreSQL 13+ |

---

## é™„å½•

### A. æœ¯è¯­è¡¨

| æœ¯è¯­ | è¯´æ˜ |
|-----|------|
| **æ‰¹æ¬¡** | ä¸€æ¬¡å®Œæ•´çš„åŠ å·¥ç”Ÿäº§è¿‡ç¨‹ |
| **å·¥æ—¶** | å‘˜å·¥å·¥ä½œæ—¶é•¿ï¼Œä»¥å°æ—¶è®¡ |
| **å·¥ç§** | å‘˜å·¥å·¥ä½œç±»å‹ï¼Œå¦‚"åŠ å·¥å·¥"ã€"è´¨æ£€å‘˜" |
| **ç™½åå•** | å…è®¸æ³¨å†Œçš„æ‰‹æœºå·åˆ—è¡¨ |
| **tempToken** | æ³¨å†Œè¿‡ç¨‹ä¸­çš„ä¸´æ—¶ä»¤ç‰Œï¼Œæœ‰æ•ˆæœŸ10åˆ†é’Ÿ |
| **å¤šç§Ÿæˆ·** | å¤šä¸ªå·¥å‚å…±äº«åŒä¸€ç³»ç»Ÿï¼Œæ•°æ®éš”ç¦» |

### B. çŠ¶æ€ç 

| çŠ¶æ€ç  | è¯´æ˜ |
|-------|------|
| 200 | æˆåŠŸ |
| 201 | åˆ›å»ºæˆåŠŸ |
| 400 | è¯·æ±‚å‚æ•°é”™è¯¯ |
| 401 | æœªæˆæƒ |
| 403 | æ— æƒé™ |
| 404 | èµ„æºä¸å­˜åœ¨ |
| 500 | æœåŠ¡å™¨é”™è¯¯ |

---

**æ–‡æ¡£ç»“æŸ**

*å¦‚æœ‰ç–‘é—®ï¼Œè¯·è”ç³»é¡¹ç›®è´Ÿè´£äºº*
