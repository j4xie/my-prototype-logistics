<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>白垩纪食品溯源系统 - 产品需求文档 (PRD) v3.0</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Roboto", "Helvetica Neue", Arial, sans-serif;
            line-height: 1.8;
            color: #333;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            border-radius: 12px;
            overflow: hidden;
        }

        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }

        header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .meta-info {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .meta-item {
            text-align: center;
        }

        .meta-label {
            font-size: 0.9em;
            opacity: 0.9;
            margin-bottom: 5px;
        }

        .meta-value {
            font-size: 1.1em;
            font-weight: 600;
        }

        .content {
            padding: 40px;
        }

        nav.toc {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 8px;
            margin-bottom: 40px;
            border-left: 4px solid #667eea;
        }

        nav.toc h2 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.5em;
        }

        nav.toc ol {
            margin-left: 20px;
        }

        nav.toc li {
            margin: 8px 0;
        }

        nav.toc a {
            color: #495057;
            text-decoration: none;
            transition: color 0.3s;
        }

        nav.toc a:hover {
            color: #667eea;
        }

        section {
            margin-bottom: 50px;
        }

        h2 {
            color: #2d3748;
            font-size: 2em;
            margin: 40px 0 20px 0;
            padding-bottom: 10px;
            border-bottom: 3px solid #667eea;
        }

        h3 {
            color: #4a5568;
            font-size: 1.5em;
            margin: 30px 0 15px 0;
        }

        h4 {
            color: #718096;
            font-size: 1.2em;
            margin: 20px 0 10px 0;
        }

        p {
            margin: 15px 0;
            text-align: justify;
        }

        pre {
            background: #2d3748;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 20px 0;
            font-family: 'Courier New', Consolas, Monaco, monospace;
            font-size: 0.9em;
            line-height: 1.6;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            overflow: hidden;
        }

        thead {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        th {
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }

        td {
            padding: 12px 15px;
            border-bottom: 1px solid #e2e8f0;
        }

        tbody tr:hover {
            background: #f7fafc;
        }

        tbody tr:last-child td {
            border-bottom: none;
        }

        .highlight-box {
            background: #fff5f5;
            border-left: 4px solid #f56565;
            padding: 20px;
            margin: 20px 0;
            border-radius: 4px;
        }

        .success-box {
            background: #f0fff4;
            border-left: 4px solid #48bb78;
            padding: 20px;
            margin: 20px 0;
            border-radius: 4px;
        }

        .info-box {
            background: #ebf8ff;
            border-left: 4px solid #4299e1;
            padding: 20px;
            margin: 20px 0;
            border-radius: 4px;
        }

        .warning-box {
            background: #fffaf0;
            border-left: 4px solid #ed8936;
            padding: 20px;
            margin: 20px 0;
            border-radius: 4px;
        }

        ul, ol {
            margin: 15px 0;
            padding-left: 30px;
        }

        li {
            margin: 8px 0;
        }

        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
            margin: 0 5px;
        }

        .badge-success {
            background: #c6f6d5;
            color: #22543d;
        }

        .badge-warning {
            background: #feebc8;
            color: #7c2d12;
        }

        .badge-danger {
            background: #fed7d7;
            color: #742a2a;
        }

        .badge-info {
            background: #bee3f8;
            color: #2c5282;
        }

        .flow-diagram {
            background: #f7fafc;
            padding: 25px;
            border-radius: 8px;
            margin: 20px 0;
            border: 2px dashed #cbd5e0;
        }

        .card {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .card-header {
            font-weight: 600;
            color: #667eea;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        footer {
            background: #2d3748;
            color: white;
            padding: 30px;
            text-align: center;
            margin-top: 40px;
        }

        .grid-2 {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin: 20px 0;
        }

        .grid-3 {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin: 20px 0;
        }

        @media (max-width: 768px) {
            .grid-2, .grid-3 {
                grid-template-columns: 1fr;
            }

            header h1 {
                font-size: 1.8em;
            }

            .meta-info {
                grid-template-columns: 1fr;
            }
        }

        .icon {
            font-size: 1.2em;
            margin-right: 8px;
        }

        .section-number {
            display: inline-block;
            background: #667eea;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            text-align: center;
            line-height: 30px;
            margin-right: 10px;
            font-weight: 600;
        }

        code {
            background: #edf2f7;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            color: #d53f8c;
        }

        .kpi-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
        }

        .kpi-value {
            font-size: 2.5em;
            font-weight: 700;
            margin: 10px 0;
        }

        .kpi-label {
            font-size: 0.9em;
            opacity: 0.9;
        }

        @media print {
            body {
                background: white;
            }

            .container {
                box-shadow: none;
            }

            pre {
                page-break-inside: avoid;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>🦖 白垩纪食品溯源系统</h1>
            <h2 style="font-weight: 400; margin-top: 10px;">产品需求文档 (PRD)</h2>

            <div class="meta-info">
                <div class="meta-item">
                    <div class="meta-label">文档版本</div>
                    <div class="meta-value">v3.0</div>
                </div>
                <div class="meta-item">
                    <div class="meta-label">创建日期</div>
                    <div class="meta-value">2025-10-08</div>
                </div>
                <div class="meta-item">
                    <div class="meta-label">项目状态</div>
                    <div class="meta-value">需求设计</div>
                </div>
                <div class="meta-item">
                    <div class="meta-label">目标</div>
                    <div class="meta-value">降本增效</div>
                </div>
            </div>
        </header>

        <div class="content">
            <!-- 目录 -->
            <nav class="toc">
                <h2><span class="icon">📋</span>目录</h2>
                <ol>
                    <li><a href="#section-1">产品概述</a></li>
                    <li><a href="#section-2">业务背景与案例</a></li>
                    <li><a href="#section-3">用户角色体系</a></li>
                    <li><a href="#section-4">核心功能模块</a></li>
                    <li><a href="#section-5">界面设计与交互流程</a></li>
                    <li><a href="#section-6">业务流程图</a></li>
                    <li><a href="#section-7">异常场景处理</a></li>
                    <li><a href="#section-8">数据流转逻辑</a></li>
                    <li><a href="#section-9">非功能性需求</a></li>
                    <li><a href="#section-10">验收标准</a></li>
                </ol>
            </nav>

            <!-- 第1章：产品概述 -->
            <section id="section-1">
                <h2><span class="section-number">1</span>产品概述</h2>

                <h3>1.1 产品定位</h3>
                <p>白垩纪食品溯源系统是一个面向食品加工行业的<strong>端到端</strong>生产管理与成本控制平台，通过智能化的原材料管理、生产计划执行、实时成本分析和AI优化建议，帮助工厂降低生产成本、提高生产效率。</p>

                <h3>1.2 核心价值主张</h3>
                <div class="grid-2">
                    <div class="card">
                        <div class="card-header">📦 原材料FIFO管理</div>
                        <p>避免浪费，新鲜/冻货智能区分，先进先出自动推荐</p>
                    </div>
                    <div class="card">
                        <div class="card-header">📋 智能生产计划</div>
                        <p>自动预估原料，库存实时检查，精准生产规划</p>
                    </div>
                    <div class="card">
                        <div class="card-header">💰 精准成本分析</div>
                        <p>原料+人工+设备+消耗品全链路追踪，成本透明化</p>
                    </div>
                    <div class="card">
                        <div class="card-header">🤖 AI优化建议</div>
                        <p>DeepSeek智能分析，机器学习效率预测，可落地方案</p>
                    </div>
                </div>

                <h3>1.3 关键指标 (KPI)</h3>
                <div class="grid-3">
                    <div class="kpi-card">
                        <div class="kpi-label">单位成本降低</div>
                        <div class="kpi-value">15-30%</div>
                        <div class="kpi-label">通过优化人员、设备</div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-label">生产效率提升</div>
                        <div class="kpi-value">20-40%</div>
                        <div class="kpi-label">培训和流程优化</div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-label">原料浪费率</div>
                        <div class="kpi-value">&lt;2%</div>
                        <div class="kpi-label">FIFO和到期预警</div>
                    </div>
                </div>
            </section>

            <!-- 第2章：业务背景 -->
            <section id="section-2">
                <h2><span class="section-number">2</span>业务背景与案例</h2>

                <h3>2.1 典型业务场景</h3>
                <div class="info-box">
                    <h4>参与方</h4>
                    <ul>
                        <li><strong>工厂A</strong>：白垩纪水产加工厂</li>
                        <li><strong>供应商B</strong>：优质肉类供应商</li>
                        <li><strong>餐馆C</strong>：海鲜餐厅连锁店</li>
                    </ul>

                    <h4 style="margin-top: 20px;">业务需求</h4>
                    <ul>
                        <li>餐馆C需要 <code>1200g</code> 精制猪肉</li>
                        <li>供应商B提供 <code>2000g</code> 新鲜猪肉原料</li>
                        <li>工厂A预期转换率 <code>60%</code>（2000g → 1200g）</li>
                        <li>生产周期 <code>7天</code></li>
                    </ul>
                </div>

                <h3>2.2 业务痛点与解决方案</h3>
                <table>
                    <thead>
                        <tr>
                            <th>痛点</th>
                            <th>影响</th>
                            <th>解决方案</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>❌ 原料浪费严重</td>
                            <td>新鲜原料到期未使用，损失5-10%</td>
                            <td>✅ FIFO自动推荐，到期预警，新鲜/冻货转换</td>
                        </tr>
                        <tr>
                            <td>❌ 生产计划靠经验</td>
                            <td>原料预估不准，经常多采购或缺货</td>
                            <td>✅ 智能预估，基于转换率自动计算</td>
                        </tr>
                        <tr>
                            <td>❌ 成本不透明</td>
                            <td>只知道总成本，不知道哪里超支</td>
                            <td>✅ 4维成本分解（原料/人工/设备/其他）</td>
                        </tr>
                        <tr>
                            <td>❌ 员工效率无法量化</td>
                            <td>不知道谁干得好，谁需要培训</td>
                            <td>✅ 机器学习效率分析，个人评分</td>
                        </tr>
                        <tr>
                            <td>❌ 优化靠拍脑袋</td>
                            <td>成本超支不知道怎么改进</td>
                            <td>✅ AI智能建议，3-5条可落地方案</td>
                        </tr>
                    </tbody>
                </table>
            </section>

            <!-- 第3章：用户角色 -->
            <section id="section-3">
                <h2><span class="section-number">3</span>用户角色体系</h2>

                <h3>3.1 角色层级架构</h3>
                <div class="flow-diagram">
<pre>
                    ┌─────────────────────┐
                    │  平台层 (Platform)   │
                    │  platform_admin     │
                    │  • 管理所有工厂      │
                    │  • 跨工厂数据分析    │
                    │  • 只读权限          │
                    └──────────┬──────────┘
                               │
                ┌──────────────┴──────────────┐
                │                             │
    ┌───────────▼──────────┐      ┌──────────▼───────────┐
    │  工厂层 (Factory)     │      │  工厂层 (Factory)     │
    │  super_admin         │      │  super_admin         │
    │  • 工厂所有权限       │      │  • 工厂所有权限       │
    │  • 需要打卡          │      │  • 需要打卡          │
    └───────────┬──────────┘      └──────────┬───────────┘
                │                             │
    ┌───────────┼──────────┐      ┌──────────┼───────────┐
    │           │          │      │          │           │
┌───▼──┐   ┌───▼──┐   ┌──▼───┐ ┌▼─────┐ ┌──▼────┐ ┌───▼───┐
│dept  │   │dept  │   │dept  │ │dept  │ │dept   │ │dept   │
│admin │   │admin │   │admin │ │admin │ │admin  │ │admin  │
│加工部 │   │仓储部 │   │质检部 │ │养殖部 │ │物流部 │ │销售部 │
└───┬──┘   └───┬──┘   └──┬───┘ └┬─────┘ └──┬────┘ └───┬───┘
    │          │          │      │          │          │
┌───▼──────────▼──────────▼──────▼──────────▼──────────▼───┐
│                    operator (操作员)                       │
│                    • 打卡                                  │
│                    • 工作报告                              │
│                    • 查看本人数据                          │
└────────────────────────────────────────────────────────────┘
</pre>
                </div>

                <h3>3.2 角色权限矩阵</h3>
                <table>
                    <thead>
                        <tr>
                            <th>功能模块</th>
                            <th>platform_admin</th>
                            <th>super_admin</th>
                            <th>dept_admin</th>
                            <th>operator</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>登录认证</strong></td>
                            <td>✅ 不打卡</td>
                            <td>✅ 需打卡</td>
                            <td>✅ 需打卡</td>
                            <td>✅ 需打卡</td>
                        </tr>
                        <tr>
                            <td><strong>原材料入库</strong></td>
                            <td>👁️ 所有工厂只读</td>
                            <td>✅ 增删改查</td>
                            <td>❌ 无权限</td>
                            <td>❌ 无权限</td>
                        </tr>
                        <tr>
                            <td><strong>生产计划管理</strong></td>
                            <td>👁️ 所有工厂只读</td>
                            <td>✅ 增删改查</td>
                            <td>✅ 本部门增删改查</td>
                            <td>👁️ 查看任务</td>
                        </tr>
                        <tr>
                            <td><strong>每日产量记录</strong></td>
                            <td>❌ 不可操作</td>
                            <td>✅ 记录</td>
                            <td>✅ 本部门记录</td>
                            <td>❌ 无权限</td>
                        </tr>
                        <tr>
                            <td><strong>成本分析</strong></td>
                            <td>👁️ 所有工厂+AI</td>
                            <td>✅ 本工厂+AI</td>
                            <td>✅ 本部门+AI</td>
                            <td>❌ 无权限</td>
                        </tr>
                        <tr>
                            <td><strong>AI优化建议</strong></td>
                            <td>✅ 可调用</td>
                            <td>✅ 可调用</td>
                            <td>✅ 可调用</td>
                            <td>❌ 无权限</td>
                        </tr>
                        <tr>
                            <td><strong>库存管理</strong></td>
                            <td>👁️ 所有工厂只读</td>
                            <td>✅ 增删改查</td>
                            <td>👁️ 相关库存只读</td>
                            <td>❌ 无权限</td>
                        </tr>
                        <tr>
                            <td><strong>系统配置</strong></td>
                            <td>✅ 平台级</td>
                            <td>✅ 工厂级</td>
                            <td>❌ 无权限</td>
                            <td>❌ 无权限</td>
                        </tr>
                        <tr>
                            <td><strong>转换率配置</strong></td>
                            <td>❌ 不可修改</td>
                            <td>✅ 可配置</td>
                            <td>❌ 无权限</td>
                            <td>❌ 无权限</td>
                        </tr>
                    </tbody>
                </table>
                <p><small><strong>图例</strong>：✅ 完全权限 | 👁️ 只读 | ❌ 无权限</small></p>
            </section>

            <!-- 第4章：核心功能模块 -->
            <section id="section-4">
                <h2><span class="section-number">4</span>核心功能模块</h2>

                <h3>4.1 模块关系图</h3>
                <div class="flow-diagram">
<pre>
┌──────────────────────────────────────┐
│     ① 原材料入库模块                  │
│  • 供应商送货                         │
│  • 质检验收                           │
│  • 入库登记（15个字段）                │
│  • FIFO标记                          │
│  • 新鲜/冻货区分                      │
└────────────┬─────────────────────────┘
             │ 生成库存数据
             ▼
┌──────────────────────────────────────┐
│     ② 生产计划模块                    │
│  • 创建计划                           │
│  • 智能预估原料（基于转换率）           │
│  • 实时检查库存                        │
│  • FIFO自动推荐批次                   │
│  • 状态流转管理                        │
└────────────┬─────────────────────────┘
             │ 开始生产
             ▼
┌──────────────────────────────────────┐
│     ③ 生产执行与认证模块               │
│  • 员工打卡（GPS+生物识别）            │
│  • 每日产量记录                        │
│  • 原料消耗扣减（实时更新库存）         │
│  • 工时自动统计                        │
│  • 转换率实时计算                      │
└────────────┬─────────────────────────┘
             │ 完成生产
             ▼
┌──────────────────────────────────────┐
│     ④ 成本分析模块                    │
│  • 原料成本（基于消耗）                │
│  • 人工成本（基于工时）                │
│  • 设备成本（折旧+维修+消耗品+能耗）   │
│  • 其他成本                           │
│  • 单位成本计算                        │
└────────────┬─────────────────────────┘
             │ 触发AI分析
             ▼
┌──────────────────────────────────────┐
│     ⑤ AI智能分析模块                  │
│  • DeepSeek LLM分析                  │
│  • 转换率评估                         │
│  • 人工效率分析                        │
│  • 设备成本优化                        │
│  • 个人效率ML预测                     │
│  • 5条优化建议                        │
└────────────┬─────────────────────────┘
             │ 反馈优化
             ▼
┌──────────────────────────────────────┐
│     ⑥ 管理配置模块                    │
│  • 原材料类型管理                      │
│  • 产品类型管理                        │
│  • 转换率配置（可基于AI建议更新）       │
│  • AI参数配置                         │
│  • 生产线配置                         │
│  • 设备管理                           │
└──────────────────────────────────────┘
</pre>
                </div>

                <h3>4.2 原材料入库模块</h3>
                <div class="success-box">
                    <h4>功能目标</h4>
                    <p>确保原材料准确入库，避免浪费，支持FIFO先进先出管理</p>
                </div>

                <h4>入库表单设计（15个关键字段）</h4>
                <table>
                    <thead>
                        <tr>
                            <th>分类</th>
                            <th>字段名称</th>
                            <th>必填</th>
                            <th>说明</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td rowspan="4"><strong>基本信息</strong></td>
                            <td>供应商</td>
                            <td><span class="badge badge-danger">必填</span></td>
                            <td>从供应商列表选择</td>
                        </tr>
                        <tr>
                            <td>原料类型</td>
                            <td><span class="badge badge-danger">必填</span></td>
                            <td>从原料类型列表选择</td>
                        </tr>
                        <tr>
                            <td>入库批次号</td>
                            <td><span class="badge badge-info">自动</span></td>
                            <td>系统自动生成，格式：RAW_YYYYMMDD_NNN</td>
                        </tr>
                        <tr>
                            <td>入库日期</td>
                            <td><span class="badge badge-info">自动</span></td>
                            <td>系统自动填充当前时间</td>
                        </tr>
                        <tr>
                            <td rowspan="3"><strong>数量信息</strong></td>
                            <td>入库重量</td>
                            <td><span class="badge badge-danger">必填</span></td>
                            <td>手动输入，单位：g</td>
                        </tr>
                        <tr>
                            <td>单价</td>
                            <td><span class="badge badge-danger">必填</span></td>
                            <td>手动输入，单位：元/kg</td>
                        </tr>
                        <tr>
                            <td>总金额</td>
                            <td><span class="badge badge-info">自动</span></td>
                            <td>自动计算：重量 × 单价</td>
                        </tr>
                        <tr>
                            <td rowspan="5"><strong>储存信息</strong></td>
                            <td>储存类型</td>
                            <td><span class="badge badge-danger">必填</span></td>
                            <td>选择：新鲜/冻货</td>
                        </tr>
                        <tr>
                            <td>储存温度</td>
                            <td><span class="badge badge-danger">必填</span></td>
                            <td>如：0-4°C（新鲜）、-18°C以下（冻货）</td>
                        </tr>
                        <tr>
                            <td>储存位置</td>
                            <td><span class="badge badge-danger">必填</span></td>
                            <td>从仓位列表选择，如：冷藏区A-01</td>
                        </tr>
                        <tr>
                            <td>保质期</td>
                            <td><span class="badge badge-danger">必填</span></td>
                            <td>手动输入，单位：天</td>
                        </tr>
                        <tr>
                            <td>到期日期</td>
                            <td><span class="badge badge-info">自动</span></td>
                            <td>自动计算：入库日期 + 保质期</td>
                        </tr>
                        <tr>
                            <td rowspan="5"><strong>质检信息</strong></td>
                            <td>质检员</td>
                            <td><span class="badge badge-danger">必填</span></td>
                            <td>从员工列表选择</td>
                        </tr>
                        <tr>
                            <td>质检状态</td>
                            <td><span class="badge badge-danger">必填</span></td>
                            <td>选择：合格/不合格/待检</td>
                        </tr>
                        <tr>
                            <td>新鲜度评分</td>
                            <td><span class="badge badge-warning">可选</span></td>
                            <td>0-10分，质检员评分</td>
                        </tr>
                        <tr>
                            <td>质检备注</td>
                            <td><span class="badge badge-warning">可选</span></td>
                            <td>质检员填写，如：肉质新鲜，无异味</td>
                        </tr>
                        <tr>
                            <td>质检照片</td>
                            <td><span class="badge badge-warning">可选</span></td>
                            <td>拍照上传，最多10张</td>
                        </tr>
                    </tbody>
                </table>

                <h4>核心功能列表</h4>
                <ul>
                    <li>✅ <strong>15字段完整入库</strong>：涵盖基本、数量、储存、质检全部信息</li>
                    <li>✅ <strong>质检验收</strong>：合格才能入库，不合格自动拒绝</li>
                    <li>✅ <strong>FIFO自动标记</strong>：入库时自动设置时间戳，新鲜优先、先入先出</li>
                    <li>✅ <strong>库存实时更新</strong>：按原料类型自动汇总可用库存</li>
                    <li>✅ <strong>到期预警</strong>：3天前黄色、1天前橙色、当天红色、过期禁用</li>
                    <li>✅ <strong>新鲜/冻货转换</strong>：支持新鲜转冻货，保质期延长，FIFO重新计算</li>
                </ul>

                <h3>4.3 生产计划模块</h3>
                <div class="success-box">
                    <h4>功能目标</h4>
                    <p>创建生产计划，智能预估原料需求，管理生产全流程，实时监控转换率</p>
                </div>

                <h4>智能预估流程</h4>
                <div class="flow-diagram">
<pre>
用户输入目标产量: 1200g
    ↓
系统读取转换率配置: 60%
    ↓
自动计算预计消耗: 1200g ÷ 60% = 2000g
    ↓
实时查询库存: 新鲜猪肉 2000g ✅
    ↓
FIFO推荐批次: RAW_20251008_001 (最早入库)
    ↓
显示预计成本:
  • 原料: ¥50 (2kg × ¥25/kg)
  • 人工: ¥13,125 (350工时 × ¥37.5/时)
  • 设备: ¥2,000 (折旧+能耗)
  • 总计: ¥15,175
  • 单位: ¥12.65/kg
</pre>
                </div>

                <h4>状态流转图</h4>
                <div class="flow-diagram">
<pre>
pending (待生产)
    ↓ [开始生产] → 检查人员/原料
in_progress (生产中)
    ↓ [每日记录产量] → 库存扣减、进度更新
    ↓ [Day 1-7 循环记录]
    ↓ [Day 7 完成生产] → 最终确认
completed (已完成)
    ↓ [自动触发成本计算]
    ↓ [自动触发AI分析]
</pre>
                </div>

                <h4>核心功能列表</h4>
                <ul>
                    <li>✅ <strong>智能预估原料</strong>：基于转换率自动计算预计消耗</li>
                    <li>✅ <strong>库存充足性检查</strong>：实时查询，不足时提示缺口</li>
                    <li>✅ <strong>FIFO推荐批次</strong>：自动推荐最早/临期批次</li>
                    <li>✅ <strong>库存不足处理</strong>：降低产量/采购补货/使用替代批次</li>
                    <li>✅ <strong>每日产量记录</strong>：消耗、产出、转换率、库存扣减</li>
                    <li>✅ <strong>转换率监控</strong>：实时计算，偏差±5%触发AI分析</li>
                    <li>✅ <strong>状态流转</strong>：pending → in_progress → completed</li>
                </ul>

                <h3>4.4 成本分析模块</h3>
                <div class="success-box">
                    <h4>功能目标</h4>
                    <p>精准计算生产成本，分析成本构成，发现优化空间，支持4维成本分解</p>
                </div>

                <h4>成本构成（4维详细分解）</h4>
                <table>
                    <thead>
                        <tr>
                            <th>成本类型</th>
                            <th>金额</th>
                            <th>占比</th>
                            <th>详细说明</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>① 原料成本</strong></td>
                            <td>¥50.00</td>
                            <td>0.3%</td>
                            <td>2000g × ¥25/kg = ¥50</td>
                        </tr>
                        <tr style="background: #fff5f5;">
                            <td><strong>② 人工成本</strong> ⚠️</td>
                            <td>¥13,125.00</td>
                            <td>81.5%</td>
                            <td>
                                350工时 × ¥37.5/时<br>
                                <small>• 员工A-D: 各70h × ¥37.5 = ¥2,625</small><br>
                                <small>• 员工E: 68.25h × ¥37.5 = ¥2,559</small>
                            </td>
                        </tr>
                        <tr>
                            <td><strong>③ 设备成本</strong></td>
                            <td>¥2,421.20</td>
                            <td>15.0%</td>
                            <td>
                                • 折旧: ¥383.60<br>
                                • 维修: ¥350.00 ⚠️<br>
                                • 消耗品: ¥1,206.00 ⚠️<br>
                                &nbsp;&nbsp;- 刀片: ¥300<br>
                                &nbsp;&nbsp;- 砧板: ¥500<br>
                                &nbsp;&nbsp;- 手套: ¥175<br>
                                &nbsp;&nbsp;- 口罩: ¥70<br>
                                &nbsp;&nbsp;- 工作服: ¥100<br>
                                &nbsp;&nbsp;- 包装: ¥61<br>
                                • 能耗: ¥481.60
                            </td>
                        </tr>
                        <tr>
                            <td><strong>④ 其他成本</strong></td>
                            <td>¥500.00</td>
                            <td>3.1%</td>
                            <td>质检费用¥200 + 管理费用¥300</td>
                        </tr>
                        <tr style="background: #fffaf0;">
                            <td><strong>总成本</strong></td>
                            <td><strong>¥16,096.20</strong></td>
                            <td>100%</td>
                            <td>
                                单位成本: <strong>¥13.19/kg</strong><br>
                                预计成本: ¥15,175.00<br>
                                超支: <strong style="color: #d53f8c;">+¥921.20 (+4.3%)</strong>
                            </td>
                        </tr>
                    </tbody>
                </table>

                <h3>4.5 AI智能分析模块</h3>
                <div class="success-box">
                    <h4>功能目标</h4>
                    <p>调用DeepSeek AI，提供成本优化建议和效率改进方案，支持机器学习个人效率预测</p>
                </div>

                <h4>AI分析5维度</h4>
                <div class="grid-2">
                    <div class="card">
                        <div class="card-header">1️⃣ 转换率分析 ✅ 优秀</div>
                        <ul>
                            <li>实际61% vs 预期60%</li>
                            <li>评价：工艺控制良好</li>
                            <li>建议：更新系统配置为61%</li>
                        </ul>
                    </div>
                    <div class="card">
                        <div class="card-header">2️⃣ 人工成本分析 ⚠️ 需优化</div>
                        <ul>
                            <li>占比81.5%（行业65-70%）</li>
                            <li>小时产量3.49g/h（行业5-6g/h）</li>
                            <li>建议：减1人、培训、优化流程</li>
                        </ul>
                    </div>
                    <div class="card">
                        <div class="card-header">3️⃣ 设备成本分析 ⚠️ 略高</div>
                        <ul>
                            <li>维修频繁（¥350）</li>
                            <li>消耗品超支（¥1,206）</li>
                            <li>建议：预防性维护、优化配置</li>
                        </ul>
                    </div>
                    <div class="card">
                        <div class="card-header">4️⃣ 原料成本分析 ✅ 优秀</div>
                        <ul>
                            <li>利用率100%，零浪费</li>
                            <li>FIFO执行完美</li>
                            <li>建议：保持当前方式</li>
                        </ul>
                    </div>
                </div>

                <div class="warning-box">
                    <h4>5️⃣ 个人效率分析 📊 机器学习</h4>
                    <table>
                        <thead>
                            <tr>
                                <th>员工</th>
                                <th>工时</th>
                                <th>产出</th>
                                <th>效率</th>
                                <th>评价</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>员工C</td>
                                <td>70h</td>
                                <td>287g</td>
                                <td>118%</td>
                                <td>⭐⭐⭐⭐⭐ 优秀</td>
                            </tr>
                            <tr>
                                <td>员工B</td>
                                <td>70h</td>
                                <td>256g</td>
                                <td>105%</td>
                                <td>⭐⭐⭐⭐ 良好</td>
                            </tr>
                            <tr>
                                <td>员工A</td>
                                <td>70h</td>
                                <td>239g</td>
                                <td>98%</td>
                                <td>⭐⭐⭐ 达标</td>
                            </tr>
                            <tr>
                                <td>员工D</td>
                                <td>70h</td>
                                <td>224g</td>
                                <td>92%</td>
                                <td>⭐⭐ 需培训</td>
                            </tr>
                            <tr style="background: #fff5f5;">
                                <td>员工E</td>
                                <td>68.25h</td>
                                <td>214g</td>
                                <td>85%</td>
                                <td>⚠️ 偏低，有迟到早退</td>
                            </tr>
                        </tbody>
                    </table>
                    <p><strong>ML建议</strong>：需积累≥10批次数据后启用完整机器学习模型，实现个人效率实时监控和培训需求自动识别</p>
                </div>

                <h4>优化建议汇总</h4>
                <div class="highlight-box">
                    <h4>🔥 立即实施（预计节省¥5,044/批次，31.3%成本降低）</h4>
                    <ol>
                        <li><strong>减少生产线人员</strong>：5人 → 4人，节省 <code>¥2,625</code></li>
                        <li><strong>优化砧板配置</strong>：10个 → 6个，节省 <code>¥200</code></li>
                        <li><strong>更换优质刀片</strong>：耐用度提升50%，节省 <code>¥75</code></li>
                        <li><strong>实施预防性维护</strong>：减少50%维修成本，节省 <code>¥175</code></li>
                        <li><strong>员工效率培训</strong>：针对D、E，提升15%效率，节省 <code>¥1,969</code></li>
                    </ol>
                    <p style="margin-top: 15px;"><strong>优化后成本</strong>：¥11,052（<strong style="color: #48bb78;">¥9.06/kg</strong>）</p>
                </div>
            </section>

            <!-- 第5章：界面设计 -->
            <section id="section-5">
                <h2><span class="section-number">5</span>界面设计与交互流程</h2>

                <h3>5.1 系统导航架构</h3>
                <div class="flow-diagram">
<pre>
白垩纪食品溯源系统
│
├─ 登录/注册
│  ├─ 登录页 (用户名+密码 / 生物识别)
│  └─ 忘记密码
│
├─ 首页 (根据角色显示不同内容)
│  ├─ platform_admin: 所有工厂概览
│  ├─ super_admin: 本工厂概览 + 快捷操作
│  ├─ dept_admin: 本部门概览 + 快捷操作
│  └─ operator: 今日任务 + 打卡入口
│
├─ Tab 1: 打卡 ⏰
│  ├─ 上班打卡
│  ├─ 下班打卡
│  ├─ 打卡历史
│  └─ 工时统计
│
├─ Tab 2: 生产 🏭
│  ├─ 生产计划列表
│  │  └─ 创建计划 → 表单 → 提交 → 详情
│  ├─ 生产计划详情
│  │  ├─ [开始生产] → 确认 → 执行
│  │  ├─ [记录今日产量] → 表单 → 提交
│  │  └─ [完成生产] → 确认 → 触发成本计算
│  └─ 每日产量记录
│
├─ Tab 3: 成本 💰
│  ├─ 成本分析列表
│  ├─ 成本详情
│  │  ├─ 成本总览 + 饼图
│  │  ├─ 成本明细（可展开）
│  │  └─ [AI智能分析] → AI报告
│  └─ AI分析报告
│     ├─ 5维分析
│     ├─ 优化建议
│     └─ [采纳建议] → 更新配置
│
├─ Tab 4: 库存 📦
│  ├─ 库存概览 (FIFO优先级排序)
│  ├─ 原材料入库 → 15字段表单 → 提交
│  ├─ 入库历史
│  └─ 库存调整 (转冻货/报废)
│
├─ Tab 5: 管理 ⚙️
│  ├─ 系统配置
│  │  ├─ 原材料类型管理
│  │  ├─ 产品类型管理
│  │  ├─ 转换率配置 ⭐ 重点
│  │  ├─ AI参数配置
│  │  └─ 其他配置...
│  └─ 员工管理
│
└─ 个人中心 👤
   ├─ 个人信息
   ├─ 我的工时
   └─ 退出登录
</pre>
                </div>

                <h3>5.2 核心界面跳转流程</h3>
                <h4>生产计划完整流程（用户视角）</h4>
                <div class="flow-diagram">
<pre>
首页 → 点击"生产"Tab
    ↓
生产计划列表页
    ↓
点击 [+创建计划] 按钮
    ↓
填写创建表单:
  • 计划名称: 餐馆C订单-精制猪肉
  • 产品类型: 精制猪肉（选择）
  • 目标产量: 1200g（输入）
    ↓ 触发智能计算
  系统自动显示:
  • 预计消耗: 2000g（60%转换率）
  • 库存状态: 2000g ✅ 充足
  • FIFO推荐: RAW_20251008_001 ⭐
    ↓
  • 选择商家: 餐馆C
  • 生产线: 生产线1
  • 人员: 5人
  • 预计成本: ¥15,175
    ↓
点击 [创建计划] 按钮
    ↓
创建成功提示 ✅
    ↓
自动跳转到 → 生产计划详情页
    ↓
显示:
  • 状态: 🟡 待生产 (pending)
  • 基本信息、原料信息、人员配置
  • 操作按钮: [开始生产] [编辑] [删除]
    ↓
点击 [开始生产] 按钮
    ↓
弹出确认对话框:
  ✅ 人员到位: 5人
  ✅ 原料准备: 2000g
  ✅ 设备正常
  [确认开始] [取消]
    ↓
点击 [确认开始]
    ↓
页面自动刷新
    ↓
显示:
  • 状态: 🟢 生产中 (in_progress)
  • 生产进度条: 0%
  • 操作按钮: [记录今日产量] [暂停] [完成生产]
    ↓
每天点击 [记录今日产量]
    ↓
填写每日表单:
  • 今日消耗原料: 300g
  • 今日产出成品: 175g
    ↓ 系统自动计算
  • 转换率: 58.3%
  • 对比预期: 60%
  • 偏差: -1.7% ⚠️ 略低
  • 质检状态: 合格
  • 上传照片: 3张
    ↓
点击 [提交记录]
    ↓
系统处理:
  • 库存扣减: -300g
  • 累计产量: +175g
  • 进度更新: 14.6%
    ↓
返回计划详情页（更新后的数据）
    ↓
（循环7天...）
    ↓
Day 7 点击 [完成生产]
    ↓
填写完成确认表单:
  • 最终产量: 1220g
  • 质检状态: 全部合格 ✅
  • 确认数据准确 ✅
    ↓
点击 [确认完成]
    ↓
系统自动:
  • 状态变更: completed
  • 触发成本计算（后台）
  • 触发AI分析（后台）
    ↓
页面显示:
  • 状态: ✅ 已完成
  • 最终数据汇总
  • 新按钮: [查看成本分析] [AI智能分析]
    ↓
点击 [AI智能分析] 按钮
    ↓
跳转到 → AI分析报告页
    ↓
显示:
  • 加载动画（5-10秒）
  • AI分析报告
  • 5维详细分析
  • 优化建议列表
  • [采纳建议] [导出PDF] [分享]
</pre>
                </div>
            </section>

            <!-- 第6章：业务流程图 -->
            <section id="section-6">
                <h2><span class="section-number">6</span>业务流程图</h2>

                <h3>6.1 端到端业务流程（7天完整周期）</h3>

                <div class="card">
                    <div class="card-header">Day 1: 原材料入库</div>
                    <div class="flow-diagram">
<pre>
供应商B送货 (2000g新鲜猪肉)
    ↓
质检员验收 (新鲜度9.5分 ✅)
    ↓
super_admin办理入库
    • 打开App → 库存Tab → 原材料入库
    • 填写15字段:
      - 供应商: 供应商B
      - 原料类型: 新鲜猪肉
      - 重量: 2000g
      - 单价: ¥25/kg
      - 储存类型: 新鲜
      - 储存位置: 冷藏区A-01
      - 保质期: 7天
      - 质检状态: 合格
      - 质检评分: 9.5分
      - 上传照片: 3张
    • 点击[提交入库]
    ↓
系统处理
    • 生成批次号: RAW_20251008_001
    • 更新库存: 新鲜猪肉 +2000g
    • FIFO标记: 优先级1（最早）
    • 到期日期: 2025-10-15
    ↓
入库完成 ✅
    • 显示批次详情
    • 启动到期预警（7天后）
</pre>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">Day 1: 创建生产计划</div>
                    <div class="flow-diagram">
<pre>
接到餐馆C订单 (1200g精制猪肉)
    ↓
super_admin创建计划
    • 打开App → 生产Tab → [+创建计划]
    • 填写表单:
      - 计划名称: 餐馆C订单-精制猪肉
      - 产品类型: 精制猪肉
      - 目标产量: 1200g
    ↓
系统智能计算
    • 读取转换率: 60%
    • 预计消耗 = 1200g ÷ 60% = 2000g
    • 查询库存: 2000g
    • 充足性: ✅ 刚好满足
    ↓
FIFO推荐
    • 推荐: RAW_20251008_001 ⭐
    • 理由: 最早入库、新鲜、临近到期
    ↓
完善信息
    • 商家: 餐馆C
    • 交货: 2025-10-15
    • 生产线: 生产线1
    • 负责人: 王五
    • 人员: 5人
    • 生产天数: 7天
    ↓
系统预算成本
    • 原料: ¥50
    • 人工: ¥13,125
    • 设备: ¥2,000
    • 总计: ¥15,175 (¥12.65/kg)
    ↓
点击[创建计划]
    ↓
创建成功
    • 计划号: PROD_20251008_001
    • 状态: pending (待生产)
    • 库存预留: 锁定2000g
    • 通知负责人: 王五
</pre>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">Day 2-8: 生产执行（7天）</div>
                    <div class="flow-diagram">
<pre>
Day 2 (2025-10-09) 开始生产
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

08:00 - 5名员工打卡上班
    • 员工A: 8:00 ✅
    • 员工B: 8:02 ✅
    • 员工C: 8:05 ✅
    • 员工D: 8:08 ✅
    • 员工E: 8:15 ⚠️ 迟到15分钟
    ↓
08:00 - dept_admin (王五) 开始生产
    • 打开计划详情
    • 点击[开始生产]
    • 确认人员/原料 ✅
    • 点击[确认开始]
    ↓
系统更新
    • 状态: pending → in_progress
    • 开始时间: 2025-10-09 08:00
    • 关联5名员工
    ↓
17:30 - 王五记录今日产量
    • 点击[记录今日产量]
    • 消耗原料: 300g
    • 产出成品: 175g
    • 转换率: 58.3% ⚠️ 略低于60%
    • 质检: 合格 ✅
    • 上传照片: 3张
    • 点击[提交记录]
    ↓
系统处理
    • 库存扣减: RAW_20251008_001 -300g → 剩余1700g
    • 累计产量: 175g
    • 完成进度: 14.6%
    • 转换率预警: ⚠️ 首日略低，持续观察
    ↓
18:00 - 5名员工下班打卡
    • 工时统计: 各10小时（员工E 9.75h）
    ↓
Day 1 完成

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
Day 2-7 循环执行（每天重复上述流程）
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

Day 2: 消耗280g → 产出170g (60.7%) ✅ 改善
Day 3: 消耗290g → 产出180g (62.1%) ✅ 优化
Day 4: 消耗270g → 产出165g (61.1%) ✅ 稳定
Day 5: 消耗285g → 产出175g (61.4%) ✅ 稳定
Day 6: 消耗300g → 产出185g (61.7%) ✅ 良好
Day 7: 消耗275g → 产出170g (61.8%) ✅ 完成

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
7天汇总
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

累计消耗: 2000g (刚好用完 ✅)
累计产出: 1220g (超目标20g ✅)
平均转换率: 61.0% (优于预期60% ✅)
总工时: 350小时 (5人 × 7天 × 10h)
</pre>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">Day 8: 完成生产</div>
                    <div class="flow-diagram">
<pre>
wang五确认完成
    • 点击[完成生产]
    • 填写确认表单:
      - 实际产量: 1220g ✅
      - 质检状态: 全部合格 ✅
      - 确认数据准确无误 ✅
    • 点击[确认完成]
    ↓
系统处理
    • 状态: in_progress → completed
    • 完成时间: 2025-10-15 18:00
    • 数据锁定（不可再修改）
    • 批次库存清零
    ↓
自动触发成本计算
    • 原料成本: ¥50.00 (0.3%)
    • 人工成本: ¥13,125.00 (81.5%) ⚠️
    • 设备成本: ¥2,421.20 (15.0%)
      - 折旧: ¥383.60
      - 维修: ¥350.00
      - 消耗品: ¥1,206.00
      - 能耗: ¥481.60
    • 其他成本: ¥500.00 (3.1%)
    • 总成本: ¥16,096.20
    • 单位成本: ¥13.19/kg
    • 超支: +¥921.20 (+4.3%) ⚠️
    ↓
自动触发AI分析
</pre>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">Day 9: AI分析与优化</div>
                    <div class="flow-diagram">
<pre>
super_admin查看成本
    • 打开成本分析详情
    • 发现人工成本81.5%过高 ⚠️
    • 点击[AI智能分析]
    ↓
系统调用DeepSeek API
    • 收集分析数据
    • 发送到DeepSeek
    • 等待分析（5-10秒）
    ↓
AI返回分析报告
    ↓
显示5维分析:
  1️⃣ 转换率61% ✅ 优秀
      → 建议更新配置

  2️⃣ 人工成本81.5% ⚠️ 过高
      → 建议减1人、培训

  3️⃣ 设备成本 ⚠️ 维修频繁
      → 建议预防性维护

  4️⃣ 原料成本 ✅ 优秀
      → FIFO执行完美

  5️⃣ 个人效率 📊
      → 员工C最优118%
      → 员工E需培训85%
    ↓
优化建议汇总
    🔥 立即实施（节省¥5,044）:
    1. 减少人员5→4人
    2. 优化砧板10→6个
    3. 更换优质刀片
    4. 预防性维护
    5. 员工培训
    ↓
    优化后成本: ¥9.06/kg（降低31.3%）
    ↓
super_admin采纳建议
    • 点击[采纳建议]
    • 跳转到系统配置
    • 更新转换率: 60% → 61%
    • 调整生产线人员: 5 → 4人
    • 优化设备配置
    ↓
配置保存 ✅
    • 下次生产使用新配置
</pre>
                    </div>
                </div>
            </section>

            <!-- 第7章：异常场景 -->
            <section id="section-7">
                <h2><span class="section-number">7</span>异常场景处理</h2>

                <h3>7.1 库存不足场景</h3>
                <div class="warning-box">
                    <h4>触发条件</h4>
                    <p>创建计划时，预估消耗 &gt; 可用库存</p>

                    <h4>示例场景</h4>
                    <ul>
                        <li>目标产量: 1500g</li>
                        <li>预估消耗: 2500g (1500g ÷ 60%)</li>
                        <li>可用库存: 2000g</li>
                        <li>缺口: <strong style="color: #d53f8c;">500g ⚠️</strong></li>
                    </ul>

                    <h4>系统处理</h4>
                    <p><strong>弹出警告对话框</strong>，提供3个处理方案：</p>
                    <ol>
                        <li><strong>降低目标产量</strong>：建议调整为1200g（库存可满足）</li>
                        <li><strong>发起采购申请</strong>：需采购≥500g新鲜猪肉</li>
                        <li><strong>使用其他批次</strong>：如有冻货批次可选择（转换率降至58%）</li>
                    </ol>
                </div>

                <h3>7.2 转换率异常场景</h3>
                <div class="highlight-box">
                    <h4>触发条件</h4>
                    <p>|实际转换率 - 预期转换率| ≥ 5%</p>

                    <h4>示例场景</h4>
                    <ul>
                        <li>Day 1记录：消耗300g → 产出150g</li>
                        <li>转换率: 50% (预期60%)</li>
                        <li>偏差: <strong style="color: #e53e3e;">-10% 🔴 严重偏低</strong></li>
                    </ul>

                    <h4>系统处理</h4>
                    <ol>
                        <li><strong>显示红色预警</strong>：转换率异常警告</li>
                        <li><strong>列出可能原因</strong>：原料质量/员工操作/设备故障/质检标准</li>
                        <li><strong>调用AI诊断</strong>：分析具体原因并提供改善建议</li>
                        <li><strong>预测改善趋势</strong>：预计Day 2-3改善至58%，Day 4后稳定60-62%</li>
                    </ol>
                </div>

                <h3>7.3 原料到期场景</h3>
                <div class="warning-box">
                    <h4>触发条件</h4>
                    <p>距离到期 ≤ 3天</p>

                    <h4>预警级别</h4>
                    <ul>
                        <li><strong>3天前</strong>: ⚠️ 黄色预警（推送提醒）</li>
                        <li><strong>1天前</strong>: 🟠 橙色预警（强提醒，FIFO优先提高）</li>
                        <li><strong>当天</strong>: 🔴 红色预警（紧急处理，必须当日处理）</li>
                        <li><strong>已过期</strong>: ⛔ 禁用（无法用于生产，只能报废）</li>
                    </ul>

                    <h4>处理方案</h4>
                    <ol>
                        <li><strong>创建新生产计划</strong>：使用剩余原料（如150g可产90g成品）</li>
                        <li><strong>转为冻货</strong>：冷冻保存，延长保质期至30天</li>
                        <li><strong>申请报废</strong>：已过期或质量不合格，走报废流程</li>
                    </ol>
                </div>

                <h3>7.4 异常优先级定义</h3>
                <table>
                    <thead>
                        <tr>
                            <th>级别</th>
                            <th>响应时间</th>
                            <th>典型场景</th>
                            <th>处理要求</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr style="background: #fff5f5;">
                            <td><strong>P0 紧急</strong></td>
                            <td>5分钟</td>
                            <td>质检严重不合格、设备重大故障、数据丢失</td>
                            <td>立即响应、启动应急预案</td>
                        </tr>
                        <tr style="background: #fffaf0;">
                            <td><strong>P1 高</strong></td>
                            <td>4小时</td>
                            <td>转换率异常≥10%、成本超支≥10%、原料当日到期</td>
                            <td>AI辅助分析、提供解决方案</td>
                        </tr>
                        <tr style="background: #fffbeb;">
                            <td><strong>P2 中</strong></td>
                            <td>24小时</td>
                            <td>转换率偏差5-10%、成本超支5-10%、设备维修频繁</td>
                            <td>制定改进计划、定期复查</td>
                        </tr>
                        <tr>
                            <td><strong>P3 低</strong></td>
                            <td>1周</td>
                            <td>转换率偏差2-5%、个别员工迟到</td>
                            <td>记录备案、持续观察</td>
                        </tr>
                    </tbody>
                </table>
            </section>

            <!-- 第8章：数据流转 -->
            <section id="section-8">
                <h2><span class="section-number">8</span>数据流转逻辑</h2>

                <h3>8.1 核心数据流转</h3>

                <div class="grid-2">
                    <div class="card">
                        <div class="card-header">1. 原材料入库 → 库存更新</div>
<pre style="font-size: 0.85em;">
入库表单(15字段)
    ↓
raw_material_receipts 表
  • batchNumber
  • quantity
  • fifoTimestamp
    ↓
inventory 表
  • +quantity
  • fifoPriority
</pre>
                    </div>

                    <div class="card">
                        <div class="card-header">2. 创建计划 → 智能预估</div>
<pre style="font-size: 0.85em;">
目标产量 1200g
    ↓
读取转换率 60%
    ↓
预估消耗 2000g
    ↓
查询库存 2000g ✅
    ↓
production_plans 表
  • planNumber
  • status
  • estimated...
</pre>
                    </div>

                    <div class="card">
                        <div class="card-header">3. 打卡 → 工时 → 成本</div>
<pre style="font-size: 0.85em;">
员工上班打卡
    ↓
employee_clock_records
  • clockIn
  • gpsLocation
    ↓
work_sessions
  • duration
  • planId
    ↓
成本计算
工时 × 时薪
</pre>
                    </div>

                    <div class="card">
                        <div class="card-header">4. 每日记录 → 库存扣减</div>
<pre style="font-size: 0.85em;">
记录产量表单
  • 消耗300g
  • 产出175g
    ↓
计算转换率 58.3%
    ↓
库存扣减 -300g
    ↓
累计产量 +175g
进度 14.6%
</pre>
                    </div>
                </div>

                <h3>8.2 核心数据表结构</h3>
                <table>
                    <thead>
                        <tr>
                            <th>数据表</th>
                            <th>核心字段</th>
                            <th>用途</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>raw_material_receipts</code></td>
                            <td>batchNumber, quantity, storageType, expiryDate, fifoTimestamp</td>
                            <td>原材料入库记录</td>
                        </tr>
                        <tr>
                            <td><code>inventory</code></td>
                            <td>materialTypeId, totalQuantity, availableQuantity, fifoPriority</td>
                            <td>库存管理</td>
                        </tr>
                        <tr>
                            <td><code>production_plans</code></td>
                            <td>planNumber, status, targetQuantity, rawMaterialInfo, estimatedCosts</td>
                            <td>生产计划</td>
                        </tr>
                        <tr>
                            <td><code>daily_production_records</code></td>
                            <td>planId, rawConsumed, productOutput, conversionRate, deviation</td>
                            <td>每日产量记录</td>
                        </tr>
                        <tr>
                            <td><code>employee_clock_records</code></td>
                            <td>employeeId, clockType, clockTime, gpsLocation, status</td>
                            <td>员工打卡</td>
                        </tr>
                        <tr>
                            <td><code>work_sessions</code></td>
                            <td>employeeId, planId, duration, startTime, endTime</td>
                            <td>工作会话和工时</td>
                        </tr>
                        <tr>
                            <td><code>cost_analysis</code></td>
                            <td>planId, rawMaterialCost, laborCost, equipmentCost, totalCost</td>
                            <td>成本分析</td>
                        </tr>
                        <tr>
                            <td><code>ai_analysis_results</code></td>
                            <td>planId, analysisText, recommendations, confidence, apiCost</td>
                            <td>AI分析结果</td>
                        </tr>
                        <tr>
                            <td><code>ai_usage_log</code></td>
                            <td>planId, service, cost, tokens, timestamp</td>
                            <td>AI使用日志</td>
                        </tr>
                        <tr>
                            <td><code>conversion_rates</code></td>
                            <td>productTypeId, materialTypeId, conversionRate, aiRecommended</td>
                            <td>转换率配置</td>
                        </tr>
                    </tbody>
                </table>
            </section>

            <!-- 第9章：非功能需求 -->
            <section id="section-9">
                <h2><span class="section-number">9</span>非功能性需求</h2>

                <h3>9.1 性能要求</h3>
                <table>
                    <thead>
                        <tr>
                            <th>指标</th>
                            <th>目标值</th>
                            <th>说明</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>App启动时间</strong></td>
                            <td>&lt;3秒</td>
                            <td>冷启动到首页可交互</td>
                        </tr>
                        <tr>
                            <td><strong>API响应时间</strong></td>
                            <td>&lt;500ms</td>
                            <td>P95响应时间</td>
                        </tr>
                        <tr>
                            <td><strong>页面切换</strong></td>
                            <td>&lt;300ms</td>
                            <td>Tab切换和页面跳转</td>
                        </tr>
                        <tr>
                            <td><strong>AI分析响应</strong></td>
                            <td>&lt;10秒</td>
                            <td>DeepSeek API调用</td>
                        </tr>
                        <tr>
                            <td><strong>并发用户</strong></td>
                            <td>100+</td>
                            <td>单工厂峰值</td>
                        </tr>
                        <tr>
                            <td><strong>内存占用</strong></td>
                            <td>&lt;200MB</td>
                            <td>App稳态运行</td>
                        </tr>
                        <tr>
                            <td><strong>APK大小</strong></td>
                            <td>&lt;50MB</td>
                            <td>Android安装包</td>
                        </tr>
                    </tbody>
                </table>

                <h3>9.2 安全要求</h3>
                <div class="grid-2">
                    <div class="card">
                        <div class="card-header">身份认证</div>
                        <ul>
                            <li>密码加密: bcrypt (12轮)</li>
                            <li>Token过期: 24小时</li>
                            <li>生物识别: 指纹/Face ID</li>
                            <li>GPS验证: 打卡位置</li>
                        </ul>
                    </div>
                    <div class="card">
                        <div class="card-header">权限控制</div>
                        <ul>
                            <li>RBAC模型: 基于角色</li>
                            <li>最小权限原则</li>
                            <li>数据隔离: 工厂/部门/个人</li>
                            <li>每请求验证</li>
                        </ul>
                    </div>
                    <div class="card">
                        <div class="card-header">数据安全</div>
                        <ul>
                            <li>传输: HTTPS强制</li>
                            <li>存储: AES-256加密</li>
                            <li>防护: SQL注入/XSS/CSRF</li>
                            <li>备份: 每日增量，每周全量</li>
                        </ul>
                    </div>
                    <div class="card">
                        <div class="card-header">审计日志</div>
                        <ul>
                            <li>登录日志: 记录所有登录</li>
                            <li>操作日志: 关键操作记录</li>
                            <li>数据变更: 增删改记录</li>
                            <li>日志保留: 90天</li>
                        </ul>
                    </div>
                </div>

                <h3>9.3 兼容性要求</h3>
                <table>
                    <thead>
                        <tr>
                            <th>平台</th>
                            <th>版本要求</th>
                            <th>说明</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>iOS</strong></td>
                            <td>13.0+</td>
                            <td>iPhone 6S及以上</td>
                        </tr>
                        <tr>
                            <td><strong>Android</strong></td>
                            <td>8.0+ (API 26+)</td>
                            <td>2GB RAM以上设备</td>
                        </tr>
                        <tr>
                            <td><strong>Node.js</strong></td>
                            <td>18.0+ LTS</td>
                            <td>后端运行环境</td>
                        </tr>
                        <tr>
                            <td><strong>MySQL</strong></td>
                            <td>8.0+</td>
                            <td>数据库</td>
                        </tr>
                        <tr>
                            <td><strong>Redis</strong></td>
                            <td>6.0+ (可选)</td>
                            <td>缓存服务</td>
                        </tr>
                    </tbody>
                </table>
            </section>

            <!-- 第10章：验收标准 -->
            <section id="section-10">
                <h2><span class="section-number">10</span>验收标准</h2>

                <h3>10.1 功能验收清单</h3>

                <div class="grid-2">
                    <div class="card">
                        <div class="card-header">原材料入库模块 ✅</div>
                        <ul style="list-style: none; padding: 0;">
                            <li>☐ 15字段完整性验证</li>
                            <li>☐ 质检流程正确</li>
                            <li>☐ FIFO自动标记</li>
                            <li>☐ 库存实时更新</li>
                            <li>☐ 到期预警机制</li>
                            <li>☐ 新鲜/冻货转换</li>
                        </ul>
                    </div>

                    <div class="card">
                        <div class="card-header">生产计划模块 ✅</div>
                        <ul style="list-style: none; padding: 0;">
                            <li>☐ 智能预估准确</li>
                            <li>☐ 库存充足性检查</li>
                            <li>☐ FIFO自动推荐</li>
                            <li>☐ 状态流转正确</li>
                            <li>☐ 每日记录完整</li>
                            <li>☐ 转换率预警</li>
                        </ul>
                    </div>

                    <div class="card">
                        <div class="card-header">员工打卡模块 ✅</div>
                        <ul style="list-style: none; padding: 0;">
                            <li>☐ GPS验证(500m)</li>
                            <li>☐ 生物识别支持</li>
                            <li>☐ 异常打卡处理</li>
                            <li>☐ 工时自动统计</li>
                            <li>☐ 补打卡审批</li>
                        </ul>
                    </div>

                    <div class="card">
                        <div class="card-header">成本分析模块 ✅</div>
                        <ul style="list-style: none; padding: 0;">
                            <li>☐ 4维成本精准计算</li>
                            <li>☐ 成本构成可视化</li>
                            <li>☐ 实际vs预期对比</li>
                            <li>☐ 明细可展开</li>
                            <li>☐ 超支预警</li>
                        </ul>
                    </div>

                    <div class="card">
                        <div class="card-header">AI分析模块 ✅</div>
                        <ul style="list-style: none; padding: 0;">
                            <li>☐ DeepSeek API集成</li>
                            <li>☐ 5维深度分析</li>
                            <li>☐ 3-5条可落地建议</li>
                            <li>☐ 成本控制¥30/月</li>
                            <li>☐ 降级策略可用</li>
                            <li>☐ ML效率预测</li>
                        </ul>
                    </div>

                    <div class="card">
                        <div class="card-header">管理配置模块 ✅</div>
                        <ul style="list-style: none; padding: 0;">
                            <li>☐ 原料/产品类型管理</li>
                            <li>☐ 转换率配置</li>
                            <li>☐ AI参数配置</li>
                            <li>☐ 供应商/商家管理</li>
                            <li>☐ 生产线/设备管理</li>
                        </ul>
                    </div>
                </div>

                <h3>10.2 验收通过标准</h3>
                <div class="success-box">
                    <h4>必达指标</h4>
                    <ul>
                        <li>✅ 功能验收通过率 ≥ <strong>95%</strong></li>
                        <li>✅ 性能指标全部达标</li>
                        <li>✅ 无P0/P1级别bug</li>
                        <li>✅ P2级别bug &lt;5个</li>
                        <li>✅ 用户满意度 ≥ <strong>85%</strong></li>
                        <li>✅ 代码覆盖率 ≥ <strong>70%</strong></li>
                    </ul>
                </div>

                <h3>10.3 验收流程时间表</h3>
                <table>
                    <thead>
                        <tr>
                            <th>阶段</th>
                            <th>周期</th>
                            <th>验收内容</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>阶段1</strong></td>
                            <td>2周</td>
                            <td>功能验收（6大模块全部功能）</td>
                        </tr>
                        <tr>
                            <td><strong>阶段2</strong></td>
                            <td>3天</td>
                            <td>权限验收（4角色权限正确性）</td>
                        </tr>
                        <tr>
                            <td><strong>阶段3</strong></td>
                            <td>3天</td>
                            <td>性能验收（响应时间、并发）</td>
                        </tr>
                        <tr>
                            <td><strong>阶段4</strong></td>
                            <td>2天</td>
                            <td>异常验收（异常场景处理）</td>
                        </tr>
                        <tr>
                            <td><strong>阶段5</strong></td>
                            <td>2天</td>
                            <td>安全验收（认证、加密、防护）</td>
                        </tr>
                        <tr>
                            <td><strong>阶段6</strong></td>
                            <td>2天</td>
                            <td>兼容性验收（iOS/Android）</td>
                        </tr>
                        <tr>
                            <td><strong>阶段7</strong></td>
                            <td>1周</td>
                            <td>UAT用户验收（真实场景测试）</td>
                        </tr>
                    </tbody>
                </table>
            </section>

            <!-- 附录 -->
            <section>
                <h2>📄 附录</h2>

                <h3>附录A：术语表</h3>
                <table>
                    <thead>
                        <tr>
                            <th>术语</th>
                            <th>说明</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>FIFO</strong></td>
                            <td>First In First Out，先进先出库存管理原则</td>
                        </tr>
                        <tr>
                            <td><strong>转换率</strong></td>
                            <td>原料转换为成品的比率，如60%表示2000g原料产出1200g成品</td>
                        </tr>
                        <tr>
                            <td><strong>GPS</strong></td>
                            <td>全球定位系统，用于打卡位置验证</td>
                        </tr>
                        <tr>
                            <td><strong>JWT</strong></td>
                            <td>JSON Web Token，用户认证令牌</td>
                        </tr>
                        <tr>
                            <td><strong>DeepSeek</strong></td>
                            <td>国产大语言模型，用于智能成本分析</td>
                        </tr>
                        <tr>
                            <td><strong>ML</strong></td>
                            <td>Machine Learning，机器学习，用于个人效率预测</td>
                        </tr>
                        <tr>
                            <td><strong>SOP</strong></td>
                            <td>Standard Operating Procedure，标准操作流程</td>
                        </tr>
                        <tr>
                            <td><strong>ROI</strong></td>
                            <td>Return On Investment，投资回报率</td>
                        </tr>
                    </tbody>
                </table>

                <h3>附录B：文档变更记录</h3>
                <table>
                    <thead>
                        <tr>
                            <th>版本</th>
                            <th>日期</th>
                            <th>修改人</th>
                            <th>修改内容</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>v3.0</strong></td>
                            <td>2025-10-08</td>
                            <td>AI助手</td>
                            <td>完整PRD创建，包含业务案例、界面流程、数据流转、异常处理</td>
                        </tr>
                        <tr>
                            <td>v2.0</td>
                            <td>2025-01-05</td>
                            <td>项目组</td>
                            <td>添加AI分析和机器学习模块</td>
                        </tr>
                        <tr>
                            <td>v1.0</td>
                            <td>2024-12-01</td>
                            <td>项目组</td>
                            <td>初始版本</td>
                        </tr>
                    </tbody>
                </table>
            </section>

            <!-- 总结 -->
            <section>
                <h2>🎯 核心特性总结</h2>

                <div class="grid-3">
                    <div class="kpi-card">
                        <div class="kpi-label">15字段</div>
                        <div class="kpi-value">完整入库</div>
                        <div class="kpi-label">质检+FIFO+到期预警</div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-label">智能预估</div>
                        <div class="kpi-value">自动计算</div>
                        <div class="kpi-label">转换率+库存+成本</div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-label">4维成本</div>
                        <div class="kpi-value">精准分解</div>
                        <div class="kpi-label">原料+人工+设备+其他</div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-label">AI分析</div>
                        <div class="kpi-value">5维诊断</div>
                        <div class="kpi-label">DeepSeek + ML预测</div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-label">成本降低</div>
                        <div class="kpi-value">31.3%</div>
                        <div class="kpi-label">AI优化建议</div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-label">FIFO管理</div>
                        <div class="kpi-value">0浪费</div>
                        <div class="kpi-label">自动推荐+到期预警</div>
                    </div>
                </div>
            </section>
        </div>

        <footer>
            <p style="margin-bottom: 10px;">🦖 <strong>白垩纪食品溯源系统 - 产品需求文档</strong></p>
            <p style="font-size: 0.9em; opacity: 0.9;">本PRD文档基于实际业务需求整理，涵盖原材料入库、生产计划、员工打卡、成本分析、AI智能优化等完整业务流程</p>
            <p style="font-size: 0.85em; opacity: 0.8; margin-top: 15px;">版本 v3.0 | 创建于 2025-10-08 | 如有疑问请联系产品负责人</p>
        </footer>
    </div>

    <script>
        // 平滑滚动到锚点
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });

        // 打印友好提示
        window.addEventListener('beforeprint', () => {
            console.log('正在打印PRD文档...');
        });
    </script>
</body>
</html>
