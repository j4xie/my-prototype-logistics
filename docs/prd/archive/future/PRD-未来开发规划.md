# ç™½å©çºªé£Ÿå“æº¯æºç³»ç»Ÿ - æœªæ¥å¼€å‘è§„åˆ’ (Roadmap)

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**åˆ›å»ºæ—¥æœŸ**: 2025-01-05
**è§„åˆ’å‘¨æœŸ**: 2025 Q1 - 2026 Q4
**å½“å‰çŠ¶æ€**: Phase 0-3 å·²å®Œæˆ âœ…

---

## ğŸ“‹ ç›®å½•

1. [é¡¹ç›®ç°çŠ¶å›é¡¾](#é¡¹ç›®ç°çŠ¶å›é¡¾)
2. [Gapåˆ†ææ€»ç»“](#gapåˆ†ææ€»ç»“)
3. [Phase 4: ä¾›åº”é“¾ä¸åº“å­˜ç®¡ç†](#phase-4-ä¾›åº”é“¾ä¸åº“å­˜ç®¡ç†) (2025 Q1)
4. [Phase 5: é£Ÿå“å®‰å…¨åˆè§„](#phase-5-é£Ÿå“å®‰å…¨åˆè§„) (2025 Q2)
5. [Phase 6: å†·é“¾ä¸åŒ…è£…](#phase-6-å†·é“¾ä¸åŒ…è£…) (2025 Q3)
6. [Phase 7: è´¨é‡æ”¹è¿›ä¸å®Œå–„](#phase-7-è´¨é‡æ”¹è¿›ä¸å®Œå–„) (2025 Q4)
7. [Phase 8+: ä¸šåŠ¡æ‹“å±•](#phase-8-ä¸šåŠ¡æ‹“å±•) (2026+)
8. [æŠ€æœ¯æ¶æ„æ¼”è¿›](#æŠ€æœ¯æ¶æ„æ¼”è¿›)
9. [èµ„æºéœ€æ±‚ä¸é¢„ç®—](#èµ„æºéœ€æ±‚ä¸é¢„ç®—)

---

## ğŸ“Š é¡¹ç›®ç°çŠ¶å›é¡¾

### âœ… Phase 0-3 å·²å®ŒæˆåŠŸèƒ½ (2024 Q4)

#### Phase 1: è®¤è¯ä¸æƒé™ç³»ç»Ÿ
- âœ… ç»Ÿä¸€ç™»å½•ç³»ç»Ÿï¼ˆå¹³å°ç”¨æˆ·+å·¥å‚ç”¨æˆ·ï¼‰
- âœ… ä¸¤é˜¶æ®µæ³¨å†Œï¼ˆæ‰‹æœºéªŒè¯+ä¿¡æ¯å®Œå–„ï¼‰
- âœ… ç”Ÿç‰©è¯†åˆ«ç™»å½•ï¼ˆæŒ‡çº¹/Face IDï¼‰
- âœ… è®¾å¤‡ç»‘å®šä¸ç®¡ç†
- âœ… 7çº§è§’è‰²æƒé™ä½“ç³»ï¼ˆplatform_admin â†’ factory_super_admin â†’ permission_admin â†’ department_admin â†’ operator â†’ viewer â†’ unactivatedï¼‰
- âœ… æ‰¹é‡æƒé™æ£€æŸ¥
- âœ… ç™½åå•ç®¡ç†

#### Phase 2: ç”Ÿäº§æ‰§è¡Œç³»ç»Ÿ (MESæ ¸å¿ƒ)
- âœ… åŸæ–™æ¥æ”¶ç®¡ç†
- âœ… ç”Ÿäº§æ‰¹æ¬¡ç®¡ç†ï¼ˆæ‰¹æ¬¡åˆ›å»ºã€æµç¨‹æ§åˆ¶ã€æ—¶é—´çº¿ï¼‰
- âœ… è´¨é‡æ£€éªŒï¼ˆä¸‰é˜¶æ®µè´¨æ£€ï¼šåŸæ–™/è¿‡ç¨‹/æˆå“ï¼‰
- âœ… å‘˜å·¥æ‰“å¡ç³»ç»Ÿï¼ˆGPSéªŒè¯ã€ç…§ç‰‡æ‰“å¡ï¼‰
- âœ… å·¥æ—¶ç»Ÿè®¡ï¼ˆæ—¥/å‘¨/æœˆç»Ÿè®¡ï¼‰
- âœ… å·¥ä½œæ—¶æ®µç®¡ç†ï¼ˆæ‰¹æ¬¡å…³è”å·¥æ—¶ï¼‰
- âœ… è®¾å¤‡å®æ—¶ç›‘æ§
- âœ… è®¾å¤‡ä½¿ç”¨ä¸æˆæœ¬æ ¸ç®—
- âœ… æˆæœ¬æ ¸ç®—ç³»ç»Ÿï¼ˆåŸæ–™æˆæœ¬+äººå·¥æˆæœ¬+è®¾å¤‡æˆæœ¬ï¼‰
- âœ… AIæˆæœ¬åˆ†æï¼ˆDeepSeek LLMé›†æˆï¼‰
- âœ… å‘Šè­¦ç³»ç»Ÿï¼ˆè´¨é‡/è®¾å¤‡/ç”Ÿäº§å‘Šè­¦ï¼‰
- âœ… ä»ªè¡¨æ¿ç³»ç»Ÿï¼ˆç”Ÿäº§/è´¨é‡/æˆæœ¬/è®¾å¤‡/å‘Šè­¦ï¼‰

#### Phase 3: ç³»ç»Ÿç®¡ç†ä¸å‘å¸ƒ
- âœ… åº”ç”¨æ¿€æ´»ç®¡ç†
- âœ… æŠ¥è¡¨ç”Ÿæˆä¸å¯¼å‡ºï¼ˆPDF/Excel/CSVï¼‰
- âœ… ç³»ç»Ÿæ—¥å¿—ä¸å®¡è®¡
- âœ… APIè®¿é—®æ—¥å¿—
- âœ… ç§»åŠ¨ç«¯ä¼˜åŒ–ï¼ˆç›¸æœº/GPS/ç¦»çº¿åŠŸèƒ½è§„åˆ’ï¼‰

### ğŸ“ˆ å½“å‰ç³»ç»Ÿèƒ½åŠ›

**æŠ€æœ¯æ ˆ**:
- å‰ç«¯: React Native 0.76+ / Expo 53+
- åç«¯: Node.js 18+ / Express.js / Prisma ORM
- æ•°æ®åº“: MySQL 8.0+ (å¯è¿ç§»PostgreSQL)
- AI: DeepSeek LLM

**æ ¸å¿ƒæŒ‡æ ‡**:
- æ•°æ®åº“è¡¨: 30+ å¼ æ ¸å¿ƒè¡¨
- APIç«¯ç‚¹: 80+ ä¸ªç§»åŠ¨ç«¯API
- ç”¨æˆ·è§’è‰²: 7çº§æƒé™ä½“ç³»
- åŠŸèƒ½æ¨¡å—: 8å¤§æ ¸å¿ƒæ¨¡å—

---

## ğŸ” Gapåˆ†ææ€»ç»“

åŸºäºå¯¹çœŸå®é£Ÿå“åŠ å·¥å‚ä¸šåŠ¡æµç¨‹çš„è°ƒç ”ï¼Œæˆ‘ä»¬å‘ç°å½“å‰ç³»ç»Ÿåœ¨ä»¥ä¸‹æ–¹é¢å­˜åœ¨**é‡è¦ç¼ºå¤±**ï¼š

### âŒ ä¸¥é‡ç¼ºå¤±åŠŸèƒ½ï¼ˆP0ä¼˜å…ˆçº§ï¼‰

| åŠŸèƒ½æ¨¡å— | ç¼ºå¤±åŸå›  | ä¸šåŠ¡å½±å“ | æ³•è§„è¦æ±‚ |
|---------|---------|---------|---------|
| **åº“å­˜ç®¡ç†ç³»ç»Ÿ** | å®Œå…¨ç¼ºå¤± | æ— æ³•è¿›è¡Œåº“å­˜è¿½è¸ªå’ŒFIFOç®¡ç† | âš ï¸ å¿…é¡» |
| **é£Ÿå“å®‰å…¨åˆè§„** | éƒ¨åˆ†æ”¯æŒ | æ— æ³•æ»¡è¶³HACCP/GMPè®¤è¯ | ğŸ”´ å¼ºåˆ¶ |
| **ä¿è´¨æœŸç®¡ç†** | å®Œå…¨ç¼ºå¤± | æ— æ³•é˜²æ­¢è¿‡æœŸäº§å“æµé€š | âš ï¸ å¿…é¡» |

### âš ï¸ é‡è¦ç¼ºå¤±åŠŸèƒ½ï¼ˆP1ä¼˜å…ˆçº§ï¼‰

| åŠŸèƒ½æ¨¡å— | ç¼ºå¤±åŸå›  | ä¸šåŠ¡å½±å“ |
|---------|---------|---------|
| **ä¾›åº”é“¾ç®¡ç†** | å®Œå…¨ç¼ºå¤± | ä¸šåŠ¡æµç¨‹ä¸å®Œæ•´ï¼ˆç¼ºå°‘é‡‡è´­ã€é”€å”®ï¼‰ |
| **å†·é“¾æ¸©åº¦ç›‘æ§** | å®Œå…¨ç¼ºå¤± | æ— æ³•è¿½æº¯æ¸©åº¦å†å² |
| **äº§å“åŒ…è£…ä¸æ ‡ç­¾** | å®Œå…¨ç¼ºå¤± | æ— æ³•ç”Ÿæˆè¿½æº¯ç  |

### ğŸ’¡ æ”¹è¿›å»ºè®®åŠŸèƒ½ï¼ˆP2ä¼˜å…ˆçº§ï¼‰

| åŠŸèƒ½æ¨¡å— | ç¼ºå¤±åŸå›  | ä¸šåŠ¡ä»·å€¼ |
|---------|---------|---------|
| **å®¢æˆ·æŠ•è¯‰ç®¡ç†** | å®Œå…¨ç¼ºå¤± | è´¨é‡æ”¹è¿›é—­ç¯ |
| **Webç®¡ç†åå°** | å®Œå…¨ç¼ºå¤± | æå‡ç®¡ç†æ•ˆç‡ |

### ç³»ç»Ÿå®šä½è°ƒæ•´

**å½“å‰å®šä½**: ç”Ÿäº§æ‰§è¡Œç³»ç»Ÿï¼ˆMESï¼‰
**ç›®æ ‡å®šä½**: **MES + è½»é‡åŒ–ERP + QMS(è´¨é‡ç®¡ç†)**

```
ç™½å©çºªæº¯æºç³»ç»Ÿ 3.0
â”œâ”€â”€ MES (ç”Ÿäº§æ‰§è¡Œ) - Phase 1-3 å·²å®Œæˆ âœ…
â”œâ”€â”€ SCM (ä¾›åº”é“¾ç®¡ç†) - Phase 4 æ–°å¢ ğŸ†•
â”œâ”€â”€ QMS (è´¨é‡ä¸åˆè§„) - Phase 5 æ–°å¢ ğŸ†•
â””â”€â”€ WMS (ä»“å‚¨ç®¡ç†) - Phase 4-6 æ–°å¢ ğŸ†•
```

---

## ğŸš€ Phase 4: ä¾›åº”é“¾ä¸åº“å­˜ç®¡ç†

**æ—¶é—´å‘¨æœŸ**: 2025å¹´1æœˆ - 2025å¹´3æœˆ (12å‘¨)
**æ ¸å¿ƒç›®æ ‡**: è¡¥é½ä¸šåŠ¡é—­ç¯ï¼Œå®ç°é‡‡è´­-ç”Ÿäº§-é”€å”®å…¨æµç¨‹ç®¡ç†
**ä¼˜å…ˆçº§**: ğŸ”´ P0ï¼ˆæœ€é«˜ä¼˜å…ˆçº§ï¼‰

### 4.1 åº“å­˜ç®¡ç†ç³»ç»Ÿ â­â­â­â­â­

#### åŠŸèƒ½æ¸…å•

**åŸºç¡€åº“å­˜ç®¡ç†**:
- âœ… åº“å­˜ä¸»æ•°æ®ç®¡ç†ï¼ˆåŸæ–™/åŠæˆå“/æˆå“/åŒ…è£…ææ–™ï¼‰
- âœ… å¤šä»“åº“ç®¡ç†ï¼ˆåŸæ–™ä»“ã€æˆå“ä»“ã€å†·åº“ï¼‰
- âœ… åº“å­˜åˆ†åŒºç®¡ç†ï¼ˆä»“åº“å†…ä½ç½®ç®¡ç†ï¼‰
- âœ… æ‰¹æ¬¡åº“å­˜ç®¡ç†ï¼ˆæ¯æ‰¹æ¬¡ç‹¬ç«‹è¿½è¸ªï¼‰

**åº“å­˜æ“ä½œ**:
- âœ… å…¥åº“ç®¡ç†ï¼ˆé‡‡è´­å…¥åº“ã€ç”Ÿäº§å…¥åº“ã€é€€è´§å…¥åº“ï¼‰
- âœ… å‡ºåº“ç®¡ç†ï¼ˆç”Ÿäº§é¢†ç”¨ã€é”€å”®å‡ºåº“ã€æŠ¥åºŸå‡ºåº“ï¼‰
- âœ… åº“å­˜è°ƒæ•´ï¼ˆç›˜ç›ˆã€ç›˜äºã€è°ƒæ‹¨ï¼‰
- âœ… åº“å­˜è½¬ç§»ï¼ˆä»“åº“é—´è½¬ç§»ï¼‰

**FIFOä¸ä¿è´¨æœŸ**:
- âœ… å…ˆè¿›å…ˆå‡ºï¼ˆFIFOï¼‰è‡ªåŠ¨æ’åº
- âœ… ä¿è´¨æœŸè‡ªåŠ¨è®¡ç®—ï¼ˆç”Ÿäº§æ—¥æœŸ+ä¿è´¨æœŸå¤©æ•°ï¼‰
- âœ… è¿‡æœŸé¢„è­¦ï¼ˆ7å¤©/3å¤©/1å¤©å¤šçº§é¢„è­¦ï¼‰
- âœ… è¿‘æ•ˆæœŸäº§å“æ ‡è¯†
- âœ… è¿‡æœŸäº§å“è‡ªåŠ¨éš”ç¦»

**åº“å­˜ç›˜ç‚¹**:
- âœ… ç›˜ç‚¹è®¡åˆ’åˆ›å»º
- âœ… ç§»åŠ¨ç«¯ç›˜ç‚¹å½•å…¥ï¼ˆæ‰«ç ç›˜ç‚¹ï¼‰
- âœ… ç›˜ç‚¹å·®å¼‚åˆ†æ
- âœ… ç›˜ç‚¹ç»“æœç¡®è®¤ä¸è°ƒæ•´

**åº“å­˜é¢„è­¦**:
- âœ… å®‰å…¨åº“å­˜è®¾ç½®
- âœ… ä½åº“å­˜é¢„è­¦
- âœ… è¶…åº“å­˜é¢„è­¦
- âœ… å‘†æ»åº“å­˜åˆ†æ

#### æ•°æ®åº“è®¾è®¡

```sql
-- ä»“åº“ç®¡ç†è¡¨
CREATE TABLE warehouses (
  id VARCHAR(36) PRIMARY KEY,
  factory_id VARCHAR(50) NOT NULL,
  warehouse_code VARCHAR(50) NOT NULL,
  warehouse_name VARCHAR(255) NOT NULL,
  warehouse_type ENUM('raw_material', 'finished_product', 'cold_storage', 'packaging') NOT NULL,
  temperature_range VARCHAR(50), -- æ¸©åº¦èŒƒå›´ "-18Â°C ~ -20Â°C"
  humidity_range VARCHAR(50),    -- æ¹¿åº¦èŒƒå›´ "60% ~ 80%"
  capacity DECIMAL(12,2),        -- å®¹é‡ï¼ˆç«‹æ–¹ç±³ï¼‰
  current_usage DECIMAL(12,2) DEFAULT 0,
  manager_id INT,
  location VARCHAR(500),
  is_active BOOLEAN DEFAULT true,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,

  FOREIGN KEY (factory_id) REFERENCES factories(id) ON DELETE CASCADE,
  FOREIGN KEY (manager_id) REFERENCES users(id),
  UNIQUE KEY unique_factory_warehouse (factory_id, warehouse_code),
  INDEX idx_type (warehouse_type),
  INDEX idx_factory_active (factory_id, is_active)
);

-- åº“å­˜ä¸»è¡¨
CREATE TABLE inventory_stocks (
  id VARCHAR(36) PRIMARY KEY,
  factory_id VARCHAR(50) NOT NULL,
  warehouse_id VARCHAR(36) NOT NULL,
  item_type ENUM('raw_material', 'semi_finished', 'finished_product', 'packaging') NOT NULL,
  item_code VARCHAR(100) NOT NULL,
  item_name VARCHAR(255) NOT NULL,
  batch_number VARCHAR(100),
  quantity DECIMAL(10,2) NOT NULL DEFAULT 0,
  unit VARCHAR(20) NOT NULL,
  location VARCHAR(100),        -- åº“ä½ "AåŒº-01-03"

  -- æˆæœ¬ä¿¡æ¯
  unit_cost DECIMAL(10,2),
  total_cost DECIMAL(12,2),

  -- æ—¥æœŸä¿¡æ¯
  production_date DATE,
  expiry_date DATE,
  shelf_life_days INT,          -- ä¿è´¨æœŸå¤©æ•°
  days_to_expiry INT GENERATED ALWAYS AS (DATEDIFF(expiry_date, CURRENT_DATE)) STORED,

  -- çŠ¶æ€ä¿¡æ¯
  status ENUM('in_stock', 'reserved', 'out_of_stock', 'expired', 'quarantine') DEFAULT 'in_stock',

  -- å…³è”ä¿¡æ¯
  reference_type VARCHAR(50),   -- 'purchase_order', 'production_batch'
  reference_id VARCHAR(36),

  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,

  FOREIGN KEY (factory_id) REFERENCES factories(id) ON DELETE CASCADE,
  FOREIGN KEY (warehouse_id) REFERENCES warehouses(id),
  UNIQUE KEY unique_stock (factory_id, warehouse_id, item_code, batch_number),
  INDEX idx_batch_expiry (batch_number, expiry_date),
  INDEX idx_factory_item (factory_id, item_code),
  INDEX idx_status (status),
  INDEX idx_expiry_warning (days_to_expiry, status)
);

-- åº“å­˜å˜åŠ¨è®°å½•è¡¨
CREATE TABLE inventory_transactions (
  id VARCHAR(36) PRIMARY KEY,
  factory_id VARCHAR(50) NOT NULL,
  stock_id VARCHAR(36) NOT NULL,
  transaction_type ENUM('in', 'out', 'adjust', 'transfer', 'freeze', 'unfreeze') NOT NULL,
  quantity DECIMAL(10,2) NOT NULL,
  quantity_before DECIMAL(10,2) NOT NULL,
  quantity_after DECIMAL(10,2) NOT NULL,

  -- å…³è”ä¿¡æ¯
  reference_type VARCHAR(50),   -- 'purchase_order', 'sales_order', 'production_batch', 'stocktaking'
  reference_id VARCHAR(36),
  reference_number VARCHAR(100),

  -- è½¬ç§»ä¿¡æ¯ï¼ˆä»…transferç±»å‹ï¼‰
  from_warehouse_id VARCHAR(36),
  to_warehouse_id VARCHAR(36),

  operator_id INT NOT NULL,
  notes TEXT,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

  FOREIGN KEY (factory_id) REFERENCES factories(id),
  FOREIGN KEY (stock_id) REFERENCES inventory_stocks(id),
  FOREIGN KEY (operator_id) REFERENCES users(id),
  INDEX idx_stock_transaction (stock_id, created_at),
  INDEX idx_factory_date (factory_id, created_at),
  INDEX idx_reference (reference_type, reference_id)
);

-- åº“å­˜ç›˜ç‚¹è¡¨
CREATE TABLE inventory_stocktakings (
  id VARCHAR(36) PRIMARY KEY,
  factory_id VARCHAR(50) NOT NULL,
  stocktaking_number VARCHAR(100) UNIQUE NOT NULL,
  warehouse_id VARCHAR(36),     -- NULLè¡¨ç¤ºå…¨éƒ¨ä»“åº“ç›˜ç‚¹
  stocktaking_type ENUM('full', 'partial', 'cycle') NOT NULL,
  status ENUM('draft', 'in_progress', 'completed', 'cancelled') DEFAULT 'draft',

  planned_date DATE NOT NULL,
  start_time TIMESTAMP,
  end_time TIMESTAMP,

  total_items INT DEFAULT 0,
  counted_items INT DEFAULT 0,
  difference_items INT DEFAULT 0,

  created_by INT NOT NULL,
  approved_by INT,
  notes TEXT,

  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,

  FOREIGN KEY (factory_id) REFERENCES factories(id),
  FOREIGN KEY (warehouse_id) REFERENCES warehouses(id),
  FOREIGN KEY (created_by) REFERENCES users(id),
  INDEX idx_factory_status (factory_id, status),
  INDEX idx_planned_date (planned_date)
);

-- åº“å­˜ç›˜ç‚¹æ˜ç»†è¡¨
CREATE TABLE inventory_stocktaking_items (
  id VARCHAR(36) PRIMARY KEY,
  stocktaking_id VARCHAR(36) NOT NULL,
  stock_id VARCHAR(36) NOT NULL,

  system_quantity DECIMAL(10,2) NOT NULL,  -- ç³»ç»Ÿæ•°é‡
  actual_quantity DECIMAL(10,2),           -- å®é™…æ•°é‡
  difference_quantity DECIMAL(10,2),       -- å·®å¼‚æ•°é‡

  status ENUM('pending', 'counted', 'adjusted') DEFAULT 'pending',
  counter_id INT,
  counted_at TIMESTAMP,
  notes TEXT,

  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

  FOREIGN KEY (stocktaking_id) REFERENCES inventory_stocktakings(id) ON DELETE CASCADE,
  FOREIGN KEY (stock_id) REFERENCES inventory_stocks(id),
  FOREIGN KEY (counter_id) REFERENCES users(id),
  INDEX idx_stocktaking (stocktaking_id),
  INDEX idx_status (status)
);

-- å®‰å…¨åº“å­˜è®¾ç½®è¡¨
CREATE TABLE inventory_safety_stocks (
  id VARCHAR(36) PRIMARY KEY,
  factory_id VARCHAR(50) NOT NULL,
  item_code VARCHAR(100) NOT NULL,
  item_name VARCHAR(255) NOT NULL,
  item_type ENUM('raw_material', 'semi_finished', 'finished_product', 'packaging') NOT NULL,

  safety_stock_min DECIMAL(10,2) NOT NULL,  -- å®‰å…¨åº“å­˜ä¸‹é™
  safety_stock_max DECIMAL(10,2),           -- å®‰å…¨åº“å­˜ä¸Šé™
  reorder_point DECIMAL(10,2),              -- å†è®¢è´§ç‚¹

  is_active BOOLEAN DEFAULT true,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,

  FOREIGN KEY (factory_id) REFERENCES factories(id),
  UNIQUE KEY unique_factory_item (factory_id, item_code),
  INDEX idx_factory_type (factory_id, item_type)
);
```

#### APIç«¯ç‚¹è®¾è®¡

```
# ä»“åº“ç®¡ç†
GET    /api/mobile/warehouses                          - ä»“åº“åˆ—è¡¨
POST   /api/mobile/warehouses                          - åˆ›å»ºä»“åº“
GET    /api/mobile/warehouses/:id                      - ä»“åº“è¯¦æƒ…
PUT    /api/mobile/warehouses/:id                      - æ›´æ–°ä»“åº“
GET    /api/mobile/warehouses/:id/stocks               - ä»“åº“åº“å­˜åˆ—è¡¨
GET    /api/mobile/warehouses/:id/capacity             - ä»“åº“å®¹é‡åˆ†æ

# åº“å­˜æŸ¥è¯¢
GET    /api/mobile/inventory/stocks                    - åº“å­˜åˆ—è¡¨ï¼ˆFIFOæ’åºï¼‰
GET    /api/mobile/inventory/stocks/:id                - åº“å­˜è¯¦æƒ…
GET    /api/mobile/inventory/stocks/:id/history        - åº“å­˜å˜åŠ¨å†å²
GET    /api/mobile/inventory/summary                   - åº“å­˜æ±‡æ€»ç»Ÿè®¡
GET    /api/mobile/inventory/by-item/:itemCode         - æŒ‰ç‰©æ–™æŸ¥è¯¢åº“å­˜
GET    /api/mobile/inventory/by-batch/:batchNumber     - æŒ‰æ‰¹æ¬¡æŸ¥è¯¢åº“å­˜

# åº“å­˜é¢„è­¦
GET    /api/mobile/inventory/alerts/low-stock          - ä½åº“å­˜é¢„è­¦
GET    /api/mobile/inventory/alerts/expiring           - å³å°†è¿‡æœŸé¢„è­¦ï¼ˆ7å¤©å†…ï¼‰
GET    /api/mobile/inventory/alerts/expired            - å·²è¿‡æœŸåº“å­˜
GET    /api/mobile/inventory/alerts/slow-moving        - å‘†æ»åº“å­˜åˆ†æ

# åº“å­˜æ“ä½œ
POST   /api/mobile/inventory/in                        - å…¥åº“
POST   /api/mobile/inventory/out                       - å‡ºåº“
POST   /api/mobile/inventory/adjust                    - åº“å­˜è°ƒæ•´
POST   /api/mobile/inventory/transfer                  - åº“å­˜è½¬ç§»
POST   /api/mobile/inventory/freeze                    - å†»ç»“åº“å­˜
POST   /api/mobile/inventory/unfreeze                  - è§£å†»åº“å­˜
POST   /api/mobile/inventory/dispose                   - å¤„ç†è¿‡æœŸ/æŠ¥åºŸ

# åº“å­˜ç›˜ç‚¹
POST   /api/mobile/inventory/stocktaking               - åˆ›å»ºç›˜ç‚¹è®¡åˆ’
GET    /api/mobile/inventory/stocktaking               - ç›˜ç‚¹è®¡åˆ’åˆ—è¡¨
GET    /api/mobile/inventory/stocktaking/:id           - ç›˜ç‚¹è¯¦æƒ…
POST   /api/mobile/inventory/stocktaking/:id/start     - å¼€å§‹ç›˜ç‚¹
POST   /api/mobile/inventory/stocktaking/:id/count     - è®°å½•ç›˜ç‚¹æ•°é‡
POST   /api/mobile/inventory/stocktaking/:id/complete  - å®Œæˆç›˜ç‚¹
GET    /api/mobile/inventory/stocktaking/:id/diff      - ç›˜ç‚¹å·®å¼‚æŠ¥å‘Š

# å®‰å…¨åº“å­˜
GET    /api/mobile/inventory/safety-stocks             - å®‰å…¨åº“å­˜è®¾ç½®åˆ—è¡¨
POST   /api/mobile/inventory/safety-stocks             - è®¾ç½®å®‰å…¨åº“å­˜
PUT    /api/mobile/inventory/safety-stocks/:id         - æ›´æ–°å®‰å…¨åº“å­˜
```

#### ä¸šåŠ¡æµç¨‹

```
é‡‡è´­å…¥åº“æµç¨‹:
é‡‡è´­è®¢å• â†’ é‡‡è´­æ”¶è´§ â†’ è´¨é‡æ£€éªŒ â†’ åˆæ ¼å…¥åº“ â†’ åˆ›å»ºåº“å­˜è®°å½• â†’ FIFOæ’åº

ç”Ÿäº§é¢†ç”¨æµç¨‹:
åˆ›å»ºç”Ÿäº§æ‰¹æ¬¡ â†’ FIFOè‡ªåŠ¨é€‰æ‹©åŸæ–™ â†’ å‡ºåº“å®¡æ‰¹ â†’ åº“å­˜æ‰£å‡ â†’ ç”Ÿäº§æŠ•æ–™

é”€å”®å‡ºåº“æµç¨‹:
é”€å”®è®¢å• â†’ FIFOè‡ªåŠ¨é€‰æ‹©æˆå“ â†’ å‡ºåº“æ‹£è´§ â†’ åº“å­˜æ‰£å‡ â†’ å‘è´§

åº“å­˜ç›˜ç‚¹æµç¨‹:
åˆ›å»ºç›˜ç‚¹è®¡åˆ’ â†’ å†»ç»“åº“å­˜ â†’ æ‰«ç ç›˜ç‚¹ â†’ å·®å¼‚åˆ†æ â†’ è´¦åŠ¡è°ƒæ•´ â†’ è§£å†»åº“å­˜
```

#### å·¥ä½œé‡ä¼°ç®—
- æ•°æ®åº“è®¾è®¡ä¸å®ç°: 1å‘¨
- åç«¯APIå¼€å‘: 2å‘¨
- å‰ç«¯UIå¼€å‘: 2å‘¨
- æµ‹è¯•ä¸ä¼˜åŒ–: 1å‘¨
- **æ€»è®¡**: 6å‘¨

---

### 4.2 ä¾›åº”å•†ä¸é‡‡è´­ç®¡ç† â­â­â­â­

#### åŠŸèƒ½æ¸…å•

**ä¾›åº”å•†ç®¡ç†**:
- âœ… ä¾›åº”å•†æ¡£æ¡ˆç®¡ç†
- âœ… ä¾›åº”å•†åˆ†ç±»ï¼ˆåŸæ–™/åŒ…è£…/è®¾å¤‡ï¼‰
- âœ… ä¾›åº”å•†è¯„çº§ï¼ˆA/B/C/é»‘åå•ï¼‰
- âœ… ä¾›åº”å•†èµ„è´¨ç®¡ç†ï¼ˆHACCP/ISO22000è¯ä¹¦ï¼‰
- âœ… ä¾›åº”å•†ç»©æ•ˆè¯„ä¼°

**é‡‡è´­ç®¡ç†**:
- âœ… é‡‡è´­éœ€æ±‚è®¡åˆ’ï¼ˆPRï¼‰
- âœ… é‡‡è´­è®¢å•ç®¡ç†ï¼ˆPOï¼‰
- âœ… é‡‡è´­æ”¶è´§ä¸éªŒæ”¶
- âœ… é‡‡è´­é€€è´§ç®¡ç†
- âœ… åº”ä»˜è´¦æ¬¾ç®¡ç†

**é‡‡è´­åˆ†æ**:
- âœ… é‡‡è´­æˆæœ¬åˆ†æ
- âœ… ä¾›åº”å•†ä¾›è´§åˆ†æ
- âœ… é‡‡è´­å‘¨æœŸåˆ†æ

#### æ•°æ®åº“è®¾è®¡

```sql
-- ä¾›åº”å•†ç®¡ç†è¡¨
CREATE TABLE suppliers (
  id VARCHAR(36) PRIMARY KEY,
  factory_id VARCHAR(50) NOT NULL,
  supplier_code VARCHAR(50) NOT NULL,
  supplier_name VARCHAR(255) NOT NULL,
  short_name VARCHAR(100),

  -- è”ç³»ä¿¡æ¯
  contact_person VARCHAR(100),
  contact_phone VARCHAR(20),
  contact_email VARCHAR(255),
  address TEXT,

  -- åˆ†ç±»ä¿¡æ¯
  supplier_type ENUM('raw_material', 'packaging', 'equipment', 'service') NOT NULL,
  product_categories JSON,      -- ["æ°´äº§å“", "å†·å†»é£Ÿå“"]

  -- è¯„çº§ä¿¡æ¯
  rating ENUM('A', 'B', 'C', 'blacklist') DEFAULT 'B',
  rating_score DECIMAL(3,2),    -- è¯„åˆ† 0-100
  last_rating_date DATE,

  -- è´¢åŠ¡ä¿¡æ¯
  credit_days INT DEFAULT 30,   -- è´¦æœŸå¤©æ•°
  credit_limit DECIMAL(12,2),   -- ä¿¡ç”¨é¢åº¦

  -- è®¤è¯ä¿¡æ¯
  certifications JSON,           -- {"HACCP": true, "ISO22000": true, "license": "SC123..."}
  license_expiry_date DATE,

  -- çŠ¶æ€ä¿¡æ¯
  is_active BOOLEAN DEFAULT true,
  is_approved BOOLEAN DEFAULT false,
  approved_by INT,
  approved_at TIMESTAMP,

  created_by INT,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,

  FOREIGN KEY (factory_id) REFERENCES factories(id) ON DELETE CASCADE,
  FOREIGN KEY (approved_by) REFERENCES users(id),
  UNIQUE KEY unique_factory_supplier (factory_id, supplier_code),
  INDEX idx_type (supplier_type),
  INDEX idx_rating (rating),
  INDEX idx_active (is_active)
);

-- é‡‡è´­è®¢å•ä¸»è¡¨
CREATE TABLE purchase_orders (
  id VARCHAR(36) PRIMARY KEY,
  factory_id VARCHAR(50) NOT NULL,
  po_number VARCHAR(100) UNIQUE NOT NULL,
  supplier_id VARCHAR(36) NOT NULL,

  order_type ENUM('standard', 'urgent', 'blanket') DEFAULT 'standard',
  order_date DATE NOT NULL,
  expected_delivery_date DATE,
  actual_delivery_date DATE,

  status ENUM('draft', 'submitted', 'confirmed', 'receiving', 'completed', 'cancelled') DEFAULT 'draft',

  -- é‡‘é¢ä¿¡æ¯
  subtotal DECIMAL(12,2),
  tax_amount DECIMAL(12,2),
  total_amount DECIMAL(12,2),
  currency VARCHAR(10) DEFAULT 'CNY',

  -- æ”¶è´§ä¿¡æ¯
  delivery_address TEXT,
  warehouse_id VARCHAR(36),

  -- å®¡æ‰¹ä¿¡æ¯
  created_by INT NOT NULL,
  approved_by INT,
  approved_at TIMESTAMP,

  notes TEXT,
  attachments JSON,

  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,

  FOREIGN KEY (factory_id) REFERENCES factories(id),
  FOREIGN KEY (supplier_id) REFERENCES suppliers(id),
  FOREIGN KEY (warehouse_id) REFERENCES warehouses(id),
  FOREIGN KEY (created_by) REFERENCES users(id),
  FOREIGN KEY (approved_by) REFERENCES users(id),
  INDEX idx_factory_status (factory_id, status),
  INDEX idx_supplier (supplier_id),
  INDEX idx_order_date (order_date)
);

-- é‡‡è´­è®¢å•æ˜ç»†è¡¨
CREATE TABLE purchase_order_items (
  id VARCHAR(36) PRIMARY KEY,
  po_id VARCHAR(36) NOT NULL,

  item_code VARCHAR(100) NOT NULL,
  item_name VARCHAR(255) NOT NULL,
  item_type ENUM('raw_material', 'packaging', 'equipment', 'other') NOT NULL,
  specification VARCHAR(500),

  quantity DECIMAL(10,2) NOT NULL,
  received_quantity DECIMAL(10,2) DEFAULT 0,
  unit VARCHAR(20) NOT NULL,

  unit_price DECIMAL(10,2) NOT NULL,
  tax_rate DECIMAL(5,2) DEFAULT 0.13,
  total_price DECIMAL(12,2),

  expected_delivery_date DATE,
  notes TEXT,

  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

  FOREIGN KEY (po_id) REFERENCES purchase_orders(id) ON DELETE CASCADE,
  INDEX idx_po_item (po_id, item_code)
);

-- é‡‡è´­æ”¶è´§è®°å½•è¡¨
CREATE TABLE purchase_receipts (
  id VARCHAR(36) PRIMARY KEY,
  factory_id VARCHAR(50) NOT NULL,
  receipt_number VARCHAR(100) UNIQUE NOT NULL,
  po_id VARCHAR(36) NOT NULL,
  supplier_id VARCHAR(36) NOT NULL,

  receipt_date DATE NOT NULL,
  warehouse_id VARCHAR(36) NOT NULL,

  status ENUM('pending_inspection', 'inspecting', 'accepted', 'rejected', 'partial_accepted') DEFAULT 'pending_inspection',

  received_by INT NOT NULL,
  inspected_by INT,
  inspection_notes TEXT,

  photos JSON,

  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,

  FOREIGN KEY (factory_id) REFERENCES factories(id),
  FOREIGN KEY (po_id) REFERENCES purchase_orders(id),
  FOREIGN KEY (supplier_id) REFERENCES suppliers(id),
  FOREIGN KEY (warehouse_id) REFERENCES warehouses(id),
  FOREIGN KEY (received_by) REFERENCES users(id),
  FOREIGN KEY (inspected_by) REFERENCES users(id),
  INDEX idx_factory_date (factory_id, receipt_date),
  INDEX idx_po (po_id),
  INDEX idx_status (status)
);

-- é‡‡è´­æ”¶è´§æ˜ç»†è¡¨
CREATE TABLE purchase_receipt_items (
  id VARCHAR(36) PRIMARY KEY,
  receipt_id VARCHAR(36) NOT NULL,
  po_item_id VARCHAR(36) NOT NULL,

  ordered_quantity DECIMAL(10,2) NOT NULL,
  received_quantity DECIMAL(10,2) NOT NULL,
  accepted_quantity DECIMAL(10,2) DEFAULT 0,
  rejected_quantity DECIMAL(10,2) DEFAULT 0,

  unit VARCHAR(20) NOT NULL,

  quality_status ENUM('pass', 'fail', 'conditional_pass') DEFAULT 'pass',
  reject_reason TEXT,

  batch_number VARCHAR(100),
  production_date DATE,
  expiry_date DATE,

  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

  FOREIGN KEY (receipt_id) REFERENCES purchase_receipts(id) ON DELETE CASCADE,
  FOREIGN KEY (po_item_id) REFERENCES purchase_order_items(id),
  INDEX idx_receipt (receipt_id),
  INDEX idx_batch (batch_number)
);

-- ä¾›åº”å•†ç»©æ•ˆè¯„ä¼°è¡¨
CREATE TABLE supplier_performance (
  id VARCHAR(36) PRIMARY KEY,
  factory_id VARCHAR(50) NOT NULL,
  supplier_id VARCHAR(36) NOT NULL,
  evaluation_period VARCHAR(20) NOT NULL,  -- "2025-Q1"

  -- è¯„ä¼°æŒ‡æ ‡
  quality_score DECIMAL(5,2),       -- è´¨é‡è¯„åˆ† 0-100
  delivery_score DECIMAL(5,2),      -- äº¤ä»˜è¯„åˆ† 0-100
  price_score DECIMAL(5,2),         -- ä»·æ ¼è¯„åˆ† 0-100
  service_score DECIMAL(5,2),       -- æœåŠ¡è¯„åˆ† 0-100
  overall_score DECIMAL(5,2),       -- ç»¼åˆè¯„åˆ† 0-100

  -- ç»Ÿè®¡æ•°æ®
  total_orders INT DEFAULT 0,
  on_time_deliveries INT DEFAULT 0,
  quality_issues INT DEFAULT 0,

  evaluator_id INT,
  evaluation_notes TEXT,

  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

  FOREIGN KEY (factory_id) REFERENCES factories(id),
  FOREIGN KEY (supplier_id) REFERENCES suppliers(id),
  FOREIGN KEY (evaluator_id) REFERENCES users(id),
  UNIQUE KEY unique_supplier_period (supplier_id, evaluation_period),
  INDEX idx_factory_period (factory_id, evaluation_period)
);
```

#### APIç«¯ç‚¹è®¾è®¡

```
# ä¾›åº”å•†ç®¡ç†
GET    /api/mobile/suppliers                           - ä¾›åº”å•†åˆ—è¡¨
POST   /api/mobile/suppliers                           - åˆ›å»ºä¾›åº”å•†
GET    /api/mobile/suppliers/:id                       - ä¾›åº”å•†è¯¦æƒ…
PUT    /api/mobile/suppliers/:id                       - æ›´æ–°ä¾›åº”å•†
POST   /api/mobile/suppliers/:id/approve               - å®¡æ‰¹ä¾›åº”å•†
GET    /api/mobile/suppliers/:id/performance           - ä¾›åº”å•†ç»©æ•ˆ
POST   /api/mobile/suppliers/:id/blacklist             - åŠ å…¥é»‘åå•

# é‡‡è´­è®¢å•
POST   /api/mobile/purchase/orders                     - åˆ›å»ºé‡‡è´­è®¢å•
GET    /api/mobile/purchase/orders                     - é‡‡è´­è®¢å•åˆ—è¡¨
GET    /api/mobile/purchase/orders/:id                 - è®¢å•è¯¦æƒ…
PUT    /api/mobile/purchase/orders/:id                 - æ›´æ–°è®¢å•
POST   /api/mobile/purchase/orders/:id/submit          - æäº¤å®¡æ‰¹
POST   /api/mobile/purchase/orders/:id/approve         - å®¡æ‰¹è®¢å•
POST   /api/mobile/purchase/orders/:id/cancel          - å–æ¶ˆè®¢å•

# é‡‡è´­æ”¶è´§
POST   /api/mobile/purchase/receipts                   - åˆ›å»ºæ”¶è´§è®°å½•
GET    /api/mobile/purchase/receipts                   - æ”¶è´§è®°å½•åˆ—è¡¨
GET    /api/mobile/purchase/receipts/:id               - æ”¶è´§è¯¦æƒ…
POST   /api/mobile/purchase/receipts/:id/inspect       - è´¨æ£€æ”¶è´§
POST   /api/mobile/purchase/receipts/:id/accept        - æ¥å—æ”¶è´§
POST   /api/mobile/purchase/receipts/:id/reject        - æ‹’ç»æ”¶è´§
GET    /api/mobile/purchase/pending-receipts           - å¾…æ”¶è´§åˆ—è¡¨

# é‡‡è´­åˆ†æ
GET    /api/mobile/purchase/analysis/cost              - é‡‡è´­æˆæœ¬åˆ†æ
GET    /api/mobile/purchase/analysis/supplier          - ä¾›åº”å•†åˆ†æ
GET    /api/mobile/purchase/analysis/category          - å“ç±»åˆ†æ
```

#### å·¥ä½œé‡ä¼°ç®—
- æ•°æ®åº“è®¾è®¡ä¸å®ç°: 1å‘¨
- åç«¯APIå¼€å‘: 1.5å‘¨
- å‰ç«¯UIå¼€å‘: 1.5å‘¨
- æµ‹è¯•ä¸ä¼˜åŒ–: 1å‘¨
- **æ€»è®¡**: 5å‘¨

---

### 4.3 å®¢æˆ·ä¸é”€å”®ç®¡ç† â­â­â­â­

#### åŠŸèƒ½æ¸…å•

**å®¢æˆ·ç®¡ç†**:
- âœ… å®¢æˆ·æ¡£æ¡ˆç®¡ç†
- âœ… å®¢æˆ·åˆ†ç±»ï¼ˆç»é”€å•†/é›¶å”®å•†/ç»ˆç«¯ç”¨æˆ·ï¼‰
- âœ… å®¢æˆ·ä¿¡ç”¨é¢åº¦ç®¡ç†
- âœ… å®¢æˆ·é€è´§åœ°å€ç®¡ç†

**é”€å”®ç®¡ç†**:
- âœ… é”€å”®è®¢å•ç®¡ç†
- âœ… é”€å”®å‘è´§ç®¡ç†
- âœ… é”€å”®é€€è´§ç®¡ç†
- âœ… åº”æ”¶è´¦æ¬¾ç®¡ç†

**é”€å”®åˆ†æ**:
- âœ… é”€å”®é¢ç»Ÿè®¡
- âœ… å®¢æˆ·é”€å”®æ’å
- âœ… äº§å“é”€å”®æ’å

#### æ•°æ®åº“è®¾è®¡

```sql
-- å®¢æˆ·ç®¡ç†è¡¨
CREATE TABLE customers (
  id VARCHAR(36) PRIMARY KEY,
  factory_id VARCHAR(50) NOT NULL,
  customer_code VARCHAR(50) NOT NULL,
  customer_name VARCHAR(255) NOT NULL,
  short_name VARCHAR(100),

  -- è”ç³»ä¿¡æ¯
  contact_person VARCHAR(100),
  contact_phone VARCHAR(20),
  contact_email VARCHAR(255),

  -- åˆ†ç±»ä¿¡æ¯
  customer_type ENUM('distributor', 'retailer', 'end_user', 'export') NOT NULL,
  customer_level ENUM('VIP', 'A', 'B', 'C') DEFAULT 'B',

  -- è´¢åŠ¡ä¿¡æ¯
  credit_days INT DEFAULT 30,
  credit_limit DECIMAL(12,2),
  current_receivable DECIMAL(12,2) DEFAULT 0,

  -- çŠ¶æ€ä¿¡æ¯
  is_active BOOLEAN DEFAULT true,
  created_by INT,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,

  FOREIGN KEY (factory_id) REFERENCES factories(id) ON DELETE CASCADE,
  UNIQUE KEY unique_factory_customer (factory_id, customer_code),
  INDEX idx_type (customer_type),
  INDEX idx_level (customer_level)
);

-- å®¢æˆ·é€è´§åœ°å€è¡¨
CREATE TABLE customer_addresses (
  id VARCHAR(36) PRIMARY KEY,
  customer_id VARCHAR(36) NOT NULL,

  address_name VARCHAR(100),    -- "åŒ—äº¬æ€»éƒ¨", "ä¸Šæµ·åˆ†å…¬å¸"
  contact_person VARCHAR(100),
  contact_phone VARCHAR(20),
  province VARCHAR(50),
  city VARCHAR(50),
  district VARCHAR(50),
  detailed_address TEXT,
  postal_code VARCHAR(20),

  is_default BOOLEAN DEFAULT false,
  is_active BOOLEAN DEFAULT true,

  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

  FOREIGN KEY (customer_id) REFERENCES customers(id) ON DELETE CASCADE,
  INDEX idx_customer (customer_id),
  INDEX idx_default (customer_id, is_default)
);

-- é”€å”®è®¢å•ä¸»è¡¨
CREATE TABLE sales_orders (
  id VARCHAR(36) PRIMARY KEY,
  factory_id VARCHAR(50) NOT NULL,
  so_number VARCHAR(100) UNIQUE NOT NULL,
  customer_id VARCHAR(36) NOT NULL,

  order_type ENUM('standard', 'urgent', 'sample') DEFAULT 'standard',
  order_date DATE NOT NULL,
  delivery_date DATE,
  actual_delivery_date DATE,

  status ENUM('pending', 'confirmed', 'picking', 'shipped', 'delivered', 'completed', 'cancelled') DEFAULT 'pending',

  -- é‡‘é¢ä¿¡æ¯
  subtotal DECIMAL(12,2),
  tax_amount DECIMAL(12,2),
  total_amount DECIMAL(12,2),
  currency VARCHAR(10) DEFAULT 'CNY',

  -- æ”¶è´§ä¿¡æ¯
  delivery_address_id VARCHAR(36),
  delivery_address TEXT,

  -- å®¡æ‰¹ä¿¡æ¯
  created_by INT NOT NULL,
  approved_by INT,
  approved_at TIMESTAMP,

  notes TEXT,
  attachments JSON,

  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,

  FOREIGN KEY (factory_id) REFERENCES factories(id),
  FOREIGN KEY (customer_id) REFERENCES customers(id),
  FOREIGN KEY (delivery_address_id) REFERENCES customer_addresses(id),
  FOREIGN KEY (created_by) REFERENCES users(id),
  INDEX idx_factory_status (factory_id, status),
  INDEX idx_customer (customer_id),
  INDEX idx_order_date (order_date)
);

-- é”€å”®è®¢å•æ˜ç»†è¡¨
CREATE TABLE sales_order_items (
  id VARCHAR(36) PRIMARY KEY,
  so_id VARCHAR(36) NOT NULL,

  item_code VARCHAR(100) NOT NULL,
  item_name VARCHAR(255) NOT NULL,
  specification VARCHAR(500),

  quantity DECIMAL(10,2) NOT NULL,
  shipped_quantity DECIMAL(10,2) DEFAULT 0,
  unit VARCHAR(20) NOT NULL,

  unit_price DECIMAL(10,2) NOT NULL,
  tax_rate DECIMAL(5,2) DEFAULT 0.13,
  total_price DECIMAL(12,2),

  notes TEXT,

  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

  FOREIGN KEY (so_id) REFERENCES sales_orders(id) ON DELETE CASCADE,
  INDEX idx_so_item (so_id, item_code)
);

-- é”€å”®å‘è´§è®°å½•è¡¨
CREATE TABLE sales_shipments (
  id VARCHAR(36) PRIMARY KEY,
  factory_id VARCHAR(50) NOT NULL,
  shipment_number VARCHAR(100) UNIQUE NOT NULL,
  so_id VARCHAR(36) NOT NULL,
  customer_id VARCHAR(36) NOT NULL,

  shipment_date DATE NOT NULL,
  warehouse_id VARCHAR(36) NOT NULL,

  status ENUM('preparing', 'shipped', 'in_transit', 'delivered', 'cancelled') DEFAULT 'preparing',

  -- ç‰©æµä¿¡æ¯
  carrier VARCHAR(100),
  tracking_number VARCHAR(100),
  vehicle_number VARCHAR(50),
  driver_name VARCHAR(100),
  driver_phone VARCHAR(20),

  shipped_by INT NOT NULL,

  notes TEXT,
  photos JSON,

  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,

  FOREIGN KEY (factory_id) REFERENCES factories(id),
  FOREIGN KEY (so_id) REFERENCES sales_orders(id),
  FOREIGN KEY (customer_id) REFERENCES customers(id),
  FOREIGN KEY (warehouse_id) REFERENCES warehouses(id),
  FOREIGN KEY (shipped_by) REFERENCES users(id),
  INDEX idx_factory_date (factory_id, shipment_date),
  INDEX idx_so (so_id),
  INDEX idx_status (status)
);

-- é”€å”®å‘è´§æ˜ç»†è¡¨
CREATE TABLE sales_shipment_items (
  id VARCHAR(36) PRIMARY KEY,
  shipment_id VARCHAR(36) NOT NULL,
  so_item_id VARCHAR(36) NOT NULL,

  ordered_quantity DECIMAL(10,2) NOT NULL,
  shipped_quantity DECIMAL(10,2) NOT NULL,
  unit VARCHAR(20) NOT NULL,

  batch_number VARCHAR(100),
  production_date DATE,
  expiry_date DATE,

  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

  FOREIGN KEY (shipment_id) REFERENCES sales_shipments(id) ON DELETE CASCADE,
  FOREIGN KEY (so_item_id) REFERENCES sales_order_items(id),
  INDEX idx_shipment (shipment_id),
  INDEX idx_batch (batch_number)
);
```

#### APIç«¯ç‚¹è®¾è®¡

```
# å®¢æˆ·ç®¡ç†
GET    /api/mobile/customers                           - å®¢æˆ·åˆ—è¡¨
POST   /api/mobile/customers                           - åˆ›å»ºå®¢æˆ·
GET    /api/mobile/customers/:id                       - å®¢æˆ·è¯¦æƒ…
PUT    /api/mobile/customers/:id                       - æ›´æ–°å®¢æˆ·
GET    /api/mobile/customers/:id/addresses             - å®¢æˆ·åœ°å€åˆ—è¡¨
POST   /api/mobile/customers/:id/addresses             - æ·»åŠ åœ°å€

# é”€å”®è®¢å•
POST   /api/mobile/sales/orders                        - åˆ›å»ºé”€å”®è®¢å•
GET    /api/mobile/sales/orders                        - é”€å”®è®¢å•åˆ—è¡¨
GET    /api/mobile/sales/orders/:id                    - è®¢å•è¯¦æƒ…
PUT    /api/mobile/sales/orders/:id                    - æ›´æ–°è®¢å•
POST   /api/mobile/sales/orders/:id/confirm            - ç¡®è®¤è®¢å•
POST   /api/mobile/sales/orders/:id/cancel             - å–æ¶ˆè®¢å•

# é”€å”®å‘è´§
POST   /api/mobile/sales/shipments                     - åˆ›å»ºå‘è´§è®°å½•
GET    /api/mobile/sales/shipments                     - å‘è´§è®°å½•åˆ—è¡¨
GET    /api/mobile/sales/shipments/:id                 - å‘è´§è¯¦æƒ…
POST   /api/mobile/sales/shipments/:id/ship            - ç¡®è®¤å‘è´§
POST   /api/mobile/sales/shipments/:id/deliver         - ç¡®è®¤é€è¾¾
GET    /api/mobile/sales/pending-shipments             - å¾…å‘è´§åˆ—è¡¨

# é”€å”®åˆ†æ
GET    /api/mobile/sales/analysis/revenue              - é”€å”®é¢åˆ†æ
GET    /api/mobile/sales/analysis/customer             - å®¢æˆ·åˆ†æ
GET    /api/mobile/sales/analysis/product              - äº§å“é”€å”®åˆ†æ
```

#### å·¥ä½œé‡ä¼°ç®—
- æ•°æ®åº“è®¾è®¡ä¸å®ç°: 0.5å‘¨
- åç«¯APIå¼€å‘: 1å‘¨
- å‰ç«¯UIå¼€å‘: 1å‘¨
- æµ‹è¯•ä¸ä¼˜åŒ–: 0.5å‘¨
- **æ€»è®¡**: 3å‘¨

---

### Phase 4 æ€»ç»“

**æ€»å·¥ä½œé‡**: 14å‘¨ (çº¦3.5ä¸ªæœˆ)
**æ ¸å¿ƒäº¤ä»˜ç‰©**:
1. âœ… å®Œæ•´çš„åº“å­˜ç®¡ç†ç³»ç»Ÿï¼ˆFIFOã€ä¿è´¨æœŸã€ç›˜ç‚¹ï¼‰
2. âœ… ä¾›åº”å•†ä¸é‡‡è´­ç®¡ç†ç³»ç»Ÿ
3. âœ… å®¢æˆ·ä¸é”€å”®ç®¡ç†ç³»ç»Ÿ
4. âœ… ä¸šåŠ¡é—­ç¯æ‰“é€šï¼ˆé‡‡è´­â†’ç”Ÿäº§â†’é”€å”®ï¼‰

**ç³»ç»Ÿå‡çº§**:
- ä»MES â†’ MES + SCM
- æ–°å¢50+å¼ æ•°æ®åº“è¡¨
- æ–°å¢100+ APIç«¯ç‚¹
- å®ç°å®Œæ•´ä¸šåŠ¡æµç¨‹è¿½æº¯

---

## ğŸ›¡ï¸ Phase 5: é£Ÿå“å®‰å…¨åˆè§„

**æ—¶é—´å‘¨æœŸ**: 2025å¹´4æœˆ - 2025å¹´6æœˆ (12å‘¨)
**æ ¸å¿ƒç›®æ ‡**: æ»¡è¶³HACCP/GMP/ISO22000æ³•è§„è¦æ±‚
**ä¼˜å…ˆçº§**: ğŸ”´ P0ï¼ˆæ³•è§„å¼ºåˆ¶è¦æ±‚ï¼‰

### 5.1 HACCPå…³é”®æ§åˆ¶ç‚¹ç®¡ç† â­â­â­â­â­

#### åŠŸèƒ½æ¸…å•

**HACCPä¸ƒå¤§åŸç†å®ç°**:
1. âœ… å±å®³åˆ†æï¼ˆHazard Analysisï¼‰
2. âœ… ç¡®å®šå…³é”®æ§åˆ¶ç‚¹ï¼ˆCCPï¼‰
3. âœ… å»ºç«‹å…³é”®é™å€¼ï¼ˆCritical Limitsï¼‰
4. âœ… å»ºç«‹ç›‘æ§ç¨‹åºï¼ˆMonitoringï¼‰
5. âœ… å»ºç«‹çº æ­£æªæ–½ï¼ˆCorrective Actionsï¼‰
6. âœ… å»ºç«‹éªŒè¯ç¨‹åºï¼ˆVerificationï¼‰
7. âœ… å»ºç«‹è®°å½•ä¿æŒç¨‹åºï¼ˆRecord Keepingï¼‰

**å…³é”®æ§åˆ¶ç‚¹ç±»å‹**:
- âœ… åŸæ–™æ¥æ”¶æ¸©åº¦æ§åˆ¶
- âœ… åŠ å·¥è¿‡ç¨‹æ¸©åº¦/æ—¶é—´æ§åˆ¶
- âœ… å†·å´æ¸©åº¦æ§åˆ¶
- âœ… é‡‘å±æ£€æµ‹
- âœ… æ€èŒ/æ¶ˆæ¯’æ§åˆ¶
- âœ… æˆå“æ£€éªŒ

#### æ•°æ®åº“è®¾è®¡

```sql
-- HACCPè®¡åˆ’è¡¨
CREATE TABLE haccp_plans (
  id VARCHAR(36) PRIMARY KEY,
  factory_id VARCHAR(50) NOT NULL,
  plan_name VARCHAR(255) NOT NULL,
  product_category VARCHAR(100),
  version VARCHAR(20) NOT NULL,

  status ENUM('draft', 'active', 'archived') DEFAULT 'draft',

  effective_date DATE,
  review_date DATE,
  next_review_date DATE,

  created_by INT,
  approved_by INT,
  approved_at TIMESTAMP,

  plan_document JSON,  -- HACCPè®¡åˆ’å®Œæ•´å†…å®¹

  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,

  FOREIGN KEY (factory_id) REFERENCES factories(id),
  INDEX idx_factory_status (factory_id, status)
);

-- HACCPå…³é”®æ§åˆ¶ç‚¹å®šä¹‰è¡¨
CREATE TABLE haccp_ccps (
  id VARCHAR(36) PRIMARY KEY,
  haccp_plan_id VARCHAR(36) NOT NULL,
  factory_id VARCHAR(50) NOT NULL,

  ccp_number VARCHAR(20) NOT NULL,  -- "CCP-1", "CCP-2"
  ccp_name VARCHAR(255) NOT NULL,
  process_step VARCHAR(255),

  ccp_type ENUM(
    'receiving_temp',
    'cooking_temp',
    'cooling_temp',
    'cold_storage_temp',
    'metal_detection',
    'pasteurization',
    'ph_control',
    'water_activity',
    'chemical_residue'
  ) NOT NULL,

  -- å…³é”®é™å€¼
  critical_limit_min DECIMAL(10,2),
  critical_limit_max DECIMAL(10,2),
  unit VARCHAR(20),

  -- ç›‘æ§é¢‘ç‡
  monitoring_frequency VARCHAR(100),  -- "æ¯2å°æ—¶", "æ¯æ‰¹æ¬¡"
  monitoring_method TEXT,

  -- çº æ­£æªæ–½
  corrective_actions TEXT,

  -- éªŒè¯ç¨‹åº
  verification_procedure TEXT,
  verification_frequency VARCHAR(100),

  is_active BOOLEAN DEFAULT true,

  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

  FOREIGN KEY (haccp_plan_id) REFERENCES haccp_plans(id) ON DELETE CASCADE,
  FOREIGN KEY (factory_id) REFERENCES factories(id),
  INDEX idx_plan (haccp_plan_id),
  INDEX idx_type (ccp_type)
);

-- HACCPç›‘æ§è®°å½•è¡¨
CREATE TABLE haccp_monitoring_records (
  id VARCHAR(36) PRIMARY KEY,
  factory_id VARCHAR(50) NOT NULL,
  ccp_id VARCHAR(36) NOT NULL,
  batch_id VARCHAR(36),  -- å¯èƒ½å…³è”ç”Ÿäº§æ‰¹æ¬¡

  monitoring_time TIMESTAMP NOT NULL,
  measured_value DECIMAL(10,2) NOT NULL,
  unit VARCHAR(20),

  critical_limit_min DECIMAL(10,2),
  critical_limit_max DECIMAL(10,2),
  is_within_limit BOOLEAN GENERATED ALWAYS AS (
    measured_value BETWEEN critical_limit_min AND critical_limit_max
  ) STORED,

  -- ä¸ç¬¦åˆæ—¶çš„å¤„ç†
  deviation_detected BOOLEAN DEFAULT false,
  corrective_action_taken TEXT,
  corrective_action_by INT,

  monitoring_person INT NOT NULL,
  verified_by INT,
  verified_at TIMESTAMP,

  notes TEXT,
  photos JSON,

  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

  FOREIGN KEY (factory_id) REFERENCES factories(id),
  FOREIGN KEY (ccp_id) REFERENCES haccp_ccps(id),
  FOREIGN KEY (batch_id) REFERENCES processing_batches(id),
  FOREIGN KEY (monitoring_person) REFERENCES users(id),
  FOREIGN KEY (corrective_action_by) REFERENCES users(id),
  FOREIGN KEY (verified_by) REFERENCES users(id),
  INDEX idx_ccp_time (ccp_id, monitoring_time),
  INDEX idx_batch (batch_id),
  INDEX idx_deviation (deviation_detected, factory_id)
);

-- HACCPéªŒè¯è®°å½•è¡¨
CREATE TABLE haccp_verification_records (
  id VARCHAR(36) PRIMARY KEY,
  factory_id VARCHAR(50) NOT NULL,
  haccp_plan_id VARCHAR(36) NOT NULL,

  verification_type ENUM(
    'calibration',          -- è®¾å¤‡æ ¡å‡†
    'records_review',       -- è®°å½•å®¡æŸ¥
    'product_testing',      -- äº§å“æ£€æµ‹
    'system_audit'          -- ä½“ç³»å®¡æ ¸
  ) NOT NULL,

  verification_date DATE NOT NULL,

  verification_result ENUM('pass', 'fail', 'observation') NOT NULL,
  findings TEXT,
  corrective_actions TEXT,

  verified_by INT NOT NULL,

  attachments JSON,

  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

  FOREIGN KEY (factory_id) REFERENCES factories(id),
  FOREIGN KEY (haccp_plan_id) REFERENCES haccp_plans(id),
  FOREIGN KEY (verified_by) REFERENCES users(id),
  INDEX idx_factory_date (factory_id, verification_date),
  INDEX idx_result (verification_result)
);
```

#### APIç«¯ç‚¹è®¾è®¡

```
# HACCPè®¡åˆ’ç®¡ç†
GET    /api/mobile/compliance/haccp/plans              - HACCPè®¡åˆ’åˆ—è¡¨
POST   /api/mobile/compliance/haccp/plans              - åˆ›å»ºHACCPè®¡åˆ’
GET    /api/mobile/compliance/haccp/plans/:id          - è®¡åˆ’è¯¦æƒ…
PUT    /api/mobile/compliance/haccp/plans/:id          - æ›´æ–°è®¡åˆ’
POST   /api/mobile/compliance/haccp/plans/:id/approve  - å®¡æ‰¹è®¡åˆ’

# CCPç®¡ç†
GET    /api/mobile/compliance/haccp/ccps               - CCPåˆ—è¡¨
POST   /api/mobile/compliance/haccp/ccps               - åˆ›å»ºCCP
GET    /api/mobile/compliance/haccp/ccps/:id           - CCPè¯¦æƒ…
PUT    /api/mobile/compliance/haccp/ccps/:id           - æ›´æ–°CCP

# CCPç›‘æ§
POST   /api/mobile/compliance/haccp/monitoring         - è®°å½•CCPç›‘æ§æ•°æ®
GET    /api/mobile/compliance/haccp/monitoring         - ç›‘æ§è®°å½•åˆ—è¡¨
GET    /api/mobile/compliance/haccp/monitoring/:id     - ç›‘æ§è¯¦æƒ…
GET    /api/mobile/compliance/haccp/deviations         - åå·®è®°å½•
POST   /api/mobile/compliance/haccp/corrective-action  - è®°å½•çº æ­£æªæ–½

# HACCPéªŒè¯
POST   /api/mobile/compliance/haccp/verification       - è®°å½•éªŒè¯ç»“æœ
GET    /api/mobile/compliance/haccp/verification       - éªŒè¯è®°å½•åˆ—è¡¨
GET    /api/mobile/compliance/haccp/audit-trail        - å®¡è®¡è¿½è¸ª

# HACCPæŠ¥å‘Š
GET    /api/mobile/compliance/haccp/reports/monthly    - æœˆåº¦HACCPæŠ¥å‘Š
GET    /api/mobile/compliance/haccp/reports/ccp-summary - CCPæ±‡æ€»æŠ¥å‘Š
```

#### å·¥ä½œé‡ä¼°ç®—
- æ•°æ®åº“è®¾è®¡ä¸å®ç°: 1å‘¨
- åç«¯APIå¼€å‘: 1.5å‘¨
- å‰ç«¯UIå¼€å‘: 1.5å‘¨
- æµ‹è¯•ä¸ä¼˜åŒ–: 1å‘¨
- **æ€»è®¡**: 5å‘¨

---

### 5.2 GMPå«ç”Ÿç®¡ç† â­â­â­â­â­

#### åŠŸèƒ½æ¸…å•

**å«ç”Ÿæ¶ˆæ¯’ç®¡ç†**:
- âœ… è½¦é—´æ¶ˆæ¯’è®°å½•
- âœ… è®¾å¤‡æ¸…æ´—æ¶ˆæ¯’
- âœ… äººå‘˜å«ç”Ÿç®¡ç†
- âœ… è½¦è¾†æ¶ˆæ¯’è®°å½•

**è™«å®³é˜²æ²»ç®¡ç†**:
- âœ… è™«å®³æ£€æŸ¥è®°å½•
- âœ… è™«å®³é˜²æ²»æªæ–½
- âœ… å¤–éƒ¨æœåŠ¡å•†ç®¡ç†

**ç¯å¢ƒç›‘æµ‹**:
- âœ… ç©ºæ°”è´¨é‡ç›‘æµ‹
- âœ… æ°´è´¨ç›‘æµ‹
- âœ… è¡¨é¢å¾®ç”Ÿç‰©ç›‘æµ‹

#### æ•°æ®åº“è®¾è®¡

```sql
-- å«ç”Ÿæ¶ˆæ¯’è®°å½•è¡¨
CREATE TABLE sanitation_records (
  id VARCHAR(36) PRIMARY KEY,
  factory_id VARCHAR(50) NOT NULL,
  record_number VARCHAR(100) UNIQUE NOT NULL,

  sanitation_type ENUM('equipment', 'facility', 'personnel', 'vehicle') NOT NULL,

  -- æ¶ˆæ¯’å¯¹è±¡
  area VARCHAR(100),              -- "åŠ å·¥è½¦é—´AåŒº"
  equipment_id VARCHAR(36),       -- è®¾å¤‡ID (å¦‚æœæ˜¯è®¾å¤‡æ¶ˆæ¯’)
  vehicle_number VARCHAR(50),     -- è½¦ç‰Œå· (å¦‚æœæ˜¯è½¦è¾†æ¶ˆæ¯’)

  -- æ¶ˆæ¯’æ–¹æ³•
  sanitation_method VARCHAR(100), -- "75%é…’ç²¾å–·æ´’", "ç´«å¤–çº¿æ¶ˆæ¯’"
  disinfectant_name VARCHAR(100),
  disinfectant_concentration VARCHAR(50),

  -- æ‰§è¡Œä¿¡æ¯
  performed_by INT NOT NULL,
  performed_at TIMESTAMP NOT NULL,
  duration_minutes INT,

  -- éªŒè¯ä¿¡æ¯
  verified_by INT,
  verified_at TIMESTAMP,
  verification_method VARCHAR(100),

  status ENUM('completed', 'failed', 'pending_verification') NOT NULL,
  failure_reason TEXT,

  notes TEXT,
  photos JSON,

  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

  FOREIGN KEY (factory_id) REFERENCES factories(id),
  FOREIGN KEY (equipment_id) REFERENCES factory_equipment(id),
  FOREIGN KEY (performed_by) REFERENCES users(id),
  FOREIGN KEY (verified_by) REFERENCES users(id),
  INDEX idx_factory_date (factory_id, performed_at),
  INDEX idx_type (sanitation_type),
  INDEX idx_area (factory_id, area)
);

-- è™«å®³é˜²æ²»è®°å½•è¡¨
CREATE TABLE pest_control_records (
  id VARCHAR(36) PRIMARY KEY,
  factory_id VARCHAR(50) NOT NULL,
  record_number VARCHAR(100) UNIQUE NOT NULL,

  inspection_date DATE NOT NULL,
  inspection_type ENUM('routine', 'complaint', 'follow_up') NOT NULL,

  -- æ£€æŸ¥åŒºåŸŸ
  areas_inspected JSON,  -- ["åŸæ–™ä»“", "åŠ å·¥è½¦é—´", "æˆå“ä»“", "åŠå…¬åŒº"]

  -- è™«å®³å‘ç°
  pest_found BOOLEAN DEFAULT false,
  pest_types JSON,       -- ["èŸ‘è‚", "è€é¼ ", "é£è™«"]
  pest_level ENUM('none', 'low', 'medium', 'high') DEFAULT 'none',
  infestation_areas JSON,

  -- é˜²æ²»æªæ–½
  control_measures_taken TEXT,
  chemicals_used JSON,   -- [{"name": "æ€è™«å‰‚A", "dosage": "100ml"}]
  traps_installed INT,
  traps_checked INT,

  -- è·Ÿè¿›
  follow_up_required BOOLEAN DEFAULT false,
  follow_up_date DATE,
  follow_up_notes TEXT,

  -- æ‰§è¡Œäºº
  inspector_name VARCHAR(100),  -- å¯èƒ½æ˜¯å¤–éƒ¨æœåŠ¡å•†
  inspector_company VARCHAR(255),
  inspector_license VARCHAR(100),
  internal_supervisor INT,

  photos JSON,
  report_attachment VARCHAR(500),

  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

  FOREIGN KEY (factory_id) REFERENCES factories(id),
  FOREIGN KEY (internal_supervisor) REFERENCES users(id),
  INDEX idx_factory_date (factory_id, inspection_date),
  INDEX idx_pest_found (pest_found),
  INDEX idx_follow_up (follow_up_required, follow_up_date)
);

-- ç¯å¢ƒç›‘æµ‹è®°å½•è¡¨
CREATE TABLE environmental_monitoring_records (
  id VARCHAR(36) PRIMARY KEY,
  factory_id VARCHAR(50) NOT NULL,

  monitoring_type ENUM('air_quality', 'water_quality', 'surface_microbe', 'noise_level') NOT NULL,
  monitoring_point VARCHAR(100) NOT NULL,  -- "åŠ å·¥è½¦é—´AåŒº", "æ°´æº1å·"

  monitoring_date DATE NOT NULL,

  -- ç›‘æµ‹æŒ‡æ ‡ï¼ˆJSONæ ¼å¼ï¼Œæ ¹æ®ç±»å‹ä¸åŒï¼‰
  test_parameters JSON,
  /* ç¤ºä¾‹:
  ç©ºæ°”è´¨é‡: {"particulate_matter": 50, "bacteria_count": 100, "temperature": 22, "humidity": 65}
  æ°´è´¨: {"ph": 7.0, "chlorine": 0.5, "bacteria_count": 0}
  è¡¨é¢å¾®ç”Ÿç‰©: {"bacteria_count": 10, "e_coli": 0}
  */

  -- æ ‡å‡†é™å€¼
  standard_limits JSON,
  compliance_status ENUM('pass', 'fail', 'marginal') NOT NULL,

  -- æ‰§è¡Œä¿¡æ¯
  tested_by INT,
  lab_name VARCHAR(255),  -- å¦‚æœæ˜¯å¤–éƒ¨å®éªŒå®¤
  test_report_number VARCHAR(100),

  -- ä¸åˆæ ¼å¤„ç†
  corrective_actions TEXT,
  retest_required BOOLEAN DEFAULT false,
  retest_date DATE,

  attachments JSON,

  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

  FOREIGN KEY (factory_id) REFERENCES factories(id),
  FOREIGN KEY (tested_by) REFERENCES users(id),
  INDEX idx_factory_type_date (factory_id, monitoring_type, monitoring_date),
  INDEX idx_compliance (compliance_status)
);

-- å‘˜å·¥å¥åº·è¯ç®¡ç†è¡¨
CREATE TABLE employee_health_certificates (
  id VARCHAR(36) PRIMARY KEY,
  user_id INT NOT NULL,

  certificate_number VARCHAR(100) UNIQUE NOT NULL,
  certificate_type ENUM('health', 'hygiene_training') NOT NULL,

  issue_date DATE NOT NULL,
  expiry_date DATE NOT NULL,
  issuing_authority VARCHAR(255),

  certificate_photo VARCHAR(500),

  status ENUM('valid', 'expiring', 'expired') GENERATED ALWAYS AS (
    CASE
      WHEN expiry_date < CURRENT_DATE THEN 'expired'
      WHEN DATEDIFF(expiry_date, CURRENT_DATE) <= 30 THEN 'expiring'
      ELSE 'valid'
    END
  ) STORED,

  days_to_expiry INT GENERATED ALWAYS AS (DATEDIFF(expiry_date, CURRENT_DATE)) STORED,

  verified_by INT,
  verified_at TIMESTAMP,

  notes TEXT,

  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,

  FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
  FOREIGN KEY (verified_by) REFERENCES users(id),
  INDEX idx_user_type (user_id, certificate_type),
  INDEX idx_expiry (expiry_date),
  INDEX idx_status (status)
);
```

#### APIç«¯ç‚¹è®¾è®¡

```
# å«ç”Ÿæ¶ˆæ¯’ç®¡ç†
POST   /api/mobile/compliance/sanitation              - è®°å½•æ¶ˆæ¯’
GET    /api/mobile/compliance/sanitation              - æ¶ˆæ¯’è®°å½•åˆ—è¡¨
GET    /api/mobile/compliance/sanitation/:id          - æ¶ˆæ¯’è¯¦æƒ…
GET    /api/mobile/compliance/sanitation/schedule     - æ¶ˆæ¯’è®¡åˆ’
POST   /api/mobile/compliance/sanitation/:id/verify   - éªŒè¯æ¶ˆæ¯’

# è™«å®³é˜²æ²»
POST   /api/mobile/compliance/pest-control            - è®°å½•è™«å®³æ£€æŸ¥
GET    /api/mobile/compliance/pest-control            - è™«å®³è®°å½•åˆ—è¡¨
GET    /api/mobile/compliance/pest-control/:id        - è™«å®³è¯¦æƒ…
GET    /api/mobile/compliance/pest-control/alerts     - è™«å®³é¢„è­¦
POST   /api/mobile/compliance/pest-control/:id/follow-up - è·Ÿè¿›å¤„ç†

# ç¯å¢ƒç›‘æµ‹
POST   /api/mobile/compliance/environmental           - è®°å½•ç¯å¢ƒç›‘æµ‹
GET    /api/mobile/compliance/environmental           - ç›‘æµ‹è®°å½•åˆ—è¡¨
GET    /api/mobile/compliance/environmental/:id       - ç›‘æµ‹è¯¦æƒ…
GET    /api/mobile/compliance/environmental/non-compliant - ä¸åˆæ ¼è®°å½•

# å¥åº·è¯ç®¡ç†
GET    /api/mobile/employees/health-certificates      - å¥åº·è¯åˆ—è¡¨
POST   /api/mobile/employees/health-certificates      - ä¸Šä¼ å¥åº·è¯
GET    /api/mobile/employees/certificates-expiring    - å³å°†è¿‡æœŸå¥åº·è¯
PUT    /api/mobile/employees/health-certificates/:id  - æ›´æ–°å¥åº·è¯
```

#### å·¥ä½œé‡ä¼°ç®—
- æ•°æ®åº“è®¾è®¡ä¸å®ç°: 1å‘¨
- åç«¯APIå¼€å‘: 1.5å‘¨
- å‰ç«¯UIå¼€å‘: 1.5å‘¨
- æµ‹è¯•ä¸ä¼˜åŒ–: 1å‘¨
- **æ€»è®¡**: 5å‘¨

---

### 5.3 äº§å“å¬å›ç®¡ç† â­â­â­â­

#### åŠŸèƒ½æ¸…å•

**å¬å›æµç¨‹ç®¡ç†**:
- âœ… å¬å›å‘èµ·ä¸å®¡æ‰¹
- âœ… å¬å›æ‰¹æ¬¡è¿½æº¯
- âœ… å®¢æˆ·é€šçŸ¥ç®¡ç†
- âœ… å¬å›è¿›åº¦è·Ÿè¸ª
- âœ… æ”¿åºœæŠ¥å‘Š

**å¬å›çº§åˆ«**:
- Class I (ä¸€çº§å¬å›): ä¸¥é‡å¥åº·å±å®³
- Class II (äºŒçº§å¬å›): ä¸­ç­‰å¥åº·å±å®³
- Class III (ä¸‰çº§å¬å›): è½»å¾®å¥åº·å±å®³

#### æ•°æ®åº“è®¾è®¡

```sql
-- äº§å“å¬å›ç®¡ç†è¡¨
CREATE TABLE product_recalls (
  id VARCHAR(36) PRIMARY KEY,
  factory_id VARCHAR(50) NOT NULL,
  recall_number VARCHAR(100) UNIQUE NOT NULL,

  -- å¬å›äº§å“ä¿¡æ¯
  product_name VARCHAR(255) NOT NULL,
  product_code VARCHAR(100),
  batch_numbers JSON NOT NULL,  -- æ¶‰åŠçš„æ‰¹æ¬¡å·åˆ—è¡¨

  -- å¬å›åŸå› 
  recall_reason TEXT NOT NULL,
  recall_category ENUM(
    'microbiological',    -- å¾®ç”Ÿç‰©æ±¡æŸ“
    'chemical',           -- åŒ–å­¦æ±¡æŸ“
    'physical',           -- ç‰©ç†å±å®³ï¼ˆå¼‚ç‰©ï¼‰
    'allergen',           -- è¿‡æ•åŸ
    'mislabeling',        -- æ ‡ç­¾é”™è¯¯
    'other'
  ) NOT NULL,

  -- å¬å›çº§åˆ«
  recall_level ENUM('class_i', 'class_ii', 'class_iii') NOT NULL,
  health_hazard_evaluation TEXT,

  -- æ•°é‡ç»Ÿè®¡
  quantity_produced DECIMAL(10,2) NOT NULL,
  quantity_distributed DECIMAL(10,2) NOT NULL,
  quantity_recalled DECIMAL(10,2) DEFAULT 0,
  recall_completion_percentage DECIMAL(5,2) GENERATED ALWAYS AS (
    CASE WHEN quantity_distributed > 0
    THEN (quantity_recalled / quantity_distributed) * 100
    ELSE 0 END
  ) STORED,

  -- æ—¶é—´ä¿¡æ¯
  recall_initiation_date DATE NOT NULL,
  recall_completion_date DATE,

  -- çŠ¶æ€ä¿¡æ¯
  status ENUM('initiated', 'in_progress', 'completed', 'terminated') DEFAULT 'initiated',

  -- é€šçŸ¥ä¿¡æ¯
  customer_notification_sent BOOLEAN DEFAULT false,
  public_announcement_made BOOLEAN DEFAULT false,
  authority_reported BOOLEAN DEFAULT false,
  authority_report_number VARCHAR(100),

  -- å¤„ç†æªæ–½
  disposal_method ENUM('destroy', 'rework', 'relabel', 'return') NOT NULL,
  disposal_completion BOOLEAN DEFAULT false,

  -- è´£ä»»äºº
  initiated_by INT NOT NULL,
  approved_by INT,
  approved_at TIMESTAMP,

  root_cause_analysis TEXT,
  preventive_actions TEXT,

  attachments JSON,

  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,

  FOREIGN KEY (factory_id) REFERENCES factories(id),
  FOREIGN KEY (initiated_by) REFERENCES users(id),
  FOREIGN KEY (approved_by) REFERENCES users(id),
  INDEX idx_factory_status (factory_id, status),
  INDEX idx_recall_date (recall_initiation_date),
  INDEX idx_level (recall_level)
);

-- å¬å›å®¢æˆ·é€šçŸ¥è®°å½•è¡¨
CREATE TABLE recall_notifications (
  id VARCHAR(36) PRIMARY KEY,
  recall_id VARCHAR(36) NOT NULL,
  customer_id VARCHAR(36) NOT NULL,

  notification_type ENUM('email', 'phone', 'letter', 'visit') NOT NULL,
  notification_date DATE NOT NULL,

  quantity_to_recall DECIMAL(10,2),
  quantity_returned DECIMAL(10,2) DEFAULT 0,

  customer_response ENUM('acknowledged', 'returned', 'no_response', 'refused') DEFAULT 'no_response',
  response_date DATE,

  notified_by INT NOT NULL,

  notes TEXT,

  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

  FOREIGN KEY (recall_id) REFERENCES product_recalls(id) ON DELETE CASCADE,
  FOREIGN KEY (customer_id) REFERENCES customers(id),
  FOREIGN KEY (notified_by) REFERENCES users(id),
  INDEX idx_recall_customer (recall_id, customer_id),
  INDEX idx_response (customer_response)
);

-- å¬å›äº§å“å›æ”¶è®°å½•è¡¨
CREATE TABLE recall_recovery_records (
  id VARCHAR(36) PRIMARY KEY,
  recall_id VARCHAR(36) NOT NULL,

  recovery_date DATE NOT NULL,
  customer_id VARCHAR(36),

  batch_number VARCHAR(100),
  quantity_recovered DECIMAL(10,2) NOT NULL,
  unit VARCHAR(20),

  recovery_location VARCHAR(255),

  disposal_method ENUM('destroy', 'rework', 'relabel', 'return_supplier') NOT NULL,
  disposal_date DATE,
  disposal_confirmation VARCHAR(500),  -- é”€æ¯è¯æ˜æ–‡ä»¶è·¯å¾„

  recovered_by INT NOT NULL,

  photos JSON,
  notes TEXT,

  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

  FOREIGN KEY (recall_id) REFERENCES product_recalls(id) ON DELETE CASCADE,
  FOREIGN KEY (customer_id) REFERENCES customers(id),
  FOREIGN KEY (recovered_by) REFERENCES users(id),
  INDEX idx_recall_date (recall_id, recovery_date),
  INDEX idx_batch (batch_number)
);
```

#### APIç«¯ç‚¹è®¾è®¡

```
# äº§å“å¬å›ç®¡ç†
POST   /api/mobile/compliance/recalls                 - å‘èµ·å¬å›
GET    /api/mobile/compliance/recalls                 - å¬å›åˆ—è¡¨
GET    /api/mobile/compliance/recalls/:id             - å¬å›è¯¦æƒ…
PUT    /api/mobile/compliance/recalls/:id             - æ›´æ–°å¬å›ä¿¡æ¯
POST   /api/mobile/compliance/recalls/:id/approve     - å®¡æ‰¹å¬å›
POST   /api/mobile/compliance/recalls/:id/complete    - å®Œæˆå¬å›

# å®¢æˆ·é€šçŸ¥
POST   /api/mobile/compliance/recalls/:id/notify      - é€šçŸ¥å®¢æˆ·
GET    /api/mobile/compliance/recalls/:id/notifications - é€šçŸ¥è®°å½•
PUT    /api/mobile/compliance/recalls/:id/notifications/:nid - æ›´æ–°é€šçŸ¥çŠ¶æ€

# äº§å“å›æ”¶
POST   /api/mobile/compliance/recalls/:id/recovery    - è®°å½•äº§å“å›æ”¶
GET    /api/mobile/compliance/recalls/:id/recovery    - å›æ”¶è®°å½•åˆ—è¡¨
GET    /api/mobile/compliance/recalls/:id/progress    - å¬å›è¿›åº¦

# æ”¿åºœæŠ¥å‘Š
POST   /api/mobile/compliance/recalls/:id/report-authority - å‘ç›‘ç®¡éƒ¨é—¨æŠ¥å‘Š
GET    /api/mobile/compliance/recalls/reports         - å¬å›æŠ¥å‘Š
```

#### å·¥ä½œé‡ä¼°ç®—
- æ•°æ®åº“è®¾è®¡ä¸å®ç°: 0.5å‘¨
- åç«¯APIå¼€å‘: 1å‘¨
- å‰ç«¯UIå¼€å‘: 1å‘¨
- æµ‹è¯•ä¸ä¼˜åŒ–: 0.5å‘¨
- **æ€»è®¡**: 3å‘¨

---

### Phase 5 æ€»ç»“

**æ€»å·¥ä½œé‡**: 13å‘¨ (çº¦3ä¸ªæœˆ)
**æ ¸å¿ƒäº¤ä»˜ç‰©**:
1. âœ… å®Œæ•´çš„HACCPç®¡ç†ç³»ç»Ÿ
2. âœ… GMPå«ç”Ÿç®¡ç†ç³»ç»Ÿ
3. âœ… äº§å“å¬å›ç®¡ç†ç³»ç»Ÿ
4. âœ… å‘˜å·¥å¥åº·è¯ç®¡ç†
5. âœ… æ»¡è¶³ISO22000è®¤è¯è¦æ±‚

**æ³•è§„åˆè§„**:
- âœ… ç¬¦åˆã€Šé£Ÿå“å®‰å…¨æ³•ã€‹
- âœ… ç¬¦åˆHACCPä¸ƒå¤§åŸç†
- âœ… ç¬¦åˆGMPè‰¯å¥½ç”Ÿäº§è§„èŒƒ
- âœ… å¯é€šè¿‡ISO22000è®¤è¯å®¡æ ¸

---

## ğŸŒ¡ï¸ Phase 6: å†·é“¾ä¸åŒ…è£…

**æ—¶é—´å‘¨æœŸ**: 2025å¹´7æœˆ - 2025å¹´9æœˆ (12å‘¨)
**æ ¸å¿ƒç›®æ ‡**: å®Œå–„æ¸©åº¦è¿½æº¯å’Œäº§å“åŒ…è£…ç®¡ç†
**ä¼˜å…ˆçº§**: ğŸŸ  P1ï¼ˆé‡è¦åŠŸèƒ½ï¼‰

### 6.1 æ¸©åº¦ç›‘æ§ä¸å†·é“¾è¿½æº¯ â­â­â­â­

#### åŠŸèƒ½æ¸…å•

**æ¸©åº¦ç›‘æ§**:
- âœ… å†·åº“æ¸©åº¦å®æ—¶ç›‘æ§
- âœ… è¿è¾“è½¦è¾†æ¸©åº¦ç›‘æ§
- âœ… ç”Ÿäº§åŒºåŸŸæ¸©åº¦ç›‘æ§
- âœ… æ¸©åº¦å¼‚å¸¸è‡ªåŠ¨å‘Šè­¦

**å†·é“¾è¿½æº¯**:
- âœ… æ‰¹æ¬¡å†·é“¾æ¸©åº¦å†å²
- âœ… æ¸©åº¦æ›²çº¿å›¾
- âœ… å†·é“¾ä¸­æ–­è®°å½•
- âœ… å†·é“¾å®Œæ•´æ€§éªŒè¯

#### æ•°æ®åº“è®¾è®¡

```sql
-- æ¸©åº¦ç›‘æ§è®¾å¤‡è¡¨
CREATE TABLE temperature_sensors (
  id VARCHAR(36) PRIMARY KEY,
  factory_id VARCHAR(50) NOT NULL,
  sensor_code VARCHAR(50) NOT NULL,
  sensor_name VARCHAR(255) NOT NULL,

  device_type ENUM('cold_storage', 'freezer', 'vehicle', 'production_area', 'incubator') NOT NULL,
  location VARCHAR(255),
  warehouse_id VARCHAR(36),

  temperature_limit_min DECIMAL(5,2) NOT NULL,
  temperature_limit_max DECIMAL(5,2) NOT NULL,
  humidity_limit_min DECIMAL(5,2),
  humidity_limit_max DECIMAL(5,2),

  monitoring_interval INT DEFAULT 300,  -- ç›‘æ§é—´éš”ï¼ˆç§’ï¼‰ï¼Œé»˜è®¤5åˆ†é’Ÿ

  is_active BOOLEAN DEFAULT true,
  last_report_time TIMESTAMP,

  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

  FOREIGN KEY (factory_id) REFERENCES factories(id),
  FOREIGN KEY (warehouse_id) REFERENCES warehouses(id),
  UNIQUE KEY unique_factory_sensor (factory_id, sensor_code),
  INDEX idx_type (device_type),
  INDEX idx_active (is_active)
);

-- æ¸©åº¦è®°å½•è¡¨
CREATE TABLE temperature_records (
  id VARCHAR(36) PRIMARY KEY,
  sensor_id VARCHAR(36) NOT NULL,
  factory_id VARCHAR(50) NOT NULL,

  temperature DECIMAL(5,2) NOT NULL,
  humidity DECIMAL(5,2),

  temperature_limit_min DECIMAL(5,2) NOT NULL,
  temperature_limit_max DECIMAL(5,2) NOT NULL,

  is_within_range BOOLEAN GENERATED ALWAYS AS (
    temperature BETWEEN temperature_limit_min AND temperature_limit_max
  ) STORED,

  recorded_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

  FOREIGN KEY (sensor_id) REFERENCES temperature_sensors(id) ON DELETE CASCADE,
  FOREIGN KEY (factory_id) REFERENCES factories(id),
  INDEX idx_sensor_time (sensor_id, recorded_at),
  INDEX idx_out_of_range (is_within_range, factory_id, recorded_at)
) PARTITION BY RANGE (YEAR(recorded_at)) (
  PARTITION p2025 VALUES LESS THAN (2026),
  PARTITION p2026 VALUES LESS THAN (2027),
  PARTITION p2027 VALUES LESS THAN (2028),
  PARTITION p_future VALUES LESS THAN MAXVALUE
);

-- æ¸©åº¦å‘Šè­¦è¡¨
CREATE TABLE temperature_alerts (
  id VARCHAR(36) PRIMARY KEY,
  factory_id VARCHAR(50) NOT NULL,
  sensor_id VARCHAR(36) NOT NULL,
  temperature_record_id VARCHAR(36) NOT NULL,

  alert_type ENUM('too_high', 'too_low', 'sensor_fault', 'data_missing') NOT NULL,
  severity ENUM('warning', 'critical') NOT NULL,

  temperature DECIMAL(5,2),
  threshold_violated DECIMAL(5,2),
  duration_minutes INT,  -- å‘Šè­¦æŒç»­æ—¶é•¿

  status ENUM('active', 'acknowledged', 'resolved', 'false_alarm') DEFAULT 'active',

  acknowledged_by INT,
  acknowledged_at TIMESTAMP,

  resolved_by INT,
  resolved_at TIMESTAMP,
  resolution_notes TEXT,

  notification_sent BOOLEAN DEFAULT false,

  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,

  FOREIGN KEY (factory_id) REFERENCES factories(id),
  FOREIGN KEY (sensor_id) REFERENCES temperature_sensors(id),
  FOREIGN KEY (temperature_record_id) REFERENCES temperature_records(id) ON DELETE CASCADE,
  FOREIGN KEY (acknowledged_by) REFERENCES users(id),
  FOREIGN KEY (resolved_by) REFERENCES users(id),
  INDEX idx_factory_status (factory_id, status),
  INDEX idx_sensor_status (sensor_id, status),
  INDEX idx_severity (severity, status)
);

-- å†·é“¾è¿½æº¯è®°å½•è¡¨
CREATE TABLE cold_chain_traces (
  id VARCHAR(36) PRIMARY KEY,
  batch_id VARCHAR(36) NOT NULL,
  factory_id VARCHAR(50) NOT NULL,

  trace_type ENUM('storage', 'transport', 'production') NOT NULL,

  start_time TIMESTAMP NOT NULL,
  end_time TIMESTAMP,
  duration_minutes INT,

  sensor_id VARCHAR(36),
  location VARCHAR(255),

  avg_temperature DECIMAL(5,2),
  min_temperature DECIMAL(5,2),
  max_temperature DECIMAL(5,2),

  temperature_violations INT DEFAULT 0,
  cold_chain_intact BOOLEAN DEFAULT true,

  notes TEXT,

  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

  FOREIGN KEY (batch_id) REFERENCES processing_batches(id) ON DELETE CASCADE,
  FOREIGN KEY (factory_id) REFERENCES factories(id),
  FOREIGN KEY (sensor_id) REFERENCES temperature_sensors(id),
  INDEX idx_batch (batch_id),
  INDEX idx_type_time (trace_type, start_time)
);
```

#### APIç«¯ç‚¹è®¾è®¡

```
# æ¸©åº¦ä¼ æ„Ÿå™¨ç®¡ç†
GET    /api/mobile/temperature/sensors                - ä¼ æ„Ÿå™¨åˆ—è¡¨
POST   /api/mobile/temperature/sensors                - æ·»åŠ ä¼ æ„Ÿå™¨
GET    /api/mobile/temperature/sensors/:id            - ä¼ æ„Ÿå™¨è¯¦æƒ…
PUT    /api/mobile/temperature/sensors/:id            - æ›´æ–°ä¼ æ„Ÿå™¨

# æ¸©åº¦ç›‘æ§
POST   /api/mobile/temperature/record                 - ä¸ŠæŠ¥æ¸©åº¦æ•°æ®
GET    /api/mobile/temperature/realtime               - å®æ—¶æ¸©åº¦ç›‘æ§
GET    /api/mobile/temperature/sensors/:id/current    - ä¼ æ„Ÿå™¨å½“å‰æ¸©åº¦
GET    /api/mobile/temperature/sensors/:id/history    - æ¸©åº¦å†å²æ›²çº¿
GET    /api/mobile/temperature/sensors/:id/statistics - æ¸©åº¦ç»Ÿè®¡

# æ¸©åº¦å‘Šè­¦
GET    /api/mobile/temperature/alerts                 - æ¸©åº¦å‘Šè­¦åˆ—è¡¨
GET    /api/mobile/temperature/alerts/active          - æ´»åŠ¨å‘Šè­¦
POST   /api/mobile/temperature/alerts/:id/acknowledge - ç¡®è®¤å‘Šè­¦
POST   /api/mobile/temperature/alerts/:id/resolve     - è§£å†³å‘Šè­¦

# å†·é“¾è¿½æº¯
GET    /api/mobile/cold-chain/trace/:batchId          - æ‰¹æ¬¡å†·é“¾è¿½æº¯
GET    /api/mobile/cold-chain/verify/:batchId         - å†·é“¾å®Œæ•´æ€§éªŒè¯
POST   /api/mobile/cold-chain/trace                   - åˆ›å»ºå†·é“¾è®°å½•
GET    /api/mobile/cold-chain/report/:batchId         - å†·é“¾æŠ¥å‘Š
```

#### å·¥ä½œé‡ä¼°ç®—
- æ•°æ®åº“è®¾è®¡ä¸å®ç°: 1å‘¨
- åç«¯APIå¼€å‘: 1.5å‘¨
- å‰ç«¯UIå¼€å‘: 1.5å‘¨
- æµ‹è¯•ä¸ä¼˜åŒ–: 1å‘¨
- **æ€»è®¡**: 5å‘¨

---

### 6.2 äº§å“åŒ…è£…ä¸è¿½æº¯ç ç®¡ç† â­â­â­â­

#### åŠŸèƒ½æ¸…å•

**åŒ…è£…ç®¡ç†**:
- âœ… åŒ…è£…è®°å½•åˆ›å»º
- âœ… è¿½æº¯ç ç”Ÿæˆï¼ˆäºŒç»´ç /æ¡å½¢ç ï¼‰
- âœ… æ ‡ç­¾æ‰“å°
- âœ… åŒ…è£…æ‰¹æ¬¡ç®¡ç†

**è¿½æº¯æŸ¥è¯¢ï¼ˆå…¬å¼€æ¥å£ï¼‰**:
- âœ… æ‰«ç è¿½æº¯æŸ¥è¯¢
- âœ… å®Œæ•´è¿½æº¯ä¿¡æ¯å±•ç¤º
- âœ… é˜²ä¼ªéªŒè¯

#### æ•°æ®åº“è®¾è®¡

```sql
-- äº§å“åŒ…è£…è®°å½•è¡¨
CREATE TABLE product_packages (
  id VARCHAR(36) PRIMARY KEY,
  factory_id VARCHAR(50) NOT NULL,
  batch_id VARCHAR(36) NOT NULL,

  package_code VARCHAR(100) UNIQUE NOT NULL,  -- åŒ…è£…ç ï¼ˆå”¯ä¸€ï¼‰
  qr_code_content TEXT,                       -- äºŒç»´ç å†…å®¹ï¼ˆJSONï¼‰
  qr_code_url VARCHAR(500),                   -- äºŒç»´ç å›¾ç‰‡URL
  barcode VARCHAR(100),                       -- æ¡å½¢ç 

  package_type ENUM('box', 'bag', 'carton', 'pallet', 'individual') NOT NULL,
  package_level ENUM('primary', 'secondary', 'tertiary') NOT NULL,  -- åŒ…è£…å±‚çº§

  net_weight DECIMAL(10,2),
  gross_weight DECIMAL(10,2),
  unit VARCHAR(20),

  pieces_per_package INT,  -- æ¯åŒ…ä»¶æ•°

  production_date DATE NOT NULL,
  expiry_date DATE NOT NULL,
  shelf_life_days INT,

  packaging_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  packaged_by INT NOT NULL,

  status ENUM('packed', 'in_stock', 'shipped', 'sold') DEFAULT 'packed',

  parent_package_id VARCHAR(36),  -- çˆ¶åŒ…è£…IDï¼ˆç”¨äºå¤šçº§åŒ…è£…ï¼‰

  notes TEXT,

  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

  FOREIGN KEY (factory_id) REFERENCES factories(id),
  FOREIGN KEY (batch_id) REFERENCES processing_batches(id) ON DELETE CASCADE,
  FOREIGN KEY (packaged_by) REFERENCES users(id),
  FOREIGN KEY (parent_package_id) REFERENCES product_packages(id),
  INDEX idx_batch_package (batch_id, package_code),
  INDEX idx_status (status),
  INDEX idx_qr_lookup (package_code)
);

-- æ ‡ç­¾æ¨¡æ¿è¡¨
CREATE TABLE label_templates (
  id VARCHAR(36) PRIMARY KEY,
  factory_id VARCHAR(50) NOT NULL,

  template_name VARCHAR(255) NOT NULL,
  template_code VARCHAR(50) NOT NULL,
  product_category VARCHAR(100),

  label_type ENUM('product_label', 'batch_label', 'pallet_label') NOT NULL,

  -- æ ‡ç­¾å†…å®¹é…ç½®ï¼ˆJSONæ ¼å¼ï¼‰
  label_fields JSON NOT NULL,
  /* ç¤ºä¾‹:
  {
    "productName": true,
    "batchNumber": true,
    "productionDate": true,
    "expiryDate": true,
    "netWeight": true,
    "ingredients": true,
    "nutritionFacts": true,
    "qrCode": true,
    "barcode": true,
    "manufacturer": true,
    "license": true
  }
  */

  -- äºŒç»´ç é…ç½®
  qr_code_format ENUM('url', 'json', 'custom') DEFAULT 'url',
  qr_code_base_url VARCHAR(500),  -- "https://trace.cretas.com/p/"

  -- æ¨¡æ¿æ–‡ä»¶
  template_file_url VARCHAR(500),

  is_active BOOLEAN DEFAULT true,
  is_default BOOLEAN DEFAULT false,

  created_by INT,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,

  FOREIGN KEY (factory_id) REFERENCES factories(id),
  FOREIGN KEY (created_by) REFERENCES users(id),
  UNIQUE KEY unique_factory_template (factory_id, template_code),
  INDEX idx_category (product_category)
);

-- è¿½æº¯æŸ¥è¯¢æ—¥å¿—è¡¨ï¼ˆå…¬å¼€æ¥å£è®¿é—®è®°å½•ï¼‰
CREATE TABLE trace_query_logs (
  id VARCHAR(36) PRIMARY KEY,
  package_code VARCHAR(100) NOT NULL,

  query_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  query_ip VARCHAR(45),
  query_location VARCHAR(255),  -- æŸ¥è¯¢åœ°ç†ä½ç½®
  user_agent TEXT,

  query_result ENUM('success', 'not_found', 'expired', 'recalled') NOT NULL,

  INDEX idx_package (package_code, query_time),
  INDEX idx_time (query_time)
) PARTITION BY RANGE (YEAR(query_time)) (
  PARTITION p2025 VALUES LESS THAN (2026),
  PARTITION p2026 VALUES LESS THAN (2027),
  PARTITION p2027 VALUES LESS THAN (2028),
  PARTITION p_future VALUES LESS THAN MAXVALUE
);
```

#### APIç«¯ç‚¹è®¾è®¡

```
# åŒ…è£…ç®¡ç†
POST   /api/mobile/packaging/packages                 - åˆ›å»ºåŒ…è£…è®°å½•
GET    /api/mobile/packaging/packages                 - åŒ…è£…è®°å½•åˆ—è¡¨
GET    /api/mobile/packaging/packages/:id             - åŒ…è£…è¯¦æƒ…
PUT    /api/mobile/packaging/packages/:id             - æ›´æ–°åŒ…è£…
GET    /api/mobile/packaging/packages/:batchId        - æ‰¹æ¬¡åŒ…è£…åˆ—è¡¨

# è¿½æº¯ç ç”Ÿæˆ
POST   /api/mobile/packaging/generate-qrcode          - ç”Ÿæˆè¿½æº¯äºŒç»´ç 
POST   /api/mobile/packaging/batch-generate           - æ‰¹é‡ç”ŸæˆäºŒç»´ç 
GET    /api/mobile/packaging/qrcode/:packageCode      - è·å–äºŒç»´ç å›¾ç‰‡

# æ ‡ç­¾æ¨¡æ¿
GET    /api/mobile/packaging/templates                - æ ‡ç­¾æ¨¡æ¿åˆ—è¡¨
POST   /api/mobile/packaging/templates                - åˆ›å»ºæ ‡ç­¾æ¨¡æ¿
GET    /api/mobile/packaging/templates/:id            - æ¨¡æ¿è¯¦æƒ…
PUT    /api/mobile/packaging/templates/:id            - æ›´æ–°æ¨¡æ¿
POST   /api/mobile/packaging/print-label              - æ‰“å°æ ‡ç­¾

# è¿½æº¯æŸ¥è¯¢ï¼ˆå…¬å¼€æ¥å£ - æ— éœ€è®¤è¯ï¼‰
GET    /api/public/trace/:packageCode                 - æ‰«ç è¿½æº¯æŸ¥è¯¢
GET    /api/public/trace/:packageCode/simple          - ç®€åŒ–è¿½æº¯ä¿¡æ¯
POST   /api/public/trace/verify                       - é˜²ä¼ªéªŒè¯

# è¿½æº¯ç»Ÿè®¡
GET    /api/mobile/packaging/query-statistics         - æŸ¥è¯¢ç»Ÿè®¡
GET    /api/mobile/packaging/hot-products             - çƒ­é—¨æŸ¥è¯¢äº§å“
```

#### è¿½æº¯ç å†…å®¹è®¾è®¡

```json
{
  "v": "1.0",
  "packageCode": "PKG-FAC001-20250105-001",
  "product": {
    "name": "å†·å†»ä¸‰æ–‡é±¼åˆ‡ç‰‡",
    "code": "PROD-SALMON-500G",
    "specification": "500g/è¢‹",
    "category": "frozen_seafood"
  },
  "batch": {
    "batchNumber": "BATCH-FAC001-20250105-001",
    "productionDate": "2025-01-05",
    "expiryDate": "2026-01-05",
    "shelfLifeDays": 365
  },
  "factory": {
    "id": "FAC001",
    "name": "ç™½å©çºªé£Ÿå“åŠ å·¥å‚",
    "license": "SC12345678901234",
    "address": "XXçœXXå¸‚XXåŒº",
    "phone": "400-xxx-xxxx"
  },
  "traceability": {
    "rawMaterial": {
      "supplier": "XXæ°´äº§ä¾›åº”å•†",
      "receiptDate": "2025-01-04",
      "batch": "SUP-20250104-001",
      "qualityGrade": "A",
      "origin": "æŒªå¨"
    },
    "production": {
      "supervisor": "å¼ ä¸‰",
      "processingLine": "Line-A",
      "startTime": "2025-01-05 08:00:00",
      "endTime": "2025-01-05 16:30:00"
    },
    "quality": {
      "inspector": "æå››",
      "inspectionDate": "2025-01-05",
      "result": "pass",
      "score": 98
    },
    "coldChain": {
      "storageTemp": "-18Â°C ~ -20Â°C",
      "violations": 0,
      "intact": true
    }
  },
  "certifications": ["HACCP", "ISO22000"],
  "qrGeneratedAt": "2025-01-05T17:00:00Z"
}
```

#### å·¥ä½œé‡ä¼°ç®—
- æ•°æ®åº“è®¾è®¡ä¸å®ç°: 0.5å‘¨
- åç«¯APIå¼€å‘: 1.5å‘¨
- å‰ç«¯UIå¼€å‘: 1.5å‘¨
- å…¬å¼€è¿½æº¯é¡µé¢å¼€å‘: 1å‘¨
- æµ‹è¯•ä¸ä¼˜åŒ–: 0.5å‘¨
- **æ€»è®¡**: 5å‘¨

---

### Phase 6 æ€»ç»“

**æ€»å·¥ä½œé‡**: 10å‘¨ (çº¦2.5ä¸ªæœˆ)
**æ ¸å¿ƒäº¤ä»˜ç‰©**:
1. âœ… å®Œæ•´çš„æ¸©åº¦ç›‘æ§ç³»ç»Ÿ
2. âœ… å†·é“¾è¿½æº¯åŠŸèƒ½
3. âœ… äº§å“åŒ…è£…ç®¡ç†
4. âœ… è¿½æº¯ç ç”Ÿæˆä¸æŸ¥è¯¢
5. âœ… å…¬å¼€è¿½æº¯é¡µé¢

**ä¸šåŠ¡ä»·å€¼**:
- âœ… å®Œæ•´çš„å†·é“¾è¿½æº¯èƒ½åŠ›
- âœ… æ¶ˆè´¹è€…å¯æ‰«ç æŸ¥è¯¢äº§å“ä¿¡æ¯
- âœ… æ»¡è¶³å†·é“¾é£Ÿå“ç›‘ç®¡è¦æ±‚

---

## ğŸ“ˆ Phase 7: è´¨é‡æ”¹è¿›ä¸å®Œå–„

**æ—¶é—´å‘¨æœŸ**: 2025å¹´10æœˆ - 2025å¹´12æœˆ (12å‘¨)
**æ ¸å¿ƒç›®æ ‡**: å®Œå–„è´¨é‡ç®¡ç†ä½“ç³»ï¼Œå¼€å‘Webç®¡ç†åå°
**ä¼˜å…ˆçº§**: ğŸŸ¡ P2ï¼ˆæ”¹è¿›ä¼˜åŒ–ï¼‰

### 7.1 å®¢æˆ·æŠ•è¯‰ä¸è´¨é‡åé¦ˆ â­â­â­

#### åŠŸèƒ½æ¸…å•

**æŠ•è¯‰ç®¡ç†**:
- âœ… æŠ•è¯‰è®°å½•ä¸åˆ†ç±»
- âœ… æŠ•è¯‰å¤„ç†æµç¨‹
- âœ… æ ¹å› åˆ†æï¼ˆRCAï¼‰
- âœ… çº æ­£é¢„é˜²æªæ–½ï¼ˆCAPAï¼‰

**è´¨é‡æ”¹è¿›**:
- âœ… æŠ•è¯‰ç»Ÿè®¡åˆ†æ
- âœ… è´¨é‡è¶‹åŠ¿åˆ†æ
- âœ… 8DæŠ¥å‘Šç”Ÿæˆ

#### æ•°æ®åº“è®¾è®¡

```sql
-- å®¢æˆ·æŠ•è¯‰è¡¨
CREATE TABLE customer_complaints (
  id VARCHAR(36) PRIMARY KEY,
  factory_id VARCHAR(50) NOT NULL,
  complaint_number VARCHAR(100) UNIQUE NOT NULL,

  customer_id VARCHAR(36),
  customer_name VARCHAR(255),
  contact_person VARCHAR(100),
  contact_phone VARCHAR(20),

  -- äº§å“ä¿¡æ¯
  product_name VARCHAR(255),
  product_code VARCHAR(100),
  batch_number VARCHAR(100),
  package_code VARCHAR(100),
  purchase_date DATE,

  -- æŠ•è¯‰ä¿¡æ¯
  complaint_type ENUM('quality', 'packaging', 'foreign_object', 'taste', 'smell', 'color', 'texture', 'expiry', 'other') NOT NULL,
  severity ENUM('critical', 'major', 'minor') NOT NULL,
  complaint_source ENUM('phone', 'email', 'social_media', 'in_person', 'third_party') NOT NULL,

  description TEXT NOT NULL,
  photos JSON,

  received_date DATE NOT NULL,
  received_by INT NOT NULL,

  -- å¤„ç†æµç¨‹
  status ENUM('new', 'assigned', 'investigating', 'resolved', 'closed', 'escalated') DEFAULT 'new',
  assigned_to INT,
  assigned_at TIMESTAMP,

  -- æ ¹å› åˆ†æ
  root_cause_analysis TEXT,
  fishbone_diagram VARCHAR(500),  -- é±¼éª¨å›¾æ–‡ä»¶è·¯å¾„
  five_whys TEXT,

  -- çº æ­£é¢„é˜²æªæ–½ (CAPA)
  corrective_action TEXT,
  corrective_action_deadline DATE,
  corrective_action_responsible INT,
  corrective_action_completed BOOLEAN DEFAULT false,

  preventive_action TEXT,
  preventive_action_deadline DATE,
  preventive_action_responsible INT,
  preventive_action_completed BOOLEAN DEFAULT false,

  -- å®¢æˆ·å“åº”
  customer_response_required BOOLEAN DEFAULT true,
  customer_response_sent BOOLEAN DEFAULT false,
  customer_satisfied ENUM('yes', 'no', 'partial', 'unknown'),

  -- å…³é—­ä¿¡æ¯
  resolved_date DATE,
  resolved_by INT,
  resolution_notes TEXT,
  closed_date DATE,

  -- æˆæœ¬å½±å“
  financial_impact DECIMAL(10,2),
  compensation_provided DECIMAL(10,2),

  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,

  FOREIGN KEY (factory_id) REFERENCES factories(id),
  FOREIGN KEY (customer_id) REFERENCES customers(id),
  FOREIGN KEY (received_by) REFERENCES users(id),
  FOREIGN KEY (assigned_to) REFERENCES users(id),
  FOREIGN KEY (resolved_by) REFERENCES users(id),
  INDEX idx_factory_status (factory_id, status),
  INDEX idx_severity (severity, status),
  INDEX idx_batch (batch_number)
);

-- æŠ•è¯‰å¤„ç†è·Ÿè¿›è¡¨
CREATE TABLE complaint_follow_ups (
  id VARCHAR(36) PRIMARY KEY,
  complaint_id VARCHAR(36) NOT NULL,

  follow_up_date DATE NOT NULL,
  follow_up_type ENUM('internal_investigation', 'customer_communication', 'corrective_action', 'verification', 'other') NOT NULL,

  description TEXT NOT NULL,
  action_taken TEXT,
  next_steps TEXT,

  created_by INT NOT NULL,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

  FOREIGN KEY (complaint_id) REFERENCES customer_complaints(id) ON DELETE CASCADE,
  FOREIGN KEY (created_by) REFERENCES users(id),
  INDEX idx_complaint_date (complaint_id, follow_up_date)
);

-- 8DæŠ¥å‘Šè¡¨
CREATE TABLE complaint_8d_reports (
  id VARCHAR(36) PRIMARY KEY,
  complaint_id VARCHAR(36) NOT NULL,
  factory_id VARCHAR(50) NOT NULL,

  report_number VARCHAR(100) UNIQUE NOT NULL,

  -- D1: Team Formation (ç»„å»ºå›¢é˜Ÿ)
  team_members JSON,
  team_leader INT,

  -- D2: Problem Description (é—®é¢˜æè¿°)
  problem_description TEXT,
  problem_photos JSON,

  -- D3: Containment Actions (éåˆ¶æªæ–½)
  containment_actions TEXT,
  containment_date DATE,

  -- D4: Root Cause Analysis (æ ¹å› åˆ†æ)
  root_cause TEXT,
  analysis_method ENUM('5_whys', 'fishbone', 'fault_tree', 'other'),

  -- D5: Corrective Actions (çº æ­£æªæ–½)
  corrective_actions TEXT,

  -- D6: Implement Corrective Actions (å®æ–½çº æ­£æªæ–½)
  implementation_plan TEXT,
  implementation_date DATE,

  -- D7: Preventive Actions (é¢„é˜²æªæ–½)
  preventive_actions TEXT,

  -- D8: Congratulate the Team (è¡¨å½°å›¢é˜Ÿ)
  completion_date DATE,
  effectiveness_verified BOOLEAN DEFAULT false,
  lessons_learned TEXT,

  status ENUM('in_progress', 'completed') DEFAULT 'in_progress',

  created_by INT NOT NULL,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,

  FOREIGN KEY (complaint_id) REFERENCES customer_complaints(id),
  FOREIGN KEY (factory_id) REFERENCES factories(id),
  FOREIGN KEY (team_leader) REFERENCES users(id),
  FOREIGN KEY (created_by) REFERENCES users(id),
  INDEX idx_complaint (complaint_id),
  INDEX idx_status (status)
);
```

#### APIç«¯ç‚¹è®¾è®¡

```
# æŠ•è¯‰ç®¡ç†
POST   /api/mobile/complaints                         - åˆ›å»ºæŠ•è¯‰
GET    /api/mobile/complaints                         - æŠ•è¯‰åˆ—è¡¨
GET    /api/mobile/complaints/:id                     - æŠ•è¯‰è¯¦æƒ…
PUT    /api/mobile/complaints/:id                     - æ›´æ–°æŠ•è¯‰
POST   /api/mobile/complaints/:id/assign              - åˆ†é…å¤„ç†äºº
POST   /api/mobile/complaints/:id/close               - å…³é—­æŠ•è¯‰

# æŠ•è¯‰å¤„ç†
POST   /api/mobile/complaints/:id/follow-up           - æ·»åŠ è·Ÿè¿›è®°å½•
POST   /api/mobile/complaints/:id/root-cause          - è®°å½•æ ¹å› åˆ†æ
POST   /api/mobile/complaints/:id/capa                - è®°å½•CAPA
POST   /api/mobile/complaints/:id/response            - å›å¤å®¢æˆ·

# 8DæŠ¥å‘Š
POST   /api/mobile/complaints/:id/8d-report           - åˆ›å»º8DæŠ¥å‘Š
GET    /api/mobile/complaints/:id/8d-report           - è·å–8DæŠ¥å‘Š
PUT    /api/mobile/complaints/:id/8d-report/:rid      - æ›´æ–°8DæŠ¥å‘Š
POST   /api/mobile/complaints/:id/8d-report/:rid/complete - å®Œæˆ8D

# æŠ•è¯‰åˆ†æ
GET    /api/mobile/complaints/statistics              - æŠ•è¯‰ç»Ÿè®¡
GET    /api/mobile/complaints/analysis/trend          - æŠ•è¯‰è¶‹åŠ¿
GET    /api/mobile/complaints/analysis/pareto         - å¸•ç´¯æ‰˜åˆ†æ
GET    /api/mobile/complaints/analysis/cost           - æŠ•è¯‰æˆæœ¬åˆ†æ
```

#### å·¥ä½œé‡ä¼°ç®—
- æ•°æ®åº“è®¾è®¡ä¸å®ç°: 0.5å‘¨
- åç«¯APIå¼€å‘: 1å‘¨
- å‰ç«¯UIå¼€å‘: 1.5å‘¨
- æµ‹è¯•ä¸ä¼˜åŒ–: 0.5å‘¨
- **æ€»è®¡**: 3.5å‘¨

---

### 7.2 Webç®¡ç†åå° â­â­â­â­

#### åŠŸèƒ½æ¸…å•

**å¹³å°ç®¡ç†åŠŸèƒ½**:
- âœ… å·¥å‚ç®¡ç†ï¼ˆåˆ›å»ºã€ç¼–è¾‘ã€åœç”¨ï¼‰
- âœ… ç”¨æˆ·ç®¡ç†ï¼ˆè·¨å·¥å‚ç”¨æˆ·ç®¡ç†ï¼‰
- âœ… æƒé™é…ç½®
- âœ… ç³»ç»Ÿé…ç½®

**æ•°æ®åˆ†æåŠŸèƒ½**:
- âœ… å¤šç»´åº¦æ•°æ®åˆ†æ
- âœ… å¯è§†åŒ–å›¾è¡¨
- âœ… æŠ¥è¡¨å¯¼å‡º
- âœ… æ•°æ®å¯¼å…¥

**ä¼˜åŠ¿**:
- å¤§å±å±•ç¤ºæ›´å‹å¥½
- æ‰¹é‡æ“ä½œæ›´é«˜æ•ˆ
- å¤æ‚æŸ¥è¯¢æ›´æ–¹ä¾¿

#### æŠ€æœ¯æ ˆ

```
å‰ç«¯: Next.js 14+ / React 18+ / TypeScript
UIåº“: Ant Design / Material-UI
å›¾è¡¨: ECharts / Recharts
çŠ¶æ€ç®¡ç†: Zustand / React Query
```

#### æ ¸å¿ƒé¡µé¢

```
/admin
â”œâ”€â”€ /dashboard              # ä»ªè¡¨æ¿
â”œâ”€â”€ /factories              # å·¥å‚ç®¡ç†
â”œâ”€â”€ /users                  # ç”¨æˆ·ç®¡ç†
â”œâ”€â”€ /batches                # æ‰¹æ¬¡ç®¡ç†
â”œâ”€â”€ /inventory              # åº“å­˜ç®¡ç†
â”œâ”€â”€ /purchase               # é‡‡è´­ç®¡ç†
â”œâ”€â”€ /sales                  # é”€å”®ç®¡ç†
â”œâ”€â”€ /quality                # è´¨é‡ç®¡ç†
â”œâ”€â”€ /compliance             # åˆè§„ç®¡ç†
â”œâ”€â”€ /reports                # æŠ¥è¡¨ä¸­å¿ƒ
â””â”€â”€ /settings               # ç³»ç»Ÿè®¾ç½®
```

#### å·¥ä½œé‡ä¼°ç®—
- é¡¹ç›®æ¶æ„æ­å»º: 1å‘¨
- æ ¸å¿ƒé¡µé¢å¼€å‘: 4å‘¨
- æ•°æ®å¯è§†åŒ–: 1å‘¨
- æµ‹è¯•ä¸ä¼˜åŒ–: 1å‘¨
- **æ€»è®¡**: 7å‘¨

---

### Phase 7 æ€»ç»“

**æ€»å·¥ä½œé‡**: 10.5å‘¨ (çº¦2.5ä¸ªæœˆ)
**æ ¸å¿ƒäº¤ä»˜ç‰©**:
1. âœ… å®Œæ•´çš„æŠ•è¯‰ç®¡ç†ç³»ç»Ÿ
2. âœ… 8DæŠ¥å‘ŠåŠŸèƒ½
3. âœ… Webç®¡ç†åå°
4. âœ… æ•°æ®åˆ†æå¢å¼º

---

## ğŸš€ Phase 8+: ä¸šåŠ¡æ‹“å±•

**æ—¶é—´å‘¨æœŸ**: 2026å¹´1æœˆ - 2026å¹´12æœˆ
**æ ¸å¿ƒç›®æ ‡**: æ‰©å±•ä¸šåŠ¡æ¨¡å—ï¼Œå®ç°å…¨äº§ä¸šé“¾è¿½æº¯
**ä¼˜å…ˆçº§**: ğŸŸ¢ P3ï¼ˆä¸šåŠ¡æ‹“å±•ï¼‰

### 8.1 å…»æ®–æ¨¡å— (2026 Q1-Q2)

**åŠŸèƒ½æ¸…å•**:
- âœ… å…»æ®–åœºç®¡ç†
- âœ… å…»æ®–æ‰¹æ¬¡ç®¡ç†
- âœ… é¥²æ–™ç®¡ç†
- âœ… æ°´è´¨ç›‘æµ‹
- âœ… ç–«ç—…ç®¡ç†
- âœ… å…»æ®–æ—¥å¿—

**å·¥ä½œé‡**: 8-10å‘¨

---

### 8.2 ç‰©æµæ¨¡å— (2026 Q2-Q3)

**åŠŸèƒ½æ¸…å•**:
- âœ… ç‰©æµè®¢å•ç®¡ç†
- âœ… è½¦è¾†ç®¡ç†
- âœ… è¿è¾“è·Ÿè¸ªï¼ˆGPSï¼‰
- âœ… è¿è¾“æ¸©åº¦ç›‘æ§
- âœ… ç­¾æ”¶ç®¡ç†
- âœ… è¿è´¹ç»“ç®—

**å·¥ä½œé‡**: 6-8å‘¨

---

### 8.3 åŒºå—é“¾æº¯æº (2026 Q4)

**åŠŸèƒ½æ¸…å•**:
- âœ… åŒºå—é“¾èŠ‚ç‚¹éƒ¨ç½²
- âœ… å…³é”®æ•°æ®ä¸Šé“¾
- âœ… æ™ºèƒ½åˆçº¦
- âœ… é˜²ç¯¡æ”¹éªŒè¯
- âœ… è”ç›Ÿé“¾ç®¡ç†

**æŠ€æœ¯é€‰å‹**:
- Hyperledger Fabric / èš‚èšé“¾ / è…¾è®¯äº‘åŒºå—é“¾

**å·¥ä½œé‡**: 8-10å‘¨

---

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„æ¼”è¿›

### å½“å‰æ¶æ„ (Phase 0-3)

```
ç§»åŠ¨ç«¯ (React Native)
      â†“
åç«¯API (Node.js + Express)
      â†“
æ•°æ®åº“ (MySQL 8.0+)
```

### ç›®æ ‡æ¶æ„ (Phase 8+)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              å®¢æˆ·ç«¯å±‚                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚   iOS    â”‚  â”‚ Android  â”‚  â”‚   Web    â”‚           â”‚
â”‚  â”‚  Mobile  â”‚  â”‚  Mobile  â”‚  â”‚  Admin   â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚ HTTPS/REST API
                      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              åº”ç”¨æœåŠ¡å±‚                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚  Mobile  â”‚  â”‚   Web    â”‚  â”‚  Report  â”‚           â”‚
â”‚  â”‚   API    â”‚  â”‚   API    â”‚  â”‚  Service â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚   Auth   â”‚  â”‚  Queue   â”‚  â”‚  Cache   â”‚           â”‚
â”‚  â”‚  Service â”‚  â”‚  (Bull)  â”‚  â”‚  (Redis) â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              æ•°æ®å­˜å‚¨å±‚                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚  MySQL   â”‚  â”‚  Redis   â”‚  â”‚   OSS    â”‚           â”‚
â”‚  â”‚ (ä¸šåŠ¡æ•°æ®)â”‚  â”‚  (ç¼“å­˜)  â”‚  â”‚ (æ–‡ä»¶)   â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚
â”‚  â”‚   ES     â”‚  â”‚   åŒºå—é“¾  â”‚                         â”‚
â”‚  â”‚ (æ—¥å¿—)   â”‚  â”‚ (å…³é”®æ•°æ®)â”‚                         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              å¤–éƒ¨æœåŠ¡å±‚                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ DeepSeek â”‚  â”‚   çŸ­ä¿¡    â”‚  â”‚   æ”¯ä»˜   â”‚           â”‚
â”‚  â”‚   LLM    â”‚  â”‚  æœåŠ¡    â”‚  â”‚  æœåŠ¡    â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æŠ€æœ¯å‡çº§è§„åˆ’

**Phase 4-5**:
- å¼•å…¥Redisç¼“å­˜
- å¼•å…¥æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆBullï¼‰
- æ•°æ®åº“è¯»å†™åˆ†ç¦»

**Phase 6-7**:
- å¼•å…¥Elasticsearchï¼ˆæ—¥å¿—åˆ†æï¼‰
- å¯¹è±¡å­˜å‚¨ï¼ˆOSSï¼‰
- CDNåŠ é€Ÿ

**Phase 8+**:
- å¾®æœåŠ¡æ¶æ„
- åŒºå—é“¾é›†æˆ
- å¤§æ•°æ®åˆ†æå¹³å°

---

## ğŸ’° èµ„æºéœ€æ±‚ä¸é¢„ç®—

### Phase 4 (2025 Q1)

**äººåŠ›éœ€æ±‚**:
- åç«¯å¼€å‘: 2äºº Ã— 3ä¸ªæœˆ = 6äººæœˆ
- å‰ç«¯å¼€å‘: 2äºº Ã— 3ä¸ªæœˆ = 6äººæœˆ
- æµ‹è¯•å·¥ç¨‹å¸ˆ: 1äºº Ã— 3ä¸ªæœˆ = 3äººæœˆ
- **æ€»è®¡**: 15äººæœˆ

**æˆæœ¬ä¼°ç®—**:
- äººåŠ›æˆæœ¬: çº¦Â¥300,000 - Â¥450,000
- æœåŠ¡å™¨æˆæœ¬: çº¦Â¥5,000/æœˆ
- ç¬¬ä¸‰æ–¹æœåŠ¡: çº¦Â¥3,000/æœˆ

---

### Phase 5 (2025 Q2)

**äººåŠ›éœ€æ±‚**:
- åç«¯å¼€å‘: 2äºº Ã— 3ä¸ªæœˆ = 6äººæœˆ
- å‰ç«¯å¼€å‘: 2äºº Ã— 3ä¸ªæœˆ = 6äººæœˆ
- æµ‹è¯•å·¥ç¨‹å¸ˆ: 1äºº Ã— 3ä¸ªæœˆ = 3äººæœˆ
- **æ€»è®¡**: 15äººæœˆ

**æˆæœ¬ä¼°ç®—**:
- äººåŠ›æˆæœ¬: çº¦Â¥300,000 - Â¥450,000
- HACCPè®¤è¯å’¨è¯¢: çº¦Â¥50,000
- ISO22000è®¤è¯: çº¦Â¥80,000

---

### Phase 6 (2025 Q3)

**äººåŠ›éœ€æ±‚**:
- åç«¯å¼€å‘: 1.5äºº Ã— 2.5ä¸ªæœˆ = 3.75äººæœˆ
- å‰ç«¯å¼€å‘: 1.5äºº Ã— 2.5ä¸ªæœˆ = 3.75äººæœˆ
- æµ‹è¯•å·¥ç¨‹å¸ˆ: 1äºº Ã— 2.5ä¸ªæœˆ = 2.5äººæœˆ
- **æ€»è®¡**: 10äººæœˆ

**æˆæœ¬ä¼°ç®—**:
- äººåŠ›æˆæœ¬: çº¦Â¥200,000 - Â¥300,000
- æ¸©åº¦ä¼ æ„Ÿå™¨ç¡¬ä»¶: çº¦Â¥30,000 - Â¥50,000

---

### Phase 7 (2025 Q4)

**äººåŠ›éœ€æ±‚**:
- åç«¯å¼€å‘: 1äºº Ã— 2.5ä¸ªæœˆ = 2.5äººæœˆ
- å‰ç«¯å¼€å‘: 2äºº Ã— 2.5ä¸ªæœˆ = 5äººæœˆ
- æµ‹è¯•å·¥ç¨‹å¸ˆ: 1äºº Ã— 2.5ä¸ªæœˆ = 2.5äººæœˆ
- **æ€»è®¡**: 10äººæœˆ

**æˆæœ¬ä¼°ç®—**:
- äººåŠ›æˆæœ¬: çº¦Â¥200,000 - Â¥300,000

---

### 2025å¹´åº¦æ€»é¢„ç®—

**äººåŠ›æŠ•å…¥**: 50äººæœˆ
**äººåŠ›æˆæœ¬**: Â¥1,000,000 - Â¥1,500,000
**ç¡¬ä»¶æˆæœ¬**: Â¥30,000 - Â¥50,000
**æœåŠ¡å™¨æˆæœ¬**: Â¥60,000/å¹´
**è®¤è¯æˆæœ¬**: Â¥130,000
**ç¬¬ä¸‰æ–¹æœåŠ¡**: Â¥36,000/å¹´

**æ€»é¢„ç®—**: çº¦Â¥1,256,000 - Â¥1,776,000

---

## ğŸ“Š é‡Œç¨‹ç¢‘ä¸äº¤ä»˜ç‰©

### 2025 Q1 (Phase 4)
- âœ… åº“å­˜ç®¡ç†ç³»ç»Ÿä¸Šçº¿
- âœ… ä¾›åº”é“¾ç®¡ç†ç³»ç»Ÿä¸Šçº¿
- âœ… FIFOå’Œä¿è´¨æœŸç®¡ç†ä¸Šçº¿
- **äº¤ä»˜ç‰©**: åº“å­˜+ä¾›åº”é“¾å®Œæ•´æ¨¡å—

### 2025 Q2 (Phase 5)
- âœ… HACCPç³»ç»Ÿä¸Šçº¿
- âœ… GMPç®¡ç†ç³»ç»Ÿä¸Šçº¿
- âœ… äº§å“å¬å›ç³»ç»Ÿä¸Šçº¿
- âœ… é€šè¿‡ISO22000è®¤è¯é¢„å®¡
- **äº¤ä»˜ç‰©**: é£Ÿå“å®‰å…¨åˆè§„å®Œæ•´æ¨¡å—

### 2025 Q3 (Phase 6)
- âœ… æ¸©åº¦ç›‘æ§ç³»ç»Ÿä¸Šçº¿
- âœ… å†·é“¾è¿½æº¯ä¸Šçº¿
- âœ… äº§å“åŒ…è£…ä¸è¿½æº¯ç ä¸Šçº¿
- âœ… å…¬å¼€è¿½æº¯é¡µé¢ä¸Šçº¿
- **äº¤ä»˜ç‰©**: å†·é“¾+åŒ…è£…å®Œæ•´æ¨¡å—

### 2025 Q4 (Phase 7)
- âœ… å®¢æˆ·æŠ•è¯‰ç³»ç»Ÿä¸Šçº¿
- âœ… Webç®¡ç†åå°ä¸Šçº¿
- âœ… ç³»ç»Ÿä¼˜åŒ–ä¸æ€§èƒ½æå‡
- **äº¤ä»˜ç‰©**: Webåå°+è´¨é‡æ”¹è¿›æ¨¡å—

### 2026 Q1-Q4 (Phase 8+)
- âœ… å…»æ®–æ¨¡å—ä¸Šçº¿
- âœ… ç‰©æµæ¨¡å—ä¸Šçº¿
- âœ… åŒºå—é“¾æº¯æºä¸Šçº¿
- **äº¤ä»˜ç‰©**: å…¨äº§ä¸šé“¾è¿½æº¯å¹³å°

---

## ğŸ¯ æ€»ç»“

### ç³»ç»Ÿæ¼”è¿›è·¯å¾„

```
Phase 0-3 (å·²å®Œæˆ)
â†“
MESç”Ÿäº§æ‰§è¡Œç³»ç»Ÿ
â†“
Phase 4 (2025 Q1)
â†“
MES + SCMä¾›åº”é“¾ç®¡ç†
â†“
Phase 5 (2025 Q2)
â†“
MES + SCM + QMSè´¨é‡ç®¡ç†
â†“
Phase 6 (2025 Q3)
â†“
MES + SCM + QMS + å†·é“¾è¿½æº¯
â†“
Phase 7 (2025 Q4)
â†“
MES + SCM + QMS + Webç®¡ç†åå°
â†“
Phase 8+ (2026)
â†“
å…¨äº§ä¸šé“¾è¿½æº¯å¹³å° + åŒºå—é“¾
```

### æ ¸å¿ƒä»·å€¼

**å¯¹å·¥å‚**:
- âœ… å®Œæ•´çš„ç”Ÿäº§ç®¡ç†ç³»ç»Ÿ
- âœ… ç¬¦åˆé£Ÿå“å®‰å…¨æ³•è§„
- âœ… é™ä½è¿è¥æˆæœ¬
- âœ… æå‡äº§å“è´¨é‡
- âœ… æé«˜ç®¡ç†æ•ˆç‡

**å¯¹æ¶ˆè´¹è€…**:
- âœ… æ‰«ç æŸ¥è¯¢å®Œæ•´è¿½æº¯ä¿¡æ¯
- âœ… ç¡®ä¿é£Ÿå“å®‰å…¨
- âœ… å¢å¼ºå“ç‰Œä¿¡ä»»

**å¯¹è¡Œä¸š**:
- âœ… æ¨åŠ¨é£Ÿå“è¡Œä¸šæ•°å­—åŒ–è½¬å‹
- âœ… æå‡é£Ÿå“å®‰å…¨ç®¡ç†æ°´å¹³
- âœ… å»ºç«‹è¡Œä¸šæ ‡å‡†

---

**æ–‡æ¡£ç»“æŸ**

*æœ¬æ–‡æ¡£ä¸ºç™½å©çºªé£Ÿå“æº¯æºç³»ç»Ÿæœªæ¥å‘å±•è§„åˆ’ï¼Œå°†æ ¹æ®å®é™…å¼€å‘è¿›åº¦å’Œå¸‚åœºéœ€æ±‚åŠ¨æ€è°ƒæ•´ã€‚*
