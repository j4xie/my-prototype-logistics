<!-- 养殖阶段 -->
<div class="bg-white rounded-lg shadow-sm p-6">
    <div class="flex items-center justify-between mb-6">
        <div>
            <h3 class="text-lg font-medium text-gray-900">养殖阶段</h3>
            <p class="text-sm text-gray-500">记录养殖过程中的关键信息</p>
        </div>
        <div class="flex items-center space-x-2">
            <span class="px-2 py-1 text-xs font-medium text-green-800 bg-green-100 rounded-full">必填</span>
            <button type="button" class="text-gray-400 hover:text-gray-600 transition-colors" aria-label="显示帮助信息" data-tooltip="填写养殖阶段信息，确保可追溯性">
                <i class="fas fa-question-circle"></i>
            </button>
        </div>
    </div>

    <form id="breeding-form" class="space-y-6">
        <!-- 基本信息 -->
        <fieldset>
            <legend class="sr-only">养殖基本信息</legend>
            <div class="mb-3 pb-2 border-b border-gray-100">
                <div class="flex items-center">
                    <h4 class="text-sm font-medium text-gray-700">基本信息</h4>
                    <span class="ml-2 text-xs text-gray-500">(必填项*)</span>
                </div>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label for="farm-name" class="block text-sm font-medium text-gray-700 mb-1">养殖场名称 <span class="text-red-500">*</span></label>
                    <input type="text" id="farm-name" name="farm-name" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" 
                        required aria-required="true" aria-describedby="farm-name-help">
                    <p id="farm-name-help" class="text-xs text-gray-500 mt-1">输入养殖场的完整注册名称</p>
                </div>
                <div>
                    <label for="farm-address" class="block text-sm font-medium text-gray-700 mb-1">养殖场地址 <span class="text-red-500">*</span></label>
                    <input type="text" id="farm-address" name="farm-address" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" 
                        required aria-required="true" aria-describedby="farm-address-help">
                    <p id="farm-address-help" class="text-xs text-gray-500 mt-1">输入养殖场的详细地址</p>
                </div>
                <div>
                    <label for="farm-license" class="block text-sm font-medium text-gray-700 mb-1">养殖许可证号 <span class="text-red-500">*</span></label>
                    <input type="text" id="farm-license" name="farm-license" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" 
                        required aria-required="true" pattern="[A-Za-z0-9-]+" aria-describedby="farm-license-help">
                    <p id="farm-license-help" class="text-xs text-gray-500 mt-1">输入有效的养殖许可证号码，格式如：SC12345-2023</p>
                </div>
                <div>
                    <label for="breeding-cycle" class="block text-sm font-medium text-gray-700 mb-1">养殖周期 <span class="text-red-500">*</span></label>
                    <div class="flex items-center space-x-2">
                        <div class="flex-1">
                            <label for="cycle-start" class="sr-only">开始日期</label>
                            <input type="date" id="cycle-start" name="cycle-start" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" 
                                required aria-required="true" aria-label="养殖开始日期">
                        </div>
                        <span class="self-center">至</span>
                        <div class="flex-1">
                            <label for="cycle-end" class="sr-only">结束日期</label>
                            <input type="date" id="cycle-end" name="cycle-end" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" 
                                required aria-required="true" aria-label="养殖结束日期">
                        </div>
                    </div>
                </div>
            </div>
        </fieldset>

        <!-- 养殖信息 -->
        <fieldset>
            <legend class="sr-only">养殖详细信息</legend>
            <div class="mb-3 pb-2 border-b border-gray-100">
                <div class="flex items-center">
                    <h4 class="text-sm font-medium text-gray-700">养殖信息</h4>
                    <span class="ml-2 text-xs text-gray-500">(必填项*)</span>
                </div>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label for="breed-type" class="block text-sm font-medium text-gray-700 mb-1">品种 <span class="text-red-500">*</span></label>
                    <select id="breed-type" name="breed-type" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" 
                        required aria-required="true">
                        <option value="">请选择品种</option>
                        <option value="black">黑猪</option>
                        <option value="white">白猪</option>
                        <option value="other">其他</option>
                    </select>
                </div>
                <div>
                    <label for="breed-source" class="block text-sm font-medium text-gray-700 mb-1">来源 <span class="text-red-500">*</span></label>
                    <select id="breed-source" name="breed-source" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" 
                        required aria-required="true">
                        <option value="">请选择来源</option>
                        <option value="self">自繁自养</option>
                        <option value="purchase">外购</option>
                    </select>
                </div>
                <div>
                    <label for="breed-scale" class="block text-sm font-medium text-gray-700 mb-1">养殖规模 <span class="text-red-500">*</span></label>
                    <input type="number" id="breed-scale" name="breed-scale" min="1" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" 
                        required aria-required="true" aria-describedby="breed-scale-help">
                    <p id="breed-scale-help" class="text-xs text-gray-500 mt-1">输入养殖的数量（头/只）</p>
                </div>
                <div>
                    <label for="breed-method" class="block text-sm font-medium text-gray-700 mb-1">养殖方式 <span class="text-red-500">*</span></label>
                    <select id="breed-method" name="breed-method" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" 
                        required aria-required="true">
                        <option value="">请选择养殖方式</option>
                        <option value="free">散养</option>
                        <option value="cage">圈养</option>
                        <option value="other">其他</option>
                    </select>
                </div>
            </div>
        </fieldset>

        <!-- 环境参数 -->
        <fieldset>
            <legend class="mb-3 text-sm font-medium text-gray-700">环境参数</legend>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div>
                    <label for="env-temp" class="block text-sm text-gray-600 mb-1">温度(℃)</label>
                    <input type="number" id="env-temp" name="env-temp" step="0.1" min="-10" max="50" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" 
                        aria-describedby="env-temp-help">
                    <p id="env-temp-help" class="text-xs text-gray-500 mt-1">养殖环境平均温度</p>
                </div>
                <div>
                    <label for="env-humidity" class="block text-sm text-gray-600 mb-1">湿度(%)</label>
                    <input type="number" id="env-humidity" name="env-humidity" step="0.1" min="0" max="100" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" 
                        aria-describedby="env-humidity-help">
                    <p id="env-humidity-help" class="text-xs text-gray-500 mt-1">养殖环境平均湿度</p>
                </div>
                <div>
                    <label for="env-ventilation" class="block text-sm text-gray-600 mb-1">通风量(m³/h)</label>
                    <input type="number" id="env-ventilation" name="env-ventilation" min="0" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" 
                        aria-describedby="env-ventilation-help">
                    <p id="env-ventilation-help" class="text-xs text-gray-500 mt-1">养殖环境通风量</p>
                </div>
            </div>
        </fieldset>

        <!-- 饲料信息 -->
        <fieldset>
            <legend class="mb-3 text-sm font-medium text-gray-700">饲料信息</legend>
            <div class="space-y-4">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label for="feed-type" class="block text-sm text-gray-600 mb-1">饲料类型</label>
                        <select id="feed-type" name="feed-type" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="">请选择饲料类型</option>
                            <option value="concentrate">精饲料</option>
                            <option value="roughage">粗饲料</option>
                            <option value="mixed">混合饲料</option>
                        </select>
                    </div>
                    <div>
                        <label for="feed-amount" class="block text-sm text-gray-600 mb-1">饲料用量(kg/天)</label>
                        <input type="number" id="feed-amount" name="feed-amount" step="0.1" min="0" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" 
                            aria-describedby="feed-amount-help">
                        <p id="feed-amount-help" class="text-xs text-gray-500 mt-1">每天饲料使用量</p>
                    </div>
                </div>
                <div>
                    <label for="feed-source" class="block text-sm text-gray-600 mb-1">饲料来源</label>
                    <input type="text" id="feed-source" name="feed-source" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" 
                        aria-describedby="feed-source-help">
                    <p id="feed-source-help" class="text-xs text-gray-500 mt-1">饲料供应商或来源</p>
                </div>
            </div>
        </fieldset>

        <!-- 防疫记录 -->
        <fieldset>
            <legend class="mb-3 text-sm font-medium text-gray-700">防疫记录</legend>
            <div class="space-y-4">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label for="vaccine-name" class="block text-sm text-gray-600 mb-1">疫苗名称</label>
                        <input type="text" id="vaccine-name" name="vaccine-name" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div>
                        <label for="vaccine-date" class="block text-sm text-gray-600 mb-1">接种日期</label>
                        <input type="date" id="vaccine-date" name="vaccine-date" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                </div>
                <div>
                    <label for="vaccine-dose" class="block text-sm text-gray-600 mb-1">接种剂量(ml)</label>
                    <input type="number" id="vaccine-dose" name="vaccine-dose" step="0.1" min="0" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <div>
                    <label for="vaccine-method" class="block text-sm text-gray-600 mb-1">接种方式</label>
                    <select id="vaccine-method" name="vaccine-method" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="">请选择接种方式</option>
                        <option value="injection">注射</option>
                        <option value="oral">口服</option>
                        <option value="nasal">滴鼻</option>
                    </select>
                </div>
                <div class="border-t border-gray-100 pt-3">
                    <button type="button" class="text-sm text-blue-600 flex items-center">
                        <i class="fas fa-plus-circle mr-1"></i> 添加更多防疫记录
                    </button>
                </div>
            </div>
        </fieldset>

        <!-- 图片上传 -->
        <fieldset>
            <legend class="mb-3 text-sm font-medium text-gray-700">现场照片</legend>
            <div class="flex items-center space-x-4">
                <div class="flex-shrink-0">
                    <div class="w-24 h-24 border-2 border-dashed border-gray-300 rounded-lg flex items-center justify-center">
                        <i class="fas fa-camera text-gray-400 text-2xl"></i>
                    </div>
                </div>
                <div class="flex-1">
                    <label for="farm-image" class="block text-sm text-gray-600 mb-1">上传养殖环境照片</label>
                    <input type="file" id="farm-image" name="farm-image" accept="image/*" class="w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100">
                    <p class="text-xs text-gray-500 mt-1">请上传清晰的养殖环境照片，大小不超过5MB</p>
                </div>
            </div>
        </fieldset>
    </form>

    <!-- 表单验证提示 -->
    <div class="mt-4 p-3 bg-blue-50 rounded-lg border border-blue-100 text-sm text-blue-800">
        <div class="flex items-start">
            <i class="fas fa-info-circle mt-0.5 mr-2"></i>
            <div>
                <p class="font-medium mb-1">填写指南</p>
                <ul class="list-disc pl-5 space-y-1 text-xs">
                    <li>带 <span class="text-red-500">*</span> 的字段为必填项</li>
                    <li>养殖许可证号必须是有效的官方证书编号</li>
                    <li>养殖周期的结束日期必须晚于开始日期</li>
                    <li>提交前请确保所有必填信息准确完整</li>
                </ul>
                <p class="text-xs mt-2">本页面数据将自动保存为草稿</p>
            </div>
        </div>
    </div>
</div>

<script>
// 初始化表单验证和状态保存
document.addEventListener('DOMContentLoaded', function() {
    // 如果表单验证脚本已加载
    if (window.traceFormValidation) {
        const breedingForm = document.getElementById('breeding-form');
        window.traceFormValidation.initFormValidation(breedingForm, 'breeding');
    } else {
        console.warn('表单验证脚本未加载，请确保引入trace-form-validation.js');
    }
    
    // 日期关联验证
    const startDateInput = document.getElementById('cycle-start');
    const endDateInput = document.getElementById('cycle-end');
    
    if (startDateInput && endDateInput) {
        // 设置结束日期最小值为开始日期
        startDateInput.addEventListener('change', function() {
            endDateInput.min = this.value;
            // 如果结束日期早于开始日期，重置结束日期
            if (endDateInput.value && endDateInput.value < this.value) {
                endDateInput.value = '';
            }
        });
        
        // 设置开始日期最大值为结束日期
        endDateInput.addEventListener('change', function() {
            if (this.value) {
                startDateInput.max = this.value;
            }
        });
    }
    
    // 工具提示
    const tooltipButtons = document.querySelectorAll('[data-tooltip]');
    tooltipButtons.forEach(button => {
        button.addEventListener('click', function() {
            alert(this.dataset.tooltip);
        });
    });
});
</script> 