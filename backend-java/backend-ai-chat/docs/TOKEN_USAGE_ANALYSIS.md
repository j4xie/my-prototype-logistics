# ğŸ”¢ ç™½å©çºª AI æˆæœ¬åˆ†æ - Token ä½¿ç”¨é‡åˆ†æ

## ğŸ“Š Token æ¶ˆè€—ä¼°ç®—

### å•æ¬¡åˆ†æçš„ Token ç»„æˆ

#### 1. System Prompt (ç³»ç»Ÿæç¤º - ä»…é¦–æ¬¡)
```
çº¦ 350 tokens (ä¸­æ–‡)
```

**å†…å®¹**:
- AI è§’è‰²å®šä½
- 4 å¤§æ ¸å¿ƒä»»åŠ¡è¯´æ˜
- å›å¤è¦æ±‚
- ç¤ºä¾‹åœºæ™¯

#### 2. User Prompt (ç”¨æˆ·è¾“å…¥ - æ¯æ¬¡)

**å…¸å‹æ‰¹æ¬¡æˆæœ¬æ•°æ®**:
```
**æ‰¹æ¬¡ä¿¡æ¯**ï¼š
- æ‰¹æ¬¡å·: BATCH_20251003_00001
- åŸææ–™: å¤§é»„é±¼ 500kg
- åŸææ–™æˆæœ¬: Â¥2000.00 (4.00å…ƒ/kg)
- äº§å“ç±»åˆ«: é²œå“
- é¢„æœŸå”®ä»·: Â¥12/kg

**æˆæœ¬ç»“æ„**ï¼š
- åŸææ–™æˆæœ¬: Â¥2000.00 (55.6%)
- äººå·¥æˆæœ¬: Â¥1200.00 (33.3%)
- è®¾å¤‡æˆæœ¬: Â¥400.00 (11.1%)
- å…¶ä»–æˆæœ¬: Â¥0.00 (0.0%)
- **æ€»æˆæœ¬**: Â¥3600.00

**äººå·¥ç»Ÿè®¡**ï¼š
- å‚ä¸å‘˜å·¥: 8äºº
- æ€»å·¥æ—¶: 6å°æ—¶0åˆ†é’Ÿ
- äººå·¥æˆæœ¬: Â¥1200.00
- å‘˜å·¥æ˜ç»†: å¼ ä¸‰(2h, Â¥400), æå››(1.5h, Â¥300), ç‹äº”(1h, Â¥200), ...

**è®¾å¤‡ç»Ÿè®¡**ï¼š
- ä½¿ç”¨è®¾å¤‡: 3å°
- æ€»ä½¿ç”¨æ—¶é•¿: 4å°æ—¶30åˆ†é’Ÿ
- è®¾å¤‡æˆæœ¬: Â¥400.00
- è®¾å¤‡æ˜ç»†: åˆ‡å‰²æœº(2h, Â¥200), å†·è—æŸœ(2h, Â¥150), ...

**åˆ©æ¶¦åˆ†æ**ï¼š
- é¢„æœŸæ”¶å…¥: Â¥6000.00
- åˆ©æ¶¦: Â¥2400.00 (40.0%)
- ç›ˆäºå¹³è¡¡ä»·: Â¥7.20/kg

è¯·åˆ†æï¼š
1. æˆæœ¬ç»“æ„æ˜¯å¦åˆç†ï¼Ÿ
2. æœ‰å“ªäº›ä¼˜åŒ–ç©ºé—´ï¼Ÿ
3. å…·ä½“æ”¹è¿›å»ºè®®æ˜¯ä»€ä¹ˆï¼Ÿ
```

**Token ä¼°ç®—**: çº¦ **400-500 tokens** (ä¸­æ–‡)

#### 3. AI Response (AI å›å¤ - æ¯æ¬¡)

**å…¸å‹å›å¤**:
```
æ ¹æ®æä¾›çš„æˆæœ¬æ•°æ®åˆ†æï¼š

1. **æˆæœ¬ç»“æ„åˆ†æ**ï¼š
   âœ… åŸææ–™æˆæœ¬å æ¯” 55.6%ï¼Œå±äºæ°´äº§åŠ å·¥è¡Œä¸šçš„åˆç†èŒƒå›´ï¼ˆ50-60%ï¼‰
   âš ï¸  äººå·¥æˆæœ¬å æ¯” 33.3%ï¼Œç•¥é«˜äºè¡Œä¸šå¹³å‡æ°´å¹³ï¼ˆ25-30%ï¼‰
   âœ… è®¾å¤‡æˆæœ¬å æ¯” 11.1%ï¼Œæ§åˆ¶è‰¯å¥½

   æ€»ä½“è¯„ä¼°ï¼šæˆæœ¬ç»“æ„åŸºæœ¬åˆç†ï¼Œä½†äººå·¥æˆæœ¬æœ‰ä¼˜åŒ–ç©ºé—´ã€‚

2. **ä¼˜åŒ–å»ºè®®**ï¼š

   **äººå·¥æˆæœ¬ä¼˜åŒ–**ï¼ˆä¼˜å…ˆçº§ï¼šé«˜ï¼‰ï¼š
   - å½“å‰8åå‘˜å·¥ï¼Œæ€»å·¥æ—¶6å°æ—¶ï¼Œäººå‡0.75å°æ—¶
   - å»ºè®®ï¼šä¼˜åŒ–äººå‘˜é…ç½®ï¼Œå‡å°‘1-2åæ“ä½œå·¥ï¼Œæˆ–å»¶é•¿å·¥ä½œæ—¶é•¿æé«˜æ•ˆç‡
   - é¢„æœŸæ•ˆæœï¼šäººå·¥æˆæœ¬å¯é™è‡³Â¥1000ï¼ˆå æ¯”27.8%ï¼‰ï¼ŒèŠ‚çœÂ¥200

   **ç”Ÿäº§æ•ˆç‡æå‡**ï¼š
   - åˆ†æå‘˜å·¥æ˜ç»†ï¼Œå¼ ä¸‰å·¥ä½œ2å°æ—¶äº§å‡ºæœ€é«˜ï¼Œå¯ä½œä¸ºæ ‡æ†
   - å»ºè®®ï¼šåˆ¶å®šæ ‡å‡†æ“ä½œæµç¨‹ï¼ˆSOPï¼‰ï¼Œæå‡æ•´ä½“æ•ˆç‡
   - é¢„æœŸæ•ˆæœï¼šç›¸åŒäº§å‡ºä¸‹ï¼Œæ€»å·¥æ—¶å¯ç¼©çŸ­è‡³5å°æ—¶

   **è®¾å¤‡åˆ©ç”¨ä¼˜åŒ–**ï¼š
   - å½“å‰è®¾å¤‡æˆæœ¬Â¥400ï¼Œåˆ©ç”¨ç‡è‰¯å¥½
   - å»ºè®®ï¼šè®¾å¤‡ä½¿ç”¨é›†ä¸­åŒ–ï¼Œé¿å…ç©ºè½¬æµªè´¹

3. **åˆ©æ¶¦æå‡è·¯å¾„**ï¼š

   **çŸ­æœŸï¼ˆ1-2å‘¨ï¼‰**ï¼š
   - ä¼˜åŒ–äººå‘˜é…ç½® â†’ äººå·¥æˆæœ¬é™è‡³Â¥1000
   - æ–°åˆ©æ¶¦ï¼šÂ¥2600ï¼ˆåˆ©æ¶¦ç‡ 43.3%ï¼‰

   **ä¸­æœŸï¼ˆ1-2æœˆï¼‰**ï¼š
   - æå‡ç”Ÿäº§æ•ˆç‡ + é™ä½æŸè€— â†’ æ€»æˆæœ¬é™è‡³Â¥3200
   - æ–°åˆ©æ¶¦ï¼šÂ¥2800ï¼ˆåˆ©æ¶¦ç‡ 46.7%ï¼‰

   **ç›ˆäºå¹³è¡¡åˆ†æ**ï¼š
   - å½“å‰ç›ˆäºå¹³è¡¡ä»·ï¼šÂ¥7.20/kg
   - ä¼˜åŒ–åç›ˆäºå¹³è¡¡ä»·ï¼šÂ¥6.40/kgï¼ˆé™ä½11%ï¼‰
   - ç«äº‰åŠ›æ˜¾è‘—æå‡

**å…·ä½“è¡ŒåŠ¨å»ºè®®**ï¼š
1. ç«‹å³è¡ŒåŠ¨ï¼šé‡æ–°è¯„ä¼°8åå‘˜å·¥çš„å·¥ä½œåˆ†é…
2. æœ¬å‘¨å®Œæˆï¼šåˆ¶å®šæ ‡å‡†æ“ä½œæµç¨‹
3. ä¸‹æœˆç›®æ ‡ï¼šäººå·¥æˆæœ¬å æ¯”é™è‡³28%ä»¥ä¸‹
```

**Token ä¼°ç®—**: çº¦ **600-800 tokens** (ä¸­æ–‡)

---

## ğŸ’° æˆæœ¬è®¡ç®—

### Llama-3.1-8B-Instruct (Hugging Face)

**ä»·æ ¼**: çº¦ **$0.15 / 1M tokens** (è¾“å…¥ + è¾“å‡º)

### å•æ¬¡åˆ†æ Token æ¶ˆè€—

#### é¦–æ¬¡å¯¹è¯ï¼ˆå« System Promptï¼‰
- System Prompt: 350 tokens
- User Prompt: 450 tokens
- AI Response: 700 tokens
- **æ€»è®¡**: ~1500 tokens

#### åç»­å¯¹è¯ï¼ˆæ—  System Promptï¼‰
- User Prompt: 450 tokens
- AI Response: 700 tokens
- **æ€»è®¡**: ~1150 tokens

#### å¤šè½®å¯¹è¯ï¼ˆ5è½®ï¼‰
```
ç¬¬1è½®: 1500 tokens (å« System)
ç¬¬2è½®: 1150 tokens
ç¬¬3è½®: 1150 tokens
ç¬¬4è½®: 1150 tokens
ç¬¬5è½®: 1150 tokens
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
æ€»è®¡:  6100 tokens
```

---

## ğŸ“ˆ æœˆåº¦æˆæœ¬é¢„æµ‹

### ä½¿ç”¨åœºæ™¯å‡è®¾

**æ¯æ—¥åˆ†æé‡**:
- å°å‹å·¥å‚: 10 æ‰¹æ¬¡/å¤©
- ä¸­å‹å·¥å‚: 30 æ‰¹æ¬¡/å¤©
- å¤§å‹å·¥å‚: 50 æ‰¹æ¬¡/å¤©

**å¹³å‡å¯¹è¯è½®æ•°**: 2è½®ï¼ˆé¦–æ¬¡åˆ†æ + 1æ¬¡è¿½é—®ï¼‰

### æˆæœ¬è®¡ç®—

#### å°å‹å·¥å‚ï¼ˆ10æ‰¹æ¬¡/å¤©ï¼‰
```
æ¯æ¬¡åˆ†æ: 1500 + 1150 = 2650 tokens
æ¯æ—¥æ¶ˆè€—: 10 Ã— 2650 = 26,500 tokens
æ¯æœˆæ¶ˆè€—: 26,500 Ã— 30 = 795,000 tokens

æœˆåº¦æˆæœ¬: 0.795M Ã— $0.15 = $0.12 (çº¦ Â¥0.85)
```

#### ä¸­å‹å·¥å‚ï¼ˆ30æ‰¹æ¬¡/å¤©ï¼‰
```
æ¯æ¬¡åˆ†æ: 2650 tokens
æ¯æ—¥æ¶ˆè€—: 30 Ã— 2650 = 79,500 tokens
æ¯æœˆæ¶ˆè€—: 79,500 Ã— 30 = 2,385,000 tokens

æœˆåº¦æˆæœ¬: 2.385M Ã— $0.15 = $0.36 (çº¦ Â¥2.55)
```

#### å¤§å‹å·¥å‚ï¼ˆ50æ‰¹æ¬¡/å¤©ï¼‰
```
æ¯æ¬¡åˆ†æ: 2650 tokens
æ¯æ—¥æ¶ˆè€—: 50 Ã— 2650 = 132,500 tokens
æ¯æœˆæ¶ˆè€—: 132,500 Ã— 30 = 3,975,000 tokens

æœˆåº¦æˆæœ¬: 3.975M Ã— $0.15 = $0.60 (çº¦ Â¥4.25)
```

---

## ğŸ¯ æˆæœ¬æ§åˆ¶ç›®æ ‡

### åŸå®šç›®æ ‡
> DeepSeek AI æˆæœ¬æ§åˆ¶: **<Â¥30/æœˆ**

### å½“å‰ä½¿ç”¨ Llama-3.1-8B æˆæœ¬
âœ… **è¿œä½äºé¢„ç®—ï¼**

| å·¥å‚è§„æ¨¡ | æ¯æ—¥æ‰¹æ¬¡ | æœˆåº¦æˆæœ¬ | é¢„ç®—å æ¯” |
|---------|---------|---------|---------|
| å°å‹ | 10 | Â¥0.85 | 2.8% |
| ä¸­å‹ | 30 | Â¥2.55 | 8.5% |
| å¤§å‹ | 50 | Â¥4.25 | 14.2% |
| **è¶…å¤§å‹** | 100 | Â¥8.50 | 28.3% |

**ç»“è®º**: å³ä½¿æ˜¯è¶…å¤§å‹å·¥å‚ï¼ˆ100æ‰¹æ¬¡/å¤©ï¼‰ï¼Œæœˆåº¦æˆæœ¬ä¹Ÿä»… **Â¥8.5**ï¼Œè¿œä½äº Â¥30 é¢„ç®—ã€‚

---

## ğŸ”§ ä¼˜åŒ–å»ºè®®

### 1. ç¼“å­˜ä¼˜åŒ–ï¼ˆå·²è§„åˆ’ï¼‰
**å®ç°**: ç›¸ä¼¼é—®é¢˜ 5 åˆ†é’Ÿç¼“å­˜

**æ•ˆæœé¢„ä¼°**:
- ç¼“å­˜å‘½ä¸­ç‡: 30-40%
- æˆæœ¬èŠ‚çœ: 30-40%
- **ä¼˜åŒ–åæœˆæˆæœ¬**: ä¸­å‹å·¥å‚ Â¥2.55 â†’ Â¥1.53

### 2. Prompt ä¼˜åŒ–
**å½“å‰ Prompt é•¿åº¦**: ~450 tokens

**ä¼˜åŒ–æ–¹å‘**:
- âœ‚ï¸ ç²¾ç®€æ‰¹æ¬¡ä¿¡æ¯æ ¼å¼
- ğŸ“Š ä½¿ç”¨è¡¨æ ¼ä»£æ›¿åˆ—è¡¨
- ğŸ”¢ å‡å°‘å°æ•°ä½æ•°

**é¢„æœŸèŠ‚çœ**: 100-150 tokens/æ¬¡ (çº¦ 22-33%)

**ä¼˜åŒ–ç¤ºä¾‹**:
```
åŸæ ¼å¼ (450 tokens):
- æ‰¹æ¬¡å·: BATCH_20251003_00001
- åŸææ–™: å¤§é»„é±¼ 500kg
- åŸææ–™æˆæœ¬: Â¥2000.00 (4.00å…ƒ/kg)
...

ä¼˜åŒ–æ ¼å¼ (350 tokens):
æ‰¹æ¬¡: BATCH_20251003_00001
åŸæ–™: å¤§é»„é±¼ 500kg @ Â¥4/kg = Â¥2000
äººå·¥: 8äºº 6h = Â¥1200 (33%)
è®¾å¤‡: 3å° 4.5h = Â¥400 (11%)
åˆ©æ¶¦: Â¥2400 (40%)
```

### 3. æ™ºèƒ½å‹ç¼©
**ç­–ç•¥**:
- å°‘äº 5 ä¸ªå‘˜å·¥ â†’ æ˜¾ç¤ºå…¨éƒ¨æ˜ç»†
- 5-10 ä¸ªå‘˜å·¥ â†’ æ˜¾ç¤ºå‰ 5 ä¸ª
- è¶…è¿‡ 10 ä¸ª â†’ ä»…æ˜¾ç¤ºç»Ÿè®¡æ•°æ®

**æ•ˆæœ**: å¤§æ‰¹æ¬¡æ•°æ®å¯èŠ‚çœ 30-50% tokens

---

## ğŸ“Š Token ç›‘æ§å»ºè®®

### å®æ—¶ç›‘æ§æŒ‡æ ‡
1. **æ¯æ¬¡åˆ†æ Token æ•°**
2. **æ¯æ—¥æ€»æ¶ˆè€—**
3. **æœˆåº¦ç´¯è®¡æ¶ˆè€—**
4. **å¹³å‡å¯¹è¯è½®æ•°**

### å‘Šè­¦é˜ˆå€¼
- âš ï¸  å•æ¬¡åˆ†æ > 3000 tokens (å¼‚å¸¸)
- âš ï¸  æ¯æ—¥æ¶ˆè€— > 150,000 tokens (ä¸­å‹å·¥å‚)
- ğŸš¨ æœˆåº¦æ¶ˆè€— > 3M tokens (çº¦ Â¥2.12ï¼Œè§¦å‘ä¼˜åŒ–)

### ç›‘æ§å®ç°
```javascript
// backend/src/controllers/processingController.js
const aiResult = await aiResponse.json();

// è®°å½• token ä½¿ç”¨
console.log(`[AI Token] Batch: ${batchId}, Tokens: ${aiResult.token_count || 'N/A'}`);

// å¯é€‰: å­˜å‚¨åˆ°æ•°æ®åº“ç”¨äºåˆ†æ
await prisma.aiUsageLog.create({
  data: {
    batchId,
    tokenCount: aiResult.token_count,
    sessionId: aiResult.session_id,
    timestamp: new Date()
  }
});
```

---

## ğŸ¯ ç»“è®º

### å½“å‰çŠ¶æ€
âœ… **æˆæœ¬å®Œå…¨å¯æ§**
- å•æ¬¡åˆ†æ: ~1500 tokens (é¦–æ¬¡) / ~1150 tokens (åç»­)
- æœˆåº¦æˆæœ¬: Â¥0.85 - Â¥8.50 (å–å†³äºè§„æ¨¡)
- **è¿œä½äº Â¥30 é¢„ç®—**

### ä¼˜åŒ–æ½œåŠ›
é€šè¿‡ç¼“å­˜ + Prompt ä¼˜åŒ–ï¼Œæˆæœ¬å¯è¿›ä¸€æ­¥é™ä½ **50-60%**

### å»ºè®®
1. âœ… å½“å‰é…ç½®å¯ç›´æ¥æŠ•å…¥ä½¿ç”¨
2. ğŸ”„ å®æ–½ç¼“å­˜æœºåˆ¶ï¼ˆä¼˜å…ˆçº§ï¼šä¸­ï¼‰
3. âœ‚ï¸  ä¼˜åŒ– Prompt æ ¼å¼ï¼ˆä¼˜å…ˆçº§ï¼šä½ï¼‰
4. ğŸ“Š æ·»åŠ  Token ç›‘æ§ï¼ˆä¼˜å…ˆçº§ï¼šä¸­ï¼‰

---

**åˆ†ææ—¶é—´**: 2025-01-03
**åŸºäºæ¨¡å‹**: Llama-3.1-8B-Instruct
**ä»·æ ¼å‚è€ƒ**: $0.15 / 1M tokens (Hugging Face Inference API)
