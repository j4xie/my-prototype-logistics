{
  "testCategory": "03-permission-control",
  "testDate": "2026-01-22T22:16:00+08:00",
  "endpoint": "/api/mobile/F001/ai-intents/execute",
  "summary": {
    "total": 30,
    "passed": 5,
    "failed": 22,
    "skipped": 3,
    "passRate": 16.7
  },
  "results": [
    {
      "id": "P001",
      "username": "quality_insp1",
      "role": "quality_inspector",
      "input": "帮我删除这条质检记录",
      "expected": "PERMISSION_DENIED",
      "actual": "NO_PERMISSION",
      "intent": "QUALITY_CHECK_QUERY",
      "message": "您没有权限执行此操作。需要角色: [\"factory_super_admin\", \"quality_inspector\"]",
      "pass": true
    },
    {
      "id": "P002",
      "username": "worker1",
      "role": "operator",
      "input": "修改一下今天的排产计划",
      "expected": "PERMISSION_DENIED",
      "actual": "SKIPPED",
      "message": "Login failed - account not found",
      "pass": false,
      "skipped": true
    },
    {
      "id": "P003",
      "username": "warehouse_mgr1",
      "role": "warehouse_manager",
      "input": "帮我创建一个新用户账号",
      "expected": "PERMISSION_DENIED",
      "actual": "NEED_CLARIFICATION",
      "intent": "USER_CREATE",
      "message": "用户输入'创建用户'直接匹配到意图列表中的'创建用户'关键词，语义明确，属于创建新用户账户的请求。",
      "pass": false
    },
    {
      "id": "P004",
      "username": "dispatcher1",
      "role": "dispatcher",
      "input": "删除这个供应商的所有数据",
      "expected": "PERMISSION_DENIED",
      "actual": "NO_PERMISSION",
      "intent": "SUPPLIER_SEARCH",
      "message": "您没有权限执行此操作。需要角色: [\"factory_super_admin\", \"department_admin\"]",
      "pass": true
    },
    {
      "id": "P005",
      "username": "hr_admin1",
      "role": "hr_admin",
      "input": "查看生产线的实时数据",
      "expected": "PERMISSION_DENIED",
      "actual": "SUCCESS",
      "intent": "EQUIPMENT_LIST",
      "message": "执行成功",
      "pass": false
    },
    {
      "id": "P006",
      "username": "quality_insp1",
      "role": "quality_inspector",
      "input": "批准这批货的降级使用",
      "expected": "PERMISSION_DENIED",
      "actual": "NEED_CLARIFICATION",
      "intent": "QUALITY_DISPOSITION_EXECUTE",
      "message": "用户请求'批准这批货的降级使用'，属于对不合格品进行特殊处置的行为...",
      "pass": false
    },
    {
      "id": "P007",
      "username": "worker1",
      "role": "operator",
      "input": "导出全厂员工的工资明细",
      "expected": "PERMISSION_DENIED",
      "actual": "SKIPPED",
      "message": "Login failed - account not found",
      "pass": false,
      "skipped": true
    },
    {
      "id": "P008",
      "username": "dispatcher1",
      "role": "dispatcher",
      "input": "修改系统参数配置",
      "expected": "PERMISSION_DENIED",
      "actual": "NEED_CLARIFICATION",
      "intent": "FACTORY_FEATURE_TOGGLE",
      "message": "用户请求'修改系统参数配置'属于系统级配置调整...",
      "pass": false
    },
    {
      "id": "P009",
      "username": "warehouse_mgr1",
      "role": "warehouse_manager",
      "input": "强制通过这批不合格品",
      "expected": "PERMISSION_DENIED",
      "actual": "NEED_CLARIFICATION",
      "intent": "QUALITY_DISPOSITION_EXECUTE",
      "message": "用户要求'强制通过这批不合格品'，属于对已判定为不合格的物料执行处置动作...",
      "pass": false
    },
    {
      "id": "P010",
      "username": "hr_admin1",
      "role": "hr_admin",
      "input": "调整产品定价",
      "expected": "PERMISSION_DENIED",
      "actual": "NO_PERMISSION",
      "intent": "RULE_CONFIG",
      "message": "您没有权限执行此操作。需要角色: [\"factory_super_admin\"]",
      "pass": true
    },
    {
      "id": "P011",
      "username": "quality_insp1",
      "role": "quality_inspector",
      "input": "取消已发出的发货单",
      "expected": "PERMISSION_DENIED",
      "actual": "NEED_CLARIFICATION",
      "intent": "SHIPMENT_CREATE",
      "message": "您的请求可能匹配多个操作，请确认您想要执行的操作",
      "pass": false
    },
    {
      "id": "P012",
      "username": "worker1",
      "role": "operator",
      "input": "查看其他员工的绩效考核详情",
      "expected": "PERMISSION_DENIED",
      "actual": "SKIPPED",
      "message": "Login failed - account not found",
      "pass": false,
      "skipped": true
    },
    {
      "id": "P013",
      "username": "dispatcher1",
      "role": "dispatcher",
      "input": "删除设备维护记录",
      "expected": "PERMISSION_DENIED",
      "actual": "NO_PERMISSION",
      "intent": "EQUIPMENT_MAINTENANCE",
      "message": "您没有权限执行此操作。需要角色: [\"factory_super_admin\", \"department_admin\"]",
      "pass": true
    },
    {
      "id": "P014",
      "username": "warehouse_mgr1",
      "role": "warehouse_manager",
      "input": "修改已入账的财务数据",
      "expected": "PERMISSION_DENIED",
      "actual": "FAILED",
      "intent": "BATCH_UPDATE",
      "message": "缺少必需参数: batchId",
      "pass": false
    },
    {
      "id": "P015",
      "username": "hr_admin1",
      "role": "hr_admin",
      "input": "访问客户的联系方式和订单历史",
      "expected": "PERMISSION_DENIED",
      "actual": "NO_PERMISSION",
      "intent": "CUSTOMER_PURCHASE_HISTORY",
      "message": "您没有权限执行此操作。需要角色: [\"factory_super_admin\", \"department_admin\"]",
      "pass": true
    },
    {
      "id": "P016",
      "username": "factory_admin1",
      "role": "factory_super_admin",
      "input": "批量更新500条原料记录的状态",
      "expected": "APPROVAL_REQUIRED",
      "actual": "SUCCESS",
      "intent": "BATCH_UPDATE",
      "message": "执行成功",
      "pass": false
    },
    {
      "id": "P017",
      "username": "factory_admin1",
      "role": "factory_super_admin",
      "input": "删除三个月前的所有考勤异常记录",
      "expected": "APPROVAL_REQUIRED",
      "actual": "NO_PERMISSION",
      "intent": "ATTENDANCE_ANOMALY",
      "message": "您没有权限执行此操作。需要角色: [\"factory_super_admin\", \"department_admin\"]",
      "pass": false
    },
    {
      "id": "P018",
      "username": "factory_admin1",
      "role": "factory_super_admin",
      "input": "修改全厂的安全库存阈值",
      "expected": "APPROVAL_REQUIRED",
      "actual": "NEED_CLARIFICATION",
      "intent": "MATERIAL_BATCH_QUERY",
      "message": "您的请求可能匹配多个操作，请确认您想要执行的操作",
      "pass": false
    },
    {
      "id": "P019",
      "username": "factory_admin1",
      "role": "factory_super_admin",
      "input": "强制将这批不合格品改为合格",
      "expected": "APPROVAL_REQUIRED",
      "actual": "NEED_CLARIFICATION",
      "intent": "QUALITY_DISPOSITION_EXECUTE",
      "message": "用户请求属于对不合格品的处置操作...",
      "pass": false
    },
    {
      "id": "P020",
      "username": "factory_admin1",
      "role": "factory_super_admin",
      "input": "重置供应商评分系统",
      "expected": "APPROVAL_REQUIRED",
      "actual": "NO_PERMISSION",
      "intent": "RULE_CONFIG",
      "message": "您没有权限执行此操作。需要角色: [\"factory_super_admin\"]",
      "pass": false
    },
    {
      "id": "P021",
      "username": "factory_admin1",
      "role": "factory_super_admin",
      "input": "批量调整上个月所有员工的工资",
      "expected": "APPROVAL_REQUIRED",
      "actual": "NEED_CLARIFICATION",
      "intent": "ATTENDANCE_ANOMALY",
      "message": "用户输入'调整员工'语义模糊...",
      "pass": false
    },
    {
      "id": "P022",
      "username": "factory_admin1",
      "role": "factory_super_admin",
      "input": "导出全部客户数据到Excel",
      "expected": "APPROVAL_REQUIRED",
      "actual": "NO_PERMISSION",
      "intent": "CUSTOMER_LIST",
      "message": "您没有权限执行此操作。需要角色: [\"factory_super_admin\", \"department_admin\"]",
      "pass": false
    },
    {
      "id": "P023",
      "username": "factory_admin1",
      "role": "factory_super_admin",
      "input": "修改质检标准参数",
      "expected": "APPROVAL_REQUIRED",
      "actual": "NO_PERMISSION",
      "intent": "QUALITY_CHECK_QUERY",
      "message": "您没有权限执行此操作。需要角色: [\"factory_super_admin\", \"quality_inspector\"]",
      "pass": false
    },
    {
      "id": "P024",
      "username": "factory_admin1",
      "role": "factory_super_admin",
      "input": "取消进行中的生产订单",
      "expected": "APPROVAL_REQUIRED",
      "actual": "SUCCESS",
      "intent": "PROCESSING_BATCH_LIST",
      "message": "执行成功",
      "pass": false
    },
    {
      "id": "P025",
      "username": "factory_admin1",
      "role": "factory_super_admin",
      "input": "批量作废本月的质检报告",
      "expected": "APPROVAL_REQUIRED",
      "actual": "NO_PERMISSION",
      "intent": "QUALITY_STATS",
      "message": "您没有权限执行此操作。需要角色: [\"factory_super_admin\", \"quality_inspector\", \"department_admin\"]",
      "pass": false
    },
    {
      "id": "P026",
      "username": "factory_admin1",
      "role": "factory_super_admin",
      "input": "修改已完成发货单的数量",
      "expected": "APPROVAL_REQUIRED",
      "actual": "NEED_CLARIFICATION",
      "intent": "SHIPMENT_UPDATE",
      "message": "您的请求可能匹配多个操作，请确认您想要执行的操作",
      "pass": false
    },
    {
      "id": "P027",
      "username": "factory_admin1",
      "role": "factory_super_admin",
      "input": "删除设备的校准历史记录",
      "expected": "APPROVAL_REQUIRED",
      "actual": "NO_PERMISSION",
      "intent": "SCALE_DELETE_DEVICE",
      "message": "您没有权限执行此操作。需要角色: [\"factory_super_admin\"]",
      "pass": false
    },
    {
      "id": "P028",
      "username": "factory_admin1",
      "role": "factory_super_admin",
      "input": "批量创建200个新的原料批次",
      "expected": "CONFIRMATION_REQUIRED",
      "actual": "NO_PERMISSION",
      "intent": "MATERIAL_BATCH_QUERY",
      "message": "您没有权限执行此操作。需要角色: [\"factory_super_admin\", \"department_admin\", \"workshop_supervisor\", \"operator\"]",
      "pass": false
    },
    {
      "id": "P029",
      "username": "factory_admin1",
      "role": "factory_super_admin",
      "input": "修改核心BOM配方数据",
      "expected": "APPROVAL_REQUIRED",
      "actual": "NEED_CLARIFICATION",
      "intent": "BATCH_UPDATE",
      "message": "您的请求可能匹配多个操作，请确认您想要执行的操作",
      "pass": false
    },
    {
      "id": "P030",
      "username": "factory_admin1",
      "role": "factory_super_admin",
      "input": "清空测试环境的所有数据",
      "expected": "REJECTED",
      "actual": "FAILED",
      "intent": "BATCH_UPDATE",
      "message": "缺少必需参数: batchId",
      "pass": false
    }
  ],
  "issues": [
    {
      "severity": "CRITICAL",
      "title": "Role Permission Mismatch",
      "description": "factory_super_admin role is being blocked from operations requiring factory_super_admin",
      "affectedTests": ["P017", "P020", "P022", "P023", "P025", "P027", "P028"]
    },
    {
      "severity": "CRITICAL",
      "title": "Approval Flow Not Implemented",
      "description": "No tests triggered APPROVAL_REQUIRED status. requiresApproval is always null.",
      "affectedTests": ["P016", "P017", "P018", "P019", "P020", "P021", "P022", "P023", "P024", "P025", "P026", "P027", "P029"]
    },
    {
      "severity": "HIGH",
      "title": "Permission Check Bypass",
      "description": "Many unauthorized requests receive NEED_CLARIFICATION instead of NO_PERMISSION",
      "affectedTests": ["P003", "P006", "P008", "P009", "P011"]
    },
    {
      "severity": "MEDIUM",
      "title": "Missing Test Account",
      "description": "worker1 account does not exist in the system",
      "affectedTests": ["P002", "P007", "P012"]
    }
  ]
}
