# v10.0 意图识别系统 - 测试报告

**测试日期**: 2026-01-22
**测试环境**: 生产环境 (139.196.165.140:10010)
**测试方式**: 7个并行 Subagent 分类执行

---

## 执行摘要

| 指标 | 结果 |
|------|------|
| 总用例数 | 200 |
| 已完成测试 | 200 |
| 整体通过率 | **约 35%** (估算) |

---

## 分类测试结果

| 类别 | 通过/总数 | 通过率 | 目标通过率 | 状态 |
|------|-----------|--------|------------|------|
| 复杂语言模式 | 4/40 | 10% | ≥85% | ❌ 未达标 |
| 多轮对话 | 约5/30 | ~17% | ≥90% | ❌ 未达标 |
| 权限控制 | 约12/30 | ~40% | 100% | ❌ 未达标 |
| 自学习验证 | 3/20 | 15% | ≥80% | ❌ 未达标 |
| RAG/咨询 | 约3/30 | ~10% | ≥70% | ❌ 未达标 |
| 写入操作 | 约8/30 | ~27% | 100% | ❌ 未达标 |
| 响应格式化 | 16/20 | 80% | 100% | ⚠️ 接近目标 |

---

## 详细分析

### 1. 复杂语言模式测试 (4/40 = 10%)

**测试文件**: `01-complex-language.json`

**子类别结果**:
| 子类别 | 通过率 |
|--------|--------|
| 反问句式 (L001-L010) | 2/10 (20%) |
| 转折与让步 (L011-L020) | 0/10 (0%) |
| 双重否定 (L021-L030) | 2/10 (20%) |
| 省略与指代 (L031-L040) | 0/10 (0%) |

**主要问题**:
1. **PARSE_ERROR**: 约20个测试返回解析错误，无法识别意图
2. **意图误判**: 反问句"难道...吗"经常被误判为陈述句
3. **转折句忽略**: "虽然...但是"结构中，系统只识别前半句
4. **省略指代失败**: "那个"、"刚才那批"等指代词未能触发 clarification

**示例失败用例**:
```
L011: "虽然上个月的产量达标了，但是不合格品率好像上升了不少"
预期: QUALITY_STATS
实际: PARSE_ERROR
```

---

### 2. 多轮对话测试 (~5/30 ≈ 17%)

**测试文件**: `02-multi-turn-dialogue.json`

**主要问题**:
1. **Clarification 触发不一致**: 部分模糊输入直接匹配错误意图而非请求澄清
2. **参数收集不足**: "我要领一些原料"应触发参数收集，实际返回 NOT_RECOGNIZED
3. **意图消歧失败**: "帮我处理一下"应询问处理什么，实际随机匹配意图

**正确触发 Clarification 的用例**:
- M016: "我想看看这批货的情况" → NEED_MORE_INFO ✓
- M024: "这个要改一下" → NEED_MORE_INFO ✓
- M029: "这个供应商怎么样" → NEED_MORE_INFO ✓

---

### 3. 权限控制测试 (~12/30 ≈ 40%)

**测试文件**: `03-permission-control.json`

**正确拒绝的用例**:
| ID | 操作 | 角色 | 结果 |
|----|------|------|------|
| P010 | 调整产品定价 | hr_admin1 | NO_PERMISSION ✓ |
| P013 | 删除设备维护记录 | dispatcher1 | NO_PERMISSION ✓ |

**问题用例**:
| ID | 操作 | 预期 | 实际 |
|----|------|------|------|
| P006 | 批准降级使用 | NO_PERMISSION | NEED_CLARIFICATION |
| P008 | 修改系统参数 | NO_PERMISSION | NEED_CLARIFICATION |
| P009 | 强制通过不合格品 | NO_PERMISSION | NEED_CLARIFICATION |

**问题**: 权限检查在意图识别之后进行，部分敏感操作在权限检查前就进入了澄清流程

---

### 4. 自学习验证测试 (3/20 = 15%)

**测试文件**: `04-self-learning.json`

**表达学习 (S001-S010)**: 2/10 (20%)
- ✓ "今儿个谁没来上班" → ATTENDANCE_ANOMALY
- ✓ "查查有没有快到期的玩意儿" → MATERIAL_EXPIRING_ALERT
- ✗ "帮我瞅瞅今天到了啥货" → SHIPMENT_QUERY (应为 MATERIAL_BATCH_QUERY)
- ✗ "看看仓库里头还剩多少带鱼" → NOT_RECOGNIZED

**关键词学习 (S011-S020)**: 1/10 (10%)
- ✓ "查一下冷链配送的发货记录" → SHIPMENT_QUERY
- ✗ "看看冷冻仓的温度记录" → PRODUCT_UPDATE
- ✗ "查查SC认证的到期时间" → QUALITY_CHECK_QUERY

**结论**: 方言/口语表达识别能力有限，行业术语映射不完善

---

### 5. RAG/咨询测试 (~3/30 ≈ 10%)

**测试文件**: `05-rag-consultation.json`

**核心问题**: 系统未能区分 RAG_QUERY 和普通业务查询

| 输入 | 预期 | 实际 |
|------|------|------|
| 带鱼的标准储存温度是多少 | RAG_QUERY | QUALITY_CHECK_QUERY |
| 食品安全法有什么重要修订 | WEB_SEARCH | QUALITY_CHECK_QUERY |
| HACCP体系中CCP点的监控要求 | RAG_QUERY | REPORT_DASHBOARD_OVERVIEW |

**结论**: RAG/网络搜索路由机制未生效，知识咨询类请求被错误路由到业务查询

---

### 6. 写入操作测试 (~8/30 ≈ 27%)

**测试文件**: `06-write-operations.json`

**创建操作 (W001-W015)**:
| ID | 操作 | 预期 | 实际 | 敏感度 |
|----|------|------|------|--------|
| W001 | 创建原料入库记录 | MATERIAL_BATCH_CREATE | MATERIAL_BATCH_CREATE | HIGH ✓ |
| W002 | 登记质检记录 | QUALITY_CHECK_CREATE | QUALITY_CHECK_EXECUTE | MEDIUM |
| W003 | 新建发货单 | SHIPMENT_CREATE | SHIPMENT_CREATE | HIGH ✓ |
| W007 | 新增供应商 | SUPPLIER_CREATE | SUPPLIER_SEARCH | LOW ✗ |
| W009 | 登记客户投诉 | COMPLAINT_CREATE | CUSTOMER_SEARCH | LOW ✗ |

**更新/删除操作 (W016-W030)**: 敏感操作大多正确触发权限检查

**问题**: 创建操作经常被误识别为查询操作

---

### 7. 响应格式化测试 (16/20 = 80%)

**测试文件**: `07-response-formatting.json`

**正面结果**:
- ✅ 所有 `formattedText` 返回自然语言，无原始 JSON
- ✅ 权限拒绝消息友好且信息完整
- ✅ 查询结果使用编号列表格式

**问题用例**:
| ID | 问题 |
|----|------|
| F005 | 返回占位符文本 "请接入AttendanceService获取实际考勤统计数据" |
| F015 | 意图误判导致返回错误类型响应 |
| F019 | 负数参数未触发验证错误 |

---

## 系统级问题总结

### 1. 意图识别准确率不足
- 反问句、转折句、双重否定等复杂语言模式识别失败
- 创建操作经常被误识别为查询操作
- 行业术语和方言表达覆盖不足

### 2. RAG/知识检索路由失败
- 知识咨询请求被错误路由到业务查询
- 未实现 RAG_QUERY 和 WEB_SEARCH 意图分流

### 3. 权限检查时机问题
- 部分敏感操作在权限检查前进入澄清流程
- 建议在意图识别后立即进行权限预检

### 4. 意图配置缺失
- 多个意图返回 "未找到意图配置: XXX" 错误
- 需要补充配置: MATERIAL_BATCH_QUERY, SHIPMENT_QUERY, QUALITY_CHECK_QUERY 等

---

## 改进建议

### 高优先级
1. **修复 PARSE_ERROR**: 检查 LLM 响应解析逻辑
2. **补充意图配置**: 添加缺失的意图执行器配置
3. **实现 RAG 路由**: 添加知识咨询意图分类规则

### 中优先级
4. **增强复杂语言理解**: 添加反问句、转折句的语义规则
5. **改进权限检查时机**: 将权限预检移到澄清流程之前
6. **扩展方言/术语词典**: 添加更多口语表达和行业术语

### 低优先级
7. **优化自学习闭环**: 确保学习到的表达能够被记忆和应用
8. **增加输入验证**: 对负数、无效日期等参数进行前置验证

---

## 测试用例文件位置

```
backend-java/src/test/intent-v10/
├── cases/
│   ├── 01-complex-language.json    (40条)
│   ├── 02-multi-turn-dialogue.json (30条)
│   ├── 03-permission-control.json  (30条)
│   ├── 04-self-learning.json       (20条)
│   ├── 05-rag-consultation.json    (30条)
│   ├── 06-write-operations.json    (30条)
│   └── 07-response-formatting.json (20条)
├── scripts/
│   ├── run-tests.sh
│   ├── test-runner.js
│   └── quick-test.sh
└── results/
    └── test_report_20260122.md
```

---

## 下一步行动

1. 开发团队修复 PARSE_ERROR 问题
2. 补充缺失的意图配置
3. 实现 RAG 意图路由
4. 重新运行测试验证修复效果

---

*报告生成时间: 2026-01-22 22:20*
