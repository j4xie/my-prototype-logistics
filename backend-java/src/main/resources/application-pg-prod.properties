# ===================================
# PostgreSQL 生产环境配置
# 使用方式: --spring.profiles.active=pg-prod
# ===================================

# 应用配置
spring.application.name=Cretas Backend System
server.port=10010

# ==========================================
# PostgreSQL 数据库配置 (生产环境)
# ==========================================
spring.datasource.driver-class-name=org.postgresql.Driver
spring.datasource.url=jdbc:postgresql://${DB_HOST:localhost}:${DB_PORT:5432}/${DB_NAME:cretas_db}?currentSchema=public&stringtype=unspecified&ssl=${DB_SSL:false}
spring.datasource.username=${DB_USERNAME:cretas_user}
spring.datasource.password=${DB_PASSWORD}

# HikariCP 连接池配置 (生产环境优化)
spring.datasource.hikari.pool-name=CretasPostgresPool
spring.datasource.hikari.maximum-pool-size=30
spring.datasource.hikari.minimum-idle=10
spring.datasource.hikari.idle-timeout=300000
spring.datasource.hikari.connection-timeout=20000
spring.datasource.hikari.max-lifetime=1800000
spring.datasource.hikari.leak-detection-threshold=60000
spring.datasource.hikari.validation-timeout=5000
spring.datasource.hikari.connection-test-query=SELECT 1

# ==========================================
# JPA/Hibernate PostgreSQL 配置 (生产环境)
# ==========================================
spring.jpa.database=POSTGRESQL
spring.jpa.database-platform=org.hibernate.dialect.PostgreSQL10Dialect
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.PostgreSQL10Dialect

# 生产环境: 禁用验证 (PostgreSQL BYTEA/BLOB 类型映射差异导致验证失败)
# 数据已迁移完成，表结构正确，跳过 Hibernate schema validation
spring.jpa.hibernate.ddl-auto=none
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.format_sql=false
spring.jpa.defer-datasource-initialization=false

# PostgreSQL 生产环境性能优化
spring.jpa.properties.hibernate.jdbc.batch_size=100
spring.jpa.properties.hibernate.order_inserts=true
spring.jpa.properties.hibernate.order_updates=true
spring.jpa.properties.hibernate.jdbc.batch_versioned_data=true
spring.jpa.properties.hibernate.temp.use_jdbc_metadata_defaults=false
spring.jpa.properties.hibernate.jdbc.lob.non_contextual_creation=true
spring.jpa.properties.hibernate.generate_statistics=false
spring.jpa.properties.hibernate.cache.use_second_level_cache=false
spring.jpa.properties.hibernate.connection.provider_disables_autocommit=true

# SQL初始化 - 生产环境禁用
spring.sql.init.mode=never

# ==========================================
# 日志配置 (生产环境精简)
# ==========================================
logging.level.root=WARN
logging.level.com.cretas.aims=INFO
logging.pattern.console=%d{yyyy-MM-dd HH:mm:ss} - %msg%n
logging.level.org.hibernate.SQL=WARN
logging.level.org.hibernate.type.descriptor.sql=WARN

# ==========================================
# 文件上传配置
# ==========================================
spring.servlet.multipart.enabled=true
spring.servlet.multipart.max-file-size=10MB
spring.servlet.multipart.max-request-size=10MB

# ==========================================
# Jackson 配置
# ==========================================
spring.jackson.time-zone=GMT+8
spring.jackson.date-format=yyyy-MM-dd HH:mm:ss
spring.jackson.serialization.write-dates-as-timestamps=false
spring.jackson.serialization.fail-on-empty-beans=false

# ==========================================
# JWT配置 (生产环境必须使用环境变量)
# ==========================================
cretas.jwt.secret=${JWT_SECRET}
cretas.jwt.expiration=86400000
cretas.jwt.refresh-expiration=2592000000

# ==========================================
# AI服务配置 (生产环境)
# ==========================================
cretas.ai.service.url=http://localhost:8085
cretas.ai.service.timeout=120000
cretas.ai.service.connect-timeout=10000

# AI意图自动学习配置
cretas.ai.intent.auto-learn.enabled=true
cretas.ai.intent.auto-learn.confidence-threshold=0.9
cretas.ai.intent.auto-learn.max-keywords-per-intent=50

# ==========================================
# AI 语义路由器配置
# ==========================================
cretas.ai.semantic-router.enabled=true
cretas.router.threshold.direct-execute=0.92
cretas.router.threshold.reranking=0.75
cretas.router.default-top-n=5

# ==========================================
# Embedding 服务配置 (生产环境启用)
# ==========================================
embedding.mode=grpc
grpc.client.embedding-service.address=static://localhost:9090
grpc.client.embedding-service.negotiationType=plaintext

# ==========================================
# 禁用自动配置
# ==========================================
spring.autoconfigure.exclude=org.springframework.boot.autoconfigure.data.redis.RedisAutoConfiguration,org.springframework.boot.autoconfigure.security.servlet.SecurityAutoConfiguration

# ==========================================
# 讯飞语音识别配置 (生产环境使用环境变量)
# ==========================================
cretas.iflytek.appid=${IFLYTEK_APPID}
cretas.iflytek.api-key=${IFLYTEK_API_KEY}
cretas.iflytek.api-secret=${IFLYTEK_API_SECRET}
cretas.iflytek.iat-url=wss://iat-api.xfyun.cn/v2/iat
cretas.iflytek.language=zh_cn
cretas.iflytek.domain=iat
cretas.iflytek.accent=mandarin
cretas.iflytek.ptt=true

# ==========================================
# 阿里云 OSS 配置
# ==========================================
aliyun.oss.endpoint=oss-cn-shanghai.aliyuncs.com
aliyun.oss.access-key-id=${ALIBABA_ACCESSKEY_ID}
aliyun.oss.access-key-secret=${ALIBABA_SECRET_KEY}
aliyun.oss.audio-bucket=cretas-audio
aliyun.oss.media-bucket=cretas-media

# ==========================================
# Active Learning 配置
# ==========================================
cretas.ai.active-learning.confidence-threshold=0.7
cretas.ai.active-learning.min-cluster-size=5
cretas.ai.active-learning.transition-smoothing=1.0
cretas.ai.active-learning.promotion-min-effectiveness=0.80
cretas.ai.active-learning.promotion-min-adoptions=3
cretas.ai.active-learning.data-retention-days=90
cretas.ai.active-learning.performance-degradation-threshold=0.05
cretas.ai.keyword.promotion.min-factories=3
cretas.ai.keyword.promotion.min-effectiveness=0.80

# ==========================================
# 多意图识别配置
# ==========================================
ai.multi-intent.threshold=0.55
ai.multi-intent.sigmoid-scale=6.0
ai.multi-intent.max-intents=3
ai.multi-intent.llm-fallback-enabled=true

# ==========================================
# Python SmartBI 服务配置 (生产环境)
# ==========================================
python-smartbi.enabled=true
python-smartbi.url=http://localhost:8083
python-smartbi.timeout=60000
python-smartbi.connect-timeout=10000
python-smartbi.fallback-on-error=false
python-smartbi.health-check-interval=30000
python-smartbi.max-retries=3

# ==========================================
# Python Error Analysis Service (生产环境)
# ==========================================
python-error-analysis.enabled=true
python-error-analysis.url=http://localhost:8083
python-error-analysis.timeout=60000
python-error-analysis.connect-timeout=10000
python-error-analysis.fallback-on-error=false
python-error-analysis.max-retries=3
python-error-analysis.health-check-interval=30000

# ==========================================
# SmartBI PostgreSQL 配置 (生产环境)
# ==========================================
smartbi.postgres.enabled=true
smartbi.postgres.url=jdbc:postgresql://${SMARTBI_DB_HOST:localhost}:${SMARTBI_DB_PORT:5432}/${SMARTBI_DB_NAME:smartbi_db}
smartbi.postgres.username=${SMARTBI_DB_USERNAME:smartbi_user}
smartbi.postgres.password=${SMARTBI_DB_PASSWORD}
smartbi.postgres.driver-class-name=org.postgresql.Driver
smartbi.postgres.hikari.pool-name=SmartBIPostgresPool
smartbi.postgres.hikari.maximum-pool-size=15
smartbi.postgres.hikari.minimum-idle=5
smartbi.postgres.hikari.idle-timeout=600000
smartbi.postgres.hikari.max-lifetime=1800000
smartbi.postgres.hikari.connection-timeout=30000

# ==========================================
# Python Intent Classifier 配置 (生产环境)
# ==========================================
python-classifier.enabled=true
python-classifier.url=http://localhost:8083
python-classifier.timeout=10000
python-classifier.connect-timeout=3000
python-classifier.health-check-interval=30000
python-classifier.weight=0.6
python-classifier.top-k=5
python-classifier.min-confidence=0.1
python-classifier.high-confidence-threshold=0.70
