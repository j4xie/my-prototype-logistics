# ===================================
# PostgreSQL 开发环境配置
# 使用方式: --spring.profiles.active=pg
# ===================================

# 应用配置
spring.application.name=Cretas Backend System
server.port=10010

# ==========================================
# PostgreSQL 数据库配置
# ==========================================
spring.datasource.driver-class-name=org.postgresql.Driver
spring.datasource.url=jdbc:postgresql://localhost:5432/cretas_db?currentSchema=public&stringtype=unspecified
spring.datasource.username=cretas_user
spring.datasource.password=${DB_PASSWORD:}

# HikariCP 连接池配置
spring.datasource.hikari.pool-name=CretasPostgresPool
spring.datasource.hikari.maximum-pool-size=20
spring.datasource.hikari.minimum-idle=5
spring.datasource.hikari.idle-timeout=300000
spring.datasource.hikari.connection-timeout=20000
spring.datasource.hikari.max-lifetime=1800000
spring.datasource.hikari.leak-detection-threshold=60000

# ==========================================
# JPA/Hibernate PostgreSQL 配置
# ==========================================
spring.jpa.database=POSTGRESQL
spring.jpa.database-platform=org.hibernate.dialect.PostgreSQL13Dialect
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.PostgreSQL13Dialect
spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=true
spring.jpa.properties.hibernate.format_sql=true
spring.jpa.defer-datasource-initialization=true

# PostgreSQL 特有优化
spring.jpa.properties.hibernate.jdbc.batch_size=50
spring.jpa.properties.hibernate.order_inserts=true
spring.jpa.properties.hibernate.order_updates=true
spring.jpa.properties.hibernate.jdbc.batch_versioned_data=true
spring.jpa.properties.hibernate.temp.use_jdbc_metadata_defaults=false
spring.jpa.properties.hibernate.jdbc.lob.non_contextual_creation=true

# SQL初始化配置
spring.sql.init.mode=always
spring.sql.init.continue-on-error=true
spring.sql.init.platform=postgresql

# ==========================================
# 日志配置
# ==========================================
logging.level.root=INFO
logging.level.com.cretas.aims=DEBUG
logging.pattern.console=%d{yyyy-MM-dd HH:mm:ss} - %msg%n
logging.pattern.file=%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n

# ==========================================
# 文件上传配置
# ==========================================
spring.servlet.multipart.enabled=true
spring.servlet.multipart.max-file-size=10MB
spring.servlet.multipart.max-request-size=10MB

# ==========================================
# Jackson 配置
# ==========================================
spring.jackson.time-zone=GMT+8
spring.jackson.date-format=yyyy-MM-dd HH:mm:ss
spring.jackson.serialization.write-dates-as-timestamps=false
spring.jackson.serialization.fail-on-empty-beans=false

# ==========================================
# JWT配置
# ==========================================
cretas.jwt.secret=${JWT_SECRET:cretas-food-traceability-system-secret-key-2025-do-not-change-in-production}
cretas.jwt.expiration=86400000
cretas.jwt.refresh-expiration=2592000000

# ==========================================
# AI服务配置
# ==========================================
cretas.ai.service.url=http://localhost:8085
cretas.ai.service.timeout=120000
cretas.ai.service.connect-timeout=10000
cretas.ai.service.fallback-enabled=true

# ==========================================
# 禁用自动配置
# ==========================================
spring.autoconfigure.exclude=org.springframework.boot.autoconfigure.data.redis.RedisAutoConfiguration,org.springframework.boot.autoconfigure.security.servlet.SecurityAutoConfiguration

# ==========================================
# 讯飞语音识别配置
# ==========================================
cretas.iflytek.appid=${IFLYTEK_APPID:f1017f5d}
cretas.iflytek.api-key=${IFLYTEK_API_KEY:cd4b7aba958b9c263a45da49f1574897}
cretas.iflytek.api-secret=${IFLYTEK_API_SECRET:ZDk1ZjQxNzUxZWU1MTI0ZDZINDhiYzAy}
cretas.iflytek.iat-url=wss://iat-api.xfyun.cn/v2/iat
cretas.iflytek.language=zh_cn
cretas.iflytek.domain=iat
cretas.iflytek.accent=mandarin
cretas.iflytek.ptt=true

# ==========================================
# 阿里云 OSS 配置
# ==========================================
aliyun.oss.endpoint=oss-cn-shanghai.aliyuncs.com
aliyun.oss.access-key-id=${ALIBABA_ACCESSKEY_ID:your-access-key-id}
aliyun.oss.access-key-secret=${ALIBABA_SECRET_KEY:your-secret-key}
aliyun.oss.audio-bucket=cretas-audio
aliyun.oss.media-bucket=cretas-media

# ==========================================
# Embedding 服务配置
# ==========================================
embedding.mode=noop
grpc.client.embedding-service.address=static://localhost:9090
grpc.client.embedding-service.negotiationType=plaintext

# ==========================================
# Active Learning 配置
# ==========================================
cretas.ai.active-learning.confidence-threshold=0.7
cretas.ai.active-learning.min-cluster-size=5
cretas.ai.active-learning.transition-smoothing=1.0
cretas.ai.active-learning.promotion-min-effectiveness=0.80
cretas.ai.active-learning.promotion-min-adoptions=3
cretas.ai.active-learning.data-retention-days=90
cretas.ai.active-learning.performance-degradation-threshold=0.05
cretas.ai.keyword.promotion.min-factories=3
cretas.ai.keyword.promotion.min-effectiveness=0.80

# ==========================================
# 多意图识别配置
# ==========================================
ai.multi-intent.threshold=0.55
ai.multi-intent.sigmoid-scale=6.0
ai.multi-intent.max-intents=3
ai.multi-intent.llm-fallback-enabled=true

# ==========================================
# Python SmartBI 服务配置
# ==========================================
python-smartbi.enabled=true
python-smartbi.url=http://localhost:8083
python-smartbi.timeout=30000
python-smartbi.connect-timeout=5000
python-smartbi.fallback-on-error=false
python-smartbi.health-check-interval=30000
python-smartbi.max-retries=2

# ==========================================
# Python Error Analysis Service
# ==========================================
python-error-analysis.enabled=true
python-error-analysis.url=http://localhost:8083
python-error-analysis.timeout=30000
python-error-analysis.connect-timeout=5000
python-error-analysis.fallback-on-error=false
python-error-analysis.max-retries=2
python-error-analysis.health-check-interval=30000

# ==========================================
# SmartBI PostgreSQL 动态数据存储
# ==========================================
# 注意: 当使用 pg profile 时，主数据源已是 PostgreSQL
# SmartBI 仍使用独立的数据库/Schema 存储动态数据
smartbi.postgres.enabled=true
smartbi.postgres.url=jdbc:postgresql://localhost:5432/smartbi_db
smartbi.postgres.username=smartbi_user
smartbi.postgres.password=${POSTGRES_SMARTBI_PASSWORD:}
smartbi.postgres.driver-class-name=org.postgresql.Driver
smartbi.postgres.hikari.pool-name=SmartBIPostgresPool
smartbi.postgres.hikari.maximum-pool-size=10
smartbi.postgres.hikari.minimum-idle=2
smartbi.postgres.hikari.idle-timeout=600000
smartbi.postgres.hikari.max-lifetime=1800000
smartbi.postgres.hikari.connection-timeout=30000

# ==========================================
# Python Intent Classifier 配置
# ==========================================
python-classifier.enabled=true
python-classifier.url=http://localhost:8083
python-classifier.timeout=10000
python-classifier.connect-timeout=3000
python-classifier.health-check-interval=30000
python-classifier.weight=0.5
python-classifier.top-k=5
python-classifier.min-confidence=0.1
