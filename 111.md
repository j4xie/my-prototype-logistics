你现在是资深架构审计工程师 + 代码走查专家。你的任务是：对我当前仓库进行“对话式配置化平台”能力核对与缺口分析，必须以真实代码为证据（文件路径 + 行号 + 关键片段），不得用推测替代证据。最终输出一份可执行的缺口清单与落地计划。

========================
一、背景与目标（必须理解）
========================
我希望系统支持两类能力，并都由 LLM 对话驱动完成：

A) 工厂侧（Factory Scope）：
- 工厂管理员可以通过与 AI 对话创建/修改：新 SKU、新产线、新 SOP、新产品
- 同时自动生成/更新：字段模型、表单模板（Formily Schema）、业务规则（Drools）、流程/状态机配置
- AI 也需要包含“帮填表”（对话解析 -> 自动填充 Formily -> 规则校验 -> 提交）

B) 平台侧（Platform Scope）：
- 平台管理员可以通过与 AI 对话创建新的“工厂类型”（Factory Type Blueprint）
- 工厂类型包含默认的字段/实体模型、模板包、规则包、SOP/流程蓝图，并可用于新租户初始化下发

关键：需要避免用户随便聊导致 AI 走神、越权、错误改配置。系统应当有明确的“范围/权限/审批/仿真/发布/回滚/审计”治理链路。

========================
二、你要核对的“目标架构形态”
========================
请以“对话 -> 结构化变更计划 ChangeSet -> 校验/仿真 -> 审批 -> 发布 -> 审计/回滚”作为目标闭环。

ChangeSet（变更集）应该至少能表达：
- intent: create/update/deprecate
- scope: factory / platform
- objects: 字段/实体、模板、规则、流程、主数据（SKU/产线/SOP）、工厂类型蓝图
- dependencies: 依赖顺序（字段->模板->规则->流程->主数据等）
- risk_level: low/medium/high（决定审批策略）
- tests: 自动生成的验收用例（至少包含规则沙箱执行样例）
- audit_meta: 发起人、工厂/平台范围、时间、版本号

治理能力（必须具备或明确缺口）：
1) 命名空间与权限边界（工厂管理员不能改平台配置；平台可发布到多工厂类型）
2) 版本化、Diff 对比、回滚
3) Dry-run / Sandbox 仿真（Formily Schema 校验、Drools 编译+样例执行、流程可达性）
4) 审批与发布策略（低风险可自动，高风险需审批/灰度）
5) 全链路审计（输入、LLM 输出、变更内容、发布版本、命中规则、执行人）

同时仍需支持“AI 帮填表”闭环：
- LLM 结构化提取（严格 JSON Schema 可验证）
- Formily 动态表单自动填充
- Drools 规则执行（ALLOW/BLOCK/REQUIRE_CONFIRM + modifiedFields 回写）
- 校验失败能否回流对话纠错（如未实现必须指出缺口）

========================
三、执行步骤（你必须按步骤走）
========================
Step 1：快速建立系统地图
- 列出仓库关键模块（backend、frontend、rules、schema、workflow、admin）
- 给出“对话/配置/审计/发布”的端到端链路图（用文字/ASCII 图即可）
- 找到与 AI 相关的入口、服务、控制器、存储表结构

Step 2：核对“AI 帮填表”是否完整闭环（用证据说话）
- 找到 AI 表单解析 API：路径、入参、出参、是否严格 JSON schema 验证、失败容错
- 找到 Formily 自动填充逻辑：在哪里 setFieldValue、如何处理未知字段、置信度/标记
- 找到 Drools 执行入口：Fact 构建、hookPoint、entityType、factoryId 注入
- 找到规则热更新：reloadRuleGroup 或等价实现；版本号机制；生效时机
- 找到“REQUIRE_CONFIRM/警告/阻止提交”的前端处理逻辑与 UI 表现
- 明确指出：校验失败是否能回流对话纠错（如果没有，列为缺口并给最小实现建议）

Step 3：核对“对话式配置化平台”能力是否已搭建
请逐项检查是否存在（或部分存在）以下组件：
A. 配置对象模型
- Field/Entity/Enum/Unit 模型是否存在？存储在哪里？是否多租户隔离？
- Form Template（Formily schema）是否版本化？是否支持模板包（schema pack）？
- Drools Rule 是否版本化/分组/多租户隔离/可回滚？
- Workflow/StateMachine 配置是否存在？guard 是否可配置且真实生效？
- SKU/产线/SOP/产品等主数据模型是否存在？是否能与模板/规则/流程关联？

B. ChangeSet 或等价机制
- 是否存在“变更集/发布单/配置变更工单”概念？（即使名字不同也可）
- 是否支持：预览 diff、dry-run、审批、发布、回滚、审计记录
- 如果不存在：请指出缺口，并给出你建议的最小 ChangeSet 数据结构与表设计/代码落点

C. 权限与防走神治理
- 是否有 intent 分类或路由（只允许进入“创建/修改配置”的受控对话域）？
- 是否有范围控制（factory scope / platform scope）？
- 是否有工具调用约束（LLM 输出必须是结构化命令，不能自由发挥）？
- 是否有“拒绝闲聊/偏题”的策略（例如提示用户选择要创建的对象类型）？
- 是否有安全策略：禁止越权、禁止直接写库、禁止跨租户影响、敏感操作必须审批

Step 4：输出缺口清单（按优先级与风险）
- 按 P0/P1/P2（或 Must/Should/Could）分级
- 每个缺口必须包含：
  1) 现状证据（找到了什么/没找到什么）
  2) 影响（无法实现哪类对话式配置）
  3) 最小修复方案（落在哪些模块、需要新增哪些接口/表/服务）
  4) 验收标准（如何证明修复完成）

Step 5：给出落地路线图（务必可执行）
- 建议用 2~3 个 Sprint 的 MVP 路线：
  Sprint 1：工厂侧对话新增字段 + 更新模板 + 简单规则发布（含版本/回滚/审计/最小审批）
  Sprint 2：工厂侧对话新增 SKU + 绑定 SOP/流程守卫（含证据要求，如拍照）
  Sprint 3：平台侧新工厂类型蓝图（模板包/规则包/初始化）
- 每个 Sprint 产物：接口清单、数据表变更、关键模块改动点、测试用例

========================
四、输出格式（必须严格遵守）
========================
请按以下结构输出：

1) 系统现状总览（1页以内）
- 结论：已具备 / 部分具备 / 不具备（分别针对“AI帮填表”和“对话式配置平台”）
- 端到端链路图（ASCII 或分段描述）

2) 证据索引（非常重要）
- 用表格列出：能力点 | 文件路径 | 行号范围 | 关键片段摘要 | 结论
- 必须至少覆盖：AI 解析 API、Formily 自动填充、Drools 执行入口、热更新、审计、流程/状态机（如果有）

3) 缺口清单（P0/P1/P2）
- 每项缺口按：现状证据 -> 影响 -> 最小修复 -> 验收标准

4) 最小 ChangeSet 方案（如果当前缺失）
- 给出推荐的数据结构（字段名即可，不用写完整代码）
- 建议的表/实体（ChangeSet、ChangeSetItem、Approval、Publish、Audit 等）
- 与现有模块的集成点（controller/service/repo）

5) 防走神/越权策略建议（可落地）
- 对话域约束：允许的意图列表（create/update/preview/publish/rollback）
- 明确拒绝策略：偏题时如何响应、如何引导用户回到“选择对象 + 生成变更预览”
- 权限与审批策略：平台/工厂边界、风险分级、灰度发布

========================
五、强约束（必须遵守）
========================
- 不允许“可能/应该/大概”式推测。每个关键结论必须给代码证据；找不到就明确写“未发现”。
- 必须指出任何示例/规则文案中的逻辑错误（如温度阈值方向、单位换算等），并说明风险。
- 如果发现某些能力被 if-else 硬编码，必须定位到文件与行号，并建议如何配置化。
- 如果发现流程守卫/状态机存在 TODO 或直接 return true，必须重点标记为 P0 风险。

现在开始：请先做 Step 1 系统地图，然后按步骤推进，直到输出完整报告。
