# 统一登录系统指南

## 系统概述

食品溯源系统采用统一登录架构，所有用户（工厂用户、系统管理员、平台超级管理员）都使用同一个登录界面。系统根据用户的权限级别自动跳转到相应的功能模块。

## 访问地址

- **登录页面**: http://localhost:3005/login
- **开发服务器**: http://localhost:3005

## 用户权限体系

### Level 0 - 平台超级管理员
- **账号**: `super_admin` / `super123`
- **权限**: 最高权限，可以管理所有工厂租户、订阅套餐和平台运营数据
- **登录后跳转**: `/platform` (平台管理控制台)
- **功能模块**:
  - 工厂管理 (创建、编辑、删除工厂)
  - 订阅套餐管理
  - 平台运营数据统计
  - 操作日志监控

### Level 1 - 系统管理员
- **账号**: `admin` / `admin123`
- **权限**: 系统管理权限，可以管理用户、角色、权限等
- **登录后跳转**: `/admin/dashboard` (管理后台)
- **功能模块**:
  - 用户管理
  - 角色权限管理
  - 系统配置
  - 审计日志

### Level 3+ - 普通用户
- **账号**: `user` / `user123`
- **权限**: 业务操作权限，使用工厂内部业务系统
- **登录后跳转**: `/farming` (工厂业务系统)
- **功能模块**:
  - 农业监控
  - 加工管理
  - 物流跟踪
  - 溯源查询

## 登录界面功能

### 统一登录表单
- 用户名和密码输入
- 密码显示/隐藏切换
- 表单验证和错误提示
- 登录状态指示器

### 员工注册入口
- **注册链接**: 登录界面底部提供"立即注册"按钮
- **注册流程**: 基于白名单的两步注册机制
- **安全验证**: 只有预授权的手机号才能注册

### 测试账号信息
界面提供三类测试账号的详细信息：
- 账号密码显示
- 一键复制功能
- 快速填充按钮
- 权限级别说明

### 便捷功能
- **复制到剪贴板**: 点击复制图标可快速复制用户名或密码
- **快速填充**: 点击"快速填充"按钮自动填入对应账号信息
- **状态反馈**: 复制成功后显示绿色勾号，2秒后恢复

## 员工注册流程

### 注册机制说明
本系统采用基于手机号白名单的注册机制，确保只有经过工厂管理员预授权的员工才能注册账户。

### 注册步骤

#### 第一步：手机号验证
1. 在登录页面点击"立即注册"
2. 输入11位手机号码
3. 系统验证手机号是否在管理员白名单中
4. 验证通过后进入资料补全页面

#### 第二步：完善注册信息
- 系统自动填充白名单中的基本信息（姓名、部门、职位）
- 用户补充登录凭据（用户名、邮箱、密码）
- 选择账户角色（普通用户/操作员/管理员）

#### 第三步：提交审核
- 注册申请提交后，账户状态为"待审核"
- 管理员收到审核通知
- 审核通过后，用户收到邮件通知可正常登录

### 测试白名单
以下手机号可用于测试注册流程：

| 手机号 | 预设姓名 | 预设部门 | 预设职位 |
|--------|----------|----------|----------|
| 13800138001 | 张三 | 养殖部门 | 养殖技术员 |
| 13800138002 | 李四 | 加工部门 | 质检员 |
| 13800138003 | 王五 | 物流部门 | 配送员 |
| 13800138004 | 赵六 | 管理部门 | 主管 |
| 13800138005 | 钱七 | 质检部门 | 检验员 |

### 管理员白名单管理
- **访问路径**: `/admin/whitelist`
- **功能**: 单个添加、批量上传、查看管理员工白名单
- **权限要求**: 需要系统管理员(Level 1)或更高权限

## 技术架构

### 认证流程
1. 用户提交登录表单
2. 系统验证用户名和密码
3. 获取用户权限信息 (role.level)
4. 根据权限级别自动跳转到相应模块

### 权限判断逻辑
```typescript
if (user?.role?.level === 0) {
  // 超级管理员 → 平台管理
  router.push('/platform');
} else if (user?.role?.level === 1) {
  // 系统管理员 → 管理后台
  router.push('/admin/dashboard');
} else {
  // 普通用户 → 工厂业务系统
  router.push('/farming');
}
```

### Mock数据结构
```typescript
interface MockUser {
  id: string;
  username: string;
  password: string;
  role: {
    name: string;
    level: number;
    displayName: string;
  };
  // ... 其他用户信息
}
```

## 开发者信息

### 技术栈
- **前端框架**: Next.js 15.3.2
- **UI库**: TailwindCSS + Lucide Icons
- **状态管理**: Zustand (useAuthStore)
- **Mock API**: MSW (Mock Service Worker)
- **类型检查**: TypeScript

### 文件位置
- **登录页面**: `src/app/login/page.tsx`
- **认证Store**: `src/store/authStore.ts`
- **Mock数据**: `src/mocks/data/auth-data.ts`
- **API处理**: `src/mocks/handlers/auth.ts`

### 样式设计
遵循 Neo Minimal iOS-Style Admin UI 设计规范：
- 渐变背景: `from-blue-50 via-white to-purple-50`
- 卡片设计: 圆角阴影，半透明背景
- 颜色方案: 蓝色主调，紫色强调
- 响应式布局: 最大宽度420px

## 故障排除

### 常见问题
1. **登录失败**: 检查用户名密码是否正确
2. **权限错误**: 确认用户角色level设置正确
3. **跳转异常**: 检查路由配置和权限判断逻辑
4. **界面异常**: 确认开发服务器正常运行

### 调试信息
开发模式下，控制台会输出详细的认证信息：
```
[AuthService] 初始化环境: mock
[AuthService] 环境检查信息: {...}
```

## 更新日志

### v2.1.0 (2025-02-02)
- [新增] 基于白名单的员工注册系统
- [新增] 两步注册流程：手机号验证 + 资料补全
- [新增] 管理员白名单管理页面 (`/admin/whitelist`)
- [优化] 登录页面增加注册入口
- [安全] 实现手机号白名单验证机制

### v2.0.0 (2025-01-XX)
- [重构] 统一登录系统，移除双模式切换
- [优化] 改进用户体验，增加快速填充功能
- [修复] 权限判断逻辑，支持多级权限体系
- [新增] 完整的测试账号信息展示

---

**维护团队**: 食品溯源系统开发组
**最后更新**: 2025年1月
**文档版本**: v2.0.0
