{
  "meta": {
    "taskId": "TASK-P3-016A",
    "validationType": "comprehensive",
    "module": "React Hook问题修复",
    "reportPath": "refactor/phase-3/progress-reports/",
    "workdir": "web-app-next"
  },
  "timestamp": "2025-05-29T14:15:11.147Z",
  "results": {
    "layer1": {
      "name": "TypeScript编译检查",
      "passed": true,
      "errors": []
    },
    "layer2": {
      "name": "构建系统验证",
      "passed": true,
      "errors": []
    },
    "layer3": {
      "name": "代码质量检查",
      "passed": true,
      "errors": [],
      "warnings": 4
    },
    "layer4": {
      "name": "核心功能验证",
      "passed": false,
      "errors": [
        "测试运行失败: Command failed: npm test\nFAIL tests/unit/lib/sync-manager.test.ts (16.194 s)\n  ● Console\n\n    console.warn\n      [Storage] 解压失败: DOMException {}\n\n    \u001b[0m \u001b[90m 53 |\u001b[39m       \u001b[36mreturn\u001b[39m decodeURIComponent(atob(compressedData))\u001b[33m;\u001b[39m\n     \u001b[90m 54 |\u001b[39m     } \u001b[36mcatch\u001b[39m (error) {\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 55 |\u001b[39m       console\u001b[33m.\u001b[39mwarn(\u001b[32m'[Storage] 解压失败:'\u001b[39m\u001b[33m,\u001b[39m error)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m               \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 56 |\u001b[39m       \u001b[36mreturn\u001b[39m compressedData\u001b[33m;\u001b[39m\n     \u001b[90m 57 |\u001b[39m     }\n     \u001b[90m 58 |\u001b[39m   }\u001b[0m\n\n      at Function.warn [as decompress] (src/lib/storage.ts:55:15)\n      at StorageImpl.decompress [as deserialize] (src/lib/storage.ts:159:41)\n      at StorageImpl.deserialize [as getItem] (src/lib/storage.ts:239:27)\n      at OfflineQueueImpl.getItem [as loadFromStorage] (src/lib/offline-queue.ts:130:51)\n      at OfflineQueueImpl.loadFromStorage [as initialize] (src/lib/offline-queue.ts:100:18)\n      at new initialize (src/lib/offline-queue.ts:90:10)\n      at Object.<anonymous> (src/lib/offline-queue.ts:547:36)\n      at Object.<anonymous> (src/lib/sync-manager.ts:28:23)\n      at Object.<anonymous> (tests/unit/lib/sync-manager.test.ts:10:22)\n\n    console.warn\n      [Storage] 数据反序列化失败: SyntaxError: \"undefined\" is not valid JSON\n          at JSON.parse (<anonymous>)\n          at StorageImpl.parse [as deserialize] (C:\\Users\\Steve\\heiniu\\web-app-next\\src\\lib\\storage.ts:162:27)\n          at StorageImpl.deserialize [as getItem] (C:\\Users\\Steve\\heiniu\\web-app-next\\src\\lib\\storage.ts:239:27)\n          at OfflineQueueImpl.getItem [as loadFromStorage] (C:\\Users\\Steve\\heiniu\\web-app-next\\src\\lib\\offline-queue.ts:130:51)\n          at OfflineQueueImpl.loadFromStorage [as initialize] (C:\\Users\\Steve\\heiniu\\web-app-next\\src\\lib\\offline-queue.ts:100:18)\n          at new initialize (C:\\Users\\Steve\\heiniu\\web-app-next\\src\\lib\\offline-queue.ts:90:10)\n          at Object.<anonymous> (C:\\Users\\Steve\\heiniu\\web-app-next\\src\\lib\\offline-queue.ts:547:36)\n          at Runtime._execModule (C:\\Users\\Steve\\heiniu\\web-app-next\\node_modules\\jest-runtime\\build\\index.js:1439:24)\n          at Runtime._loadModule (C:\\Users\\Steve\\heiniu\\web-app-next\\node_modules\\jest-runtime\\build\\index.js:1022:12)\n          at Runtime.requireModule (C:\\Users\\Steve\\heiniu\\web-app-next\\node_modules\\jest-runtime\\build\\index.js:882:12)\n          at Runtime.requireModuleOrMock (C:\\Users\\Steve\\heiniu\\web-app-next\\node_modules\\jest-runtime\\build\\index.js:1048:21)\n          at Object.<anonymous> (C:\\Users\\Steve\\heiniu\\web-app-next\\src\\lib\\sync-manager.ts:28:23)\n          at Runtime._execModule (C:\\Users\\Steve\\heiniu\\web-app-next\\node_modules\\jest-runtime\\build\\index.js:1439:24)\n          at Runtime._loadModule (C:\\Users\\Steve\\heiniu\\web-app-next\\node_modules\\jest-runtime\\build\\index.js:1022:12)\n          at Runtime.requireModule (C:\\Users\\Steve\\heiniu\\web-app-next\\node_modules\\jest-runtime\\build\\index.js:882:12)\n          at Runtime.requireModuleOrMock (C:\\Users\\Steve\\heiniu\\web-app-next\\node_modules\\jest-runtime\\build\\index.js:1048:21)\n          at Object.<anonymous> (C:\\Users\\Steve\\heiniu\\web-app-next\\tests\\unit\\lib\\sync-manager.test.ts:10:22)\n          at Runtime._execModule (C:\\Users\\Steve\\heiniu\\web-app-next\\node_modules\\jest-runtime\\build\\index.js:1439:24)\n          at Runtime._loadModule (C:\\Users\\Steve\\heiniu\\web-app-next\\node_modules\\jest-runtime\\build\\index.js:1022:12)\n          at Runtime.requireModule (C:\\Users\\Steve\\heiniu\\web-app-next\\node_modules\\jest-runtime\\build\\index.js:882:12)\n          at jestAdapter (C:\\Users\\Steve\\heiniu\\web-app-next\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:77:13)\n          at processTicksAndRejections (node:internal/process/task_queues:105:5)\n          at runTestInternal (C:\\Users\\Steve\\heiniu\\web-app-next\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n          at runTest (C:\\Users\\Steve\\heiniu\\web-app-next\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n\n    \u001b[0m \u001b[90m 170 |\u001b[39m       \u001b[36mreturn\u001b[39m parsed\u001b[33m.\u001b[39mdata\u001b[33m;\u001b[39m\n     \u001b[90m 171 |\u001b[39m     } \u001b[36mcatch\u001b[39m (deserializationError) {\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 172 |\u001b[39m       console\u001b[33m.\u001b[39mwarn(\u001b[32m'[Storage] 数据反序列化失败:'\u001b[39m\u001b[33m,\u001b[39m deserializationError)\u001b[33m;\u001b[39m\n     \u001b[90m     |\u001b[39m               \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 173 |\u001b[39m       \u001b[36mreturn\u001b[39m \u001b[36mnull\u001b[39m\u001b[33m;\u001b[39m\n     \u001b[90m 174 |\u001b[39m     }\n     \u001b[90m 175 |\u001b[39m   }\u001b[0m\n\n      at StorageImpl.warn [as deserialize] (src/lib/storage.ts:172:15)\n      at StorageImpl.deserialize [as getItem] (src/lib/storage.ts:239:27)\n      at OfflineQueueImpl.getItem [as loadFromStorage] (src/lib/offline-queue.ts:130:51)\n      at OfflineQueueImpl.loadFromStorage [as initialize] (src/lib/offline-queue.ts:100:18)\n      at new initialize (src/lib/offline-queue.ts:90:10)\n      at Object.<anonymous> (src/lib/offline-queue.ts:547:36)\n      at Object.<anonymous> (src/lib/sync-manager.ts:28:23)\n      at Object.<anonymous> (tests/unit/lib/sync-manager.test.ts:10:22)\n\n    console.log\n      [Storage] 已读取数据: operations 失败\n\n      at StorageImpl.log [as getItem] (src/lib/storage.ts:240:15)\n\n    console.log\n      [NetworkDetector] 网络状态变化: unknown → online\n\n      at NetworkDetectorImpl.log [as updateStatus] (src/lib/network-detector.ts:122:15)\n\n    console.warn\n      [Storage] 解压失败: DOMException {}\n\n    \u001b[0m \u001b[90m 53 |\u001b[39m       \u001b[36mreturn\u001b[39m decodeURIComponent(atob(compressedData))\u001b[33m;\u001b[39m\n     \u001b[90m 54 |\u001b[39m     } \u001b[36mcatch\u001b[39m (error) {\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 55 |\u001b[39m       console\u001b[33m.\u001b[39mwarn(\u001b[32m'[Storage] 解压失败:'\u001b[39m\u001b[33m,\u001b[39m error)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m               \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 56 |\u001b[39m       \u001b[36mreturn\u001b[39m compressedData\u001b[33m;\u001b[39m\n     \u001b[90m 57 |\u001b[39m     }\n     \u001b[90m 58 |\u001b[39m   }\u001b[0m\n\n      at Function.warn [as decompress] (src/lib/storage.ts:55:15)\n      at StorageImpl.decompress [as deserialize] (src/lib/storage.ts:159:41)\n      at StorageImpl.deserialize [as getItem] (src/lib/storage.ts:239:27)\n      at OfflineQueueImpl.getItem [as loadFromStorage] (src/lib/offline-queue.ts:130:51)\n      at OfflineQueueImpl.loadFromStorage [as initialize] (src/lib/offline-queue.ts:100:18)\n      at new initialize (src/lib/offline-queue.ts:90:10)\n      at new SyncManagerImpl (src/lib/sync-manager.ts:117:27)\n      at Object.<anonymous> (src/lib/sync-manager.ts:639:35)\n      at Object.<anonymous> (tests/unit/lib/sync-manager.test.ts:10:22)\n\n    console.warn\n      [Storage] 数据反序列化失败: SyntaxError: \"undefined\" is not valid JSON\n          at JSON.parse (<anonymous>)\n          at StorageImpl.parse [as deserialize] (C:\\Users\\Steve\\heiniu\\web-app-next\\src\\lib\\storage.ts:162:27)\n          at StorageImpl.deserialize [as getItem] (C:\\Users\\Steve\\heiniu\\web-app-next\\src\\lib\\storage.ts:239:27)\n          at OfflineQueueImpl.getItem [as loadFromStorage] (C:\\Users\\Steve\\heiniu\\web-app-next\\src\\lib\\offline-queue.ts:130:51)\n          at OfflineQueueImpl.loadFromStorage [as initialize] (C:\\Users\\Steve\\heiniu\\web-app-next\\src\\lib\\offline-queue.ts:100:18)\n          at new initialize (C:\\Users\\Steve\\heiniu\\web-app-next\\src\\lib\\offline-queue.ts:90:10)\n          at new SyncManagerImpl (C:\\Users\\Steve\\heiniu\\web-app-next\\src\\lib\\sync-manager.ts:117:27)\n          at Object.<anonymous> (C:\\Users\\Steve\\heiniu\\web-app-next\\src\\lib\\sync-manager.ts:639:35)\n          at Runtime._execModule (C:\\Users\\Steve\\heiniu\\web-app-next\\node_modules\\jest-runtime\\build\\index.js:1439:24)\n          at Runtime._loadModule (C:\\Users\\Steve\\heiniu\\web-app-next\\node_modules\\jest-runtime\\build\\index.js:1022:12)\n          at Runtime.requireModule (C:\\Users\\Steve\\heiniu\\web-app-next\\node_modules\\jest-runtime\\build\\index.js:882:12)\n          at Runtime.requireModuleOrMock (C:\\Users\\Steve\\heiniu\\web-app-next\\node_modules\\jest-runtime\\build\\index.js:1048:21)\n          at Object.<anonymous> (C:\\Users\\Steve\\heiniu\\web-app-next\\tests\\unit\\lib\\sync-manager.test.ts:10:22)\n          at Runtime._execModule (C:\\Users\\Steve\\heiniu\\web-app-next\\node_modules\\jest-runtime\\build\\index.js:1439:24)\n          at Runtime._loadModule (C:\\Users\\Steve\\heiniu\\web-app-next\\node_modules\\jest-runtime\\build\\index.js:1022:12)\n          at Runtime.requireModule (C:\\Users\\Steve\\heiniu\\web-app-next\\node_modules\\jest-runtime\\build\\index.js:882:12)\n          at jestAdapter (C:\\Users\\Steve\\heiniu\\web-app-next\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:77:13)\n          at processTicksAndRejections (node:internal/process/task_queues:105:5)\n          at runTestInternal (C:\\Users\\Steve\\heiniu\\web-app-next\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n          at runTest (C:\\Users\\Steve\\heiniu\\web-app-next\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n\n    \u001b[0m \u001b[90m 170 |\u001b[39m       \u001b[36mreturn\u001b[39m parsed\u001b[33m.\u001b[39mdata\u001b[33m;\u001b[39m\n     \u001b[90m 171 |\u001b[39m     } \u001b[36mcatch\u001b[39m (deserializationError) {\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 172 |\u001b[39m       console\u001b[33m.\u001b[39mwarn(\u001b[32m'[Storage] 数据反序列化失败:'\u001b[39m\u001b[33m,\u001b[39m deserializationError)\u001b[33m;\u001b[39m\n     \u001b[90m     |\u001b[39m               \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 173 |\u001b[39m       \u001b[36mreturn\u001b[39m \u001b[36mnull\u001b[39m\u001b[33m;\u001b[39m\n     \u001b[90m 174 |\u001b[39m     }\n     \u001b[90m 175 |\u001b[39m   }\u001b[0m\n\n      at StorageImpl.warn [as deserialize] (src/lib/storage.ts:172:15)\n      at StorageImpl.deserialize [as getItem] (src/lib/storage.ts:239:27)\n      at OfflineQueueImpl.getItem [as loadFromStorage] (src/lib/offline-queue.ts:130:51)\n      at OfflineQueueImpl.loadFromStorage [as initialize] (src/lib/offline-queue.ts:100:18)\n      at new initialize (src/lib/offline-queue.ts:90:10)\n      at new SyncManagerImpl (src/lib/sync-manager.ts:117:27)\n      at Object.<anonymous> (src/lib/sync-manager.ts:639:35)\n      at Object.<anonymous> (tests/unit/lib/sync-manager.test.ts:10:22)\n\n    console.log\n      [Storage] 已读取数据: operations 失败\n\n      at StorageImpl.log [as getItem] (src/lib/storage.ts:240:15)\n\n    console.log\n      [SyncManager] 同步管理器初始化完成\n\n      at SyncManagerImpl.log [as initialize] (src/lib/sync-manager.ts:143:13)\n\n    console.error\n      [SyncManager] 执行操作失败: test_operation (test-op-123) Error: Execution error\n          at Object.<anonymous> (C:\\Users\\Steve\\heiniu\\web-app-next\\tests\\unit\\lib\\sync-manager.test.ts:264:21)\n          at Promise.then.completed (C:\\Users\\Steve\\heiniu\\web-app-next\\node_modules\\jest-circus\\build\\utils.js:298:28)\n          at new Promise (<anonymous>)\n          at callAsyncCircusFn (C:\\Users\\Steve\\heiniu\\web-app-next\\node_modules\\jest-circus\\build\\utils.js:231:10)\n          at _callCircusTest (C:\\Users\\Steve\\heiniu\\web-app-next\\node_modules\\jest-circus\\build\\run.js:316:40)\n          at processTicksAndRejections (node:internal/process/task_queues:105:5)\n          at _runTest (C:\\Users\\Steve\\heiniu\\web-app-next\\node_modules\\jest-circus\\build\\run.js:252:3)\n          at _runTestsForDescribeBlock (C:\\Users\\Steve\\heiniu\\web-app-next\\node_modules\\jest-circus\\build\\run.js:126:9)\n          at _runTestsForDescribeBlock (C:\\Users\\Steve\\heiniu\\web-app-next\\node_modules\\jest-circus\\build\\run.js:121:9)\n          at _runTestsForDescribeBlock (C:\\Users\\Steve\\heiniu\\web-app-next\\node_modules\\jest-circus\\build\\run.js:121:9)\n          at run (C:\\Users\\Steve\\heiniu\\web-app-next\\node_modules\\jest-circus\\build\\run.js:71:3)\n          at runAndTransformResultsToJestFormat (C:\\Users\\Steve\\heiniu\\web-app-next\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n          at jestAdapter (C:\\Users\\Steve\\heiniu\\web-app-next\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n          at runTestInternal (C:\\Users\\Steve\\heiniu\\web-app-next\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n          at runTest (C:\\Users\\Steve\\heiniu\\web-app-next\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n\n    \u001b[0m \u001b[90m 105 |\u001b[39m       \u001b[36mreturn\u001b[39m\n     \u001b[90m 106 |\u001b[39m     }\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 107 |\u001b[39m     originalError\u001b[33m.\u001b[39mcall(console\u001b[33m,\u001b[39m \u001b[33m...\u001b[39margs)\n     \u001b[90m     |\u001b[39m                   \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 108 |\u001b[39m   }\n     \u001b[90m 109 |\u001b[39m })\n     \u001b[90m 110 |\u001b[39m\u001b[0m\n\n      at Object.call [as error] (tests/setup.ts:107:19)\n      at error (src/lib/sync-manager.ts:431:19)\n          at async Promise.all (index 0)\n      at SyncManagerImpl.executeSyncBatch (src/lib/sync-manager.ts:439:7)\n      at SyncManagerImpl.performSync (src/lib/sync-manager.ts:351:7)\n      at SyncManagerImpl.triggerSync (src/lib/sync-manager.ts:279:5)\n      at Object.<anonymous> (tests/unit/lib/sync-manager.test.ts:268:7)\n\n    console.error\n      [SyncManager] 同步过程发生错误: Error: Queue error\n          at Object.<anonymous> (C:\\Users\\Steve\\heiniu\\web-app-next\\tests\\unit\\lib\\sync-manager.test.ts:626:56)\n          at Promise.then.completed (C:\\Users\\Steve\\heiniu\\web-app-next\\node_modules\\jest-circus\\build\\utils.js:298:28)\n          at new Promise (<anonymous>)\n          at callAsyncCircusFn (C:\\Users\\Steve\\heiniu\\web-app-next\\node_modules\\jest-circus\\build\\utils.js:231:10)\n          at _callCircusTest (C:\\Users\\Steve\\heiniu\\web-app-next\\node_modules\\jest-circus\\build\\run.js:316:40)\n          at _runTest (C:\\Users\\Steve\\heiniu\\web-app-next\\node_modules\\jest-circus\\build\\run.js:252:3)\n          at _runTestsForDescribeBlock (C:\\Users\\Steve\\heiniu\\web-app-next\\node_modules\\jest-circus\\build\\run.js:126:9)\n          at _runTestsForDescribeBlock (C:\\Users\\Steve\\heiniu\\web-app-next\\node_modules\\jest-circus\\build\\run.js:121:9)\n          at _runTestsForDescribeBlock (C:\\Users\\Steve\\heiniu\\web-app-next\\node_modules\\jest-circus\\build\\run.js:121:9)\n          at run (C:\\Users\\Steve\\heiniu\\web-app-next\\node_modules\\jest-circus\\build\\run.js:71:3)\n          at runAndTransformResultsToJestFormat (C:\\Users\\Steve\\heiniu\\web-app-next\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n          at jestAdapter (C:\\Users\\Steve\\heiniu\\web-app-next\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n          at runTestInternal (C:\\Users\\Steve\\heiniu\\web-app-next\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n          at runTest (C:\\Users\\Steve\\heiniu\\web-app-next\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n\n    \u001b[0m \u001b[90m 105 |\u001b[39m       \u001b[36mreturn\u001b[39m\n     \u001b[90m 106 |\u001b[39m     }\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 107 |\u001b[39m     originalError\u001b[33m.\u001b[39mcall(console\u001b[33m,\u001b[39m \u001b[33m...\u001b[39margs)\n     \u001b[90m     |\u001b[39m                   \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 108 |\u001b[39m   }\n     \u001b[90m 109 |\u001b[39m })\n     \u001b[90m 110 |\u001b[39m\u001b[0m\n\n      at Object.call [as error] (tests/setup.ts:107:19)\n      at SyncManagerImpl.error [as performSync] (src/lib/sync-manager.ts:359:15)\n      at SyncManagerImpl.triggerSync (src/lib/sync-manager.ts:279:5)\n      at Object.<anonymous> (tests/unit/lib/sync-manager.test.ts:628:7)\n\n    console.error\n      [SyncManager] 同步过程发生错误: Error: First call error\n          at Object.<anonymous> (C:\\Users\\Steve\\heiniu\\web-app-next\\tests\\unit\\lib\\sync-manager.test.ts:642:17)\n          at C:\\Users\\Steve\\heiniu\\web-app-next\\node_modules\\jest-mock\\build\\index.js:397:39\n          at Object.<anonymous> (C:\\Users\\Steve\\heiniu\\web-app-next\\node_modules\\jest-mock\\build\\index.js:404:13)\n          at Object.mockConstructor [as getPendingOperations] (C:\\Users\\Steve\\heiniu\\web-app-next\\node_modules\\jest-mock\\build\\index.js:148:19)\n          at SyncManagerImpl.getPendingOperations (C:\\Users\\Steve\\heiniu\\web-app-next\\src\\lib\\sync-manager.ts:371:41)\n          at SyncManagerImpl.getPendingOperations [as performSync] (C:\\Users\\Steve\\heiniu\\web-app-next\\src\\lib\\sync-manager.ts:341:44)\n          at SyncManagerImpl.start (C:\\Users\\Steve\\heiniu\\web-app-next\\src\\lib\\sync-manager.ts:160:5)\n          at Object.<anonymous> (C:\\Users\\Steve\\heiniu\\web-app-next\\tests\\unit\\lib\\sync-manager.test.ts:647:7)\n\n    \u001b[0m \u001b[90m 105 |\u001b[39m       \u001b[36mreturn\u001b[39m\n     \u001b[90m 106 |\u001b[39m     }\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 107 |\u001b[39m     originalError\u001b[33m.\u001b[39mcall(console\u001b[33m,\u001b[39m \u001b[33m...\u001b[39margs)\n     \u001b[90m     |\u001b[39m                   \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 108 |\u001b[39m   }\n     \u001b[90m 109 |\u001b[39m })\n     \u001b[90m 110 |\u001b[39m\u001b[0m\n\n      at Object.call [as error] (tests/setup.ts:107:19)\n      at SyncManagerImpl.error [as performSync] (src/lib/sync-manager.ts:359:15)\n      at SyncManagerImpl.start (src/lib/sync-manager.ts:160:5)\n      at Object.<anonymous> (tests/unit/lib/sync-manager.test.ts:647:7)\n\n  ● SyncManager › 批量处理 › 应该控制并发执行数量\n\n    thrown: \"Exceeded timeout of 15000 ms for a test.\n    Add a timeout value to this test to increase the timeout, if this is a long-running test. See https://jestjs.io/docs/api#testname-fn-timeout.\"\n\n    \u001b[0m \u001b[90m 307 |\u001b[39m     })\u001b[33m;\u001b[39m\n     \u001b[90m 308 |\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 309 |\u001b[39m     test(\u001b[32m'应该控制并发执行数量'\u001b[39m\u001b[33m,\u001b[39m \u001b[36masync\u001b[39m () \u001b[33m=>\u001b[39m {\n     \u001b[90m     |\u001b[39m     \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 310 |\u001b[39m       \u001b[36mlet\u001b[39m activeCalls \u001b[33m=\u001b[39m \u001b[35m0\u001b[39m\u001b[33m;\u001b[39m\n     \u001b[90m 311 |\u001b[39m       \u001b[36mlet\u001b[39m maxActiveCalls \u001b[33m=\u001b[39m \u001b[35m0\u001b[39m\u001b[33m;\u001b[39m\n     \u001b[90m 312 |\u001b[39m       \u001b[0m\n\n      at test (tests/unit/lib/sync-manager.test.ts:309:5)\n      at describe (tests/unit/lib/sync-manager.test.ts:281:3)\n      at Object.describe (tests/unit/lib/sync-manager.test.ts:73:1)\n\n  ● SyncManager › 网络状态处理 › 应该在网络离线时暂停同步\n\n    expect(received).toBeDefined()\n\n    Received: undefined\n\n    \u001b[0m \u001b[90m 357 |\u001b[39m       \n     \u001b[90m 358 |\u001b[39m       \u001b[90m// 确保回调已被设置（构造函数中注册）\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 359 |\u001b[39m       expect(statusChangeCallback)\u001b[33m.\u001b[39mtoBeDefined()\u001b[33m;\u001b[39m\n     \u001b[90m     |\u001b[39m                                    \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 360 |\u001b[39m       \n     \u001b[90m 361 |\u001b[39m       syncManager\u001b[33m.\u001b[39mstart()\u001b[33m;\u001b[39m\n     \u001b[90m 362 |\u001b[39m       \u001b[0m\n\n      at Object.toBeDefined (tests/unit/lib/sync-manager.test.ts:359:36)\n\n  ● SyncManager › 网络状态处理 › 应该在网络恢复时恢复同步\n\n    expect(received).toBeDefined()\n\n    Received: undefined\n\n    \u001b[0m \u001b[90m 383 |\u001b[39m       \n     \u001b[90m 384 |\u001b[39m       \u001b[90m// 确保回调已被设置（构造函数中注册）\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 385 |\u001b[39m       expect(statusChangeCallback)\u001b[33m.\u001b[39mtoBeDefined()\u001b[33m;\u001b[39m\n     \u001b[90m     |\u001b[39m                                    \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 386 |\u001b[39m       \n     \u001b[90m 387 |\u001b[39m       syncManager\u001b[33m.\u001b[39mstart()\u001b[33m;\u001b[39m\n     \u001b[90m 388 |\u001b[39m       syncManager\u001b[33m.\u001b[39mpause()\u001b[33m;\u001b[39m\u001b[0m\n\n      at Object.toBeDefined (tests/unit/lib/sync-manager.test.ts:385:36)\n\n  ● SyncManager › 网络状态处理 › 应该在仅在线模式下跳过离线同步\n\n    expect(jest.fn()).not.toHaveBeenCalled()\n\n    Expected number of calls: 0\n    Received number of calls: 1\n\n    1: {\"data\": {\"name\": \"test\"}, \"id\": \"test-op-123\", \"maxRetries\": 3, \"method\": \"POST\", \"priority\": 2, \"retryCount\": 0, \"status\": \"pending\", \"timestamp\": 1748528095736, \"type\": \"test_operation\", \"url\": \"/api/test\"}\n\n    \u001b[0m \u001b[90m 420 |\u001b[39m       \u001b[36mawait\u001b[39m syncManager\u001b[33m.\u001b[39mtriggerSync()\u001b[33m;\u001b[39m\n     \u001b[90m 421 |\u001b[39m       \n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 422 |\u001b[39m       expect(mockExecutor\u001b[33m.\u001b[39mexecute)\u001b[33m.\u001b[39mnot\u001b[33m.\u001b[39mtoHaveBeenCalled()\u001b[33m;\u001b[39m\n     \u001b[90m     |\u001b[39m                                        \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 423 |\u001b[39m     })\u001b[33m;\u001b[39m\n     \u001b[90m 424 |\u001b[39m   })\u001b[33m;\u001b[39m\n     \u001b[90m 425 |\u001b[39m\u001b[0m\n\n      at Object.toHaveBeenCalled (tests/unit/lib/sync-manager.test.ts:422:40)\n\n  ● SyncManager › 失败操作重试 › 应该定期重试失败的操作\n\n    expect(jest.fn()).toHaveBeenCalledTimes(expected)\n\n    Expected number of calls: 2\n    Received number of calls: 0\n\n    \u001b[0m \u001b[90m 515 |\u001b[39m       \u001b[36mawait\u001b[39m \u001b[33mPromise\u001b[39m\u001b[33m.\u001b[39mresolve()\u001b[33m;\u001b[39m \u001b[90m// 等待异步操作完成\u001b[39m\n     \u001b[90m 516 |\u001b[39m       \n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 517 |\u001b[39m       expect(mockQueue\u001b[33m.\u001b[39mretryOperation)\u001b[33m.\u001b[39mtoHaveBeenCalledTimes(\u001b[35m2\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m     |\u001b[39m                                        \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 518 |\u001b[39m     })\u001b[33m;\u001b[39m\n     \u001b[90m 519 |\u001b[39m\n     \u001b[90m 520 |\u001b[39m     test(\u001b[32m'应该跳过不可重试的失败操作'\u001b[39m\u001b[33m,\u001b[39m \u001b[36masync\u001b[39m () \u001b[33m=>\u001b[39m {\u001b[0m\n\n      at Object.toHaveBeenCalledTimes (tests/unit/lib/sync-manager.test.ts:517:40)\n\n  ● SyncManager › 错误处理 › 应该处理同步过程中的错误\n\n    expect(received).toHaveBeenCalledWith(...expected)\n\n    Matcher error: received value must be a mock or spy function\n\n    Received has type:  function\n    Received has value: [Function anonymous]\n\n    \u001b[0m \u001b[90m 629 |\u001b[39m       \n     \u001b[90m 630 |\u001b[39m       expect(syncManager\u001b[33m.\u001b[39mgetStatus())\u001b[33m.\u001b[39mtoBe(\u001b[33mSyncStatus\u001b[39m\u001b[33m.\u001b[39m\u001b[33mERROR\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 631 |\u001b[39m       expect(consoleMock\u001b[33m.\u001b[39merror)\u001b[33m.\u001b[39mtoHaveBeenCalledWith(\n     \u001b[90m     |\u001b[39m                                 \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 632 |\u001b[39m         expect\u001b[33m.\u001b[39mstringContaining(\u001b[32m'同步过程发生错误'\u001b[39m)\u001b[33m,\u001b[39m\n     \u001b[90m 633 |\u001b[39m         expect\u001b[33m.\u001b[39many(\u001b[33mError\u001b[39m)\n     \u001b[90m 634 |\u001b[39m       )\u001b[33m;\u001b[39m\u001b[0m\n\n      at Object.toHaveBeenCalledWith (tests/unit/lib/sync-manager.test.ts:631:33)\n\n  ● SyncManager › 错误处理 › 应该继续定时同步即使发生错误\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: 2\n    Received: 1\n\n    \u001b[0m \u001b[90m 653 |\u001b[39m       \u001b[36mawait\u001b[39m \u001b[33mPromise\u001b[39m\u001b[33m.\u001b[39mresolve()\u001b[33m;\u001b[39m\n     \u001b[90m 654 |\u001b[39m       \n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 655 |\u001b[39m       expect(callCount)\u001b[33m.\u001b[39mtoBe(\u001b[35m2\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m     |\u001b[39m                         \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 656 |\u001b[39m     })\u001b[33m;\u001b[39m\n     \u001b[90m 657 |\u001b[39m   })\u001b[33m;\u001b[39m\n     \u001b[90m 658 |\u001b[39m\u001b[0m\n\n      at Object.toBe (tests/unit/lib/sync-manager.test.ts:655:25)\n\nTest Suites: 1 failed, 1 of 9 total\nTests:       7 failed, 26 passed, 33 total\nSnapshots:   0 total\nTime:        18.366 s\nRan all test suites.\n"
      ]
    },
    "layer5": {
      "name": "集成功能验证",
      "passed": false,
      "errors": [
        "服务器启动失败"
      ]
    }
  },
  "summary": {
    "totalLayers": 5,
    "passedLayers": 3,
    "overallPassed": false
  }
}