<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>生产加工 - 食品溯源系统</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="assets/styles.css">
    <style>
        :root {
            --primary-color: #1890FF;
            --primary-hover: #40A9FF;
            --primary-active: #096DD9;
            --success-color: #52C41A;
            --success-hover: #73D13D;
            --warning-color: #FA8C16;
            --warning-hover: #FFA940;
            --error-color: #FF4D4F;
            --error-hover: #FF7875;
        }
        
        .bg-icon-primary {
            background-color: #E6F7FF;
        }
        
        .bg-icon-success {
            background-color: #F6FFED;
        }
        
        .bg-icon-warning {
            background-color: #FFF7E6;
        }
        
        .bg-icon-error {
            background-color: #FFF1F0;
        }
        
        .bg-icon-purple {
            background-color: #F9F0FF;
        }
        
        .icon-primary {
            color: var(--primary-color);
        }
        
        .icon-success {
            color: var(--success-color);
        }
        
        .icon-warning {
            color: var(--warning-color);
        }
        
        .icon-error {
            color: var(--error-color);
        }
        
        .icon-purple {
            color: #722ED1;
        }
        
        .quick-btn {
            transition: all 0.3s ease;
        }
        
        .quick-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .progress-bg {
            background-color: #F5F5F5;
        }
        
        .progress-bar {
            background-color: var(--primary-color);
        }
        
        .chart-bar {
            width: 28px;
            background-color: var(--primary-color);
            border-radius: 4px;
            position: relative;
        }
        
        .chart-value {
            position: absolute;
            top: -20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 10px;
            color: var(--text-secondary);
        }
        
        .h-30p { height: 30%; }
        .h-40p { height: 40%; }
        .h-50p { height: 50%; }
        .h-60p { height: 60%; }
        .h-70p { height: 70%; }
        .h-80p { height: 80%; }
        .h-90p { height: 90%; }
        
        .progress-label {
            font-size: 12px;
            margin-bottom: 4px;
            display: flex;
            justify-content: space-between;
        }
        
        .batch-info {
            display: grid;
            grid-template-columns: auto 1fr;
            gap: 8px 16px;
            font-size: 14px;
        }
        
        .batch-info dt {
            color: var(--text-secondary);
            font-weight: normal;
        }
        
        .batch-info dd {
            color: var(--text-primary);
            font-weight: 500;
        }
    </style>
</head>
<body class="bg-[#F0F2F5]">
    <!-- 页面容器 -->
    <div class="page-container">
        <!-- 顶部导航栏 -->
        <header class="app-header">
            <div class="header-container">
                <div class="flex items-center">
                    <a href="home-selector.html" class="nav-icon mr-2">
                        <i class="fas fa-chevron-left text-lg"></i>
                    </a>
                    <span class="header-title">生产加工</span>
                </div>
                <div class="flex items-center">
                    <a href="javascript:void(0)" class="nav-icon" id="refreshBtn">
                        <i class="fas fa-sync-alt"></i>
                    </a>
                    <a href="settings.html" class="nav-icon ml-1">
                        <i class="fas fa-cog text-lg"></i>
                    </a>
                </div>
            </div>
        </header>

        <!-- 主要内容区域 -->
        <main class="content-container">
            <div class="content-area">
                <!-- 用户信息卡片 -->
                <div class="user-card p-4 mb-4">
                    <div class="flex items-center">
                        <div class="user-avatar">
                            <i class="fas fa-user"></i>
                        </div>
                        <div class="ml-3">
                            <h3 class="text-md font-semibold" id="userName">王生产</h3>
                            <p class="text-sm text-gray-500" id="userRole">生产主管</p>
                        </div>
                    </div>
                </div>

                <!-- 当前批次信息 -->
                <div class="content-section">
                    <div class="card">
                        <div class="flex items-center justify-between p-4 border-b border-gray-100">
                            <h2 class="text-lg font-medium flex items-center">
                                <i class="fas fa-box text-primary-color mr-2"></i>
                                当前批次信息
                            </h2>
                            <span class="status-tag info">进行中</span>
                        </div>
                        <div class="p-4">
                            <dl class="batch-info">
                                <dt>批次编号</dt>
                                <dd id="batchNumber">P-2023051205</dd>
                                
                                <dt>开始时间</dt>
                                <dd id="startTime">2023-05-12 08:30</dd>
                                
                                <dt>预计完成</dt>
                                <dd id="estimatedCompletion">2023-05-12 16:30</dd>
                                
                                <dt>加工状态</dt>
                                <dd><span class="status-tag warning">加工中</span></dd>
                            </dl>
                        </div>
                    </div>
                </div>

                <!-- 生产进度 -->
                <div class="content-section">
                    <div class="card">
                        <div class="flex items-center justify-between p-4 border-b border-gray-100">
                            <h2 class="text-lg font-medium flex items-center">
                                <i class="fas fa-tasks text-primary-color mr-2"></i>
                                生产进度
                            </h2>
                            <a href="process-detail.html" class="text-primary-color text-sm flex items-center">
                                详情 <i class="fas fa-chevron-right ml-1 text-xs"></i>
                            </a>
                        </div>
                        <div class="p-4">
                            <div class="mb-4">
                                <div class="progress-label">
                                    <span>屠宰加工</span>
                                    <span>65%</span>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-bar-fill" style="width: 65%"></div>
                                </div>
                            </div>
                            
                            <div class="mb-4">
                                <div class="progress-label">
                                    <span>品质检验</span>
                                    <span>40%</span>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-bar-fill" style="width: 40%"></div>
                                </div>
                            </div>
                            
                            <div>
                                <div class="progress-label">
                                    <span>包装入库</span>
                                    <span>15%</span>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-bar-fill" style="width: 15%"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 质量检测指标 -->
                <div class="content-section">
                    <div class="card">
                        <div class="flex items-center justify-between p-4 border-b border-gray-100">
                            <h2 class="text-lg font-medium flex items-center">
                                <i class="fas fa-vial text-primary-color mr-2"></i>
                                质量检测指标
                            </h2>
                            <span class="status-tag success">合格</span>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead>
                                    <tr class="text-left bg-gray-50">
                                        <th class="py-2 px-4 text-sm font-medium">检测项目</th>
                                        <th class="py-2 px-4 text-sm font-medium">检测值</th>
                                        <th class="py-2 px-3 text-sm font-medium">标准范围</th>
                                        <th class="py-2 px-3 text-sm font-medium">状态</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr class="border-t border-gray-100">
                                        <td class="py-3 px-4 text-sm">PH值</td>
                                        <td class="py-3 px-4 text-sm">5.8</td>
                                        <td class="py-3 px-3 text-sm">5.6-6.2</td>
                                        <td class="py-3 px-3 text-sm">
                                            <span class="status-tag success">合格</span>
                                        </td>
                                    </tr>
                                    <tr class="border-t border-gray-100">
                                        <td class="py-3 px-4 text-sm">水分含量</td>
                                        <td class="py-3 px-4 text-sm">72.5%</td>
                                        <td class="py-3 px-3 text-sm">≤75%</td>
                                        <td class="py-3 px-3 text-sm">
                                            <span class="status-tag success">合格</span>
                                        </td>
                                    </tr>
                                    <tr class="border-t border-gray-100">
                                        <td class="py-3 px-4 text-sm">蛋白质</td>
                                        <td class="py-3 px-4 text-sm">21.3%</td>
                                        <td class="py-3 px-3 text-sm">≥20%</td>
                                        <td class="py-3 px-3 text-sm">
                                            <span class="status-tag success">合格</span>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- 快捷操作 -->
                <div class="content-section mb-6">
                    <h2 class="text-lg font-medium mb-3 flex items-center">
                        <i class="fas fa-bolt text-primary-color mr-2"></i>
                        快捷操作
                    </h2>
                    <div class="grid grid-cols-2 gap-4">
                        <button class="module-card p-4" id="slaughterBtn">
                            <div class="module-icon bg-icon-bg-primary mb-3 mx-auto">
                                <i class="fas fa-cut text-primary-color text-xl"></i>
                            </div>
                            <p class="text-center text-sm">屠宰信息录入</p>
                        </button>
                        <button class="module-card p-4" id="qualityBtn">
                            <div class="module-icon bg-icon-bg-success mb-3 mx-auto">
                                <i class="fas fa-clipboard-check text-success text-xl"></i>
                            </div>
                            <p class="text-center text-sm">肉质等级评定</p>
                        </button>
                        <button class="module-card p-4" id="environmentBtn">
                            <div class="module-icon bg-icon-bg-warning mb-3 mx-auto">
                                <i class="fas fa-camera text-warning text-xl"></i>
                            </div>
                            <p class="text-center text-sm">加工环境拍照</p>
                        </button>
                        <button class="module-card p-4" id="reportBtn">
                            <div class="module-icon bg-icon-bg-purple mb-3 mx-auto">
                                <i class="fas fa-file-alt text-purple-color text-xl"></i>
                            </div>
                            <p class="text-center text-sm">质检报告查阅</p>
                        </button>
                    </div>
                </div>
            </div>
        </main>

        <!-- 底部导航栏 -->
        <footer class="app-footer">
            <div class="footer-container">
                <a href="home-selector.html" class="tab-item">
                    <i class="fas fa-home text-xl"></i>
                    <span class="text-xs mt-1">首页</span>
                </a>
                <a href="trace-list.html" class="tab-item">
                    <i class="fas fa-list text-xl"></i>
                    <span class="text-xs mt-1">记录</span>
                </a>
                <a href="trace-map.html" class="tab-item">
                    <i class="fas fa-map-marker-alt text-xl"></i>
                    <span class="text-xs mt-1">地图</span>
                </a>
                <a href="profile.html" class="tab-item">
                    <i class="fas fa-user text-xl"></i>
                    <span class="text-xs mt-1">我的</span>
                </a>
            </div>
        </footer>
    </div>

    <!-- 通用JS脚本 -->
    <script src="components/trace-common.js"></script>
    
    <!-- 页面特定脚本 -->
    <script>
        // 当页面加载完成时
        document.addEventListener('DOMContentLoaded', function() {
            // 初始化页面
            initPage();
            
            // 绑定事件
            document.getElementById('refreshBtn').addEventListener('click', function() {
                refreshData();
            });
            
            document.getElementById('slaughterBtn').addEventListener('click', function() {
                if (traceAuth.hasPermission('processing.slaughter')) {
                    window.location.href = 'processing-slaughter.html';
                } else {
                    traceUI.showToast('您没有屠宰信息录入权限', 'error');
                }
            });
            
            document.getElementById('qualityBtn').addEventListener('click', function() {
                if (traceAuth.hasPermission('processing.quality')) {
                    window.location.href = 'processing-quality.html';
                } else {
                    traceUI.showToast('您没有肉质等级评定权限', 'error');
                }
            });
            
            document.getElementById('environmentBtn').addEventListener('click', function() {
                if (traceAuth.hasPermission('processing.environment')) {
                    window.location.href = 'processing-environment.html';
                } else {
                    traceUI.showToast('您没有拍照权限', 'error');
                }
            });
            
            document.getElementById('reportBtn').addEventListener('click', function() {
                if (traceAuth.hasPermission('processing.report')) {
                    window.location.href = 'processing-reports.html';
                } else {
                    traceUI.showToast('您没有报告查阅权限', 'error');
                }
            });
            
            // 权限检查
            checkActionPermissions();
            
            // 调整内容区域的填充，确保不被导航栏遮挡
            adjustMainPadding();
            
            // 监听窗口大小变化，重新调整填充
            window.addEventListener('resize', adjustMainPadding);
        });
        
        /**
         * 初始化页面
         */
        function initPage() {
            // 根据当前页面设置底部导航激活状态
            setActiveNavItem();
            
            // 加载用户数据
            loadUserData();
        }
        
        /**
         * 设置当前激活的导航项
         */
        function setActiveNavItem() {
            // 获取当前页面路径
            const currentPath = window.location.pathname;
            
            // 获取所有导航项
            const navItems = document.querySelectorAll('.tab-item');
            
            // 移除所有激活状态
            navItems.forEach(item => {
                item.classList.remove('active');
            });
            
            // 默认首页激活
            const homeNav = document.querySelector('.tab-item:nth-child(1)');
            if (homeNav) {
                homeNav.classList.add('active');
            }
        }
        
        /**
         * 动态调整主内容区域的填充，确保在所有设备下内容不被导航栏遮挡
         */
        function adjustMainPadding() {
            const mainElement = document.querySelector('.content-container');
            if (!mainElement) return;
            
            // 获取CSS变量值或使用默认值
            const navHeight = parseInt(getComputedStyle(document.documentElement).getPropertyValue('--nav-height')) || 64;
            const bottomTabHeight = parseInt(getComputedStyle(document.documentElement).getPropertyValue('--bottom-tab-height')) || 60;
            
            // 计算合适的填充值（顶部导航高度 + 安全间距）
            const topPadding = navHeight + 16;
            const bottomPadding = bottomTabHeight + 20; // 添加额外安全间距
            
            // 应用填充值
            mainElement.style.paddingTop = `${topPadding}px`;
            mainElement.style.paddingBottom = `${bottomPadding}px`;
        }
        
        /**
         * 刷新数据
         */
        function refreshData() {
            const refreshBtn = document.getElementById('refreshBtn');
            traceUI.showLoading(refreshBtn);
            
            // 模拟数据刷新
            setTimeout(() => {
                loadUserData();
                traceUI.hideLoading(refreshBtn);
                traceUI.showToast('数据已更新', 'success');
            }, 1000);
        }
        
        /**
         * 加载用户数据
         */
        function loadUserData() {
            // 模拟用户数据
            const userData = {
                name: '王生产',
                role: '生产主管',
                permissions: ['processing.slaughter', 'processing.quality', 'processing.environment', 'processing.report']
            };
            
            // 更新用户信息
            document.getElementById('userName').textContent = userData.name;
            document.getElementById('userRole').textContent = userData.role;
            
            // 模拟权限存储
            if (!traceAuth.isAuthenticated()) {
                traceAuth.login({
                    id: '003',
                    name: userData.name,
                    role: userData.role,
                    permissions: userData.permissions
                });
            }
        }
        
        /**
         * 检查按钮权限
         */
        function checkActionPermissions() {
            // 检查按钮权限
            const buttons = [
                { id: 'slaughterBtn', permission: 'processing.slaughter' },
                { id: 'qualityBtn', permission: 'processing.quality' },
                { id: 'environmentBtn', permission: 'processing.environment' },
                { id: 'reportBtn', permission: 'processing.report' }
            ];
            
            buttons.forEach(btn => {
                const buttonElement = document.getElementById(btn.id);
                if (buttonElement && !traceAuth.hasPermission(btn.permission)) {
                    buttonElement.classList.add('disabled');
                    
                    // 添加锁图标
                    const lockIcon = document.createElement('i');
                    lockIcon.className = 'fas fa-lock text-gray-400 absolute top-2 right-2 text-xs';
                    buttonElement.style.position = 'relative';
                    buttonElement.appendChild(lockIcon);
                }
            });
        }
    </script>
</body>
</html> 