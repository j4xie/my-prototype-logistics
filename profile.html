<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>个人中心 - 食品溯源系统</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="stylesheet" href="assets/styles.css">
    <script type="module" src="components/trace-error-handler.js"></script>
    <script type="module" src="components/trace-store.js"></script>
    <script type="module" src="components/trace-ux.js"></script>
    <script type="module" src="components/trace-a11y.js"></script>
    
    <script type="module">
        import { traceStore } from './components/trace-store.js';
        import { traceErrorHandler } from './components/trace-error-handler.js';
        
        document.addEventListener('DOMContentLoaded', () => {
            const isInIframe = window !== window.parent;
            
            if (!traceStore.user.isAuthenticated) {
                if (!isInIframe) {
                    window.location.href = 'login.html';
                }
                return;
            }
            
            updatePageState(traceStore.user);
            
            // 设置退出登录事件
            const logoutBtn = document.getElementById('logout-btn');
            if (logoutBtn) {
                logoutBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    traceStore.logout();
                    
                    window.parent.postMessage({
                        type: 'LOGOUT'
                    }, window.location.origin);
                    
                    if (!isInIframe) {
                        window.location.href = 'login.html';
                    }
                });
            }
        });
        
        function updatePageState(user) {
            const userNameEl = document.getElementById('user-name');
            const userRoleEl = document.getElementById('user-role');
            const userEmailEl = document.getElementById('user-email');
            
            if (userNameEl) userNameEl.textContent = user.name || '未知用户';
            if (userRoleEl) userRoleEl.textContent = user.role === 'admin' ? '管理员' : '普通用户';
            if (userEmailEl) userEmailEl.textContent = user.email || '未设置邮箱';
        }
    </script>
</head>
<body class="bg-[#F7F8FA]">
    <div class="max-w-[390px] mx-auto min-h-screen pb-16">
        <div class="bg-[#1890FF] text-white pt-12 px-5 pb-8 rounded-b-2xl shadow-md">
            <div class="flex items-center mb-6">
                <div id="user-avatar" class="w-16 h-16 rounded-full bg-white/30 mr-4 flex items-center justify-center">
                    <i class="fas fa-user text-2xl text-white"></i>
                </div>
                <div>
                    <h2 id="user-name" class="text-xl font-medium text-white">加载中...</h2>
                    <p id="user-role" class="text-sm text-white/90 mt-1">加载中...</p>
                    <p id="user-email" class="text-sm text-white/90 mt-1">加载中...</p>
                </div>
            </div>
        </div>

        <div class="px-5 mt-6">
            <div class="bg-white rounded-xl shadow-sm divide-y">
                <a href="profile-edit.html" class="flex items-center justify-between p-4">
                    <div class="flex items-center">
                        <div class="w-10 h-10 rounded-full bg-blue-50 flex items-center justify-center mr-3">
                            <i class="fas fa-user-edit text-[#1890FF]"></i>
                        </div>
                        <span class="font-medium">编辑资料</span>
                    </div>
                    <i class="fas fa-chevron-right text-gray-400"></i>
                </a>
                
                <a href="change-password.html" class="flex items-center justify-between p-4">
                    <div class="flex items-center">
                        <div class="w-10 h-10 rounded-full bg-blue-50 flex items-center justify-center mr-3">
                            <i class="fas fa-lock text-[#1890FF]"></i>
                        </div>
                        <span class="font-medium">修改密码</span>
                    </div>
                    <i class="fas fa-chevron-right text-gray-400"></i>
                </a>
                
                <a href="notifications.html" class="flex items-center justify-between p-4">
                    <div class="flex items-center">
                        <div class="w-10 h-10 rounded-full bg-blue-50 flex items-center justify-center mr-3">
                            <i class="fas fa-bell text-[#1890FF]"></i>
                        </div>
                        <span class="font-medium">消息通知</span>
                    </div>
                    <i class="fas fa-chevron-right text-gray-400"></i>
                </a>
                
                <a href="settings.html" class="flex items-center justify-between p-4">
                    <div class="flex items-center">
                        <div class="w-10 h-10 rounded-full bg-blue-50 flex items-center justify-center mr-3">
                            <i class="fas fa-cog text-[#1890FF]"></i>
                        </div>
                        <span class="font-medium">系统设置</span>
                    </div>
                    <i class="fas fa-chevron-right text-gray-400"></i>
                </a>
            </div>
            
            <button id="logout-btn" class="w-full bg-white text-red-500 font-medium py-4 rounded-xl shadow-sm mt-6 hover:bg-red-50 transition-colors">
                退出登录
            </button>
        </div>

        <div class="trace-tabbar">
            <a href="home-selector.html" class="trace-tabbar-item">
                <i class="fas fa-home"></i>
                <span>首页</span>
            </a>
            <a href="trace-list.html" class="trace-tabbar-item">
                <i class="fas fa-list"></i>
                <span>记录</span>
            </a>
            <a href="create-trace.html" class="trace-tabbar-item">
                <div class="w-14 h-14 rounded-full bg-[#00467F] flex items-center justify-center -mt-5 shadow-lg">
                    <i class="fas fa-plus text-white text-lg"></i>
                </div>
            </a>
            <a href="trace-map.html" class="trace-tabbar-item">
                <i class="fas fa-map-marker-alt"></i>
                <span>地图</span>
            </a>
            <a href="profile.html" class="trace-tabbar-item active">
                <i class="fas fa-user"></i>
                <span>我的</span>
            </a>
        </div>
    </div>
</body>
</html> 