# 前端集成测试指南

## 📱 前端配置状态

前端已经正确配置指向宝塔服务器：

```typescript
// 默认 API 地址
API_BASE_URL = 'http://139.196.165.140:10010'

// 默认工厂 ID
DEFAULT_FACTORY_ID = 'CRETAS_2024_001'
```

---

## 🚀 启动前端

### 方式1️⃣: 生产环境（推荐）

```bash
cd /Users/jietaoxie/my-prototype-logistics/frontend/CretasFoodTrace
npm start:production
```

### 方式2️⃣: 测试环境

```bash
npm start:test
```

### 方式3️⃣: 本地开发环境

```bash
npm start:local
```

---

## 🧪 前端测试清单

### 【第1步】启动前端应用

执行上面的启动命令之一，等待应用在浏览器打开（通常是 `http://localhost:3010`）。

---

### 【第2步】测试登录流程

1. **打开应用** → 会自动跳转到登录界面
2. **输入账号**: `super_admin`
3. **输入密码**: `123456`
4. **点击登录** → 应该能成功登录

**预期结果**:
- ✅ 登录成功
- ✅ 跳转到首页/仪表板
- ✅ 显示用户名 "super_admin"
- ✅ Token 保存到本地存储

---

### 【第3步】测试业务接口

登录成功后，测试以下模块：

#### 1. 材料批次模块
- 点击菜单 → 材料批次（或类似选项）
- 应该能加载并显示材料批次列表
- 检查网络请求: `GET /api/mobile/CRETAS_2024_001/material-batches`

#### 2. 生产批次模块
- 点击菜单 → 生产批次
- 应该能加载并显示生产批次列表
- 检查网络请求: `GET /api/mobile/CRETAS_2024_001/production-batches`

#### 3. 设备管理模块
- 点击菜单 → 设备
- 应该能加载并显示设备列表
- 检查网络请求: `GET /api/mobile/CRETAS_2024_001/equipment`

#### 4. 质检记录模块
- 点击菜单 → 质检或质量检验
- 应该能加载并显示质检记录
- 检查网络请求: `GET /api/mobile/CRETAS_2024_001/quality-inspections`

---

### 【第4步】测试 AI 成本分析功能（核心测试）

这是最重要的测试，验证完整的 **前端 → Java 后端 → AI 服务** 链路：

#### 4.1 找到成本分析界面
- 通常在批次详情页或专门的分析页面
- 寻找 "成本分析"、"AI 分析"、"智能分析" 等选项

#### 4.2 触发成本分析
- 选择一个批次或输入成本数据
- 点击 "分析" 或 "开始分析" 按钮

#### 4.3 观察结果
**预期显示**:
- ✅ 加载动画（表示请求在处理）
- ✅ AI 返回的分析结果文本
- ✅ 包括成本结构分析、优化建议等

**检查网络请求**:
- 打开浏览器开发者工具 (F12)
- 找到请求: `POST /api/mobile/CRETAS_2024_001/ai/analysis/cost/batch`
- 查看响应状态: 应该是 `200`
- 查看响应体: 应该包含 `"code": 200` 和 AI 分析结果

---

## 🔍 浏览器开发者工具调试

### 打开开发者工具

**Windows/Linux**: `F12` 或 `Ctrl + Shift + I`
**Mac**: `Cmd + Option + I`

### 查看网络请求

1. 打开 **Network** 标签
2. 清空旧请求（点击垃圾桶图标）
3. 在前端执行操作
4. 观察新的网络请求

### 查看API返回

1. 找到 API 请求（如 `cost/batch`）
2. 点击请求
3. 查看 **Response** 标签
4. 应该看到 JSON 响应

**正常的响应示例**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "success": true,
    "aiAnalysis": "【**成本结构分析**】\n\n根据批次的成本数据...",
    "sessionId": "session_xxx",
    "messageCount": 1
  }
}
```

---

## ✅ 完整的测试检查清单

- [ ] **登录功能**
  - [ ] 能成功登录
  - [ ] 显示用户信息
  - [ ] Token 保存正确

- [ ] **材料批次接口**
  - [ ] 能加载列表
  - [ ] 网络状态 200
  - [ ] 数据显示正确

- [ ] **生产批次接口**
  - [ ] 能加载列表
  - [ ] 网络状态 200
  - [ ] 数据显示正确

- [ ] **设备管理接口**
  - [ ] 能加载列表
  - [ ] 网络状态 200
  - [ ] 数据显示正确

- [ ] **质检记录接口**
  - [ ] 能加载列表
  - [ ] 网络状态 200
  - [ ] 数据显示正确

- [ ] **AI 成本分析接口** ⭐ 最重要
  - [ ] 能触发分析
  - [ ] 网络请求发送正确
  - [ ] 响应状态 200
  - [ ] 返回 AI 分析结果
  - [ ] 没有错误消息

---

## 🐛 常见问题排查

### Q1: 前端无法连接到后端

**症状**: 所有接口都返回连接错误

**检查**:
```bash
# 检查后端是否运行
lsof -i :10010

# 检查防火墙
# 确保 10010 端口已开放
```

### Q2: 登录返回 404

**症状**: 登录请求返回 404

**检查**:
- 后端登录接口是否是 `/api/mobile/auth/unified-login`
- Token 是否正确保存

### Q3: AI 分析返回错误

**症状**: 调用 `/ai/analysis/cost/batch` 返回错误

**检查**:
```bash
# 1. 检查 AI 服务是否运行
lsof -i :8085

# 2. 查看 AI 服务日志
tail -50 /www/wwwroot/project/logs/ai-service.log

# 3. 查看 Java 后端日志
tail -50 /www/wwwroot/project/logs/cretas-backend.log
```

### Q4: 前端显示旧数据或缓存问题

**解决**:
```bash
# 清除浏览器缓存
# 或使用无痕窗口

# 或强制刷新
Ctrl + Shift + Delete (Windows)
Cmd + Shift + Delete (Mac)
```

---

## 📊 测试结果记录

### 表格: 前端接口测试结果

| 接口 | 请求方式 | 路径 | 状态 | 响应时间 | 备注 |
|------|---------|------|------|---------|------|
| 登录 | POST | `/api/mobile/auth/unified-login` | ✅ | - | 获取 Token |
| 材料批次 | GET | `/api/mobile/CRETAS_2024_001/material-batches` | - | - | 待测试 |
| 生产批次 | GET | `/api/mobile/CRETAS_2024_001/production-batches` | - | - | 待测试 |
| 设备列表 | GET | `/api/mobile/CRETAS_2024_001/equipment` | - | - | 待测试 |
| 质检记录 | GET | `/api/mobile/CRETAS_2024_001/quality-inspections` | - | - | 待测试 |
| **AI 成本分析** | **POST** | **`/api/mobile/CRETAS_2024_001/ai/analysis/cost/batch`** | **-** | **-** | **最关键** |

---

## 🎯 测试完成标准

**全部通过** ✅:
- 所有接口都能成功调用（HTTP 200）
- 数据能正确显示
- AI 分析能返回结果
- 没有错误消息

**部分失败** ⚠️:
- 某些接口返回错误
- 需要查看日志排查原因

**全部失败** ❌:
- 无法连接到后端
- 需要检查后端是否在运行
- 需要检查网络和防火墙配置

---

## 📝 测试报告模板

完成测试后，记录以下信息：

```
【前端集成测试报告】

测试时间: 2025-11-22
测试人员: [你的名字]
测试环境: 宝塔服务器 (139.196.165.140:10010)

【登录模块】
- 状态: ✅ / ⚠️ / ❌
- 备注:

【材料批次】
- 状态: ✅ / ⚠️ / ❌
- 备注:

【生产批次】
- 状态: ✅ / ⚠️ / ❌
- 备注:

【设备管理】
- 状态: ✅ / ⚠️ / ❌
- 备注:

【质检记录】
- 状态: ✅ / ⚠️ / ❌
- 备注:

【AI 成本分析】(最关键)
- 状态: ✅ / ⚠️ / ❌
- 响应时间: xxxx ms
- 备注:

【整体评价】
- 总体通过率: xx%
- 存在的问题:
- 优化建议:
```

---

**现在就启动前端，开始集成测试吧！** 🚀
