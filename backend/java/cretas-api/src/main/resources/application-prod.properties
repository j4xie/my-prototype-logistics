# ===================================
# 生产环境配置 (宝塔服务器)
# ===================================

# 应用配置
spring.application.name=Cretas Backend System
server.port=10010

# 数据库配置 (生产环境 - 新数据库 creats-test)
spring.datasource.url=jdbc:mysql://localhost:3306/creats-test?useUnicode=true&characterEncoding=utf8&useSSL=false&serverTimezone=Asia/Shanghai
spring.datasource.username=creats-test
spring.datasource.password=${DB_PASSWORD}
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver

# JPA配置 - 生产环境安全设置
# validate: 只验证表结构，不会修改
# none: 完全不检查和修改表结构
spring.jpa.hibernate.ddl-auto=validate
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MySQL8Dialect
spring.jpa.properties.hibernate.format_sql=false
spring.jpa.defer-datasource-initialization=false

# SQL初始化 - 生产环境禁用
spring.sql.init.mode=never

# 日志配置 - 生产环境精简
logging.level.root=WARN
logging.level.com.cretas.aims=INFO
logging.pattern.console=%d{yyyy-MM-dd HH:mm:ss} - %msg%n

# 文件上传配置
spring.servlet.multipart.enabled=true
spring.servlet.multipart.max-file-size=50MB
spring.servlet.multipart.max-request-size=50MB

# Jackson 配置
spring.jackson.time-zone=GMT+8
spring.jackson.date-format=yyyy-MM-dd HH:mm:ss
spring.jackson.serialization.write-dates-as-timestamps=false
spring.jackson.serialization.fail-on-empty-beans=false

# JWT配置
cretas.jwt.secret=cretas-food-traceability-system-secret-key-2025-do-not-change-in-production
cretas.jwt.expiration=86400000
cretas.jwt.refresh-expiration=2592000000

# AI服务配置 (生产环境)
cretas.ai.service.url=http://139.196.165.140:8083
cretas.ai.service.timeout=120000
cretas.ai.service.connect-timeout=10000

# AI意图自动学习配置
cretas.ai.intent.auto-learn.enabled=true
cretas.ai.intent.auto-learn.confidence-threshold=0.9
cretas.ai.intent.auto-learn.max-keywords-per-intent=50

# ==========================================
# AI 语义路由器配置 (SemanticRouterService)
# ==========================================
cretas.ai.semantic-router.enabled=true
cretas.router.threshold.direct-execute=0.92
cretas.router.threshold.reranking=0.75
cretas.router.default-top-n=5

# ==========================================
# Embedding 服务配置
# ==========================================
# 模式选择:
#   grpc - 使用独立的 embedding-service (gRPC 调用)
#   其他值 - 使用 NoOpEmbeddingClient (语义匹配禁用)
#
# 生产环境：启用 embedding 服务 (gRPC)
# v13.0: A/B Test - 测试 embedding 对意图识别准确率的影响
embedding.mode=grpc
grpc.client.embedding-service.address=static://localhost:9090
grpc.client.embedding-service.negotiationType=plaintext

# 禁用Redis和Security自动配置
spring.autoconfigure.exclude=org.springframework.boot.autoconfigure.data.redis.RedisAutoConfiguration,org.springframework.boot.autoconfigure.security.servlet.SecurityAutoConfiguration

# ==========================================
# Python SmartBI 服务配置 (生产环境)
# ==========================================
# SmartBI 所有功能完全由 Python 服务 (端口 8083) 处理
# 包括：Excel 解析、字段映射 (LLM)、数据分析、图表生成、AI 洞察
# 不再有 Java fallback，Python 服务必须可用
python-smartbi.enabled=true
python-smartbi.url=http://localhost:8083
python-smartbi.timeout=60000
python-smartbi.connect-timeout=10000
python-smartbi.fallback-on-error=false
python-smartbi.health-check-interval=30000
python-smartbi.max-retries=3

# ==========================================
# SmartBI PostgreSQL 配置
# ==========================================
smartbi.postgres.enabled=true
smartbi.postgres.url=jdbc:postgresql://localhost:5432/smartbi_db
smartbi.postgres.username=smartbi_user
smartbi.postgres.password=smartbi_secure_password_2025
smartbi.postgres.driver-class-name=org.postgresql.Driver
smartbi.postgres.hikari.pool-name=SmartBIPostgresPool
smartbi.postgres.hikari.maximum-pool-size=10
smartbi.postgres.hikari.minimum-idle=2

# ==========================================
# Python 意图分类器配置 (生产环境)
# ==========================================
# 使用 chinese-roberta-wwm-ext 微调模型
# 准确率: 97.45% Top-1, 99.68% Top-3
python-classifier.enabled=true
python-classifier.url=http://localhost:8083
python-classifier.timeout=10000
python-classifier.connect-timeout=3000
python-classifier.health-check-interval=30000
python-classifier.weight=0.6
python-classifier.top-k=5
python-classifier.min-confidence=0.1
python-classifier.high-confidence-threshold=0.70
