<!--
  - Copyright (C) 2018-2019
  - 食品商城小程序
  - 注意：
  - 基于 JooLun 框架二次开发
-->
<!-- 顶部导航栏 - 黑底金字 -->
<view class="header-bar">
  <view class="logo">
    <text class="logo-b">B</text>
    <text class="logo-and">&</text>
    <text class="logo-f">F</text>
  </view>
  <view class="header-search" bindtap="goSearch">
    <text class="cuIcon-search"></text>
    <text class="search-placeholder">搜索商品</text>
  </view>
</view>

<view class="page-content">
  <!-- 通知栏 - 浅金背景 -->
  <view class="notice-bar">
    <text class="cuIcon-notice"></text>
    <swiper class="notice-swiper" autoplay="true" circular="true" vertical="true" interval="4000">
      <swiper-item>
        <text class="notice-text">欢迎使用白垩纪食品溯源商城</text>
      </swiper-item>
      <swiper-item>
        <text class="notice-text">扫码即可查看商品溯源信息</text>
      </swiper-item>
      <swiper-item>
        <text class="notice-text">联系电话：13916928096</text>
      </swiper-item>
    </swiper>
  </view>

  <!-- 食品分类网格 - 10个分类 -->
  <view class="category-section">
    <view class="category-grid">
      <navigator class="category-item" hover-class="none" url='/pages/goods/goods-list/index?categoryFirst=FOOD_CAT_001'>
        <view class="category-icon-box">
          <text class="category-icon-text">牛</text>
        </view>
        <text class="category-name">牛羊肉类</text>
      </navigator>
      <navigator class="category-item" hover-class="none" url='/pages/goods/goods-list/index?categoryFirst=FOOD_CAT_002'>
        <view class="category-icon-box">
          <text class="category-icon-text">禽</text>
        </view>
        <text class="category-name">家禽蛋副</text>
      </navigator>
      <navigator class="category-item" hover-class="none" url='/pages/goods/goods-list/index?categoryFirst=FOOD_CAT_003'>
        <view class="category-icon-box">
          <text class="category-icon-text">调</text>
        </view>
        <text class="category-name">调理肉类</text>
      </navigator>
      <navigator class="category-item" hover-class="none" url='/pages/goods/goods-list/index?categoryFirst=FOOD_CAT_004'>
        <view class="category-icon-box">
          <text class="category-icon-text">罐</text>
        </view>
        <text class="category-name">肉肠罐头</text>
      </navigator>
      <navigator class="category-item" hover-class="none" url='/pages/goods/goods-list/index?categoryFirst=FOOD_CAT_005'>
        <view class="category-icon-box">
          <text class="category-icon-text">鲜</text>
        </view>
        <text class="category-name">海鲜水产</text>
      </navigator>
      <navigator class="category-item" hover-class="none" url='/pages/goods/goods-list/index?categoryFirst=FOOD_CAT_006'>
        <view class="category-icon-box">
          <text class="category-icon-text">蔬</text>
        </view>
        <text class="category-name">蔬菜菌菇</text>
      </navigator>
      <navigator class="category-item" hover-class="none" url='/pages/goods/goods-list/index?categoryFirst=FOOD_CAT_007'>
        <view class="category-icon-box">
          <text class="category-icon-text">面</text>
        </view>
        <text class="category-name">米面制品</text>
      </navigator>
      <navigator class="category-item" hover-class="none" url='/pages/goods/goods-list/index?categoryFirst=FOOD_CAT_008'>
        <view class="category-icon-box">
          <text class="category-icon-text">点</text>
        </view>
        <text class="category-name">小吃点心</text>
      </navigator>
      <navigator class="category-item" hover-class="none" url='/pages/goods/goods-list/index?categoryFirst=FOOD_CAT_009'>
        <view class="category-icon-box">
          <text class="category-icon-text">水</text>
        </view>
        <text class="category-name">水发产品</text>
      </navigator>
      <navigator class="category-item" hover-class="none" url='/pages/goods/goods-list/index'>
        <view class="category-icon-box category-all">
          <text class="cuIcon-apps category-icon-cuicon"></text>
        </view>
        <text class="category-name">所有分类</text>
      </navigator>
    </view>
  </view>

  <!-- Banner轮播 -->
  <view class="banner-section">
    <swiper class="banner-swiper" indicator-dots="true" circular="true" autoplay="true" interval="5000" duration="500" bindchange="onBannerChange" indicator-color="rgba(212, 175, 55, 0.3)" indicator-active-color="#D4AF37">
      <swiper-item wx:for="{{swiperData}}" wx:key="index" bindtap="onBannerClick" data-index="{{index}}">
        <image class="banner-image" src="{{item}}" mode="aspectFill" binderror="onBannerImageError" data-index="{{index}}"></image>
      </swiper-item>
    </swiper>
  </view>

  <!-- 快捷功能入口 -->
  <view class="quick-actions">
    <navigator class="quick-action-item" hover-class="none" url='/pages/traceability/scan/index'>
      <view class="quick-action-icon trace-icon">
        <text class="cuIcon-scan"></text>
      </view>
      <view class="quick-action-text">
        <text class="quick-action-title">扫码溯源</text>
        <text class="quick-action-desc">查看商品来源</text>
      </view>
      <text class="cuIcon-right"></text>
    </navigator>
    <navigator class="quick-action-item" hover-class="none" url='/pages/ai-rag/chat/index'>
      <view class="quick-action-icon ai-icon">
        <text class="cuIcon-message"></text>
      </view>
      <view class="quick-action-text">
        <text class="quick-action-title">AI助手</text>
        <text class="quick-action-desc">智能问答服务</text>
      </view>
      <text class="cuIcon-right"></text>
    </navigator>
  </view>

  <!-- 推荐商品 -->
  <view class="section-header">
    <view class="section-title">
      <view class="title-decoration"></view>
      <text>热销单品</text>
    </view>
    <navigator hover-class="none" url='/pages/goods/goods-list/index?type=2' class='section-more'>
      <text>更多</text>
      <text class='cuIcon-right'></text>
    </navigator>
  </view>

  <view class='goods-scroll-wrapper'>
    <scroll-view class="goods-scroll" scroll-x>
      <block wx:for="{{goodsListHot}}" wx:key="index">
        <navigator hover-class="none" url='/pages/goods/goods-detail/index?id={{item.id}}' class='goods-card'>
          <view class='goods-img-box'>
            <image src="{{item.picUrls[0] ? item.picUrls[0] : '/public/img/no_pic.png'}}" mode="aspectFill"></image>
          </view>
          <view class="goods-info">
            <text class='goods-name'>{{item.name}}</text>
            <text class='goods-desc'>{{item.sellPoint}}</text>
            <view class="goods-price-row">
              <!-- 已登录显示价格 -->
              <text wx:if="{{isLoggedIn}}" class="goods-price"><text class="price-symbol">¥</text>{{item.salesPrice}}</text>
              <!-- 未登录显示登录提示 -->
              <text wx:else class="price-login-hint" catchtap="goToLogin">登录查看价格</text>
              <view class="goods-buy-btn">购买</view>
            </view>
          </view>
        </navigator>
      </block>
    </scroll-view>
  </view>

  <!-- 猜你喜欢 - 个性化推荐模块 -->
  <view class="section-header">
    <view class="section-title">
      <view class="title-decoration"></view>
      <text>猜你喜欢</text>
      <!-- 个性化推荐标签 -->
      <view class="recommend-tag" wx:if="{{usePersonalized}}">
        <text class="cuIcon-likefill"></text>
        <text>为你推荐</text>
      </view>
    </view>
    <!-- 刷新按钮 -->
    <view class="refresh-btn" bindtap="refresh" wx:if="{{isLoggedIn}}">
      <text class="cuIcon-refresh"></text>
      <text>换一批</text>
    </view>
  </view>

  <!-- 推荐商品列表 -->
  <view class="recommend-list" wx:if="{{recommendList.length > 0}}">
    <view class="recommend-grid">
      <view class="recommend-item" wx:for="{{recommendList}}" wx:key="id" data-product="{{item}}" bindtap="onRecommendClick">
        <view class="recommend-img-box">
          <image src="{{item.picUrls[0] ? item.picUrls[0] : '/public/img/no_pic.png'}}" mode="aspectFill"></image>
          <!-- 推荐理由标签 -->
          <view class="recommend-reason" wx:if="{{item.recommendReason}}">
            <text>{{item.recommendReason}}</text>
          </view>
          <!-- 探索标签 -->
          <view class="explore-tag" wx:if="{{item.isExploration}}">
            <text>新发现</text>
          </view>
        </view>
        <view class="recommend-info">
          <text class="recommend-name">{{item.name}}</text>
          <text class="recommend-desc">{{item.sellPoint}}</text>
          <view class="recommend-price-row">
            <!-- 已登录显示价格 -->
            <text wx:if="{{isLoggedIn}}" class="recommend-price"><text class="price-symbol">¥</text>{{item.salesPrice}}</text>
            <!-- 未登录显示登录提示 -->
            <text wx:else class="price-login-hint" catchtap="goToLogin">登录查看价格</text>
            <view class="recommend-buy-btn">购买</view>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- 未登录或无推荐时显示普通商品列表 -->
  <view wx:if="{{recommendList.length === 0}}">
    <goods-card goodsList="{{goodsList}}" isLoggedIn="{{isLoggedIn}}"/>
  </view>

  <!-- 加载状态 -->
  <view class="cu-load" wx:if="{{usePersonalized}}">
    <view wx:if="{{recommendLoading}}" class="loading">加载中...</view>
    <view wx:elif="{{!hasMoreRecommend}}" class="over">— 已经到底了 —</view>
  </view>
  <view class="cu-load {{loadmore?'loading':'over'}}" wx:else></view>
</view>

<!-- 浮动AI客服按钮 -->
<navigator class="floating-ai-btn" hover-class="floating-ai-btn-active" url="/pages/ai-rag/chat/index">
  <text class="cuIcon-service"></text>
</navigator>

<!-- 启动广告弹窗 -->
<view class="splash-ad-modal" wx:if="{{showSplashAd}}" bindtap="closeSplashAd">
  <view class="splash-ad-content" catchtap="preventClose">
    <!-- 顶部：倒计时和关闭按钮 -->
    <view class="splash-ad-header">
      <view class="splash-ad-countdown">{{splashAdCountdown}}秒后关闭</view>
      <view class="splash-ad-close" bindtap="closeSplashAd">
        <text class="cuIcon-close"></text>
      </view>
    </view>
    <!-- 广告图片 -->
    <image
      class="splash-ad-image"
      src="{{splashAdData.imageUrl}}"
      mode="widthFix"
      bindtap="onSplashAdClick"
    ></image>
    <!-- 跳过按钮 -->
    <view class="splash-ad-skip" bindtap="closeSplashAd">跳过广告</view>
  </view>
</view>

<!-- 冷启动偏好设置弹窗 - 首次用户显示 -->
<cold-start-popup
  show="{{showColdStartPopup}}"
  bind:complete="onColdStartComplete"
/>
