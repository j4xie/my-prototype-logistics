<!--
  登录页面 - 整合微信一键登录和手机号验证码登录
-->
<view class="login-container">
  <!-- Logo区域 -->
  <view class="login-header">
    <view class="login-logo">
      <view class="logo-icon-wrapper">
        <text class="cuIcon-scan logo-icon"></text>
      </view>
    </view>
    <text class="login-title">溯源商城</text>
    <text class="login-subtitle">全程可追溯 · 品质有保障</text>
  </view>

  <!-- 登录卡片 -->
  <view class="login-card">
    <!-- 登录方式切换 Tab -->
    <view class="login-tabs">
      <view class="login-tab {{loginType === 'wechat' ? 'active' : ''}}" bindtap="switchLoginType" data-type="wechat">
        <text class="cuIcon-weixin tab-icon"></text>
        <text>微信登录</text>
      </view>
      <view class="login-tab {{loginType === 'phone' ? 'active' : ''}}" bindtap="switchLoginType" data-type="phone">
        <text class="cuIcon-phone tab-icon"></text>
        <text>手机号登录</text>
      </view>
    </view>

    <!-- 微信一键登录 -->
    <view class="login-form" wx:if="{{loginType === 'wechat'}}">
      <view class="wechat-hint">
        <text class="cuIcon-infofill hint-icon"></text>
        <text>使用微信绑定的手机号快速登录</text>
      </view>

      <!-- 开发环境提示 -->
      <view class="dev-hint" wx:if="{{isDevTools}}">
        <text class="cuIcon-warnfill"></text>
        <text>开发者工具中无法测试微信登录，请使用真机预览或切换到手机号登录</text>
      </view>

      <button class="wechat-btn" open-type="getPhoneNumber" bindgetphonenumber="onGetPhoneNumber">
        <text class="cuIcon-weixin"></text>
        <text>微信一键登录</text>
      </button>
    </view>

    <!-- 手机号验证码登录 -->
    <view class="login-form" wx:if="{{loginType === 'phone'}}">
      <!-- 手机号输入 -->
      <view class="input-group">
        <view class="input-wrapper">
          <text class="input-prefix">+86</text>
          <input
            class="input"
            type="number"
            maxlength="11"
            placeholder="请输入手机号"
            value="{{phone}}"
            bindinput="onPhoneInput"
          />
          <text class="clear-btn" wx:if="{{phone}}" bindtap="clearPhone">×</text>
        </view>
      </view>

      <!-- 验证码输入 -->
      <view class="input-group">
        <view class="input-wrapper code-wrapper">
          <input
            class="input code-input"
            type="number"
            maxlength="6"
            placeholder="请输入验证码"
            value="{{code}}"
            bindinput="onCodeInput"
          />
          <button
            class="send-code-btn {{canSendCode && countdown === 0 ? '' : 'disabled'}}"
            disabled="{{!canSendCode || countdown > 0}}"
            bindtap="sendCode"
          >
            {{countdown > 0 ? countdown + 's' : '获取验证码'}}
          </button>
        </view>
      </view>

      <!-- 登录按钮 -->
      <button
        class="phone-login-btn {{canLogin ? '' : 'disabled'}}"
        disabled="{{!canLogin || loading}}"
        bindtap="doPhoneLogin"
      >
        {{loading ? '登录中...' : '登录'}}
      </button>
    </view>

    <!-- 用户协议 -->
    <view class="agreement">
      <checkbox-group bindchange="onAgreementChange">
        <label class="agreement-label">
          <checkbox value="agree" checked="{{agreed}}" color="#D4AF37"/>
          <text class="agreement-text">登录即表示同意<text class="agreement-link" catchtap="showUserAgreement">《用户协议》</text>和<text class="agreement-link" catchtap="showPrivacyPolicy">《隐私政策》</text></text>
        </label>
      </checkbox-group>
    </view>
  </view>

  <!-- 特性展示 -->
  <view class="features">
    <view class="feature-item">
      <view class="feature-icon">
        <text class="cuIcon-scan"></text>
      </view>
      <text class="feature-label">扫码溯源</text>
    </view>
    <view class="feature-item">
      <view class="feature-icon">
        <text class="cuIcon-creativefill"></text>
      </view>
      <text class="feature-label">AI智能</text>
    </view>
    <view class="feature-item">
      <view class="feature-icon">
        <text class="cuIcon-safe"></text>
      </view>
      <text class="feature-label">品质保证</text>
    </view>
  </view>

  <!-- 跳过登录 -->
  <view class="skip-login" bindtap="skipLogin">
    <text>暂不登录，先逛逛</text>
    <text class="cuIcon-right"></text>
  </view>
</view>

<!-- 授权弹窗 -->
<view class="cu-modal {{showAuthModal ? 'show' : ''}}">
  <view class="cu-dialog">
    <view class="cu-bar bg-white justify-end">
      <view class="content">微信授权</view>
      <view class="action" bindtap="hideAuthModal">
        <text class="cuIcon-close text-gray"></text>
      </view>
    </view>
    <view class="padding-xl text-center">
      <text class="cuIcon-weixin" style="font-size: 80rpx; color: #07c160;"></text>
      <view class="margin-top text-lg text-bold">微信授权登录</view>
      <view class="margin-top-sm text-gray text-sm">
        溯源商城将获取你的微信昵称、头像等公开信息
      </view>
    </view>
    <view class="cu-bar bg-white">
      <view class="action margin-0 flex-sub text-gray" bindtap="hideAuthModal">取消</view>
      <view class="action margin-0 flex-sub text-green solid-left" bindtap="confirmAuth">确认授权</view>
    </view>
  </view>
</view>
