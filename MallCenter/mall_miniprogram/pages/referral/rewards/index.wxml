<!--
  æ¨èå¥–åŠ±é¡µé¢
-->
<view class="container">
  <!-- ä½™é¢å¡ç‰‡ -->
  <view class="balance-card">
    <view class="balance-bg"></view>
    <view class="balance-content">
      <view class="balance-main">
        <text class="balance-label">å¯æç°é‡‘é¢ï¼ˆå…ƒï¼‰</text>
        <text class="balance-value">{{balance.available}}</text>
      </view>
      <view class="balance-actions">
        <view class="withdraw-btn" bindtap="openWithdrawModal">
          <text>æç°</text>
        </view>
      </view>
      <view class="balance-detail">
        <view class="detail-item">
          <text class="detail-value">Â¥{{balance.total}}</text>
          <text class="detail-label">ç´¯è®¡å¥–åŠ±</text>
        </view>
        <view class="detail-divider"></view>
        <view class="detail-item">
          <text class="detail-value">Â¥{{balance.pending}}</text>
          <text class="detail-label">å¾…åˆ°è´¦</text>
        </view>
        <view class="detail-divider"></view>
        <view class="detail-item">
          <text class="detail-value">Â¥{{balance.withdrawn}}</text>
          <text class="detail-label">å·²æç°</text>
        </view>
      </view>
    </view>
  </view>

  <!-- å¿«æ·å…¥å£ -->
  <view class="quick-actions">
    <view class="action-item" bindtap="goShare">
      <text class="action-icon">ğŸ‘¥</text>
      <text class="action-text">é‚€è¯·å¥½å‹</text>
    </view>
    <view class="action-item" bindtap="viewRules">
      <text class="action-icon">ğŸ“‹</text>
      <text class="action-text">æç°è§„åˆ™</text>
    </view>
  </view>

  <!-- æ ‡ç­¾é¡µ -->
  <view class="tabs-wrapper">
    <view class="tabs">
      <view class="tab-item {{activeTab === item.key ? 'active' : ''}}"
            wx:for="{{tabs}}" wx:key="key"
            data-key="{{item.key}}"
            bindtap="switchTab">
        <text class="tab-text">{{item.name}}</text>
        <view class="tab-indicator" wx:if="{{activeTab === item.key}}"></view>
      </view>
    </view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-container" wx:if="{{loading}}">
    <view class="loading-spinner"></view>
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <!-- åˆ—è¡¨å†…å®¹ -->
  <block wx:else>
    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state" wx:if="{{recordList.length === 0}}">
      <text class="empty-icon">ğŸ’°</text>
      <text class="empty-text">æš‚æ— å¥–åŠ±è®°å½•</text>
      <view class="empty-action" bindtap="goShare">å»é‚€è¯·å¥½å‹</view>
    </view>

    <!-- è®°å½•åˆ—è¡¨ -->
    <view class="record-list" wx:else>
      <view class="record-item" wx:for="{{recordList}}" wx:key="id">
        <view class="record-icon {{item.type}}">
          <text wx:if="{{item.type === 'income'}}">ğŸ’°</text>
          <text wx:else>ğŸ’³</text>
        </view>
        <view class="record-info">
          <text class="record-title">{{item.title}}</text>
          <text class="record-desc">{{item.desc}}</text>
          <text class="record-time">{{item.createTime}}</text>
        </view>
        <view class="record-amount {{item.amount > 0 ? 'income' : 'expense'}}">
          <text>{{item.amount > 0 ? '+' : ''}}{{item.amount}}</text>
          <text class="record-status {{item.status}}" wx:if="{{item.status !== 'success'}}">
            {{item.status === 'processing' ? 'å¤„ç†ä¸­' : 'å¾…ç¡®è®¤'}}
          </text>
        </view>
      </view>
    </view>

    <!-- åŠ è½½æ›´å¤š -->
    <view class="load-more" wx:if="{{recordList.length > 0}}">
      <view class="loading-more" wx:if="{{loadingMore}}">
        <view class="loading-spinner small"></view>
        <text>åŠ è½½ä¸­...</text>
      </view>
      <text class="no-more" wx:elif="{{!hasMore}}">æ²¡æœ‰æ›´å¤šäº†</text>
    </view>
  </block>

  <!-- æç°å¼¹çª— -->
  <view class="modal-mask" wx:if="{{showWithdrawModal}}" bindtap="closeWithdrawModal">
    <view class="modal-content" catchtap="stopPropagation">
      <view class="modal-header">
        <text class="modal-title">æç°</text>
        <view class="modal-close" bindtap="closeWithdrawModal">Ã—</view>
      </view>
      <view class="modal-body">
        <view class="available-row">
          <text class="available-label">å¯æç°é‡‘é¢</text>
          <text class="available-value">Â¥{{balance.available}}</text>
        </view>
        <view class="input-group">
          <text class="input-prefix">Â¥</text>
          <input class="amount-input" type="digit" placeholder="è¯·è¾“å…¥æç°é‡‘é¢"
                 value="{{withdrawAmount}}" bindinput="onWithdrawInput" />
          <view class="withdraw-all-btn" bindtap="withdrawAll">å…¨éƒ¨æç°</view>
        </view>
        <view class="tips-row">
          <text class="tips-text">æœ€ä½æç°é‡‘é¢ Â¥{{minWithdraw}}ï¼Œé¢„è®¡1-3ä¸ªå·¥ä½œæ—¥åˆ°è´¦</text>
        </view>
      </view>
      <view class="modal-footer">
        <view class="cancel-btn" bindtap="closeWithdrawModal">å–æ¶ˆ</view>
        <view class="confirm-btn" bindtap="confirmWithdraw">ç¡®è®¤æç°</view>
      </view>
    </view>
  </view>
</view>
