<!--
  æˆ‘çš„æ¨èé¡µé¢
-->
<view class="container">
  <!-- ç»Ÿè®¡å¤´éƒ¨ -->
  <view class="stats-header">
    <view class="stats-bg"></view>
    <view class="stats-content">
      <view class="stats-row">
        <view class="stat-item">
          <text class="stat-value">{{stats.total}}</text>
          <text class="stat-label">æ€»æ¨è</text>
        </view>
        <view class="stat-divider"></view>
        <view class="stat-item">
          <text class="stat-value success">{{stats.success}}</text>
          <text class="stat-label">å·²æˆåŠŸ</text>
        </view>
        <view class="stat-divider"></view>
        <view class="stat-item">
          <text class="stat-value pending">{{stats.pending}}</text>
          <text class="stat-label">å¾…ç¡®è®¤</text>
        </view>
        <view class="stat-divider"></view>
        <view class="stat-item">
          <text class="stat-value reward">Â¥{{stats.totalRewards}}</text>
          <text class="stat-label">ç´¯è®¡å¥–åŠ±</text>
        </view>
      </view>
    </view>
  </view>

  <!-- æ ‡ç­¾é¡µ -->
  <view class="tabs-wrapper">
    <view class="tabs">
      <view class="tab-item {{activeTab === item.key ? 'active' : ''}}"
            wx:for="{{tabs}}" wx:key="key"
            data-key="{{item.key}}"
            bindtap="switchTab">
        <text class="tab-text">{{item.name}}</text>
        <view class="tab-indicator" wx:if="{{activeTab === item.key}}"></view>
      </view>
    </view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-container" wx:if="{{loading}}">
    <view class="loading-spinner"></view>
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <!-- åˆ—è¡¨å†…å®¹ -->
  <block wx:else>
    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state" wx:if="{{referralList.length === 0}}">
      <text class="empty-icon">ğŸ“­</text>
      <text class="empty-text">æš‚æ— æ¨èè®°å½•</text>
      <view class="empty-action" bindtap="goShare">å»é‚€è¯·å¥½å‹</view>
    </view>

    <!-- æ¨èåˆ—è¡¨ -->
    <view class="referral-list" wx:else>
      <view class="referral-item" wx:for="{{referralList}}" wx:key="id"
            data-id="{{item.id}}" bindtap="viewDetail">
        <!-- ç”¨æˆ·ä¿¡æ¯ -->
        <view class="user-section">
          <view class="avatar" wx:if="{{item.avatar}}">
            <image class="avatar-img" src="{{item.avatar}}" mode="aspectFill"></image>
          </view>
          <view class="avatar default-avatar" wx:else>
            <text>{{item.userName[0] || '?'}}</text>
          </view>
          <view class="user-info">
            <text class="user-name">{{item.userName}}</text>
            <text class="user-phone">{{item.phone}}</text>
          </view>
          <view class="status-badge {{item.status}}">
            <text>{{item.status === 'success' ? 'å·²æˆåŠŸ' : 'å¾…ç¡®è®¤'}}</text>
          </view>
        </view>

        <!-- è¯¦æƒ…ä¿¡æ¯ -->
        <view class="detail-section">
          <view class="detail-row">
            <text class="detail-label">æ³¨å†Œæ—¶é—´</text>
            <text class="detail-value">{{item.registerTime}}</text>
          </view>
          <view class="detail-row" wx:if="{{item.firstOrderTime}}">
            <text class="detail-label">é¦–å•æ—¶é—´</text>
            <text class="detail-value">{{item.firstOrderTime}}</text>
          </view>
          <view class="detail-row" wx:if="{{item.status === 'success'}}">
            <text class="detail-label">è·å¾—å¥–åŠ±</text>
            <text class="detail-value reward">+Â¥{{item.reward}}</text>
          </view>
          <view class="detail-row" wx:if="{{item.status === 'pending'}}">
            <text class="detail-label">çŠ¶æ€è¯´æ˜</text>
            <text class="detail-value hint">ç­‰å¾…å®Œæˆé¦–å•</text>
          </view>
        </view>
      </view>
    </view>

    <!-- åŠ è½½æ›´å¤š -->
    <view class="load-more" wx:if="{{referralList.length > 0}}">
      <view class="loading-more" wx:if="{{loadingMore}}">
        <view class="loading-spinner small"></view>
        <text>åŠ è½½ä¸­...</text>
      </view>
      <text class="no-more" wx:elif="{{!hasMore}}">æ²¡æœ‰æ›´å¤šäº†</text>
    </view>
  </block>

  <!-- åº•éƒ¨é‚€è¯·æŒ‰é’® -->
  <view class="bottom-bar">
    <button class="invite-btn" open-type="share">
      <text class="btn-icon">ğŸ‘¥</text>
      <text>é‚€è¯·å¥½å‹</text>
    </button>
  </view>
</view>
