<!--
  分享推荐页面
-->
<view class="container">
  <!-- 加载状态 -->
  <view class="loading-container" wx:if="{{loading}}">
    <view class="loading-spinner"></view>
    <text class="loading-text">加载中...</text>
  </view>

  <block wx:else>
    <!-- 头部卡片 -->
    <view class="header-card">
      <view class="header-bg"></view>
      <view class="header-content">
        <text class="header-title">邀请好友 赚取奖励</text>
        <text class="header-desc">每邀请一位好友完成首单，您可获得 ¥{{rewardInfo.referrerReward}} 奖励</text>
      </view>
    </view>

    <!-- 统计卡片 -->
    <view class="stats-card">
      <view class="stat-item" bindtap="viewMyReferrals">
        <text class="stat-value">{{stats.totalReferrals}}</text>
        <text class="stat-label">总邀请</text>
      </view>
      <view class="stat-divider"></view>
      <view class="stat-item" bindtap="viewMyReferrals">
        <text class="stat-value">{{stats.successCount}}</text>
        <text class="stat-label">已成功</text>
      </view>
      <view class="stat-divider"></view>
      <view class="stat-item" bindtap="viewRewards">
        <text class="stat-value highlight">¥{{stats.totalRewards}}</text>
        <text class="stat-label">累计奖励</text>
      </view>
    </view>

    <!-- 二维码区域 -->
    <view class="qrcode-section">
      <text class="section-title">我的专属二维码</text>
      <view class="qrcode-wrapper">
        <image class="qrcode-image" src="{{qrCodeUrl}}" mode="aspectFit" wx:if="{{qrCodeUrl}}"></image>
        <view class="qrcode-placeholder" wx:else>
          <text class="placeholder-icon">📱</text>
          <text class="placeholder-text">二维码生成中...</text>
        </view>
      </view>
      <view class="referral-code-row">
        <text class="code-label">推荐码：</text>
        <text class="code-value">{{referralCode}}</text>
        <view class="copy-btn" bindtap="copyCode">复制</view>
      </view>
      <view class="qrcode-actions">
        <view class="action-btn save-btn" bindtap="saveQRCode">
          <text class="action-icon">📥</text>
          <text>保存图片</text>
        </view>
      </view>
    </view>

    <!-- 分享入口 -->
    <view class="share-section">
      <text class="section-title">快速分享</text>
      <view class="share-buttons">
        <button class="share-btn wechat" open-type="share">
          <text class="share-icon">💬</text>
          <text class="share-text">微信好友</text>
        </button>
        <view class="share-btn moments" bindtap="shareToMoments">
          <text class="share-icon">🌍</text>
          <text class="share-text">朋友圈</text>
        </view>
      </view>
    </view>

    <!-- 邀请步骤 -->
    <view class="steps-section">
      <text class="section-title">如何邀请</text>
      <view class="steps-list">
        <view class="step-item" wx:for="{{rules}}" wx:key="icon">
          <view class="step-number">{{item.icon}}</view>
          <view class="step-content">
            <text class="step-title">{{item.title}}</text>
            <text class="step-desc">{{item.desc}}</text>
          </view>
        </view>
      </view>
    </view>

    <!-- 奖励说明 -->
    <view class="reward-info-card">
      <view class="reward-header">
        <text class="reward-icon">🎁</text>
        <text class="reward-title">奖励说明</text>
      </view>
      <view class="reward-rules">
        <view class="rule-item">
          <text class="rule-dot">•</text>
          <text class="rule-text">邀请人奖励：好友完成首单后，您获得 ¥{{rewardInfo.referrerReward}}</text>
        </view>
        <view class="rule-item">
          <text class="rule-dot">•</text>
          <text class="rule-text">被邀请人奖励：新用户注册后可获得 ¥{{rewardInfo.refereeReward}} 优惠券</text>
        </view>
        <view class="rule-item">
          <text class="rule-dot">•</text>
          <text class="rule-text">每月邀请奖励上限：¥{{rewardInfo.maxMonthly}}</text>
        </view>
        <view class="rule-item">
          <text class="rule-dot">•</text>
          <text class="rule-text">奖励将在好友首单完成后24小时内发放</text>
        </view>
      </view>
      <view class="view-more" bindtap="viewRewards">
        <text>查看我的奖励</text>
        <text class="arrow">→</text>
      </view>
    </view>
  </block>
</view>
