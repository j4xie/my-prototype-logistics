<!--
  - Copyright (C) 2018-2019
  - All rights reserved, Designed By www.joolun.com
  - æ³¨æ„ï¼š
  - æœ¬è½¯ä»¶ä¸ºwww.joolun.comå¼€å‘ç ”åˆ¶ï¼Œé¡¹ç›®ä½¿ç”¨è¯·ä¿ç•™æ­¤è¯´æ˜
-->
<!-- å›¾ç‰‡è½®æ’­ -->
<view class='product-carousel'>
  <swiper class="carousel-swiper" indicator-dots="false" circular="true" autoplay="true" interval="5000" duration="500" bindchange="change">
    <swiper-item wx:for="{{goodsSpu.picUrls}}" wx:key="index">
      <image class="carousel-image" src="{{item}}" mode="aspectFill"></image>
    </swiper-item>
  </swiper>
  <view class="carousel-indicators">
    <view class="carousel-dot {{currents === index + 1 ? 'active' : ''}}" wx:for="{{goodsSpu.picUrls}}" wx:key="index"></view>
  </view>
  <view class="share-btn" bindtap="shareShow">
    <text class="cuIcon-share"></text>
  </view>
</view>

<!-- äº§å“ä¿¡æ¯åŒºåŸŸ -->
<view class="product-info-section">
  <!-- äº§å“æ ‡é¢˜å’Œæ ‡ç­¾ -->
  <view class="product-header">
    <view class="product-title">{{goodsSpu.name}}</view>
    <view class="product-subtitle">{{goodsSpu.sellPoint}}</view>
    <view class="product-tags-row">
      <view class="tag tag-trace">å¯æº¯æº</view>
      <view class="tag tag-hot" wx:if="{{goodsSpu.saleNum > 100}}">çƒ­é”€</view>
      <view class="tag" wx:if="{{goodsSpu.freightTemplat}}">åŒ…é‚®</view>
    </view>
  </view>

  <!-- ä»·æ ¼åŒºåŸŸ -->
  <view class="price-section">
    <view class="price-header">
      <text class="price-current">Â¥{{hasTiers && currentPrice ? currentPrice : goodsSpu.salesPrice}}</text>
      <text class="price-unit">/{{goodsSpu.unit || 'ä»¶'}}</text>
      <text class="price-original" wx:if="{{goodsSpu.marketPrice}}">Â¥{{goodsSpu.marketPrice}}</text>
    </view>

    <!-- é˜¶æ¢¯å®šä»·æç¤º -->
    <view class="tier-hint" wx:if="{{hasTiers && nextTier}}">
      <text class="cuIcon-hot"></text>
      <text>å†ä¹°{{quantityToNextTier}}ä»¶ï¼Œå•ä»·é™è‡³Â¥{{nextTier.price}}</text>
    </view>

    <!-- é˜¶æ¢¯å®šä»·è¡¨ -->
    <view class="tier-pricing-table" wx:if="{{hasTiers && priceTiers.length > 0}}">
      <view class="tier-row header">
        <text>èµ·è®¢é‡</text>
        <text>å•ä»·</text>
      </view>
      <view class="tier-row {{currentTier && currentTier.id === item.id ? 'active' : ''}}" wx:for="{{priceTiers}}" wx:key="id">
        <text class="tier-qty">â‰¥{{item.minQuantity}}{{goodsSpu.unit || 'ä»¶'}}</text>
        <text class="tier-price">Â¥{{item.price}}/{{goodsSpu.unit || 'ä»¶'}}</text>
      </view>
    </view>
  </view>
</view>

<!-- ä¾›è´§å•†ä¿¡æ¯ -->
<view class="supplier-section">
  <view class="section-title">
    <text class="cuIcon-shop"></text>
    <text>ä¾›è´§å•†ä¿¡æ¯</text>
  </view>
  <view class="supplier-card" bindtap="goToMerchant">
    <view class="supplier-header">
      <view class="supplier-logo">å·¥</view>
      <view class="supplier-info">
        <view class="supplier-name">ç™½å©çºªé£Ÿå“æœ‰é™å…¬å¸</view>
        <view class="supplier-meta">ä¸Šæµ·å¸‚æµ¦ä¸œæ–°åŒº Â· 5å¹´ç»è¥</view>
      </view>
      <view class="supplier-arrow">
        <text class="cuIcon-right"></text>
      </view>
    </view>
    <view class="supplier-stats">
      <text class="stat-item">äº§å“: 12</text>
      <text class="stat-item">è¯„åˆ†: 4.8</text>
      <text class="stat-item">å¥½è¯„ç‡: 98%</text>
    </view>
  </view>
</view>

<!-- æº¯æºä¿¡æ¯ -->
<view class="traceability-section">
  <view class="section-title">
    <text class="cuIcon-safe"></text>
    <text>äº§å“æº¯æºä¿¡æ¯</text>
  </view>
  <view class="trace-timeline">
    <view class="trace-item">
      <view class="trace-dot"></view>
      <view class="trace-content">
        <view class="trace-time">{{traceInfo.inspectionTime || '2025-01-15 14:30'}}</view>
        <view class="trace-title">è´¨æ£€åˆæ ¼</view>
        <view class="trace-desc">æ‰¹æ¬¡å·: {{traceInfo.batchNo || 'BATCH-20250115-001'}} Â· æ£€éªŒå‘˜: {{traceInfo.inspector || 'å¼ ä¸‰'}}</view>
      </view>
    </view>
    <view class="trace-item">
      <view class="trace-dot"></view>
      <view class="trace-content">
        <view class="trace-time">{{traceInfo.processTime || '2025-01-15 10:00'}}</view>
        <view class="trace-title">åŠ å·¥å®Œæˆ</view>
        <view class="trace-desc">åŠ å·¥è½¦é—´: {{traceInfo.workshop || 'AåŒº3å·çº¿'}} Â· æ“ä½œå‘˜: {{traceInfo.operator || 'æå››'}}</view>
      </view>
    </view>
    <view class="trace-item">
      <view class="trace-dot"></view>
      <view class="trace-content">
        <view class="trace-time">{{traceInfo.receiveTime || '2025-01-15 08:00'}}</view>
        <view class="trace-title">åŸæ–™å…¥åº“</view>
        <view class="trace-desc">ä¾›åº”å•†: {{traceInfo.supplier || 'æµ·é²œæ‰¹å‘å¸‚åœº'}} Â· é‡é‡: {{traceInfo.weight || '500kg'}}</view>
      </view>
    </view>
  </view>
  <view class="trace-footer">
    <button class="trace-detail-btn" bindtap="goToTrace">æŸ¥çœ‹å®Œæ•´æº¯æº</button>
  </view>
</view>

<!-- äº§å“è§„æ ¼ -->
<view class="specs-section">
  <view class="section-title">
    <text class="cuIcon-list"></text>
    <text>äº§å“è§„æ ¼</text>
  </view>
  <view class="spec-list">
    <view class="spec-item">
      <text class="spec-label">äº§å“åˆ†ç±»</text>
      <text class="spec-value">{{goodsSpu.categoryName || 'å†·å†»é£Ÿå“'}}</text>
    </view>
    <view class="spec-item">
      <text class="spec-label">äº§åœ°</text>
      <text class="spec-value">{{goodsSpu.origin || 'ä¸­å›½'}}</text>
    </view>
    <view class="spec-item">
      <text class="spec-label">ä¿è´¨æœŸ</text>
      <text class="spec-value">{{goodsSpu.shelfLife || '12ä¸ªæœˆ'}}</text>
    </view>
    <view class="spec-item">
      <text class="spec-label">å‚¨å­˜æ¡ä»¶</text>
      <text class="spec-value">{{goodsSpu.storage || '-18â„ƒå†·å†»ä¿å­˜'}}</text>
    </view>
    <view class="spec-item">
      <text class="spec-label">åº“å­˜æ•°é‡</text>
      <text class="spec-value">{{goodsSpu.stock}}{{goodsSpu.unit || 'ä»¶'}}</text>
    </view>
    <view class="spec-item" wx:if="{{goodsSpu.saleNum}}">
      <text class="spec-label">ç´¯è®¡é”€é‡</text>
      <text class="spec-value">{{goodsSpu.saleNum}}{{goodsSpu.unit || 'ä»¶'}}</text>
    </view>
  </view>
</view>

<!-- AI æ™ºèƒ½åˆ†æå…¥å£ -->
<view class="ai-analysis-section">
  <view class="section-title">
    <text class="cuIcon-creativefill"></text>
    <text>AI æ™ºèƒ½åˆ†æ</text>
  </view>
  <view class="ai-cards-grid">
    <view class="ai-entry-card product-analysis" bindtap="goToAiAnalysis" data-type="product">
      <text class="ai-icon">ğŸ“Š</text>
      <text class="ai-label">äº§å“åˆ†æ</text>
    </view>
    <view class="ai-entry-card factory-analysis" bindtap="goToAiAnalysis" data-type="factory">
      <text class="ai-icon">ğŸ­</text>
      <text class="ai-label">å·¥å‚åˆ†æ</text>
    </view>
    <view class="ai-entry-card industry-analysis" bindtap="goToAiAnalysis" data-type="industry">
      <text class="ai-icon">ğŸ“ˆ</text>
      <text class="ai-label">è¡Œä¸šåˆ†æ</text>
    </view>
  </view>
</view>

<!-- å•†å“è¯¦æƒ… -->
<view class="description-section">
  <view class="section-title">
    <text class="cuIcon-text"></text>
    <text>å•†å“è¯¦æƒ…</text>
  </view>
  <view class="description-content">
    <template is="wxParse" data="{{wxParseData:description.nodes}}"/>
  </view>
</view>

<view class="page-bottom-space"></view>

<!-- åº•éƒ¨æ“ä½œæ  -->
<view class="bottom-action-bar">
  <view class="action-contact-btn" bindtap="contactSupplier">
    <text class="cuIcon-service"></text>
    <text>è”ç³»ä¾›åº”å•†</text>
  </view>
  <button class="action-cart-btn" bindtap="showQtyModal">
    <text class="cuIcon-cart"></text>
    <text>åŠ å…¥è´­ç‰©è½¦</text>
  </button>
</view>

<!-- æµ®åŠ¨AIæŒ‰é’® -->
<view class="fab-ai" bindtap="goToAiChat">
  <text class="cuIcon-creativefill"></text>
</view>

<!-- æµ®åŠ¨è´­ç‰©è½¦æŒ‰é’® -->
<navigator class="fab-cart" open-type='switchTab' url='/pages/shopping-cart/index' wx:if="{{shoppingCartCount > 0}}">
  <text class="cuIcon-cart"></text>
  <view class="fab-cart-badge">{{shoppingCartCount}}</view>
</navigator>

<!-- htmlè½¬wxml -->
<import src="/public/wxParse/wxParse.wxml"/>

<!-- å•†å“ä¸‹æ¶æç¤º -->
<view class="cu-modal {{goodsSpu.shelf=='0'?'show':''}}">
  <view class="cu-dialog">
    <view class="cu-bar bg-white justify-end">
      <view class="content">æç¤º</view>
    </view>
    <view class="padding-xl">
      æŠ±æ­‰ï¼Œè¯¥å•†å“å·²ä¸‹æ¶
    </view>
  </view>
</view>

<!-- æµ·æŠ¥ç»„ä»¶ -->
<poster id="poster" hide-loading="{{false}}" preload="{{false}}" config="{{posterConfig}}" bind:success="onPosterSuccess" bind:fail="onPosterFail"></poster>

<!-- åˆ†äº«å¼¹çª— -->
<view class="cu-modal bottom-modal {{shareShow}}">
  <view class="cu-dialog">
    <view class="cu-bar bg-white">
      <view class="action text-green"></view>
      <view class="action text-red" bindtap="shareHide">å–æ¶ˆ</view>
    </view>
    <view class="padding flex flex-direction">
      <button class="cu-btn bg-green lg" open-type='share'>å‘é€ç»™æœ‹å‹</button>
      <button class="cu-btn bg-orange lg margin-top-sm" bindtap="onCreatePoster">ç”Ÿæˆæµ·æŠ¥</button>
    </view>
  </view>
</view>

<!-- æµ·æŠ¥é¢„è§ˆå¼¹çª— -->
<view class="cu-modal {{posterShow ? 'show' : ''}}">
  <view class="cu-dialog">
    <view style="height: calc(100vh - 200rpx)">
      <image src="{{posterUrl}}" style="height: 100%;"></image>
    </view>
    <view class="cu-bar bg-white">
      <view class="action margin-0 flex-sub" bindtap="hidePosterShow">å–æ¶ˆ</view>
      <view class="action margin-0 flex-sub solid-left text-red text-bold" bindtap="savePoster">ä¿å­˜åˆ°ç›¸å†Œ</view>
    </view>
  </view>
</view>

<!-- æ•°é‡é€‰æ‹©å™¨å¼¹çª— -->
<view class="qty-modal {{showQtyModal ? 'show' : ''}}" bindtap="hideQtyModal">
  <view class="qty-modal-content" catchtap="preventClose">
    <view class="qty-header">
      <text class="qty-title">é€‰æ‹©æ•°é‡</text>
      <text class="qty-close cuIcon-close" bindtap="hideQtyModal"></text>
    </view>

    <view class="qty-product-info">
      <image class="qty-product-image" src="{{goodsSpu.picUrls[0]}}" mode="aspectFill"></image>
      <view class="qty-product-detail">
        <text class="qty-product-name">{{goodsSpu.name}}</text>
        <text class="qty-product-price">Â¥{{hasTiers && currentPrice ? currentPrice : goodsSpu.salesPrice}}/{{goodsSpu.unit || 'ä»¶'}}</text>
      </view>
    </view>

    <view class="qty-selector">
      <button class="qty-btn" bindtap="minusNum" disabled="{{cartNum <= 1}}">-</button>
      <input type="number" class="qty-input" value="{{cartNum}}" bindchange="onQuantityChange"/>
      <button class="qty-btn" bindtap="addNum">+</button>
    </view>

    <view class="qty-price-info">
      <view class="qty-total-label">æ€»ä»·</view>
      <view class="qty-total-price">Â¥{{(hasTiers && currentPrice ? currentPrice : goodsSpu.salesPrice) * cartNum}}</view>
      <view class="qty-tier-hint" wx:if="{{hasTiers && nextTier}}">
        å†è´­ä¹°{{quantityToNextTier}}{{goodsSpu.unit || 'ä»¶'}}å¯äº«Â¥{{nextTier.price}}ä¼˜æƒ ä»·
      </view>
    </view>

    <view class="qty-actions">
      <button class="qty-action-btn add-cart" bindtap="toDo" data-type="1">åŠ å…¥è´­ç‰©è½¦</button>
      <button class="qty-action-btn buy-now" bindtap="toDo" data-type="2">ç«‹å³è´­ä¹°</button>
    </view>
  </view>
</view>
