<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.joolun.mall.mapper.TraceabilityQualityReportMapper">
    <resultMap id="reportMap" type="com.joolun.mall.entity.TraceabilityQualityReport">
        <id property="id" column="id"/>
        <result property="batchId" column="batch_id"/>
        <result property="stage" column="stage"/>
        <result property="result" column="result"/>
        <result property="inspector" column="inspector"/>
        <result property="inspectorId" column="inspector_id"/>
        <result property="inspectionTime" column="inspection_time"/>
        <result property="testItems" column="test_items" typeHandler="com.baomidou.mybatisplus.extension.handlers.JacksonTypeHandler"/>
        <result property="certificateImage" column="certificate_image"/>
        <result property="reportFile" column="report_file"/>
        <result property="createTime" column="create_time"/>
    </resultMap>

    <sql id="reportSql">
        tqr.id,
        tqr.batch_id,
        tqr.stage,
        tqr.result,
        tqr.inspector,
        tqr.inspector_id,
        tqr.inspection_time,
        tqr.test_items,
        tqr.certificate_image,
        tqr.report_file,
        tqr.create_time
    </sql>

    <select id="selectByBatchId" resultMap="reportMap">
        SELECT
        <include refid="reportSql"/>
        FROM traceability_quality_report tqr
        WHERE tqr.batch_id = #{batchId}
        ORDER BY tqr.inspection_time DESC
    </select>
</mapper>
