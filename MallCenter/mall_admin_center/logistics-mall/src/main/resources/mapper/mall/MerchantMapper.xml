<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.joolun.mall.mapper.MerchantMapper">
    <resultMap id="merchantMap" type="com.joolun.mall.entity.Merchant">
        <id property="id" column="id"/>
        <result property="userId" column="user_id"/>
        <result property="merchantNo" column="merchant_no"/>
        <result property="merchantName" column="merchant_name"/>
        <result property="shortName" column="short_name"/>
        <result property="logoUrl" column="logo_url"/>
        <result property="licenseNo" column="license_no"/>
        <result property="licenseImage" column="license_image"/>
        <result property="legalPerson" column="legal_person"/>
        <result property="legalIdCard" column="legal_id_card"/>
        <result property="legalIdFront" column="legal_id_front"/>
        <result property="legalIdBack" column="legal_id_back"/>
        <result property="bankAccount" column="bank_account"/>
        <result property="bankName" column="bank_name"/>
        <result property="bankBranch" column="bank_branch"/>
        <result property="contactName" column="contact_name"/>
        <result property="contactPhone" column="contact_phone"/>
        <result property="contactEmail" column="contact_email"/>
        <result property="address" column="address"/>
        <result property="status" column="status"/>
        <result property="rating" column="rating"/>
        <result property="reviewRate" column="review_rate"/>
        <result property="operatingYears" column="operating_years"/>
        <result property="productCount" column="product_count"/>
        <result property="orderCount" column="order_count"/>
        <result property="totalSales" column="total_sales"/>
        <result property="createTime" column="create_time"/>
        <result property="updateTime" column="update_time"/>
        <result property="delFlag" column="del_flag"/>
    </resultMap>

    <sql id="merchantSql">
        merchant.id,
        merchant.user_id,
        merchant.merchant_no,
        merchant.merchant_name,
        merchant.short_name,
        merchant.logo_url,
        merchant.license_no,
        merchant.license_image,
        merchant.legal_person,
        merchant.legal_id_card,
        merchant.legal_id_front,
        merchant.legal_id_back,
        merchant.bank_account,
        merchant.bank_name,
        merchant.bank_branch,
        merchant.contact_name,
        merchant.contact_phone,
        merchant.contact_email,
        merchant.address,
        merchant.status,
        merchant.rating,
        merchant.review_rate,
        merchant.operating_years,
        merchant.product_count,
        merchant.order_count,
        merchant.total_sales,
        merchant.create_time,
        merchant.update_time,
        merchant.del_flag
    </sql>

    <select id="selectPage1" resultMap="merchantMap">
        SELECT
        <include refid="merchantSql"/>
        FROM merchant merchant
        <where>
            merchant.del_flag = 0
            <if test="query.status != null">
                AND merchant.status = #{query.status}
            </if>
            <if test="query.merchantName != null and query.merchantName != ''">
                AND merchant.merchant_name LIKE CONCAT('%',#{query.merchantName},'%')
            </if>
            <if test="query.contactPhone != null and query.contactPhone != ''">
                AND merchant.contact_phone = #{query.contactPhone}
            </if>
            <if test="query.merchantNo != null and query.merchantNo != ''">
                AND merchant.merchant_no = #{query.merchantNo}
            </if>
        </where>
        ORDER BY merchant.create_time DESC
    </select>

    <select id="selectByUserId" resultMap="merchantMap">
        SELECT
        <include refid="merchantSql"/>
        FROM merchant merchant
        WHERE merchant.del_flag = 0
          AND merchant.user_id = #{userId}
    </select>

    <select id="selectByMerchantNo" resultMap="merchantMap">
        SELECT
        <include refid="merchantSql"/>
        FROM merchant merchant
        WHERE merchant.del_flag = 0
          AND merchant.merchant_no = #{merchantNo}
    </select>
</mapper>
