<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.joolun.mall.mapper.TraceabilityTimelineMapper">
    <resultMap id="timelineMap" type="com.joolun.mall.entity.TraceabilityTimeline">
        <id property="id" column="id"/>
        <result property="batchId" column="batch_id"/>
        <result property="stage" column="stage"/>
        <result property="title" column="title"/>
        <result property="description" column="description"/>
        <result property="operator" column="operator"/>
        <result property="operatorId" column="operator_id"/>
        <result property="workshop" column="workshop"/>
        <result property="equipment" column="equipment"/>
        <result property="status" column="status"/>
        <result property="sortOrder" column="sort_order"/>
        <result property="timestamp" column="timestamp"/>
        <result property="extraData" column="extra_data" typeHandler="com.baomidou.mybatisplus.extension.handlers.JacksonTypeHandler"/>
        <result property="createTime" column="create_time"/>
        <result property="updateTime" column="update_time"/>
    </resultMap>

    <sql id="timelineSql">
        tt.`id`,
        tt.`batch_id`,
        tt.`stage`,
        tt.`title`,
        tt.`description`,
        tt.`operator`,
        tt.`operator_id`,
        tt.`workshop`,
        tt.`equipment`,
        tt.`status`,
        tt.`sort_order`,
        tt.`timestamp`,
        tt.`extra_data`,
        tt.`create_time`,
        tt.`update_time`
    </sql>

    <select id="selectByBatchId" resultMap="timelineMap">
        SELECT
        <include refid="timelineSql"/>
        FROM traceability_timeline tt
        WHERE tt.`batch_id` = #{batchId}
        ORDER BY tt.`sort_order` ASC, tt.`timestamp` ASC
    </select>
</mapper>
