<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.joolun.mall.mapper.MerchantPageConfigMapper">
    <resultMap id="configMap" type="com.joolun.mall.entity.MerchantPageConfig">
        <id property="id" column="id"/>
        <result property="merchantId" column="merchant_id"/>
        <result property="pageType" column="page_type"/>
        <result property="templateId" column="template_id"/>
        <result property="themeConfig" column="theme_config"/>
        <result property="modulesConfig" column="modules_config"/>
        <result property="status" column="status"/>
        <result property="publishTime" column="published_at"/>
        <result property="aiGenerated" column="ai_generated"/>
        <result property="aiPrompt" column="ai_prompt"/>
        <result property="createBy" column="create_by"/>
        <result property="createTime" column="create_time"/>
        <result property="updateTime" column="update_time"/>
    </resultMap>

    <sql id="configSql">
        c.`id`, c.`merchant_id`, c.`page_type`, c.`template_id`, c.`theme_config`,
        c.`modules_config`, c.`status`, c.`published_at`, c.`ai_generated`, c.`ai_prompt`,
        c.`create_by`, c.`create_time`, c.`update_time`
    </sql>

    <select id="selectByMerchantAndPageType" resultMap="configMap">
        SELECT <include refid="configSql"/>
        FROM merchant_page_config c
        WHERE c.`merchant_id` = #{merchantId} AND c.`page_type` = #{pageType}
        LIMIT 1
    </select>

    <select id="selectByMerchantId" resultMap="configMap">
        SELECT <include refid="configSql"/>
        FROM merchant_page_config c
        WHERE c.`merchant_id` = #{merchantId}
        ORDER BY c.`page_type` ASC
    </select>

    <select id="selectPublishedConfig" resultMap="configMap">
        SELECT <include refid="configSql"/>
        FROM merchant_page_config c
        WHERE c.`merchant_id` = #{merchantId}
          AND c.`page_type` = #{pageType}
          AND c.`status` = 1
        LIMIT 1
    </select>
</mapper>
