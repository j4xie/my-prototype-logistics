import{c as p}from"./permission-CtopeLks.js";import{U as g,B,d as T,r as L,C as O,y as j,D as k,e as m,c as R,o as q,f,i as h,l as s,G as S}from"./index-DxyzpFVi.js";function $(l){return g({url:"/goodscategory/tree",method:"get",params:l})}function E(l){return g({url:"/goodscategory",method:"post",data:l})}function P(l){return g({url:"/goodscategory/"+l,method:"delete"})}function y(l){return g({url:"/goodscategory",method:"put",data:l})}const G={dialogDrag:!0,border:!0,stripe:!0,menuAlign:"center",align:"center",menuType:"text",searchShow:!1,viewBtn:!0,searchMenuSpan:6,column:[{label:"父分类",prop:"parentId",type:"tree",hide:!0,props:{label:"name",value:"id"},rules:[{required:!0,message:"请选择父分类",trigger:"change"}]},{label:"名称",prop:"name",align:"left",rules:[{required:!0,message:"请输入名称",trigger:"blur"},{max:16,message:"长度在不能超过16个字符"}]},{label:"是否显示",prop:"enable",type:"radio",search:!0,sortable:!0,span:24,slot:!0,rules:[{required:!0,message:"请选择显示状态",trigger:"blur"}],dicData:[{label:"关闭",value:"0"},{label:"启用",value:"1"}]},{label:"排序",type:"number",prop:"sort",sortable:!0,rules:[{required:!0,message:"排序不能为空",trigger:"blur"}]},{label:"图片",prop:"picUrl",type:"upload",listType:"picture-img",width:250,rules:[{required:!0,message:"图片不能为空",trigger:"change"}],canvasOption:{text:"joolun",ratio:.1},oss:"ali",loadText:"附件上传中，请稍等",span:24,tip:"只能上传jpg/png文件，且不超过50kb"},{label:"描述",prop:"description",hide:!0,rules:[{max:255,message:"长度在不能超过255个字符"}]},{label:"创建时间",prop:"createTime",editDisplay:!1,addDisplay:!1},{label:"更新时间",prop:"updateTime",editDisplay:!1,addDisplay:!1}]},z=B({name:"GoodsCategory"}),M=Object.assign(z,{setup(l){const{proxy:u}=T(),b=L(null),t=O({form:{},tableData:[],tableLoading:!1,page:{total:0,currentPage:1,pageSize:20,ascs:[],descs:"create_time"}}),v=j(()=>({addBtn:p(["mall:goodscategory:add"]),delBtn:p(["mall:goodscategory:del"]),editBtn:p(["mall:goodscategory:edit"]),viewBtn:p(["mall:goodscategory:get"])})),{form:i,tableData:w,tableLoading:C}=k(t);function _(e){e&&e.id&&y({id:e.id,enable:e.enable}).then(()=>{})}function d(){t.tableLoading=!0,$().then(e=>{let a=e.data;t.tableData=a;let o=[{id:"0",name:"顶级分类",parentId:"0"}];a.forEach(n=>{o.push({id:n.id,name:n.name,parentId:n.parentId})}),b.value.DIC.parentId=o,t.tableLoading=!1}).catch(()=>{t.tableLoading=!1})}function D(e,a){u.$confirm("是否确认删除此数据","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){return P(e.id)}).then(()=>{u.$message({showClose:!0,message:"删除成功",type:"success"}),d(t.page)}).catch(function(o){})}function x(e,a,o,n){y(e).then(()=>{u.$message({showClose:!0,message:"修改成功",type:"success"}),o(),d(t.page)}).catch(()=>{n()})}function U(e,a,o){E(e).then(()=>{u.$message({showClose:!0,message:"添加成功",type:"success"}),a(),d(t.page)}).catch(()=>{o()})}function I(e){d(t.page)}return(e,a)=>{const o=m("el-switch"),n=m("ImageUpload"),V=m("avue-crud");return q(),R("div",null,[f(V,{ref_key:"crud",ref:b,modelValue:s(i),"onUpdate:modelValue":a[1]||(a[1]=r=>S(i)?i.value=r:null),data:s(w),"table-loading":s(C),permission:s(v),option:s(G),onOnLoad:d,onRefreshChange:I,onRowUpdate:x,onRowSave:U,onRowDel:D},{enable:h(r=>[f(o,{"active-value":"1","inactive-value":"0",modelValue:r.row.enable,"onUpdate:modelValue":c=>r.row.enable=c,style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"},"inline-prompt":"","active-icon":"Check","inactive-icon":"Close",onChange:c=>_(r.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),"picUrl-form":h(r=>[f(n,{limit:1,disabled:r.type=="view",modelValue:s(i).picUrl,"onUpdate:modelValue":a[0]||(a[0]=c=>s(i).picUrl=c)},null,8,["disabled","modelValue"])]),_:1},8,["modelValue","data","table-loading","permission","option"])])}}});export{M as default};
