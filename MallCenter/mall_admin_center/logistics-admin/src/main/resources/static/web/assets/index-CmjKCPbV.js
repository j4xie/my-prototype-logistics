import{g as Le,W as Me,a as Ue,p as ze,b as $e,d as Se}from"./main-dgY30BGH.js";import{c as Ie}from"./main.vue_vue_type_style_index_0_scoped_25ddb73a_lang-CRgDsjTq.js";import{d as Z,r as U,$ as ee,y as Pe,w as De,F as te,e as b,c as f,o as c,h as n,j as z,k as v,i as s,l as t,f as o,Y as Ee,G as B,a3 as Be,L as R,a4 as Re,_ as Te,B as xe,C as je,D as Oe,I as Fe,J as Y,n as _,M as K,N as D,A as X,H as E,t as He,v as We}from"./index-DxyzpFVi.js";/* empty css                                                 */import{W as qe}from"./wxfreepublish-ncAXMMh-.js";/* empty css                                                             */const Je={ref:"uploadRef",class:"editor-img-uploader"},Ge={class:"editor"},Qe={__name:"WxEditor",props:{modelValue:{type:String},height:{type:Number,default:null},minHeight:{type:Number,default:null},readOnly:{type:Boolean,default:!1},fileSize:{type:Number,default:5},type:{type:String,default:"url"}},setup(A){const{proxy:m}=Z(),e=U(),$=U("/dev-api/wxmaterial/newsImgUpload"),j=U({Authorization:"Bearer "+ee()}),h=A,S=U({theme:"snow",bounds:document.body,debug:"warn",modules:{toolbar:[["bold","italic","underline","strike"],["blockquote","code-block"],[{list:"ordered"},{list:"bullet"}],[{indent:"-1"},{indent:"+1"}],[{size:["small",!1,"large","huge"]}],[{header:[1,2,3,4,5,6,!1]}],[{color:[]},{background:[]}],[{align:[]}],["clean"],["link","image","video"]]},placeholder:"请输入内容",readOnly:h.readOnly}),V=Pe(()=>{let u={};return h.minHeight&&(u.minHeight=`${h.minHeight}px`),h.height&&(u.height=`${h.height}px`),u}),C=U("");De(()=>h.modelValue,u=>{u!==C.value&&(C.value=u===void 0?"<p></p>":u.replace(/data-src/g,"src"))},{immediate:!0}),te(()=>{if(h.type=="url"){let u=e.value.getQuill();u.getModule("toolbar").addHandler("image",w=>{w?m.$refs.uploadRef.click():u.format("image",!1)})}});function T(u){return["image/jpeg","image/jpg","image/png","image/svg"].includes(u.type)?h.fileSize&&!(u.size/1024/1024<h.fileSize)?(m.$modal.msgError(`上传文件大小不能超过 ${h.fileSize} MB!`),!1):!0:(m.$modal.msgError("图片格式错误!"),!1)}function O(u,y){if(u.link){let w=Re(e.value).getQuill(),d=w.selection.savedRange.index;w.insertEmbed(d,"image",u.link),w.setSelection(d+1)}else m.$modal.msgError("图片插入失败")}function L(){m.$modal.msgError("图片插入失败")}return(u,y)=>{const w=b("el-upload");return c(),f(R,null,[n("div",null,[A.type=="url"?(c(),z(w,{key:0,action:t($),"before-upload":T,"on-success":O,"on-error":L,name:"file","show-file-list":!1,headers:t(j),class:"editor-img-uploader"},{default:s(()=>[n("i",Je,null,512)]),_:1},8,["action","headers"])):v("",!0)]),n("div",Ge,[o(t(Be),{ref_key:"quillEditorRef",ref:e,content:t(C),"onUpdate:content":y[0]||(y[0]=d=>B(C)?C.value=d:null),contentType:"html",onTextChange:y[1]||(y[1]=d=>u.$emit("update:modelValue",t(C))),options:t(S),style:Ee(t(V))},null,8,["content","options","style"])])],64)}}},k=A=>(He("data-v-bd36ae7a"),A=A(),We(),A),Ye={class:"app-container"},Ke={class:"add_but"},Xe={class:"left"},Ze={class:"select-item"},et=["onClick"],tt={class:"news-content"},at=k(()=>n("div",{class:"flex-c material-img"},"未设置",-1)),lt={class:"news-content-title"},it={key:0,class:"child"},ot=["onClick"],st={class:"news-content-item"},nt={class:"news-content-item-title"},dt={class:"news-content-item-img"},rt=k(()=>n("div",{class:"flex-c material-img",style:{background:"#eeeeee"}}," 未设置 ",-1)),ct={class:"child"},ut={key:0,class:"news-main-plus"},mt={class:"right"},pt={class:"thumb-div"},gt=k(()=>n("div",{class:"input-tt",style:{display:"flex"}},"封面：",-1)),ft=["src"],ht={class:"thumb-but"},_t=k(()=>n("div",{class:"el-upload__tip"}," 支持bmp/png/jpeg/jpg/gif格式，大小不超过2M ",-1)),bt={class:"digest"},vt=k(()=>n("div",{class:"input-tt"},"标题：",-1)),yt=k(()=>n("div",{class:"input-tt"},"作者：",-1)),wt=k(()=>n("div",{class:"input-tt"},"原文地址：",-1)),kt=k(()=>n("div",{class:"input-tt"},"摘要：",-1)),At={style:{"padding-bottom":"20px"}},Ct={class:"dialog-footer"},Nt={class:"waterfall"},Vt={key:0,class:"waterfall-item"},Lt={key:0,class:"el-table__empty-block"},Mt=xe({name:"WxMpDraft"}),Ut=Object.assign(Mt,{setup(A){const{proxy:m}=Z(),e=je({tableData:[],page:{total:0,currentPage:1,pageSize:10},page1:{total:0,currentPage:1,pageSize:10},tableLoading:!1,fileList:[],dialogVideoVisible:!1,dialogNewsVisible:!1,addMaterialLoading:!1,uploadData:{mediaType:"image",title:"",introduction:""},articlesAdd:[{title:"",thumbMediaId:"",author:"",digest:"",showCoverPic:"",content:"",contentSourceUrl:"",needOpenComment:"",onlyFansCanComment:"",thumbUrl:""}],isActiveAddNews:0,dialogImageVisible:!1,imageListData:[],tableLoading1:!1,operateMaterial:"add",articlesMediaId:"",hackResetEditor:!1,actionUrl:U("/dev-api/wxmaterial/materialFileUpload"),headers:{Authorization:"Bearer "+ee()},activeName:"title"}),{activeName:$,materialType:j,tableData:h,tableLoading:S,page:V,page1:C,fileList:T,dialogVideoVisible:O,dialogNewsVisible:L,addMaterialLoading:u,uploadData:y,uploadRules:w,articlesAdd:d,isActiveAddNews:p,dialogImageVisible:x,imageListData:zt,tableLoading1:$t,operateMaterial:I,articlesMediaId:St,hackResetEditor:ae,actionUrl:le,headers:ie}=Oe(e);te(()=>{N(e.page)});function N(a,l){e.tableData=[],e.tableLoading=!0,Le(Object.assign({current:a.currentPage,size:a.pageSize},l)).then(r=>{e.tableData=r.data.items,e.page.total=r.data.totalCount,e.page.currentPage=a.currentPage,e.page.pageSize=a.pageSize,e.tableLoading=!1}).catch(()=>{e.tableLoading=!1})}function oe(a){e.page.currentPage=1,e.page.pageSize=a,N(e.page)}function se(a){e.page.currentPage=a,N(e.page)}function ne(a){m.$confirm("此操作将永久删除该草稿, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{e.tableLoading=!0,Se({id:a.mediaId}).then(l=>{e.tableLoading=!1,l.code==200?N(e.page):(e.tableLoading=!1,m.$message.error("删除出错："+l.msg))}).catch(()=>{e.tableLoading=!1})})}function de(){e.tableLoading1=!0,Ie({current:e.page1.currentPage,size:e.page1.pageSize,type:"image"}).then(a=>{e.tableLoading1=!1,e.imageListData=a.data.items,e.page1.total=a.data.totalCount}).catch(()=>{e.tableLoading1=!1})}function re(){e.imageListData=null,e.page1.currentPage=1,de(),e.dialogImageVisible=!0}function ce(a){m.$confirm("修改内容可能还未保存，确定关闭吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{e.hackResetEditor=!1,E(()=>{e.hackResetEditor=!0}),e.isActiveAddNews=0,a()}).catch(()=>{})}function F(a){let l=e.articlesAdd[a];e.articlesAdd[a]=e.articlesAdd[a+1],e.articlesAdd[a+1]=l,e.isActiveAddNews=a+1}function ue(a){let l=e.articlesAdd[a];e.articlesAdd[a]=e.articlesAdd[a-1],e.articlesAdd[a-1]=l,e.isActiveAddNews=a-1}function H(a){e.hackResetEditor=!1,E(()=>{e.hackResetEditor=!0}),e.isActiveAddNews=a}function W(a){m.$confirm("确定删除该图文吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{e.articlesAdd.splice(a,1),e.isActiveAddNews==a&&(e.isActiveAddNews=0)}).catch(()=>{})}function me(){e.articlesAdd.push({title:"",thumbMediaId:"",author:"",digest:"",showCoverPic:"",content:"",contentSourceUrl:"",needOpenComment:"",onlyFansCanComment:"",thumbUrl:""}),e.isActiveAddNews=e.articlesAdd.length-1}function pe(){e.addMaterialLoading=!0,e.operateMaterial=="add"&&Ue({articles:e.articlesAdd}).then(a=>{e.addMaterialLoading=!1,e.dialogNewsVisible=!1,a.code==200?(e.isActiveAddNews=0,e.articlesAdd=[{title:"",thumbMediaId:"",author:"",digest:"",showCoverPic:"",content:"",contentSourceUrl:"",needOpenComment:"",onlyFansCanComment:"",thumbUrl:""}],e.page.currentPage=1,N(e.page)):m.$message.error("新增图文出错："+a.msg)}).catch(()=>{e.addMaterialLoading=!1}),e.operateMaterial=="edit"&&ze({articles:e.articlesAdd,mediaId:e.articlesMediaId}).then(a=>{e.addMaterialLoading=!1,e.dialogNewsVisible=!1,a.code==200?(e.isActiveAddNews=0,e.articlesAdd=[{title:"",thumbMediaId:"",author:"",digest:"",showCoverPic:"",content:"",contentSourceUrl:"",needOpenComment:"",onlyFansCanComment:"",thumbUrl:""}],N(e.page)):m.$message.error("修改图文出错："+a.msg)}).catch(()=>{e.addMaterialLoading=!1})}function ge(a){e.hackResetEditor=!1,E(()=>{e.hackResetEditor=!0}),e.operateMaterial=="add"&&(e.isActiveAddNews=0),e.operateMaterial="edit",e.articlesAdd=JSON.parse(JSON.stringify(a.content.newsItem)),e.articlesMediaId=a.mediaId,e.dialogNewsVisible=!0}function fe(){e.hackResetEditor=!1,E(()=>{e.hackResetEditor=!0}),e.operateMaterial=="edit"&&(e.isActiveAddNews=0,e.articlesAdd=[{title:"",thumbMediaId:"",author:"",digest:"",showCoverPic:"",content:"",contentSourceUrl:"",needOpenComment:"",onlyFansCanComment:"",thumbUrl:""}]),e.operateMaterial="add",e.dialogNewsVisible=!0}function he(a){e.addMaterialLoading=!0;const l=a.type==="image/jpeg"||a.type==="image/png"||a.type==="image/gif"||a.type==="image/bmp"||a.type==="image/jpg",r=a.size/1024/1024<2;return l||m.$message.error("上传图片格式不对!"),r||m.$message.error("上传图片大小不能超过2M!"),e.addMaterialLoading=!1,l&&r}function _e(a,l,r){e.tableLoading=!1,e.addMaterialLoading=!1,a.code==200?(e.dialogVideoVisible=!1,e.fileList=[],e.uploadData.title="",e.uploadData.introduction="",e.articlesAdd[e.isActiveAddNews].thumbMediaId=a.data.mediaId,e.articlesAdd[e.isActiveAddNews].thumbUrl=a.data.url):m.$message.error("上传出错："+a.msg)}function be(a){e.dialogImageVisible=!1,e.articlesAdd[e.isActiveAddNews].thumbMediaId=a.mediaId,e.articlesAdd[e.isActiveAddNews].thumbUrl=a.url}function ve(a){m.$confirm("你正在通过发布的方式发表内容。 发布不占用群发次数，一天可多次发布。已发布内容不会推送给用户，也不会展示在公众号主页中。 发布后，你可以前往发表记录获取链接，也可以将发布内容添加到自定义菜单、自动回复、话题和页面模板中。","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{e.tableLoading=!0,$e(a.mediaId).then(l=>{e.tableLoading=!1,m.$message.success("发布任务提交成功"),N(e.page)}).catch(()=>{e.tableLoading=!1})}).catch(()=>{})}return(a,l)=>{const r=b("el-button"),q=b("el-image"),ye=b("Plus"),we=b("el-icon"),ke=b("el-upload"),J=b("el-dialog"),P=b("el-input"),G=b("el-tab-pane"),Ae=b("el-tabs"),Ce=b("el-row"),Ne=b("el-empty"),Ve=b("el-pagination"),Q=Fe("loading");return c(),f("div",Ye,[n("div",Ke,[o(r,{type:"primary",onClick:fe},{default:s(()=>[_("新 增 ")]),_:1})]),o(J,{title:t(I)=="add"?"新建图文":"修改图文","append-to-body":"","before-close":ce,"close-on-click-modal":!1,modelValue:t(L),"onUpdate:modelValue":l[8]||(l[8]=i=>B(L)?L.value=i:null),width:"80%",top:"20px"},{footer:s(()=>[n("div",Ct,[o(r,{onClick:l[7]||(l[7]=i=>L.value=!1)},{default:s(()=>[_("取 消")]),_:1}),o(r,{type:"primary",onClick:pe},{default:s(()=>[_("提 交")]),_:1})])]),default:s(()=>[n("div",Xe,[n("div",Ze,[(c(!0),f(R,null,K(t(d),(i,g)=>(c(),f("div",{key:i.id},[g==0?(c(),f("div",{key:0,class:D(["news-main father",{activeAddNews:t(p)==g}]),onClick:M=>H(g)},[n("div",tt,[o(q,{class:"material-img",src:i.thumbUrl},{error:s(()=>[at]),_:2},1032,["src"]),n("div",lt,X(i.title),1)]),t(d).length>1?(c(),f("div",it,[o(r,{size:"small",icon:"Bottom",onClick:M=>F(g)},{default:s(()=>[_("下移")]),_:2},1032,["onClick"]),t(I)=="add"?(c(),z(r,{key:0,size:"small",type:"danger",icon:"Delete",onClick:M=>W(g)},{default:s(()=>[_("删除 ")]),_:2},1032,["onClick"])):v("",!0)])):v("",!0)],10,et)):v("",!0),g>0?(c(),f("div",{key:1,class:D(["news-main-item father",{activeAddNews:t(p)==g}]),onClick:M=>H(g)},[n("div",st,[n("div",nt,X(i.title),1),n("div",dt,[o(q,{class:"material-img",style:{height:"55px"},src:i.thumbUrl},{error:s(()=>[rt]),_:2},1032,["src"])])]),n("div",ct,[t(d).length>g+1?(c(),z(r,{key:0,size:"small",icon:"Bottom",onClick:M=>F(g)},{default:s(()=>[_("下移 ")]),_:2},1032,["onClick"])):v("",!0),o(r,{size:"small",icon:"Top",onClick:M=>ue(g)},{default:s(()=>[_("上移")]),_:2},1032,["onClick"]),t(I)=="add"?(c(),z(r,{key:1,size:"small",type:"danger",icon:"Delete",onClick:M=>W(g)},{default:s(()=>[_("删除 ")]),_:2},1032,["onClick"])):v("",!0)])],10,ot)):v("",!0)]))),128)),t(d).length<8&&t(I)=="add"?(c(),f("div",ut,[o(r,{onClick:me,type:"primary",icon:"Plus",circle:""})])):v("",!0)])]),Y((c(),f("div",mt,[o(Ae,{modelValue:t($),"onUpdate:modelValue":l[6]||(l[6]=i=>B($)?$.value=i:null)},{default:s(()=>[o(G,{label:"封面标题",name:"title"},{default:s(()=>[n("div",null,[n("div",pt,[gt,n("div",null,[t(d)[t(p)].thumbUrl?(c(),f("img",{key:0,class:D(["material-img",t(p)==0?"avatar":"avatar1"]),src:t(d)[t(p)].thumbUrl},null,10,ft)):(c(),z(we,{key:1,class:D(["avatar-uploader-icon",t(p)==0?"avatar":"avatar1"])},{default:s(()=>[o(ye)]),_:1},8,["class"])),n("div",ht,[o(ke,{action:t(le),headers:t(ie),multiple:"",limit:1,"on-success":_e,"file-list":t(T),"before-upload":he,data:t(y)},{trigger:s(()=>[o(r,{size:"small",type:"primary"},{default:s(()=>[_(" 本地上传 ")]),_:1})]),tip:s(()=>[_t]),default:s(()=>[o(r,{size:"small",type:"primary",onClick:re,style:{"margin-left":"5px"}},{default:s(()=>[_("素材库选择 ")]),_:1})]),_:1},8,["action","headers","file-list","data"])])])]),o(J,{title:"选择图片",modelValue:t(x),"onUpdate:modelValue":l[0]||(l[0]=i=>B(x)?x.value=i:null),width:"80%","append-to-body":""},{default:s(()=>[o(Me,{objData:{repType:"image"},onSelectMaterial:be})]),_:1},8,["modelValue"]),n("div",bt,[vt,o(P,{modelValue:t(d)[t(p)].title,"onUpdate:modelValue":l[1]||(l[1]=i=>t(d)[t(p)].title=i),placeholder:"请输入标题"},null,8,["modelValue"]),yt,o(P,{modelValue:t(d)[t(p)].author,"onUpdate:modelValue":l[2]||(l[2]=i=>t(d)[t(p)].author=i),placeholder:"请输入作者"},null,8,["modelValue"]),wt,o(P,{modelValue:t(d)[t(p)].contentSourceUrl,"onUpdate:modelValue":l[3]||(l[3]=i=>t(d)[t(p)].contentSourceUrl=i),placeholder:"请输入原文地址"},null,8,["modelValue"])])]),kt,o(P,{rows:5,type:"textarea",modelValue:t(d)[t(p)].digest,"onUpdate:modelValue":l[4]||(l[4]=i=>t(d)[t(p)].digest=i),placeholder:"请输入摘要",maxlength:"120"},null,8,["modelValue"])]),_:1}),o(G,{label:"内容详情",name:"content"},{default:s(()=>[n("div",At,[t(ae)?(c(),z(Qe,{key:0,modelValue:t(d)[t(p)].content,"onUpdate:modelValue":l[5]||(l[5]=i=>t(d)[t(p)].content=i),minHeight:350,uploadData:t(y)},null,8,["modelValue","uploadData"])):v("",!0)])]),_:1})]),_:1},8,["modelValue"])])),[[Q,t(u)]])]),_:1},8,["title","modelValue"]),Y((c(),f("div",Nt,[(c(!0),f(R,null,K(t(h),i=>(c(),f(R,{key:i.id},[i.content&&i.content.newsItem?(c(),f("div",Vt,[o(qe,{objData:i.content.newsItem},null,8,["objData"]),o(Ce,{class:"ope-row"},{default:s(()=>[o(r,{type:"success",icon:"Promotion",size:"small",onClick:g=>ve(i)},{default:s(()=>[_("发布")]),_:2},1032,["onClick"]),o(r,{type:"primary",size:"small",plain:"",icon:"el-icon-edit",onClick:g=>ge(i)},{default:s(()=>[_("编辑")]),_:2},1032,["onClick"]),o(r,{type:"danger",size:"small",plain:"",icon:"el-icon-delete",onClick:g=>ne(i)},{default:s(()=>[_("删除")]),_:2},1032,["onClick"])]),_:2},1024)])):v("",!0)],64))),128))])),[[Q,t(S)]]),t(h).length<=0&&!t(S)?(c(),f("div",Lt,[o(Ne)])):v("",!0),o(Ve,{onSizeChange:oe,onCurrentChange:se,"current-page":t(V).currentPage,"onUpdate:currentPage":l[9]||(l[9]=i=>t(V).currentPage=i),"page-sizes":[10,20],"page-size":t(V).pageSize,layout:"total, sizes, prev, pager, next, jumper",total:t(V).total,class:"pagination"},null,8,["current-page","page-size","total"])])}}}),Tt=Te(Ut,[["__scopeId","data-v-bd36ae7a"]]);export{Tt as default};
