import{c as g}from"./permission-CtopeLks.js";import{U as m,B as q,d as R,C as z,D as A,y as E,e as h,c as G,o as S,f as b,i,l as s,V as H,h as M,A as W,j as U,k as w,n as x,G as Z}from"./index-DxyzpFVi.js";function J(l){return m({url:"/goodsspu/page",method:"get",params:l})}function K(l){return m({url:"/goodsspu",method:"post",data:l})}function Q(l){return m({url:"/goodsspu/"+l,method:"get"})}function X(l){return m({url:"/goodsspu/"+l,method:"delete"})}function Y(l){return m({url:"/goodsspu",method:"put",data:l})}function ee(l){return m({url:"/goodsspu/shelf",method:"put",params:l})}const ae={dialogType:"drawer",border:!0,stripe:!0,menuAlign:"center",align:"center",menuType:"text",searchShow:!1,excelBtn:!0,printBtn:!0,selection:!0,dialogWidth:"88%",searchMenuSpan:6,column:[{label:"商品名称",prop:"name",search:!0,display:!1},{label:"商品图片",prop:"picUrls",width:125,slot:!0,display:!1},{label:"类目",prop:"categoryId",type:"cascader",search:!0,props:{label:"name",value:"id"},dicUrl:"/goodscategory/tree",checkStrictly:!0,display:!1},{label:"卖点",prop:"sellPoint",display:!1,overHidden:!0,width:120},{label:"销售价",prop:"salesPrice",slot:!0,display:!1},{label:"市场价",prop:"marketPrice",display:!1},{label:"成本价",prop:"costPrice",display:!1},{label:"库存",prop:"stock",display:!1},{label:"商品编码",prop:"spuCode",width:110,search:!0,sortable:!0,display:!1},{label:"虚拟销量",prop:"saleNum",display:!1},{label:"创建时间",prop:"createTime",sortable:"custom",width:110,display:!1},{label:"是否上架",prop:"shelf",type:"radio",search:!0,width:110,sortable:"custom",slot:!0,display:!1,dicData:[{label:"下架",value:"0"},{label:"上架",value:"1"}]},{label:"更新时间",prop:"updateTime",width:110,display:!1}],group:[{icon:"el-icon-goods",label:"基本信息",prop:"group1",column:[{label:"商品名称",prop:"name",span:24,rules:[{required:!0,message:"商品名称不能为空",trigger:"blur"},{max:100,message:"长度在不能超过100个字符"}]},{label:"商品图片",prop:"picUrls",listType:"picture-card",dataType:"array",type:"upload",width:250,rules:[{required:!0,message:"图片不能为空",trigger:"change"}],canvasOption:{text:"joolun",ratio:.1},oss:"ali",loadText:"附件上传中，请稍等",span:24,tip:"只能上传jpg/png文件，且不超过50kb"},{label:"类目",prop:"categoryId",type:"cascader",props:{label:"name",value:"id"},dicUrl:"/goodscategory/tree",checkStrictly:!0,rules:[{required:!0,message:"请选择类目",trigger:"blur"}]},{label:"是否上架",prop:"shelf",type:"radio",rules:[{required:!0,message:"请选择是否上架",trigger:"blur"}],dicData:[{label:"下架",value:"0"},{label:"上架",value:"1"}]},{label:"商品编码",prop:"spuCode",rules:[{max:32,message:"长度在不能超过32个字符"}]},{label:"库存",prop:"stock",type:"number",precision:0,min:0,rules:[{required:!0,message:"库存必须填写",trigger:"blur"}]},{label:"销售价",prop:"salesPrice",type:"number",precision:2,min:0,rules:[{required:!0,message:"销售价必须填写",trigger:"blur"}]},{label:"市场价",prop:"marketPrice"},{label:"成本价",prop:"costPrice"},{label:"虚拟销量",prop:"saleNum",type:"number",precision:0,min:0,tip:"可以按自己需求设置，系统会按销售情况自动累加"},{label:"卖点",prop:"sellPoint",span:24,rules:[{max:500,message:"长度在不能超过500个字符"}]}]},{icon:"el-icon-grape",label:"辅助信息",prop:"group5",column:[{label:"描述",prop:"description",formslot:!0,span:24}]}]},te={style:{color:"red"}},oe=q({name:"GoodsSpu"}),se=Object.assign(oe,{setup(l){const{proxy:d}=R(),a=z({form:{},tableData:[],page:{total:0,currentPage:1,pageSize:20,ascs:[],descs:"create_time"},paramsSearch:{},tableLoading:!1,dialogAppraises:!1,optionAppraises:{props:{avatar:"nickName",author:"headimgUrl",body:"content"}},selectionData:[],pointsConfig:null}),{form:c,page:k,tableData:P,tableLoading:V}=A(a),I=E(()=>({addBtn:g(["mall:goodsspu:add"]),delBtn:g(["mall:goodsspu:del"]),editBtn:g(["mall:goodsspu:edit"]),viewBtn:g(["mall:goodsspu:get"])}));function D(e){a.selectionData=e}function v(e){if(a.selectionData.length<=0){d.$message.error("请选择商品");return}let t="";a.selectionData.forEach(o=>{t+=o.id+","}),C(t,e)}function B(e){e&&e.id&&C(e.id,e.shelf)}function C(e,t){ee({ids:e,shelf:t}).then(o=>{n(a.page)}).catch(()=>{n(a.page)})}function O(e,t){t=="add"?e():t=="edit"&&(a.tableLoading=!0,Q(a.form.id).then(o=>{a.form.description=o.data.description,a.tableLoading=!1,e()}).catch(()=>{a.tableLoading=!1,e()}))}function j(e,t){e=d.filterForm(e),a.paramsSearch=e,a.page.currentPage=1,n(a.page,e),t()}function L(e){let t=e.prop?e.prop.replace(/([A-Z])/g,"_$1").toLowerCase():"";e.order=="ascending"?(a.page.descs=[],a.page.ascs=t):e.order=="descending"?(a.page.ascs=[],a.page.descs=t):(a.page.ascs=[],a.page.descs=[]),n(a.page)}function n(e,t){a.tableLoading=!0,a.paramsSearch.categoryId&&(a.paramsSearch.categoryFirst=a.paramsSearch.categoryId[0],a.paramsSearch.categorySecond=a.paramsSearch.categoryId[1]),J(Object.assign({current:e.currentPage,size:e.pageSize,descs:a.page.descs,ascs:a.page.ascs},t,a.paramsSearch)).then(o=>{let u=o.data.records?o.data.records:[];u.forEach(function(p,_){let f=[];p.categoryFirst&&f.push(p.categoryFirst),p.categorySecond&&f.push(p.categorySecond),p.categoryId=f}),a.tableData=u,a.page.total=o.data.total,a.page.currentPage=e.currentPage,a.page.pageSize=e.pageSize,a.tableLoading=!1}).catch(()=>{a.tableLoading=!1})}function T(e,t){d.$confirm("是否确认删除此数据","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){return X(e.id)}).then(()=>{d.$message({showClose:!0,message:"删除成功",type:"success"}),n(a.page)}).catch(function(o){})}function $(e,t,o,u){e.categoryFirst=e.categoryId[0],e.categorySecond=e.categoryId[1]?e.categoryId[1]:"",Y(e).then(()=>{d.$message({showClose:!0,message:"修改成功",type:"success"}),o(),n(a.page)}).catch(()=>{u()})}function F(e,t,o){e.categoryFirst=e.categoryId[0],e.categorySecond=e.categoryId[1]?e.categoryId[1]:"",K(e).then(()=>{d.$message({showClose:!0,message:"添加成功",type:"success"}),t(),n(a.page)}).catch(()=>{o()})}function N(e){n(a.page)}return(e,t)=>{const o=h("el-button"),u=h("el-switch"),p=h("ImageUpload"),_=h("el-image"),f=h("avue-crud");return S(),G("div",null,[b(f,{ref:"crud",modelValue:s(c),"onUpdate:modelValue":t[4]||(t[4]=r=>Z(c)?c.value=r:null),page:s(k),data:s(P),"table-loading":s(V),option:s(ae),permission:s(I),"before-open":O,onOnLoad:n,onRefreshChange:N,onRowUpdate:$,onRowSave:F,onRowDel:T,onSortChange:L,onSearchChange:j,onSelectionChange:D},{"menu-left":i(()=>[s(g)(["mall:goodsspu:edit"])?(S(),U(o,{key:0,type:"success",onClick:t[0]||(t[0]=r=>v("1")),icon:"el-icon-document"},{default:i(()=>[x("批量上架")]),_:1})):w("",!0),s(g)(["mall:goodsspu:edit"])?(S(),U(o,{key:1,type:"warning",onClick:t[1]||(t[1]=r=>v("0")),icon:"el-icon-document"},{default:i(()=>[x("批量下架")]),_:1})):w("",!0)]),salesPrice:i(r=>[M("div",te,"￥"+W(r.row.salesPrice),1)]),shelf:i(r=>[b(u,{"active-value":"1","inactive-value":"0",modelValue:r.row.shelf,"onUpdate:modelValue":y=>r.row.shelf=y,style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"},"inline-prompt":"","active-icon":"Check","inactive-icon":"Close",onChange:y=>B(r.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),"description-form":i(()=>[b(H,{modelValue:s(c).description,"onUpdate:modelValue":t[2]||(t[2]=r=>s(c).description=r),minHeight:300},null,8,["modelValue"])]),"picUrls-form":i(r=>[b(p,{limit:5,disabled:r.type=="view",returnType:"array",modelValue:s(c).picUrls,"onUpdate:modelValue":t[3]||(t[3]=y=>s(c).picUrls=y)},null,8,["disabled","modelValue"])]),picUrls:i(r=>[b(_,{style:{width:"100px",height:"100px"},src:r.row.picUrls?r.row.picUrls[0]:""},null,8,["src"])]),_:1},8,["modelValue","page","data","table-loading","option","permission"])])}}});export{se as default};
