import{c as ie,d as ne,g as de,b as re}from"./main.vue_vue_type_style_index_0_scoped_25ddb73a_lang-CRgDsjTq.js";import{_ as se,B as pe,d as ue,r as F,C as ce,$ as ge,D as me,F as fe,e as r,I as _e,c as h,o as _,f as o,i,h as s,J as A,k as be,l as t,n as c,L as ye,M as he,A as ve,j as O,G as E,t as Le,v as Ce}from"./index-DxyzpFVi.js";/* empty css                                                 *//* empty css                                                             */const y=v=>(Le("data-v-e1e659e8"),v=v(),Ce(),v),we={class:"app-container"},Ve=y(()=>s("span",null,"图片",-1)),ke={class:"add_but"},ze=y(()=>s("div",{class:"el-upload__tip"}," 支持bmp/png/jpeg/jpg/gif格式，大小不超过2M ",-1)),Me={class:"waterfall"},Ue=["href"],Pe=["src"],Ie={class:"item-name"},Te={key:0,class:"el-table__empty-block"},$e=y(()=>s("span",null,"语音",-1)),xe={class:"add_but"},Se=y(()=>s("div",{class:"el-upload__tip"}," 格式支持mp3/wma/wav/amr，文件大小不超过2M，播放长度不超过60s ",-1)),De=y(()=>s("span",null,"视频",-1)),Ae={class:"add_but"},je=y(()=>s("div",{class:"el-upload__tip"},"格式支持MP4，文件大小不超过10MB",-1)),Ne={class:"dialog-footer"},Be=pe({name:"WxMpMaterial"}),Re=Object.assign(Be,{setup(v){const{proxy:p}=ue(),j=F(null),e=ce({materialType:"image",tableData:[],page:{total:0,currentPage:1,pageSize:10},page1:{total:0,currentPage:1,pageSize:10},tableLoading:!1,fileList:[],dialogVideoVisible:!1,dialogNewsVisible:!1,addMaterialLoading:!1,uploadData:{mediaType:"image",title:"",introduction:""},uploadRules:{title:[{required:!0,message:"请输入标题",trigger:"blur"}],introduction:[{required:!0,message:"请输入描述",trigger:"blur"}]},articlesAdd:[{title:"",thumbMediaId:"",author:"",digest:"",showCoverPic:"",content:"",contentSourceUrl:"",needOpenComment:"",onlyFansCanComment:"",thumbUrl:""}],isActiveAddNews:0,dialogImageVisible:!1,imageListData:[],tableLoading1:!1,operateMaterial:"add",articlesMediaId:"",hackResetEditor:!1,actionUrl:F("/dev-api/wxmaterial/materialFileUpload"),headers:{Authorization:"Bearer "+ge()}}),{materialType:k,tableData:L,tableLoading:C,page:u,page1:Fe,fileList:z,dialogVideoVisible:w,dialogNewsVisible:Oe,addMaterialLoading:Ee,uploadData:m,uploadRules:q,articlesAdd:qe,isActiveAddNews:Ge,dialogImageVisible:Je,imageListData:We,tableLoading1:He,operateMaterial:Ke,articlesMediaId:Qe,hackResetEditor:Xe,actionUrl:M,headers:U}=me(e);fe(()=>{b(e.page)});function G(a){e.tableLoading=!0,re({mediaId:a.mediaId}).then(l=>{if(e.tableLoading=!1,l.code==200){let n=l.data.downUrl;window.open(n,"_blank")}else p.$message.error("获取微信视频素材出错："+l.data.msg)}).catch(()=>{e.tableLoading=!1})}function J(a){e.tableLoading=!0,de({mediaId:a.mediaId,fileName:a.name}).then(l=>{e.tableLoading=!1;let n=window.URL.createObjectURL(new Blob([l.data])),g=document.createElement("a");g.style.display="none",g.href=n,g.setAttribute("download",a.name),document.body.appendChild(g),g.click()}).catch(()=>{e.tableLoading=!1})}function W(){p.$refs.uploadForm.validate(a=>{if(a)j.value.submit();else return!1})}function H(){e.dialogVideoVisible=!0}function K(a){e.tableLoading=!0;const l=a.type==="image/jpeg"||a.type==="image/png"||a.type==="image/gif"||a.type==="image/bmp"||a.type==="image/jpg",n=a.size/1024/1024<2;return l||p.$message.error("上传图片格式不对!"),n||p.$message.error("上传图片大小不能超过2M!"),e.tableLoading=!1,l&&n}function Q(a){e.tableLoading=!0;const l=a.type==="audio/mp3"||a.type==="audio/wma"||a.type==="audio/wav"||a.type==="audio/amr",n=a.size/1024/1024<2;return l||p.$message.error("上传语音格式不对!"),n||p.$message.error("上传语音大小不能超过2M!"),e.tableLoading=!1,l&&n}function X(a){e.addMaterialLoading=!0;const l=a.type==="video/mp4",n=a.size/1024/1024<10;return l||p.$message.error("上传视频格式不对!"),n||p.$message.error("上传视频大小不能超过10M!"),e.addMaterialLoading=!1,l&&n}function P(a){p.$confirm("此操作将永久删除该文件, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{e.tableLoading=!0,ne({id:a.mediaId}).then(l=>{e.tableLoading=!1,l.code==200?b(e.page):(e.tableLoading=!1,p.$message.error("删除出错："+l.data.msg))}).catch(()=>{e.tableLoading=!1})})}function Y(a){p.$message.error("上传出错："+a)}function I(a,l,n){e.tableLoading=!1,e.addMaterialLoading=!1,a.code==200?(e.dialogVideoVisible=!1,e.fileList=[],e.uploadData.title="",e.uploadData.introduction="",e.materialType!="news"?(e.page.currentPage=1,b(e.page)):(e.articlesAdd[e.isActiveAddNews].thumbMediaId=a.data.mediaId,e.articlesAdd[e.isActiveAddNews].thumbUrl=a.data.url)):(e.fileList=[],p.$message.error("上传出错："+a.msg))}function Z(a,l){let n=a.paneName;e.page.currentPage=1,e.materialType=n,b(e.page),e.uploadData.mediaType=n,n=="news"&&(e.uploadData.mediaType="image")}function b(a,l){e.tableData=[],e.tableLoading=!0,ie(Object.assign({current:a.currentPage,size:a.pageSize,type:e.materialType},l)).then(n=>{e.tableData=n.data.items,e.page.total=n.data.totalCount,e.page.currentPage=a.currentPage,e.page.pageSize=a.pageSize,e.tableLoading=!1}).catch(()=>{e.tableLoading=!1})}function T(a){e.page.currentPage=1,e.page.pageSize=a,b(e.page)}function $(a){e.page.currentPage=a,b(e.page)}return(a,l)=>{const n=r("el-button"),g=r("el-upload"),ee=r("el-row"),ae=r("el-empty"),x=r("el-pagination"),S=r("el-tab-pane"),f=r("el-table-column"),N=r("el-table"),B=r("el-input"),R=r("el-form-item"),te=r("el-form"),le=r("el-dialog"),oe=r("el-tabs"),D=_e("loading");return _(),h("div",we,[o(oe,{modelValue:t(k),"onUpdate:modelValue":l[7]||(l[7]=d=>E(k)?k.value=d:null),onTabClick:Z},{default:i(()=>[o(S,{name:"image"},{label:i(()=>[Ve]),default:i(()=>[s("div",ke,[o(g,{action:t(M),headers:t(U),multiple:"",limit:1,"on-success":I,"on-error":Y,"file-list":t(z),"before-upload":K,data:t(m)},{tip:i(()=>[ze]),default:i(()=>[o(n,{type:"primary",icon:"Upload"},{default:i(()=>[c("点击上传")]),_:1})]),_:1},8,["action","headers","file-list","data"])]),A((_(),h("div",Me,[(_(!0),h(ye,null,he(t(L),d=>(_(),h("div",{class:"waterfall-item",key:d.id},[s("a",{target:"_blank",href:d.url},[s("img",{class:"material-img",src:d.url},null,8,Pe),s("div",Ie,ve(d.name),1)],8,Ue),o(ee,{class:"ope-row flex-c"},{default:i(()=>[o(n,{type:"danger",icon:"el-icon-delete",circle:"",onClick:V=>P(d)},null,8,["onClick"])]),_:2},1024)]))),128))])),[[D,t(C)]]),t(L).length<=0&&!t(C)?(_(),h("div",Te,[o(ae)])):be("",!0),o(x,{onSizeChange:T,onCurrentChange:$,"current-page":t(u).currentPage,"onUpdate:currentPage":l[0]||(l[0]=d=>t(u).currentPage=d),"page-sizes":[10,20],"page-size":t(u).pageSize,layout:"total, sizes, prev, pager, next, jumper",total:t(u).total,class:"pagination"},null,8,["current-page","page-size","total"])]),_:1}),o(S,{name:"voice"},{label:i(()=>[$e]),default:i(()=>[s("div",xe,[o(g,{action:t(M),headers:t(U),multiple:"",limit:1,"on-success":I,"file-list":t(z),"before-upload":Q,data:t(m)},{tip:i(()=>[Se]),default:i(()=>[o(n,{type:"primary",icon:"Upload"},{default:i(()=>[c("点击上传")]),_:1})]),_:1},8,["action","headers","file-list","data"])]),A((_(),O(N,{data:t(L),stripe:"",border:""},{default:i(()=>[o(f,{prop:"mediaId",label:"media_id"}),o(f,{prop:"name",label:"名称"}),o(f,{prop:"updateTime",label:"更新时间"}),o(f,{fixed:"right",label:"操作"},{default:i(d=>[o(n,{link:"",icon:"el-icon-download",type:"primary",onClick:V=>J(d.row)},{default:i(()=>[c("下载")]),_:2},1032,["onClick"]),o(n,{link:"",icon:"el-icon-delete",type:"danger",onClick:V=>P(d.row)},{default:i(()=>[c("删除")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[D,t(C)]]),o(x,{onSizeChange:T,onCurrentChange:$,"current-page":t(u).currentPage,"onUpdate:currentPage":l[1]||(l[1]=d=>t(u).currentPage=d),"page-sizes":[10,20],"page-size":t(u).pageSize,layout:"total, sizes, prev, pager, next, jumper",total:t(u).total,class:"pagination"},null,8,["current-page","page-size","total"])]),_:1}),o(S,{name:"video"},{label:i(()=>[De]),default:i(()=>[s("div",Ae,[o(n,{type:"primary",icon:"Plus",onClick:H},{default:i(()=>[c("新建")]),_:1})]),o(le,{title:"新建视频",modelValue:t(w),"onUpdate:modelValue":l[5]||(l[5]=d=>E(w)?w.value=d:null)},{footer:i(()=>[s("div",Ne,[o(n,{onClick:l[4]||(l[4]=d=>w.value=!1)},{default:i(()=>[c("取 消")]),_:1}),o(n,{type:"primary",onClick:W},{default:i(()=>[c("提 交")]),_:1})])]),default:i(()=>[o(g,{ref_key:"uploadVideo",ref:j,action:t(M),headers:t(U),multiple:"",limit:1,"on-success":I,"file-list":t(z),"before-upload":X,"auto-upload":!1,data:t(m)},{trigger:i(()=>[o(n,{type:"primary"},{default:i(()=>[c("选择视频")]),_:1})]),default:i(()=>[je]),_:1},8,["action","headers","file-list","data"]),o(te,{model:t(m),rules:t(q),ref:"uploadForm"},{default:i(()=>[o(R,{label:"标题",prop:"title"},{default:i(()=>[o(B,{modelValue:t(m).title,"onUpdate:modelValue":l[2]||(l[2]=d=>t(m).title=d),placeholder:"标题将展示在相关播放页面，建议填写清晰、准确、生动的标题"},null,8,["modelValue"])]),_:1}),o(R,{label:"描述",prop:"introduction"},{default:i(()=>[o(B,{rows:3,type:"textarea",modelValue:t(m).introduction,"onUpdate:modelValue":l[3]||(l[3]=d=>t(m).introduction=d),placeholder:"介绍语将展示在相关播放页面，建议填写简洁明确、有信息量的内容"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"]),A((_(),O(N,{data:t(L),stripe:"",border:""},{default:i(()=>[o(f,{prop:"mediaId",label:"media_id"}),o(f,{prop:"name",label:"名称"}),o(f,{prop:"updateTime",label:"更新时间"}),o(f,{fixed:"right",label:"操作"},{default:i(d=>[o(n,{link:"",icon:"el-icon-view",type:"primary",onClick:V=>G(d.row)},{default:i(()=>[c("查看")]),_:2},1032,["onClick"]),o(n,{link:"",icon:"el-icon-delete",type:"danger",onClick:V=>P(d.row)},{default:i(()=>[c("删除")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[D,t(C)]]),o(x,{onSizeChange:T,onCurrentChange:$,"current-page":t(u).currentPage,"onUpdate:currentPage":l[6]||(l[6]=d=>t(u).currentPage=d),"page-sizes":[10,20],"page-size":t(u).pageSize,layout:"total, sizes, prev, pager, next, jumper",total:t(u).total,class:"pagination"},null,8,["current-page","page-size","total"])]),_:1})]),_:1},8,["modelValue"])])}}}),ta=se(Re,[["__scopeId","data-v-e1e659e8"]]);export{ta as default};
