import{c as k}from"./permission-CtopeLks.js";import{U as h,B as ne,d as se,r as re,C as ie,D as oe,y as ue,F as de,e as p,I as ce,c as L,o as d,f as g,i as n,L as B,M as V,l as i,j as m,J as x,n as c,G as S,A as E,h as N,k as U}from"./index-DxyzpFVi.js";import{g as pe}from"./wxusertags-CjEFZ3CX.js";import{W as ge}from"./main-rttH6h2b.js";import"./main-DtlCLU_N.js";import"./main.vue_vue_type_style_index_0_scoped_25ddb73a_lang-CRgDsjTq.js";import"./wxfreepublish-ncAXMMh-.js";/* empty css                                                             */import"./main-dgY30BGH.js";function me(r){return h({url:"/wxuser/page",method:"get",params:r})}function fe(r){return h({url:"/wxuser",method:"post",data:r})}function be(r){return h({url:"/wxuser/"+r,method:"delete"})}function he(r){return h({url:"/wxuser",method:"put",data:r})}function _e(r){return h({url:"/wxuser/synchron",method:"post",data:r})}function ye(r){return h({url:"/wxuser/remark",method:"put",data:r})}function we(r){return h({url:"/wxuser/tagid-list",method:"put",data:r})}let xe=[{label:"公众号搜索",value:"ADD_SCENE_SEARCH"},{label:"公众号迁移",value:"ADD_SCENE_ACCOUNT_MIGRATION"},{label:"名片分享",value:"ADD_SCENE_PROFILE_CARD"},{label:"扫描二维码",value:"ADD_SCENE_QR_CODE"},{label:"图文页内名称点击",value:"ADD_SCENE_PROFILE_LINK"},{label:"图文页右上角菜单",value:"ADD_SCENE_PROFILE_ITEM"},{label:"支付后关注",value:"ADD_SCENE_PAID"},{label:"其他",value:"ADD_SCENE_OTHERS"}],De=[{label:"取消关注",value:"0"},{label:"已关注",value:"1"}],ke=[{label:"未知",value:"0"},{label:"男",value:"1"},{label:"女",value:"2"}];const ve={dialogDrag:!0,border:!0,index:!1,indexLabel:"序号",stripe:!0,selection:!0,menuAlign:"center",align:"center",editBtn:!1,delBtn:!1,addBtn:!1,viewBtn:!0,searchShow:!1,menuWidth:150,menuType:"text",searchMenuSpan:6,defaultSort:{prop:"subscribeTime",order:"descending"},column:[{label:"头像",prop:"headimgUrl",dataType:"string",fileType:"img",type:"upload",minWidth:83,listType:"picture-img",editDisplay:!1},{label:"昵称",prop:"nickName",width:100,sortable:!0,search:!0,editDisplay:!1},{label:"是否订阅",prop:"subscribe",width:110,type:"select",sortable:!0,search:!0,editDisplay:!1,slot:!0,dicData:De},{label:"openId",prop:"openId",search:!0},{label:"关注渠道",prop:"subscribeScene",width:110,type:"select",sortable:!0,search:!0,editDisplay:!1,dicData:xe},{label:"关注时间",prop:"subscribeTime",type:"datetime",width:110,sortable:!0,editDisplay:!1},{label:"性别",prop:"sex",type:"select",search:!0,editDisplay:!1,slot:!0,dicData:ke},{label:"国家",prop:"country",search:!0,editDisplay:!1},{label:"省份",prop:"province",editDisplay:!1},{label:"城市",prop:"city",search:!0,editDisplay:!1},{label:"语言",prop:"language",editDisplay:!1},{label:"标签",prop:"tagidList",type:"select",editDisplay:!1,searchslot:!0,search:!0,props:{label:"name",value:"id"}},{label:"备注",prop:"remark"},{label:"二维码扫码场景",prop:"qrSceneStr",sortable:!0,minWidth:90,search:!0,editDisplay:!1},{label:"union_id",prop:"unionId",hide:!0,editDisplay:!1},{label:"关注次数",prop:"subscribeNum",width:110,sortable:!0,editDisplay:!1},{label:"创建时间",prop:"createTime",type:"datetime",sortable:!0,hide:!0,editDisplay:!1},{label:"更新时间",prop:"updateTime",type:"datetime",sortable:!0,hide:!0,editDisplay:!1},{label:"取关时间",prop:"cancelSubscribeTime",type:"datetime",sortable:!0,hide:!0,editDisplay:!1}]},Ce=N("i",{class:"el-icon-map-location"},null,-1),Te={class:"dialog-footer"},Le=ne({name:"WxMpUser"}),Re=Object.assign(Le,{setup(r){const{proxy:s}=se(),v=re(null),e=ie({tableData:[],page:{total:0,currentPage:1,pageSize:20,ascs:[],descs:"subscribe_time"},paramsSearch:{},tableLoading:!1,selectionData:[],dialogTagging:!1,checkedTags:[],userTagsData:[],taggingType:"",dialogMsgVisible:!1,wxUserId:""}),{tableData:A,tableLoading:R,page:O,dialogTagging:_,checkedTags:C,userTagsData:I,taggingType:T,dialogMsgVisible:D,wxUserId:P}=oe(e),M=ue(()=>({addBtn:k(["wxmp:wxuser:add"]),delBtn:k(["wxmp:wxuser:del"]),editBtn:k(["wxmp:wxuser:edit"]),viewBtn:k(["wxmp:wxuser:get"])}));de(()=>{F()});function F(){e.tableLoading=!0,pe().then(a=>{if(a.code==200){let t=a.data;e.userTagsData=t,v.value.DIC.tagidList=t}else s.$message.error("获取用户标签出错："+a.msg);e.tableLoading=!1,o(e.page)}).catch(()=>{e.tableLoading=!1,o(e.page)})}function j(a){e.wxUserId=a.id,e.dialogMsgVisible=!0}function W(){let a=[];for(let t=0;t<e.selectionData.length;t++)a.push(e.selectionData[t].openId);if(e.checkedTags.length<=0){s.$message.error("请选择标签");return}if(a.length<=0){s.$message.error("请选择用户");return}e.tableLoading=!0,we({taggingType:e.taggingType,tagIds:e.checkedTags,openIds:a}).then(t=>{e.tableLoading=!1,e.checkedTags=[],v.value.selectClear(),t.code==200?o(e.page):s.$message.error("打标签出错："+t.msg)}).catch(()=>{e.tableLoading=!1}),e.dialogTagging=!1}function z(a){e.selectionData=a}function q(a,t){a=s.filterForm(a),e.paramsSearch=a,e.page.currentPage=1,o(e.page,a),t()}function G(){s.$confirm("同步用户需要一定时间，用户量越大、用时越久，请耐心等待，勿重复提交；确认此操作吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{e.tableLoading=!0,_e().then(a=>{e.tableLoading=!1,a.code==200?o(e.page):s.$message.error("同步微信用户出错："+a.msg)}).catch(()=>{e.tableLoading=!1}),setTimeout(()=>{e.tableLoading&&(e.tableLoading=!1,s.$alert("同步请求发送成功，系统正在处理中，请稍后刷新查看同步结果，用户量越大用时越久，请耐心等待，勿重复提交","提示",{confirmButtonText:"确定"}))},3e3)}).catch(()=>{})}function H(a){let t=a.prop?a.prop.replace(/([A-Z])/g,"_$1").toLowerCase():"";a.order=="ascending"?(e.page.descs=[],e.page.ascs=t):a.order=="descending"?(e.page.ascs=[],e.page.descs=t):(e.page.ascs=[],e.page.descs=[]),o(e.page)}function o(a,t){e.tableLoading=!0,me(Object.assign({current:a.currentPage,size:a.pageSize,descs:e.page.descs,ascs:e.page.ascs,appType:"2"},t,e.paramsSearch)).then(u=>{e.tableData=u.data.records,e.page.total=u.data.total,e.page.currentPage=a.currentPage,e.page.pageSize=a.pageSize,e.tableLoading=!1}).catch(()=>{e.tableLoading=!1})}function J(a,t){s.$prompt("请输入备注","提示",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/\S/,inputErrorMessage:"输入不能为空"}).then(({value:u})=>{e.tableLoading=!0,a.remark=u,ye(a).then(y=>{e.tableLoading=!1,y.code==200?(e.tableData.splice(t,1,Object.assign({},a)),s.$message({showClose:!0,message:"修改成功",type:"success"}),o(e.page)):s.$message.error(y.msg)}).catch(()=>{e.tableLoading=!1})})}function K(a,t){s.$confirm("是否确认删除","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){return be(a.id)}).then(()=>{s.$message({showClose:!0,message:"删除成功",type:"success"}),o(e.page)}).catch(function(u){})}function Q(a,t,u,y){he(a).then(()=>{s.$message({showClose:!0,message:"修改成功",type:"success"}),u(),o(e.page)}).catch(()=>{y()})}function Z(a,t,u){fe(a).then(()=>{s.$message({showClose:!0,message:"添加成功",type:"success"}),t(),o(e.page)}).catch(()=>{u()})}function X(a){o(e.page)}return(a,t)=>{const u=p("el-tag"),y=p("el-link"),f=p("el-button"),Y=p("el-checkbox"),ee=p("el-checkbox-group"),$=p("el-dialog"),ae=p("el-option"),te=p("el-select"),le=p("avue-crud"),w=ce("hasPermi");return d(),L("div",null,[g(le,{ref_key:"crud",ref:v,page:i(O),data:i(A),"table-loading":i(R),option:i(ve),permission:i(M),onOnLoad:o,onRefreshChange:X,onRowUpdate:Q,onRowSave:Z,onRowDel:K,onSortChange:H,onSearchChange:q,onSelectionChange:z},{subscribe:n(l=>[g(u,{size:"small",effect:"dark",type:l.row.subscribe=="1"?"success":l.row.subscribe=="0"?"danger":"warning"},{default:n(()=>[c(E(l.row.$subscribe),1)]),_:2},1032,["type"])]),sex:n(l=>[g(u,{size:"small",effect:"light",type:l.row.sex=="1"?"success":l.row.sex=="2"?"danger":"warning"},{default:n(()=>[c(E(l.row.$sex||"未知"),1)]),_:2},1032,["type"])]),latitude:n(l=>[l.row.longitude?(d(),m(y,{key:0,type:"primary",target:"_blank",href:"https://map.qq.com/?type=marker&isopeninfowin=1&markertype=1&pointx="+l.row.longitude+"&pointy="+l.row.latitude+"&name="+l.row.nickName+"&ref=joolun"},{default:n(()=>[Ce]),_:2},1032,["href"])):U("",!0)]),"menu-left":n(()=>[x((d(),m(f,{type:"success",onClick:t[0]||(t[0]=l=>{_.value=!0,T.value="tagging"}),icon:"el-icon-document"},{default:n(()=>[c("打标签 ")]),_:1})),[[w,["wxmp:wxuser:tagging"]]]),x((d(),m(f,{type:"warning",onClick:t[1]||(t[1]=l=>{_.value=!0,T.value="unTagging"}),icon:"el-icon-document"},{default:n(()=>[c("去除标签 ")]),_:1})),[[w,["wxmp:wxuser:tagging"]]]),x((d(),m(f,{type:"danger",onClick:G,icon:"el-icon-refresh"},{default:n(()=>[c("同步用户 ")]),_:1})),[[w,["wxmp:wxuser:synchro"]]]),g($,{title:i(T)=="tagging"?"请选择要打的标签":"请选择要去除的标签",modelValue:i(_),"onUpdate:modelValue":t[4]||(t[4]=l=>S(_)?_.value=l:null),width:"30%"},{footer:n(()=>[N("span",Te,[g(f,{onClick:t[3]||(t[3]=l=>_.value=!1)},{default:n(()=>[c("取 消")]),_:1}),g(f,{type:"primary",onClick:W},{default:n(()=>[c("确 定")]),_:1})])]),default:n(()=>[g(ee,{modelValue:i(C),"onUpdate:modelValue":t[2]||(t[2]=l=>S(C)?C.value=l:null)},{default:n(()=>[(d(!0),L(B,null,V(i(I),l=>(d(),m(Y,{label:l.id,key:l.id},{default:n(()=>[c(E(l.name),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["title","modelValue"])]),menu:n(l=>[x((d(),m(f,{link:"",icon:"el-icon-edit",type:"primary",plain:"",onClick:b=>J(l.row,l.index)},{default:n(()=>[c("修改备注 ")]),_:2},1032,["onClick"])),[[w,["wxmp:wxuser:edit:remark"]]]),x((d(),m(f,{link:"",icon:"el-icon-chat-line-round",type:"primary",plain:"",onClick:b=>j(l.row,l.index)},{default:n(()=>[c("消息 ")]),_:2},1032,["onClick"])),[[w,["wxmp:wxuser:index"]]])]),tagidListSearch:n(l=>[g(te,{modelValue:l.row.tagidList,"onUpdate:modelValue":b=>l.row.tagidList=b,placeholder:"请选择"},{default:n(()=>[(d(!0),L(B,null,V(i(I),b=>(d(),m(ae,{key:b.id,label:b.name,value:b.id},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:1},8,["page","data","table-loading","option","permission"]),g($,{title:"用户消息",modelValue:i(D),"onUpdate:modelValue":t[5]||(t[5]=l=>S(D)?D.value=l:null),width:"700px"},{default:n(()=>[i(D)?(d(),m(ge,{key:0,wxUserId:i(P)},null,8,["wxUserId"])):U("",!0)]),_:1},8,["modelValue"])])}}});export{Re as default};
